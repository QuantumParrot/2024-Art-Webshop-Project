import{m as b,a as k}from"./pinia@2.1.7_vue@3.4.19-CHKlOEZr.js";import{l as x}from"./alert-dm0RMdUk.js";import{c as g}from"./userCart-BE0r8f0t.js";import{m as f,l as T}from"./@vue_runtime-dom@3.4.19-AC5g8dxk.js";import{_ as w}from"./index-oiU3jX8y.js";import{O as d,P as t,V as p,F as C,ao as S,aJ as h,N as E,c as v,aH as y,aq as N,aj as c,al as V,ak as q}from"./@vue_runtime-core@3.4.19-CGfIweqO.js";import{P as n,n as I}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./sweetalert2@11.10.5-jk-t8Na3.js";import"./@ckeditor_ckeditor5-vue@5.1.0-nhPJMPZe.js";import"./vue@3.4.19-CzIOYL8w.js";import"./axios@1.6.7-Di5RpEPX.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-Bp4gs7Rm.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-Bg5iSJV4.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-eCggCihV.js";import"./vue-router@4.2.5_vue@3.4.19-DxgIm9Z7.js";const L={data(){return{couponCode:"",couponUsed:["text-decoration-line-through","text-secondary"],couponEditable:!0,timer:""}},computed:{...b(x,["loadingTask"]),...b(g,["carts","sum"]),couponLabelText(){return this.loadingTask?"套用中":this.carts[0].coupon&&!this.couponEditable?"已套用優惠券":"套用優惠券"}},watch:{carts:{handler(o){o.length&&o[0].coupon&&(this.couponCode=o[0].coupon.code,this.couponEditable=!1)},deep:!0}},methods:{...k(g,["getCarts","updateCart","deleteSingleCart","clearCart","useCoupon"]),checkCoupon(){this.couponEditable?this.couponEditable&&this.couponCode&&this.useCoupon(this.couponCode):this.couponEditable=!0},changeCartQty(o,e){const l=this.carts.find(m=>m.id===o);Number.isInteger(e)?e<1?l.qty=1:l.qty=e:l.qty=Math.floor(e),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(()=>this.updateCart(l,l.qty),500)}},mounted(){var o;this.getCarts(),(o=this.carts[0])!=null&&o.coupon&&(this.couponCode=this.carts[0].coupon.code)}},i=o=>(V("data-v-1716799a"),o=o(),q(),o),Q={class:"flex-classic mb-5"},U=i(()=>t("span",{class:"text-highlight"},[t("i",{class:"bi bi-caret-left-fill"})],-1)),j={class:"d-flex flex-column gap-3"},z={class:"row align-items-center g-3"},B={class:"col-xl-8 col-lg-7"},D={class:"row align-items-stretch gx-3"},F={class:"col-sm-4"},M={class:"h-100 mask z-0"},P=["src","alt"],A=i(()=>t("div",{class:"z-2 mask-txt text-light fs-3"},[t("i",{class:"bi bi-box-arrow-up-right"})],-1)),H={class:"col-sm-8"},J={class:"h-100 bg-light rounded-0 px-3 py-5 mb-0 d-flex align-items-center"},O={class:"fs-7 text-muted"},G={class:"mb-0"},K={class:"col-xl-4 col-lg-5"},R={class:"flex-classic gap-3"},W={class:"input-group"},X=["disabled","onClick"],Y=i(()=>t("i",{class:"bi bi-dash"},null,-1)),Z=[Y],$=["value","onChange"],tt=["onClick"],ot=i(()=>t("i",{class:"bi bi-plus"},null,-1)),st=[ot],et={class:"w-75 text-end"},it={class:"mb-0"},nt={class:"position-absolute top-0 end-0"},lt=["onClick"],at=i(()=>t("i",{class:"bi bi-x-lg"},null,-1)),dt=[at],ct={class:"py-5 border-bottom-dotted"},rt={class:"row justify-content-end gx-1 gy-5"},ut={class:"col-xl-4 col-lg-5"},pt={class:"input-group"},ht={for:"coupon",class:"input-group-text bg-primary text-white fw-bold"},mt={role:"status",class:"spinner-border spinner-border-sm me-2"},_t=i(()=>t("span",{class:"visually-hidden"},"Loading...",-1)),bt=[_t],gt=["disabled"],ft=["disabled"],Ct={key:0},vt=i(()=>t("b",null,"套用",-1)),yt=[vt],kt={key:1,class:"bi bi-arrow-repeat"},xt={class:"text-end py-5 border-bottom-dotted mb-5"},Tt={key:0,class:"fs-7"},wt={class:"text-danger"},St={class:"fs-5 mb-0"},Et=i(()=>t("span",null,"總計：",-1)),Nt=i(()=>t("span",null,"NT＄",-1)),Vt=["onClick"];function qt(o,e,l,m,r,a){const _=N("router-link");return c(),d(C,null,[t("div",Q,[t("button",{tyoe:"button",class:"btn btn-outline-secondary rounded-1",onClick:e[0]||(e[0]=s=>o.$router.push("/products"))},[U,p(" 繼續購物")]),t("button",{type:"button",class:"btn btn-outline-secondary rounded-1",onClick:e[1]||(e[1]=(...s)=>o.clearCart&&o.clearCart(...s))}," 清空購物車")]),t("div",j,[(c(!0),d(C,null,S(o.carts,s=>(c(),d("div",{key:s,class:"bg-white rounded-1 p-3 position-relative"},[t("div",z,[t("div",B,[t("div",D,[t("div",F,[t("div",M,[v(_,{target:"_blank",to:`/product/${s.product.id}`},{default:y(()=>[t("img",{class:"card-img object-fit-cover",src:s.product.imageUrl,alt:s.product.title},null,8,P),A]),_:2},1032,["to"])])]),t("div",H,[t("div",J,[t("div",null,[t("p",null,[t("b",null,n(s.product.title),1)]),t("p",O,n(s.product.content),1),t("p",G,"單價 NT＄"+n(s.product.price),1)])])])])]),t("div",K,[t("div",R,[t("div",W,[t("button",{type:"button",class:"input-group-text btn btn-primary",disabled:s.qty<=1,onClick:u=>a.changeCartQty(s.id,s.qty-1)},Z,8,X),t("input",{type:"number",class:"form-control py-1 text-center",min:"1",value:s.qty,onChange:u=>a.changeCartQty(s.id,+u.target.value)},null,40,$),t("button",{type:"button",class:"input-group-text btn btn-primary",onClick:u=>a.changeCartQty(s.id,s.qty+1)},st,8,tt)]),t("div",et,[t("p",it,[t("b",null,"NT＄"+n(s.total),1)])])])])]),t("div",nt,[t("button",{type:"button",class:"btn btn-sm btn-remove btn-primary rounded-1 shadow-sm",onClick:u=>o.deleteSingleCart(s.id)},dt,8,lt)])]))),128))]),t("div",ct,[t("div",rt,[t("div",ut,[t("div",pt,[t("label",ht,[h(t("div",mt,bt,512),[[f,!!o.loadingTask]]),p(" "+n(a.couponLabelText),1)]),h(t("input",{id:"coupon",type:"text",class:"form-control","onUpdate:modelValue":e[2]||(e[2]=s=>r.couponCode=s),disabled:o.loadingTask||!r.couponEditable},null,8,gt),[[T,r.couponCode,void 0,{trim:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:e[3]||(e[3]=(...s)=>a.checkCoupon&&a.checkCoupon(...s)),disabled:!!o.loadingTask},[r.couponEditable?(c(),d("span",Ct,yt)):(c(),d("i",kt))],8,ft)])])])]),t("div",xt,[o.carts[0].coupon?(c(),d("p",Tt,[p("折扣了 "),t("span",wt,n(o.sum.total-o.sum.finalTotal),1),p(" 元！ ")])):E("",!0),t("p",St,[Et,Nt,t("span",{class:I(o.sum.finalTotal!==o.sum.total?r.couponUsed:"")},n(o.sum.total),3),h(t("span",{class:"ms-1"},n(o.sum.finalTotal),513),[[f,o.sum.finalTotal!==o.sum.total]])])]),t("div",null,[v(_,{to:"/checkout/form",custom:""},{default:y(({navigate:s})=>[t("button",{type:"button",class:"float-end btn btn-highlight rounded-1",onClick:s}," 下一步",8,Vt)]),_:1})])],64)}const Zt=w(L,[["render",qt],["__scopeId","data-v-1716799a"]]);export{Zt as default};
