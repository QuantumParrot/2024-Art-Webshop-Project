import{a as i}from"./axios@1.6.7-Di5RpEPX.js";import{d as n}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as p,a as m}from"./alert-BXjizhtP.js";import{c as f}from"./userCart-Dyu3INCi.js";var u={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const a=p(),s=m(),h=f(),{VITE_APP_SITE:d,VITE_APP_PATH:l}=u,$=n("userOrder",{state:()=>({order:{},tempOrder:{}}),actions:{getOrder(e,t){a.createLoader("get-single-order"),i.get(`${d}/api/${l}/order/${e}`).then(r=>{const{order:c}=r.data;c!==null?this.order=this.refactorOrder(c):s.toastAlert("查無此訂單","error")}).finally(()=>{typeof t=="function"&&t(),a.removeLoader("get-single-order")})},createOrder(e){const t={message:e.message,project:e.project||"不指定",state:0},r={user:{name:e.name,tel:e.tel,address:e.address,email:e.email},message:JSON.stringify(t)},c={title:"確認送出訂單？",text:"一旦按下確定，即視為交易成立",type:"confirm"};s.checkAlert(c,()=>{a.createLoader("create-order"),i.post(`${d}/api/${l}/order`,{data:r}).then(o=>(s.toastAlert(o.data.message,"success"),i.get(`${d}/api/${l}/order/${o.data.orderId}`))).then(o=>{this.tempOrder=this.refactorOrder(o.data.order),this.router.replace("/checkout/order")}).catch(o=>s.errorAlert(o)).finally(()=>a.removeLoader("create-order"))})},refactorOrder(e){const t=+e.total.toFixed(0);if(e.message.startsWith('{"')){const r=JSON.parse(e.message);return{...e,message:r.message,state:+r.state,project:r.project,total:t}}return{...e,state:e.state||0,project:e.project||"不指定",total:t}},payOrder(e){a.createLoader("pay-order"),i.post(`${d}/api/${l}/pay/${e}`).then(()=>{const t={title:"謝謝您！",text:"我們將立即為您出貨，敬請耐心等待等候！",icon:"success",buttonColor:"#424242"};s.modalAlert(t),h.getCarts(),this.getOrder(e),setTimeout(()=>this.router.push("/"),1500)}).catch(t=>s.errorAlert(t)).finally(()=>a.removeLoader("pay-order"))}}});export{$ as u};
