import{P as N}from"./PaginationComponent-CPEO26-U.js";import{m as V}from"./modal-CDwUaSdC.js";import{m as O,a as w}from"./pinia@2.1.7_vue@3.4.19-CHKlOEZr.js";import{a as f}from"./adminOrder-Ca4-x5Tq.js";import{l as L,a as A}from"./alert-rz954VAU.js";import{m as T,v as I,n as U}from"./@vue_runtime-dom@3.4.19-AC5g8dxk.js";import{_ as S}from"./index-D6-Ga_jm.js";import{aj as r,O as c,P as t,aJ as x,F as u,ao as C,N as g,V as m,al as B,ak as F,c as v,aH as y,aq as k}from"./@vue_runtime-core@3.4.19-CGfIweqO.js";import{P as s,n as _,l as j}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import{D as q}from"./DeleteModal-C09f8YIp.js";import"./bootstrap@5.3.2_@popperjs_core@2.11.8-D5C7Xrhu.js";import"./@ckeditor_ckeditor5-vue@5.1.0-CegNn2NB.js";import"./vue@3.4.19-CdjQKHui.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./@popperjs_core@2.11.8-B-7x2Wgm.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./axios@1.6.7-Di5RpEPX.js";import"./sweetalert2@11.10.5-BCnrvazC.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-Bp4gs7Rm.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-Bg5iSJV4.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-DG0Fkrwv.js";import"./vue-router@4.2.5_vue@3.4.19-DxgIm9Z7.js";const z={mixins:[V],props:["tempOrder"],data(){return{modal:"",tab:"content"}},computed:{...O(f,["statesCode"]),...O(L,["loadingTask"])},methods:{...w(f,["updateOrder"]),...w(A,["checkAlert"]),preUpdate(e){const o=+e.target.value,l={code:o,order:this.tempOrder},b=()=>{this.updateOrder(l,this.hideModal)};if(o===4){const n={title:"確定完成訂單？",text:"提醒您，完成訂單之後就無法修改狀態囉！"};this.checkAlert(n,b,()=>{e.target.value=this.tempOrder.state})}else b()}}},a=e=>(B("data-v-68b4fc2c"),e=e(),F(),e),E={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},H={class:"modal-dialog modal-dialog-centered"},J={class:"modal-content"},G={class:"modal-header"},K={class:"fs-5 mb-0"},Q=["disabled"],R=a(()=>t("i",{class:"bi bi-x-circle-fill"},null,-1)),W=[R],X={class:"modal-body py-4"},Y={class:"nav nav-pills bg-gray rounded-2 mb-3"},Z={class:"nav-item flex-grow-1"},tt={class:"nav-item flex-grow-1"},et={class:"table table-light align-middle"},st={class:"text-end"},ot={class:"flex-classic"},lt=a(()=>t("span",null,"NT＄",-1)),nt={key:0},at={colspan:"2",class:"fs-7"},dt={class:"flex-classic"},it=a(()=>t("span",null,"NT＄",-1)),rt={class:"fs-5 fw-bold"},ct=a(()=>t("td",{colspan:"2",class:"py-3"},"總計",-1)),mt={class:"text-end"},pt={class:"mb-0"},_t=a(()=>t("span",null,"付款狀態：",-1)),ut=a(()=>t("span",{class:"badge bg-primary me-2"},"訂單成立日期",-1)),ht=a(()=>t("hr",null,null,-1)),bt=a(()=>t("span",{class:"badge bg-primary me-2"},"姓名",-1)),gt=a(()=>t("hr",null,null,-1)),ft=a(()=>t("span",{class:"badge bg-primary me-2"},"電話",-1)),vt=a(()=>t("hr",null,null,-1)),yt=a(()=>t("p",null,[t("span",{class:"badge bg-primary"},"地址")],-1)),kt=a(()=>t("hr",null,null,-1)),Ot=a(()=>t("p",null,[t("span",{class:"badge bg-primary"},"信箱")],-1)),wt=a(()=>t("hr",null,null,-1)),xt=a(()=>t("p",null,[t("span",{class:"badge bg-primary"},"贊助計畫")],-1)),Ct=a(()=>t("hr",null,null,-1)),Mt=a(()=>t("p",null,[t("span",{class:"badge bg-primary"},"留言")],-1)),Pt={class:"pre-wrap mb-0"},Tt={key:0,class:"modal-footer"},St={class:"alert bg-gray d-flex align-items-center gap-3 text-nowrap mb-0"},$t={class:"d-flex align-items-center"},Dt={key:0,class:"spinner-border text-primary me-3",role:"status"},Nt=a(()=>t("span",null,"修改訂單狀態",-1)),Vt=["value","disabled"],Lt=["value"];function At(e,o,l,b,n,h){return r(),c("div",E,[t("div",H,[t("div",J,[t("div",G,[t("h4",K,s(l.tempOrder.id),1),t("button",{type:"button",class:"btn border-0 p-0 fs-4",disabled:!!e.loadingTask,onClick:o[0]||(o[0]=(...d)=>e.hideModal&&e.hideModal(...d))},W,8,Q)]),t("div",X,[t("ul",Y,[t("li",Z,[t("button",{type:"button",onClick:o[1]||(o[1]=d=>n.tab="content"),class:_(["w-100 nav-link",{active:n.tab==="content"}])}," 訂購商品",2)]),t("li",tt,[t("button",{type:"button",onClick:o[2]||(o[2]=d=>n.tab="info"),class:_(["w-100 nav-link",{active:n.tab==="info"}])}," 客戶資訊",2)])]),x(t("div",null,[t("table",et,[t("tbody",null,[(r(!0),c(u,null,C(l.tempOrder.products,(d,p)=>(r(),c(u,{key:p},[t("tr",null,[t("td",null,s(d.product.title),1),t("td",null,"× "+s(d.qty)+" "+s(d.product.unit),1),t("td",st,[t("div",ot,[lt,t("span",{class:_({"text-decoration-line-through":d.coupon})},s(d.total),3)])])]),d.coupon?(r(),c("tr",nt,[t("td",at,"優惠券："+s(d.coupon.code),1),t("td",null,[t("div",dt,[it,t("span",null,[t("b",null,s(d.final_total),1)])])])])):g("",!0)],64))),128))]),t("tfoot",rt,[t("tr",null,[ct,t("td",mt,"NT＄"+s(l.tempOrder.total),1)])])]),t("p",pt,[_t,t("span",{class:_(l.tempOrder.is_paid?"text-success":"text-danger")},s(l.tempOrder.is_paid?"已付款":"未付款"),3)])],512),[[T,n.tab==="content"]]),x(t("div",null,[t("p",null,[ut,m(" "+s(e.$calc.formatTime(l.tempOrder.create_at*1e3)),1)]),ht,t("p",null,[bt,m(" "+s(l.tempOrder.user.name),1)]),gt,t("p",null,[ft,m(" "+s(l.tempOrder.user.tel),1)]),vt,yt,t("p",null,s(l.tempOrder.user.address),1),kt,Ot,t("p",null,s(l.tempOrder.user.email),1),wt,xt,t("p",null,s(l.tempOrder.project),1),Ct,Mt,t("p",Pt,s(l.tempOrder.message),1)],512),[[T,n.tab==="info"]])]),l.tempOrder.is_paid&&l.tempOrder.state!==4?(r(),c("div",Tt,[t("div",St,[t("div",$t,[e.loadingTask===l.tempOrder.id?(r(),c("div",Dt)):g("",!0),Nt]),t("select",{class:"form-select",value:l.tempOrder.state,onChange:o[3]||(o[3]=(...d)=>h.preUpdate&&h.preUpdate(...d)),disabled:!!e.loadingTask},[(r(!0),c(u,null,C(e.statesCode,(d,p)=>(r(),c("option",{key:p,value:p},s(d.title),9,Lt))),128))],40,Vt)])])):g("",!0)])])],512)}const It=S(z,[["render",At],["__scopeId","data-v-68b4fc2c"]]),Ut={components:{PaginationComponent:N,AdminOrderModal:It,DeleteModal:q},data(){return{tempOrder:{user:{},products:{}},deletePermission:!1}},computed:{...O(f,["ordersList","statesCode","currentPage","totalPages"])},methods:{...w(f,["getOrders","switchPage","deleteOrder","downTheDrain"]),openModal(e,o){this.tempOrder={...e,total:+e.total.toFixed(0)},o==="check"?this.$refs.orderModal.showModal():this.$refs.deleteModal.showModal()}},mounted(){this.ordersList.length||this.getOrders()}},Bt={class:"text-end mb-7"},Ft=t("h3",{class:"fs-2 mb-2"},"訂單管理",-1),jt={class:"text-muted"},qt={class:"alert bg-gray flex-classic mb-5"},zt={class:"d-flex gap-2"},Et={for:"unlock",class:"btn btn-outline-primary"},Ht={class:"table-responsive"},Jt={class:"table table-hover text-nowrap"},Gt=t("thead",null,[t("tr",null,[t("th",{scope:"col",width:"10%"},"日期"),t("th",{scope:"col",width:"40%"},"訂單"),t("th",{scope:"col",width:"30%",class:"d-none d-md-table-cell text-end"},"總額"),t("th",{scope:"col",width:"15%",class:"text-center"},"狀態"),t("th",{scope:"col",class:"text-center"},"刪除")])],-1),Kt={class:"align-middle"},Qt=["onClick"],Rt={class:"me-2"},Wt=t("i",{class:"bi bi-search"},null,-1),Xt={class:"d-none d-md-table-cell text-end"},Yt={class:"text-center fw-bold"},Zt={class:"text-end"},te=["disabled","onClick"],ee=t("i",{class:"bi bi-trash3-fill"},null,-1),se=[ee],oe={key:1,class:"alert bg-gray"},le={class:"mb-4"},ne={class:"text-muted"},ae={class:"mt-3"},de=t("b",null,"客戶姓名",-1),ie=t("b",null,"訂單總額",-1);function re(e,o,l,b,n,h){const d=k("pagination-component"),p=k("admin-order-modal"),$=k("delete-modal");return r(),c(u,null,[t("div",Bt,[Ft,t("p",jt,"目前共有 "+s(e.ordersList.length)+" 筆訂單",1)]),e.ordersList.length?(r(),c(u,{key:0},[t("div",qt,[t("div",zt,[x(t("input",{type:"checkbox",id:"unlock",class:"btn-check","onUpdate:modelValue":o[0]||(o[0]=i=>n.deletePermission=i)},null,512),[[I,n.deletePermission]]),t("label",Et,[t("i",{class:_(["bi",n.deletePermission?"bi-unlock-fill":"bi-lock-fill"])},null,2)]),n.deletePermission?(r(),c("button",{key:0,type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=(...i)=>e.downTheDrain&&e.downTheDrain(...i))},"刪除所有訂單")):g("",!0)]),v(d,{current:e.currentPage,total:e.totalPages,onSwitchPage:e.switchPage},null,8,["current","total","onSwitchPage"])]),t("div",Ht,[t("table",Jt,[Gt,t("tbody",Kt,[(r(!0),c(u,null,C(e.ordersList,i=>{var M,P;return r(),c("tr",{key:i.id},[t("td",null,s(e.$calc.formatDate(i.create_at*1e3,"/")),1),t("td",null,[t("span",{class:_(["badge me-3",i.is_paid?"bg-success":"bg-danger"])},s(i.is_paid?"已付款":"未付款"),3),t("a",{href:"#",onClick:U(D=>h.openModal(i,"check"),["prevent"])},[t("span",Rt,s(i.user.name),1),Wt],8,Qt)]),t("td",Xt,"NT$ "+s(i.total),1),t("td",Yt,[t("span",{style:j({color:(M=e.statesCode[i.state||0])==null?void 0:M.color})},s((P=e.statesCode[i.state||0])==null?void 0:P.title),5)]),t("td",Zt,[t("button",{type:"button",class:"btn btn-outline-danger",disabled:!n.deletePermission,onClick:D=>h.openModal(i,"delete")},se,8,te)])])}),128))])])])],64)):(r(),c("div",oe,"沒有訂單記錄")),v(p,{ref:"orderModal","temp-order":n.tempOrder},null,8,["temp-order"]),v($,{ref:"deleteModal",onDeleteTarget:o[2]||(o[2]=i=>e.deleteOrder(n.tempOrder.id,this.$refs.deleteModal.hideModal))},{title:y(()=>[m("確定刪除訂單！？")]),alert:y(()=>[m("這是客人的訂單欸！你要確定欸！(ﾟдﾟ≡ﾟдﾟ)")]),itemDetail:y(()=>[t("details",le,[t("summary",null,[m("訂單編號："),t("span",ne,s(n.tempOrder.id),1)]),t("p",ae,[de,m("："+s(n.tempOrder.user.name),1)]),t("p",null,[ie,m("：NT$ "+s(n.tempOrder.total),1)])])]),_:1},512)],64)}const Ie=S(Ut,[["render",re]]);export{Ie as default};
