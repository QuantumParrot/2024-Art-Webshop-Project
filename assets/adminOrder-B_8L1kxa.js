import{a as l}from"./axios@1.6.7-Di5RpEPX.js";import{d as m}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as f,a as g}from"./alert-Dw2Xe9FX.js";var u={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:d,VITE_APP_PATH:n}=u,o=f(),i=g(),$=m("adminOrder",{state:()=>({orders:[],statesCode:{0:{title:"未確認款項",color:"#c62828"},1:{title:"已確認款項",color:"#ff6f00"},2:{title:"安排出貨中",color:"#1565c0"},3:{title:"商品配送中",color:"#00838f"},4:{title:"訂單已完成",color:"#388e3c"}},currentPage:1,orderState:5,isPaid:2,timeAscending:0}),getters:{refactorOrders:({orders:e})=>e.map(t=>{if(t.message.startsWith('{"')&&t.message.endsWith("}")){const a=JSON.parse(t.message);return{...t,message:a.message||"無",project:a.project,state:parseInt(a.state,10),total:parseInt(t.total.toFixed(0),10)}}return{...t,project:t.project||"不指定",state:t.state||0,total:parseInt(t.total.toFixed(0),10)}}),stateOptions:({isPaid:e})=>e!==0?[0,1,2,3,4]:[],filterOrders:({refactorOrders:e,isPaid:t,orderState:a})=>{let r=t===2?e:e.filter(s=>s.is_paid===!!t);return r=a===5?r:r.filter(s=>s.state===a),r},displaying:({filterOrders:e,currentPage:t,timeAscending:a})=>(e.sort((r,s)=>a?r.create_at-s.create_at:s.create_at-r.create_at),e.filter((r,s)=>Math.floor(s/10)+1===t)),totalPages:({filterOrders:e})=>Math.ceil(e.length/10)},actions:{switchPage(e){this.currentPage=e},resetOrders(){this.totalOrderList.length=0},getOrders(e=1){const t=`${d}/api/${n}/admin/orders?page=`;let a=[];o.createLoader("get-orders"),l.get(`${t}${e}`).then(r=>{const{orders:s,pagination:p}=r.data;if(a=s,p.total_pages>1){const h=[];for(let c=2;c<=p.total_pages;c+=1)h.push(l.get(`${t}${c}`));return Promise.all(h)}return!1}).then(r=>{Array.isArray(r)&&r.forEach(s=>a.push(...s.data.orders)),this.orders=a}).catch(r=>i.errorAlert(r)).finally(()=>o.removeLoader("get-orders"))},updateOrder(e,t){const{code:a,order:r}=e;o.setLoader(r.id),l.put(`${d}/api/${n}/admin/order/${r.id}`,{data:{...r,state:Number(a)}}).then(s=>{i.toastAlert(s.data.message,"success"),t(),this.getOrders()}).catch(s=>i.errorAlert(s)).finally(()=>o.setLoader(""))},deleteOrder(e,t){o.createLoader("delete-order"),l.delete(`${d}/api/${n}/admin/order/${e}`).then(()=>{i.toastAlert("我們懷念它 (´;ω;`)","success"),t(),this.getOrders()}).catch(a=>i.errorAlert(a)).finally(()=>o.removeLoader("delete-order"))},downTheDrain(){i.multiverseAlert(()=>{o.createLoader("tan-tiau"),l.delete(`${d}/api/${n}/admin/orders/all`).then(()=>{i.toastAlert("沒了 ... 都沒了 (´;ω;`)","success"),this.getOrders()}).catch(e=>i.errorAlert(e)).finally(()=>o.removeLoader("tan-tiau"))})},switchFilter(e,t){this[e]=t}}});export{$ as a};
