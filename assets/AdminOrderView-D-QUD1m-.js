import{c as V}from"./calculator-CHDHV-Nf.js";import{m as E,P as I}from"./modal-DpdsW0t1.js";import{h as N}from"./moment-Cl4UOzQZ.js";import{i as B,j as g,m as T,_ as S,o as i,b as c,e,t as s,n as p,k as M,v as $,F as O,l as x,h as _,f as D,p as H,g as Y,a as R,s as j,d as k,w as y,r as w,u as F}from"./index-C9uzhFc_.js";import{u as U,a as q}from"./alert-zZOFHmEP.js";import{D as z}from"./DeleteModal-ClDC_XhV.js";var W={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:f,VITE_APP_PATH:v}=W,u=U(),m=q(),A=B("adminOrder",{state:()=>({orders:[],currentPage:1}),getters:{totalPages:({orders:t})=>Math.ceil(t.length/5)},actions:{switchPage(t){this.currentPage=t},getOrders(){u.createLoader("get-orders"),g.get(`${f}/api/${v}/admin/orders`).then(t=>{this.orders=t.data.orders,this.switchPage(1)}).catch(t=>m.errorAlert(t)).finally(()=>u.removeLoader("get-orders"))},updateOrder(t,o){const l={title:"確定結單？",text:"提醒您，送出後即無法修改訂單狀態囉！"};m.checkAlert(l,()=>{u.createLoader("update-order"),g.put(`${f}/api/${v}/admin/order/${t.id}`,{data:{...t,is_paid:!t.is_paid}}).then(h=>{m.toastAlert(h.data.message,"success"),o(),this.getOrders()}).catch(h=>m.errorAlert(h)).finally(()=>u.removeLoader("update-order"))})},deleteOrder(t,o){u.createLoader("delete-order"),g.delete(`${f}/api/${v}/admin/order/${t}`).then(()=>{m.toastAlert("我們懷念它 (´;ω;`)","success"),o(),this.getOrders()}).catch(l=>m.errorAlert(l)).finally(()=>u.removeLoader("delete-order"))},downTheDrain(){m.multiverseAlert(()=>{u.createLoader("tan-tiau"),g.delete(`${f}/api/${v}/admin/orders/all`).then(()=>{m.toastAlert("沒了 ... 都沒了 (´;ω;`)","success"),this.getOrders()}).catch(t=>m.errorAlert(t)).finally(()=>u.removeLoader("tan-tiau"))})}}}),G={mixins:[E],props:["tempOrder"],data(){return{modal:"",tab:"content"}},methods:{...T(A,["updateOrder"]),formatTime(t){return N(t).format("YYYY/MM/DD HH:mm:ss")}}},a=t=>(H("data-v-f88974d7"),t=t(),Y(),t),J={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},K={class:"modal-dialog modal-dialog-centered"},Q={class:"modal-content"},X={class:"modal-header"},Z={class:"fs-5 mb-0"},ee=a(()=>e("i",{class:"bi bi-x-circle-fill"},null,-1)),te=[ee],se={class:"modal-body py-4"},oe={class:"nav nav-pills bg-light rounded-2 mb-3"},le={class:"nav-item flex-grow-1"},ne={class:"nav-item flex-grow-1"},re={class:"table table-light"},ae={class:"text-end"},de={class:"fs-5 fw-bold"},ie=a(()=>e("td",{colspan:"2"},"總計",-1)),ce={class:"text-end"},me={class:"mb-0"},ue=a(()=>e("span",null,"付款狀態：",-1)),_e=a(()=>e("span",{class:"badge bg-primary me-2"},"訂單成立日期",-1)),he=a(()=>e("hr",null,null,-1)),pe=a(()=>e("span",{class:"badge bg-primary me-2"},"姓名",-1)),be=a(()=>e("hr",null,null,-1)),ge=a(()=>e("span",{class:"badge bg-primary me-2"},"電話",-1)),fe=a(()=>e("hr",null,null,-1)),ve=a(()=>e("p",null,[e("span",{class:"badge bg-primary"},"地址")],-1)),Oe=a(()=>e("hr",null,null,-1)),Pe=a(()=>e("p",null,[e("span",{class:"badge bg-primary"},"信箱")],-1)),ke=a(()=>e("hr",null,null,-1)),ye=a(()=>e("p",null,[e("span",{class:"badge bg-primary"},"留言")],-1)),we={class:"pre-wrap mb-0"},Me={key:0,class:"modal-footer"};function Ae(t,o,l,h,n,b){return i(),c("div",J,[e("div",K,[e("div",Q,[e("div",X,[e("h4",Z,s(l.tempOrder.id),1),e("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:o[0]||(o[0]=(...d)=>t.hideModal&&t.hideModal(...d))},te)]),e("div",se,[e("ul",oe,[e("li",le,[e("button",{type:"button",onClick:o[1]||(o[1]=d=>n.tab="content"),class:p(["w-100 nav-link",{active:n.tab==="content"}])}," 訂購商品",2)]),e("li",ne,[e("button",{type:"button",onClick:o[2]||(o[2]=d=>n.tab="info"),class:p(["w-100 nav-link",{active:n.tab==="info"}])}," 客戶資訊",2)])]),M(e("div",null,[e("table",re,[e("tbody",null,[(i(!0),c(O,null,x(l.tempOrder.products,(d,P)=>(i(),c("tr",{key:P},[e("td",null,s(d.product.title),1),e("td",null,"× "+s(d.qty)+" "+s(d.product.unit),1),e("td",ae,"NT$ "+s(d.total),1)]))),128))]),e("tfoot",de,[e("tr",null,[ie,e("td",ce,"NT$ "+s(l.tempOrder.total),1)])])]),e("p",me,[ue,e("span",{class:p(l.tempOrder.is_paid?"text-success":"text-danger")},s(l.tempOrder.is_paid?"已付款":"未付款"),3)])],512),[[$,n.tab==="content"]]),M(e("div",null,[e("p",null,[_e,_(" "+s(b.formatTime(l.tempOrder.create_at*1e3)),1)]),he,e("p",null,[pe,_(" "+s(l.tempOrder.user.name),1)]),be,e("p",null,[ge,_(" "+s(l.tempOrder.user.tel),1)]),fe,ve,e("p",null,s(l.tempOrder.user.address),1),Oe,Pe,e("p",null,s(l.tempOrder.user.email),1),ke,ye,e("p",we,s(l.tempOrder.message),1)],512),[[$,n.tab==="info"]])]),l.tempOrder.is_paid?D("",!0):(i(),c("div",Me,[e("button",{type:"button",class:"btn btn-highlight",onClick:o[3]||(o[3]=d=>t.updateOrder(l.tempOrder,t.hideModal))}," 確認結單")]))])])],512)}const $e=S(G,[["render",Ae],["__scopeId","data-v-f88974d7"]]),Te={mixins:[V],components:{PaginationComponent:I,AdminOrderModal:$e,DeleteModal:z},data(){return{tempOrder:{user:{},products:{}},deletePermission:!1}},computed:{...R(A,["orders","currentPage","totalPages"])},methods:{...T(A,["getOrders","switchPage","deleteOrder","downTheDrain"]),openModal(t,o){this.tempOrder={...t},o==="check"?this.$refs.orderModal.showModal():this.$refs.deleteModal.showModal()}},mounted(){this.getOrders()}},Se={class:"text-end mb-7"},xe=e("h3",{class:"fs-2 mb-2"},"訂單管理",-1),De={class:"fs-6 text-muted"},Ce={class:"alert bg-light flex-classic mb-5"},Le={class:"d-flex gap-2"},Ve={for:"unlock",class:"btn btn-outline-primary"},Ee={class:"table table-hover text-nowrap"},Ie=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"10%"}),e("th",{scope:"col",width:"40%"}),e("th",{scope:"col",width:"40%",class:"d-none d-md-table-cell text-end"}),e("th",{scope:"col",width:"10%"})])],-1),Ne={class:"align-middle"},Be=["onClick"],He={class:"me-2"},Ye=e("i",{class:"bi bi-search"},null,-1),Re={class:"d-none d-md-table-cell text-end"},je={class:"text-end"},Fe=["disabled","onClick"],Ue={key:1,class:"alert bg-light"},qe={class:"mb-4"},ze={class:"text-muted"},We={class:"mt-3"},Ge=e("b",null,"客戶姓名",-1),Je=e("b",null,"訂單總額",-1);function Ke(t,o,l,h,n,b){const d=w("pagination-component"),P=w("admin-order-modal"),C=w("delete-modal");return i(),c(O,null,[e("div",Se,[xe,e("p",De,[e("span",null,"目前共有 "+s(t.orders.length)+" 筆訂單，",1),e("span",null,"尚有 "+s(t.orders.filter(r=>!r.is_paid).length)+" 筆未結單",1)])]),t.orders.length?(i(),c(O,{key:0},[e("div",Ce,[e("div",Le,[M(e("input",{type:"checkbox",id:"unlock",class:"btn-check","onUpdate:modelValue":o[0]||(o[0]=r=>n.deletePermission=r)},null,512),[[j,n.deletePermission]]),e("label",Ve,[e("i",{class:p(["bi",n.deletePermission?"bi-unlock-fill":"bi-lock-fill"])},null,2)]),n.deletePermission?(i(),c("button",{key:0,type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=(...r)=>t.downTheDrain&&t.downTheDrain(...r))},"刪除所有訂單")):D("",!0)]),k(d,{current:t.currentPage,total:t.totalPages,onSwitchPage:t.switchPage},null,8,["current","total","onSwitchPage"])]),e("table",Ee,[Ie,e("tbody",Ne,[(i(!0),c(O,null,x(t.orders,r=>(i(),c("tr",{key:r.id},[e("td",null,s(t.formatDate(r.create_at*1e3,"/")),1),e("td",null,[e("span",{class:p(["badge me-3",r.is_paid?"bg-success":"bg-danger"])},s(r.is_paid?"已結單":"未結單"),3),e("a",{href:"#",onClick:F(L=>b.openModal(r,"check"),["prevent"])},[e("span",He,s(r.user.name),1),Ye],8,Be)]),e("td",Re,"NT$ "+s(r.total),1),e("td",je,[e("button",{type:"button",class:"btn btn-outline-danger",disabled:!n.deletePermission,onClick:L=>b.openModal(r,"delete")}," 刪除",8,Fe)])]))),128))])])],64)):(i(),c("div",Ue,"沒有訂單記錄")),k(P,{ref:"orderModal","temp-order":n.tempOrder},null,8,["temp-order"]),k(C,{ref:"deleteModal",onDeleteTarget:o[2]||(o[2]=r=>t.deleteOrder(n.tempOrder))},{title:y(()=>[_("確定刪除訂單！？")]),alert:y(()=>[_("這是客人的訂單欸！你要確定欸！(ﾟдﾟ≡ﾟдﾟ)")]),itemDetail:y(()=>[e("details",qe,[e("summary",null,[_("訂單編號："),e("span",ze,s(n.tempOrder.id),1)]),e("p",We,[Ge,_("："+s(n.tempOrder.user.name),1)]),e("p",null,[Je,_("：NT$ "+s(n.tempOrder.total),1)])])]),_:1},512)],64)}const ot=S(Te,[["render",Ke]]);export{ot as default};
