import{C as P,P as g,i as p}from"./@ckeditor_ckeditor5-core@41.1.0-D0yh88O_.js";import{n as x,h as N,F as z,O as K,e as $,q,U as D,K as H}from"./@ckeditor_ckeditor5-utils@41.1.0-Cn-yVoWx.js";import{h as G}from"./@ckeditor_ckeditor5-engine@41.1.0-CtehaBhy.js";import{f as v,a as E,I as W,i as X,D as j,b as J,g as Y}from"./@ckeditor_ckeditor5-typing@41.1.0-DSIargVI.js";import{a as Q}from"./@ckeditor_ckeditor5-clipboard@41.1.0-p8v1EZ-3.js";import{i as Z}from"./@ckeditor_ckeditor5-widget@41.1.0-DVCYQBVz.js";import{V as _,e as R,F,s as ee,L as te,h as ie,B as k,i as ne,j as y,k as se,l as oe}from"./@ckeditor_ckeditor5-ui@41.1.0-D8zEL7-J.js";import"./color-convert@2.0.1-CFYumGoF.js";import{n as re}from"./lodash-es@4.17.21-C5qYGfgy.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae{constructor(){this._definitions=new Set}get length(){return this._definitions.size}add(e){Array.isArray(e)?e.forEach(t=>this._definitions.add(t)):this._definitions.add(e)}getDispatcher(){return e=>{e.on("attribute:linkHref",(t,n,i)=>{if(!i.consumable.test(n.item,"attribute:linkHref")||!(n.item.is("selection")||i.schema.isInline(n.item)))return;const s=i.writer,a=s.document.selection;for(const o of this._definitions){const l=s.createAttributeElement("a",o.attributes,{priority:5});o.classes&&s.addClass(o.classes,l);for(const u in o.styles)s.setStyle(u,o.styles[u],l);s.setCustomProperty("link",!0,l),o.callback(n.attributeNewValue)?n.item.is("selection")?s.wrap(a.getFirstRange(),l):s.wrap(i.mapper.toViewRange(n.range),l):s.unwrap(i.mapper.toViewRange(n.range),l)}},{priority:"high"})}}getDispatcherForLinkedImage(){return e=>{e.on("attribute:linkHref:imageBlock",(t,n,{writer:i,mapper:s})=>{const a=s.toViewElement(n.item),o=Array.from(a.getChildren()).find(l=>l.is("element","a"));for(const l of this._definitions){const u=x(l.attributes);if(l.callback(n.attributeNewValue)){for(const[c,d]of u)c==="class"?i.addClass(d,o):i.setAttribute(c,d,o);l.classes&&i.addClass(l.classes,o);for(const c in l.styles)i.setStyle(c,l.styles[c],o)}else{for(const[c,d]of u)c==="class"?i.removeClass(d,o):i.removeAttribute(c,o);l.classes&&i.removeClass(l.classes,o);for(const c in l.styles)i.removeStyle(c,o)}}})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const le=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,ce=/^(?:(?:https?|ftps?|mailto):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))/i,ue=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,de=/^((\w+:(\/{2,})?)|(\W))/i,b="Ctrl+K";function he(r){return r.is("attributeElement")&&!!r.getCustomProperty("link")}function T(r,{writer:e}){const t=e.createAttributeElement("a",{href:r},{priority:5});return e.setCustomProperty("link",!0,t),t}function B(r){const e=String(r);return me(e)?e:"#"}function me(r){return!!r.replace(le,"").match(ce)}function fe(r,e){const t={"Open in a new tab":r("Open in a new tab"),Downloadable:r("Downloadable")};return e.forEach(n=>("label"in n&&t[n.label]&&(n.label=t[n.label]),n)),e}function ke(r){const e=[];if(r)for(const[t,n]of Object.entries(r)){const i=Object.assign({},n,{id:`link${re(t)}`});e.push(i)}return e}function V(r,e){return r?e.checkAttribute(r.name,"linkHref"):!1}function ge(r){return ue.test(r)}function A(r,e){const t=ge(r)?"mailto:":e,n=!!t&&!U(r);return r&&n?t+r:r}function U(r){return de.test(r)}function L(r){window.open(r,"_blank","noopener")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class be extends P{constructor(){super(...arguments),this.manualDecorators=new N,this.automaticDecorators=new ae}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement()||z(t.getSelectedBlocks());V(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=t.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref"));for(const i of this.manualDecorators)i.value=this._getDecoratorStateFromModel(i.id)}execute(e,t={}){const n=this.editor.model,i=n.document.selection,s=[],a=[];for(const o in t)t[o]?s.push(o):a.push(o);n.change(o=>{if(i.isCollapsed){const l=i.getFirstPosition();if(i.hasAttribute("linkHref")){const u=S(i);let c=v(l,"linkHref",i.getAttribute("linkHref"),n);i.getAttribute("linkHref")===u&&(c=this._updateLinkContent(n,o,c,e)),o.setAttribute("linkHref",e,c),s.forEach(d=>{o.setAttribute(d,!0,c)}),a.forEach(d=>{o.removeAttribute(d,c)}),o.setSelection(o.createPositionAfter(c.end.nodeBefore))}else if(e!==""){const u=x(i.getAttributes());u.set("linkHref",e),s.forEach(d=>{u.set(d,!0)});const{end:c}=n.insertContent(o.createText(e,u),l);o.setSelection(c)}["linkHref",...s,...a].forEach(u=>{o.removeSelectionAttribute(u)})}else{const l=n.schema.getValidRanges(i.getRanges(),"linkHref"),u=[];for(const d of i.getSelectedBlocks())n.schema.checkAttribute(d,"linkHref")&&u.push(o.createRangeOn(d));const c=u.slice();for(const d of l)this._isRangeToUpdate(d,u)&&c.push(d);for(const d of c){let m=d;if(c.length===1){const f=S(i);i.getAttribute("linkHref")===f&&(m=this._updateLinkContent(n,o,d,e),o.setSelection(o.createSelection(m)))}o.setAttribute("linkHref",e,m),s.forEach(f=>{o.setAttribute(f,!0,m)}),a.forEach(f=>{o.removeAttribute(f,m)})}}})}_getDecoratorStateFromModel(e){const t=this.editor.model,n=t.document.selection,i=n.getSelectedElement();return V(i,t.schema)?i.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,t){for(const n of t)if(n.containsRange(e))return!1;return!0}_updateLinkContent(e,t,n,i){const s=t.createText(i,{linkHref:i});return e.insertContent(s,n)}}function S(r){if(r.isCollapsed){const e=r.getFirstPosition();return e.textNode&&e.textNode.data}else{const e=Array.from(r.getFirstRange().getItems());if(e.length>1)return null;const t=e[0];return t.is("$text")||t.is("$textProxy")?t.data:null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class we extends P{refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement();V(n,e.schema)?this.isEnabled=e.schema.checkAttribute(n,"linkHref"):this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref")}execute(){const e=this.editor,t=this.editor.model,n=t.document.selection,i=e.commands.get("link");t.change(s=>{const a=n.isCollapsed?[v(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),t)]:t.schema.getValidRanges(n.getRanges(),"linkHref");for(const o of a)if(s.removeAttribute("linkHref",o),i)for(const l of i.manualDecorators)s.removeAttribute(l.id,o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pe extends K(){constructor({id:e,label:t,attributes:n,classes:i,styles:s,defaultValue:a}){super(),this.id=e,this.set("value",void 0),this.defaultValue=a,this.label=t,this.attributes=n,this.classes=i,this.styles=s}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const _e="ck-link_selected",I="automatic",Ve="manual",ve=/^(https?:)?\/\//;class O extends g{static get pluginName(){return"LinkEditing"}static get requires(){return[E,W,Q]}constructor(e){super(e),e.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:"linkHref"}),e.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:T}),e.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(i,s)=>T(B(i),s)}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:i=>i.getAttribute("href")}}),e.commands.add("link",new be(e)),e.commands.add("unlink",new we(e));const t=fe(e.t,ke(e.config.get("link.decorators")));this._enableAutomaticDecorators(t.filter(i=>i.mode===I)),this._enableManualDecorators(t.filter(i=>i.mode===Ve)),e.plugins.get(E).registerAttribute("linkHref"),X(e,"linkHref","a",_e),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(e){const t=this.editor,i=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&i.add({id:"linkIsExternal",mode:I,callback:s=>!!s&&ve.test(s),attributes:{target:"_blank",rel:"noopener noreferrer"}}),i.add(e),i.length&&t.conversion.for("downcast").add(i.getDispatcher())}_enableManualDecorators(e){if(!e.length)return;const t=this.editor,i=t.commands.get("link").manualDecorators;e.forEach(s=>{t.model.schema.extend("$text",{allowAttributes:s.id});const a=new pe(s);i.add(a),t.conversion.for("downcast").attributeToElement({model:a.id,view:(o,{writer:l,schema:u},{item:c})=>{if((c.is("selection")||u.isInline(c))&&o){const d=l.createAttributeElement("a",a.attributes,{priority:5});a.classes&&l.addClass(a.classes,d);for(const m in a.styles)l.setStyle(m,a.styles[m],d);return l.setCustomProperty("link",!0,d),d}}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",...a._createPattern()},model:{key:a.id}})})}_enableLinkOpen(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"click",(i,s)=>{if(!($.isMac?s.domEvent.metaKey:s.domEvent.ctrlKey))return;let o=s.domTarget;if(o.tagName.toLowerCase()!="a"&&(o=o.closest("a")),!o)return;const l=o.getAttribute("href");l&&(i.stop(),s.preventDefault(),L(l))},{context:"$capture"}),this.listenTo(n,"keydown",(i,s)=>{const o=e.commands.get("link").value;o&&s.keyCode===q.enter&&s.altKey&&(i.stop(),L(o))})}_enableSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection;this.listenTo(n,"change:attribute",(i,{attributeKeys:s})=>{!s.includes("linkHref")||n.hasAttribute("linkHref")||t.change(a=>{Ae(a,Ee(t.schema))})})}_enableClipboardIntegration(){const e=this.editor,t=e.model,n=this.editor.config.get("link.defaultProtocol");n&&this.listenTo(e.plugins.get("ClipboardPipeline"),"contentInsertion",(i,s)=>{t.change(a=>{const o=a.createRangeIn(s.content);for(const l of o.getItems())if(l.hasAttribute("linkHref")){const u=A(l.getAttribute("linkHref"),n);a.setAttribute("linkHref",u,l)}})})}}function Ae(r,e){r.removeSelectionAttribute("linkHref");for(const t of e)r.removeSelectionAttribute(t)}function Ee(r){return r.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ye extends _{constructor(e,t){super(e),this.focusTracker=new D,this.keystrokes=new H,this._focusables=new R;const n=e.t;this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),p.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),p.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(t),this.children=this._createFormChildren(t.manualDecorators),this._focusCycler=new F({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const i=["ck","ck-link-form","ck-responsive-form"];t.manualDecorators.length&&i.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:i,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,t)=>(e[t.name]=t.isOn,e),{})}render(){super.render(),ee({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createUrlInput(){const e=this.locale.t,t=new te(this.locale,ie);return t.label=e("Link URL"),t}_createButton(e,t,n,i){const s=new k(this.locale);return s.set({label:e,icon:t,tooltip:!0}),s.extendTemplate({attributes:{class:n}}),i&&s.delegate("execute").to(this,i),s}_createManualDecoratorSwitches(e){const t=this.createCollection();for(const n of e.manualDecorators){const i=new ne(this.locale);i.set({name:n.id,label:n.label,withText:!0}),i.bind("isOn").toMany([n,e],"value",(s,a)=>a===void 0&&s===void 0?!!n.defaultValue:!!s),i.on("execute",()=>{n.set("value",!i.isOn)}),t.add(i)}return t}_createFormChildren(e){const t=this.createCollection();if(t.add(this.urlInputView),e.length){const n=new _;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(i=>({tag:"li",children:[i],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),t.add(n)}return t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}const Te='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Le extends _{constructor(e){super(e),this.focusTracker=new D,this.keystrokes=new H,this._focusables=new R;const t=e.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(t("Unlink"),Te,"unlink"),this.editButtonView=this._createButton(t("Edit link"),p.pencil,"edit"),this.set("href",void 0),this._focusCycler=new F({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,t,n){const i=new k(this.locale);return i.set({label:e,icon:t,tooltip:!0}),i.delegate("execute").to(this,n),i}_createPreviewButton(){const e=new k(this.locale),t=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:t.to("href",i=>i&&B(i)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",i=>i||n("This link has no URL")),e.bind("isEnabled").to(this,"href",i=>!!i),e.template.tag="a",e.template.eventListeners={},e}}const Se='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const h="link-ui";class Ie extends g{constructor(){super(...arguments),this.actionsView=null,this.formView=null}static get requires(){return[y]}static get pluginName(){return"LinkUI"}init(){const e=this.editor;e.editing.view.addObserver(G),this._balloon=e.plugins.get(y),this._createToolbarLinkButton(),this._enableBalloonActivators(),e.conversion.for("editingDowncast").markerToHighlight({model:h,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:h,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const e=this.editor,t=new Le(e.locale),n=e.commands.get("link"),i=e.commands.get("unlink");return t.bind("href").to(n,"value"),t.editButtonView.bind("isEnabled").to(n),t.unlinkButtonView.bind("isEnabled").to(i),this.listenTo(t,"edit",()=>{this._addFormView()}),this.listenTo(t,"unlink",()=>{e.execute("unlink"),this._hideUI()}),t.keystrokes.set("Esc",(s,a)=>{this._hideUI(),a()}),t.keystrokes.set(b,(s,a)=>{this._addFormView(),a()}),t}_createFormView(){const e=this.editor,t=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),i=e.config.get("link.allowCreatingEmptyLinks"),s=new(se(ye))(e.locale,t);return s.urlInputView.fieldView.bind("value").to(t,"value"),s.urlInputView.bind("isEnabled").to(t,"isEnabled"),s.saveButtonView.bind("isEnabled").to(t,"isEnabled",s.urlInputView,"isEmpty",(a,o)=>a&&(i||!o)),this.listenTo(s,"submit",()=>{const{value:a}=s.urlInputView.fieldView.element,o=A(a,n);e.execute("link",o,s.getDecoratorSwitchesState()),this._closeFormView()}),this.listenTo(s,"cancel",()=>{this._closeFormView()}),s.keystrokes.set("Esc",(a,o)=>{this._closeFormView(),o()}),s}_createToolbarLinkButton(){const e=this.editor,t=e.commands.get("link"),n=e.t;e.ui.componentFactory.add("link",i=>{const s=new k(i);return s.isEnabled=!0,s.label=n("Link"),s.icon=Se,s.keystroke=b,s.tooltip=!0,s.isToggleable=!0,s.bind("isEnabled").to(t,"isEnabled"),s.bind("isOn").to(t,"value",a=>!!a),this.listenTo(s,"execute",()=>this._showUI(!0)),s})}_enableBalloonActivators(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),e.keystrokes.set(b,(n,i)=>{i(),e.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(e,t)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),t())},{priority:"high"}),this.editor.keystrokes.set("Esc",(e,t)=>{this._isUIVisible&&(this._hideUI(),t())}),oe({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const t=this.editor.commands.get("link");this.formView.disableCssTransitions(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=t.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,t=e.editing.view.document;let n=this._getSelectedLinkElement(),i=a();const s=()=>{const o=this._getSelectedLinkElement(),l=a();n&&!o||!n&&l!==i?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=o,i=l};function a(){return t.selection.focus.getAncestors().reverse().find(o=>o.is("element"))}this.listenTo(e.ui,"update",s),this.listenTo(this._balloon,"change:visibleView",s)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const e=this._balloon.visibleView;return!!this.formView&&e==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,t=this.editor.model,n=e.document;let i;if(t.markers.has(h)){const s=Array.from(this.editor.editing.mapper.markerNameToElements(h)),a=e.createRange(e.createPositionBefore(s[0]),e.createPositionAfter(s[s.length-1]));i=e.domConverter.viewRangeToDom(a)}else i=()=>{const s=this._getSelectedLinkElement();return s?e.domConverter.mapViewToDom(s):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:i}}_getSelectedLinkElement(){const e=this.editor.editing.view,t=e.document.selection,n=t.getSelectedElement();if(t.isCollapsed||n&&Z(n))return w(t.getFirstPosition());{const i=t.getFirstRange().getTrimmed(),s=w(i.start),a=w(i.end);return!s||s!=a?null:e.createRangeIn(s).getTrimmed().isEqual(i)?s:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(h))t.updateMarker(h,{range:n});else if(n.start.isAtEnd){const i=n.start.getLastMatchingPosition(({item:s})=>!e.schema.isContent(s),{boundaries:n});t.addMarker(h,{usingOperation:!1,affectsData:!1,range:t.createRange(i,n.end)})}else t.addMarker(h,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(h)&&e.change(t=>{t.removeMarker(h)})}}function w(r){return r.getAncestors().find(e=>he(e))||null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ce=4,M=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),Pe=2;class xe extends g{static get requires(){return[j,O]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(e,t){return t.textNode&&t.textNode.hasAttribute("linkHref")?v(t,"linkHref",t.textNode.getAttribute("linkHref"),e):null}_selectEntireLinks(e,t){const i=this.editor.model,s=i.document.selection,a=s.getFirstPosition(),o=s.getLastPosition();let l=t.getJoined(this._expandLinkRange(i,a)||t);l&&(l=l.getJoined(this._expandLinkRange(i,o)||t)),l&&(l.start.isBefore(a)||l.end.isAfter(o))&&e.setSelection(l)}_enablePasteLinking(){const e=this.editor,t=e.model,n=t.document.selection,i=e.plugins.get("ClipboardPipeline"),s=e.commands.get("link");i.on("inputTransformation",(a,o)=>{if(!this.isEnabled||!s.isEnabled||n.isCollapsed||o.method!=="paste"||n.rangeCount>1)return;const l=n.getFirstRange(),u=o.dataTransfer.getData("text/plain");if(!u)return;const c=u.match(M);c&&c[2]===u&&(t.change(d=>{this._selectEntireLinks(d,l),s.execute(u)}),a.stop())},{priority:"high"})}_enableTypingHandling(){const e=this.editor,t=new J(e.model,n=>{if(!De(n))return;const i=C(n.substr(0,n.length-1));if(i)return{url:i}});t.on("matched:data",(n,i)=>{const{batch:s,range:a,url:o}=i;if(!s.isTyping)return;const l=a.end.getShiftedBy(-1),u=l.getShiftedBy(-o.length),c=e.model.createRange(u,l);this._applyAutoLink(o,c)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("enter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition();if(!i.parent.previousSibling)return;const s=t.createRangeIn(i.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(s)})}_enableShiftEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("shiftEnter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition(),s=t.createRange(t.createPositionAt(i.parent,0),i.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(s)})}_checkAndApplyAutoLinkOnRange(e){const t=this.editor.model,{text:n,range:i}=Y(e,t),s=C(n);if(s){const a=t.createRange(i.end.getShiftedBy(-s.length),i.end);this._applyAutoLink(s,a)}}_applyAutoLink(e,t){const n=this.editor.model,i=this.editor.config.get("link.defaultProtocol"),s=A(e,i);!this.isEnabled||!He(t,n)||!U(s)||Re(t)||this._persistAutoLink(s,t)}_persistAutoLink(e,t){const n=this.editor.model,i=this.editor.plugins.get("Delete");n.enqueueChange(s=>{s.setAttribute("linkHref",e,t),n.enqueueChange(()=>{i.requestUndoOnBackspace()})})}}function De(r){return r.length>Ce&&r[r.length-1]===" "&&r[r.length-2]!==" "}function C(r){const e=M.exec(r);return e?e[Pe]:null}function He(r,e){return e.schema.checkAttributeInSelection(e.createSelection(r),"linkHref")}function Re(r){const e=r.start.nodeAfter;return!!e&&e.hasAttribute("linkHref")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qe extends g{static get requires(){return[O,Ie,xe]}static get pluginName(){return"Link"}}export{qe as L};
