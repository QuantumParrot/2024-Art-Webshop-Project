import{a as c}from"./axios@1.6.7-Di5RpEPX.js";import{d as h}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as p,a as A}from"./alert-BXjizhtP.js";var u={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:l,VITE_APP_PATH:o}=u,a=p(),i=A(),$=h("adminArticle",{state:()=>({articles:[],categories:{網站公告:["營運通知","優惠活動","展覽資訊","講座資訊","網站測試"],專欄文章:["藝術","歷史","地球","天文"],公益計劃:["海洋保育","野生動物救援","社會關懷"]}}),getters:{tags:({articles:e})=>{const r=[];return e.forEach(t=>t.tag.forEach((s,n)=>{n!==0&&!r.includes(s)&&r.push(s)})),r}},actions:{getArticles(){a.createLoader("get-articles"),c.get(`${l}/api/${o}/admin/articles`).then(e=>{const{articles:r,pagination:t}=e.data;if(this.articles=r,t.total_pages>1){const s=`${l}/api/${o}/admin/articles?page=`,n=[];for(let d=2;d<=t.total_pages;d+=1)n.push(c.get(`${s}${d}`));return Promise.all(n)}return!1}).then(e=>{Array.isArray(e)&&e.forEach(r=>this.articles.push(...r.data.articles)),this.articles=this.articles.toSorted((r,t)=>t.create_at-r.create_at)}).catch(e=>i.errorAlert(e)).finally(()=>a.removeLoader("get-articles"))},createArticle(e,r){a.createLoader("create-article"),c.post(`${l}/api/${o}/admin/article`,{data:e}).then(t=>{i.toastAlert(t.data.message,"success"),r(),this.getArticles()}).catch(t=>i.errorAlert(t)).finally(()=>a.removeLoader("create-article"))},updateArticle(e,r){a.createLoader("update-article"),c.put(`${l}/api/${o}/admin/article/${e.id}`,{data:e}).then(t=>{i.toastAlert(t.data.message,"success"),r(),this.getArticles()}).catch(t=>i.errorAlert(t)).finally(()=>a.removeLoader("update-article"))},deleteArticle(e,r){const t={title:"確定刪除文章？",text:`名稱：${r}`};i.checkAlert(t,()=>{a.createLoader("delete-article"),c.delete(`${l}/api/${o}/admin/article/${e}`).then(s=>{i.toastAlert(s.data.message,"success"),this.getArticles()}).catch(s=>i.errorAlert(s)).finally(()=>a.removeLoader("delete-article"))})},switchArticleStatus(e){const r=e.isPublic;a.createLoader("switch-article-status"),c.put(`${l}/api/${o}/admin/article/${e.id}`,{data:{...e,content:e.description,isPublic:!e.isPublic}}).then(()=>{i.toastAlert(`文章已${r?"隱藏":"公開"}`,"success"),this.getArticles()}).catch(t=>i.errorAlert(t)).finally(()=>a.removeLoader("switch-article-status"))}}});export{$ as a};
