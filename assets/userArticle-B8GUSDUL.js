import{a as o}from"./axios@1.6.7-Di5RpEPX.js";import{d as g}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as f,a as p}from"./alert-Bb6H8DPx.js";import{u as P}from"./userProduct-Bp0UFY4u.js";var m={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const i=f(),u=p(),d=P(),{VITE_APP_SITE:l,VITE_APP_PATH:c}=m,y=g("userArticle",{state:()=>({articles:[],article:{},filter:"",relatedProducts:[],currentPage:{column:1,news:1}}),getters:{news:({articles:t})=>t.filter(e=>e.type==="網站公告").sort((e,a)=>a.create_at-e.create_at),newsList:({news:t,currentPage:e})=>t.filter((a,r)=>Math.floor(r/5)+1===e.news),columns:({articles:t})=>t.filter(e=>e.type==="專欄文章"),columnList:({columns:t,filter:e,currentPage:a})=>{const{column:r}=a;return(e?t.filter(s=>s.category===e):t).filter((s,h)=>Math.floor(h/9)+1===r)},projects:({articles:t})=>t.filter(e=>e.type==="公益計劃"),totalPages:({columns:t,news:e})=>({column:Math.ceil(t.length/9),news:Math.ceil(e.length/5)})},actions:{getArticles(){i.createLoader("get-user-articles"),o.get(`${l}/api/${c}/articles`).then(t=>{this.articles=t.data.articles}).catch(t=>u.errorAlert(t)).finally(()=>i.removeLoader("get-user-articles"))},getArticle(t){i.createLoader("get-single-article"),o.get(`${l}/api/${c}/article/${t}`).then(e=>{this.article=e.data.article,this.article.type==="專欄文章"?(this.router.push(`/article/${this.article.id}`),this.getRelatedProducts(this.article.tag)):this.router.push(`/news/${this.article.id}`)}).catch(e=>u.errorAlert(e)).finally(()=>i.removeLoader("get-single-article"))},switchFilter(t){this.filter=t},switchPage(t,e){this.currentPage[e]=t},async getRelatedProducts(t){const e=await o.get(`${l}/api/${c}/products/all`),a=Object.values(e.data.products);let r=[];Array.isArray(t)&&(r=a.filter(n=>n.tags.some(s=>t.includes(s)))),r.length>3?r=d.getRandomProducts(r,3):r.push(...d.getRandomProducts(a,Math.abs(r.length-3))),this.relatedProducts=r}}});export{y as u};
