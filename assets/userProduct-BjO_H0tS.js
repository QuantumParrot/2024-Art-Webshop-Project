import{a as u}from"./axios@1.6.7-Di5RpEPX.js";import{d as P}from"./pinia@2.1.7_vue@3.4.19-CHKlOEZr.js";import{l as f,a as m}from"./alert-dm0RMdUk.js";var A={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const i=f(),l=m(),{VITE_APP_SITE:n,VITE_APP_PATH:p}=A,y=P("userProduct",{state:()=>({products:[],pagination:{},product:{},totalProducts:[],relatedProducts:[]}),actions:{getProducts(r="",t=1){i.createLoader("get-user-products"),u.get(`${n}/api/${p}/products?category=${r}&page=${t}`).then(o=>{this.products=o.data.products,this.pagination=o.data.pagination}).catch(o=>l.errorAlert(o)).finally(()=>i.removeLoader("get-user-products"))},getProduct(r){i.createLoader("get-single-product"),u.get(`${n}/api/${p}/product/${r}`).then(t=>{this.product=t.data.product,this.totalProducts.length?this.getRelatedProducts(t.data.product):this.getTotalProducts(t.data.product,this.getRelatedProducts)}).catch(t=>l.errorAlert(t)).finally(()=>i.removeLoader("get-single-product"))},getTotalProducts(r,t){i.createLoader("get-total-products"),u.get(`${n}/api/${p}/products/all`).then(o=>{this.totalProducts=Object.values(o.data.products),typeof t=="function"&&t(r)}).catch(o=>l.errorAlert(o)).finally(()=>i.removeLoader("get-total-products"))},getRelatedProducts(r){const{category:t,tags:o}=r,d=this.totalProducts.filter(a=>a.id!==r.id&&Array.isArray(a.tags)),e=d.filter(a=>a.tags.some(s=>o.includes(s)));if(e.length<3){const a=e.map(c=>c.id),s=d.filter(c=>c.category===t&&!a.includes(c.id));if(s.length>3)e.push(...this.getRandomProducts(s,3-e.length));else if(e.push(...s),e.length<3){const c=d.filter(g=>!e.map(h=>h.id).includes(g.id));e.push(...this.getRandomProducts(c,3-e.length))}this.relatedProducts=e}else this.relatedProducts=this.getRandomProducts(e,3)},getRandomProducts(r,t){let o=0;const d=[...r],e=[];function a(){const s=Math.floor(Math.random()*d.length);o+=1,e.push(...d.splice(s,1))}for(;o<t;)a();return e}}});export{y as u};
