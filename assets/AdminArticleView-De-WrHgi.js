import{c as $}from"./calculator-BHGMByDI.js";import{d as T,m as I,a as H}from"./pinia@2.1.7_vue@3.4.19-BaxWQ2Jo.js";import{a as f}from"./axios@1.6.7-Di5RpEPX.js";import{u as N,a as B}from"./alert-Dip58-jj.js";import{b as F}from"./@ckeditor_ckeditor5-vue@5.1.0-BRsWHAsX.js";import{m as j,P as O}from"./modal-cHtxAZDp.js";import{C as R}from"./@ckeditor_ckeditor5-editor-classic@41.1.0-C5gT8LbW.js";import{E as z}from"./@ckeditor_ckeditor5-essentials@41.1.0-C75rVVOj.js";import{B as J,I as W}from"./@ckeditor_ckeditor5-basic-styles@41.1.0-Bl6ixVuM.js";import"./@ckeditor_ckeditor5-utils@41.1.0-Cn-yVoWx.js";import"./@ckeditor_ckeditor5-core@41.1.0-D0yh88O_.js";import"./@ckeditor_ckeditor5-engine@41.1.0-CtehaBhy.js";import"./@ckeditor_ckeditor5-ui@41.1.0-CAo3E1r6.js";import"./color-convert@2.0.1-_RKowGEt.js";import{L as G}from"./@ckeditor_ckeditor5-link@41.1.0-CzUv6QZd.js";import"./@ckeditor_ckeditor5-widget@41.1.0-CCeCQ99-.js";import"./@ckeditor_ckeditor5-clipboard@41.1.0-CSBXoIoC.js";import{H as K}from"./@ckeditor_ckeditor5-heading@41.1.0-CJzcqE4y.js";import"./@ckeditor_ckeditor5-paragraph@41.1.0-DXqD23bY.js";import{F as Q}from"./@ckeditor_ckeditor5-font@41.1.0-C6OuEVWC.js";import{U as X}from"./UploadForm-OZFq419b.js";import{m as P,l as Y,v as Z}from"./@vue_runtime-dom@3.4.19-DVfTC9pq.js";import{_ as E}from"./index-CC7777Lp.js";import{aj as p,O as u,P as t,c as d,aH as tt,aJ as y,F as M,ao as q,N as et,aq as g,al as ot,ak as it}from"./@vue_runtime-core@3.4.19-CzGklseq.js";import{n as x,P as w}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./sweetalert2@11.10.5-D1b63BCh.js";import"./vue@3.4.19-bS3wBxtn.js";import"./bootstrap@5.3.2_@popperjs_core@2.11.8-aNy9Y6fu.js";import"./@ckeditor_ckeditor5-watchdog@41.1.0-B5W-sfM8.js";import"./lodash-es@4.17.21-C5qYGfgy.js";import"./@ckeditor_ckeditor5-typing@41.1.0-DSIargVI.js";import"./@ckeditor_ckeditor5-enter@41.1.0-CzFUQWGc.js";import"./@ckeditor_ckeditor5-select-all@41.1.0-DIHXo6am.js";import"./@ckeditor_ckeditor5-undo@41.1.0-BeXJaCFG.js";import"./color-parse@1.4.2-DPQjrGBK.js";import"./color-name@1.1.4-Dc5RlJww.js";import"./vanilla-colorful@0.7.2-PEGE98j7.js";import"./clipboard@2.0.11-BIMaK3BZ.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-CIwtLcK9.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-CtCrC8gK.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-Cp1hpGuW.js";import"./vue-router@4.2.5_vue@3.4.19-CGkOaO3i.js";var st={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:b,VITE_APP_PATH:v}=st,r=N(),c=B(),U=T("adminArticle",{state:()=>({articles:[],pagination:{},article:{}}),getters:{tags:({articles:e})=>{const o=[];return e.forEach(l=>l.tag.forEach((_,i)=>{i!==0&&!o.includes(_)&&o.push(_)})),o}},actions:{getArticles(e=1){r.createLoader("get-articles"),f.get(`${b}/api/${v}/admin/articles?page=${e}`).then(o=>{const{articles:l,pagination:_}=o.data;this.articles=l.sort((i,m)=>m.create_at-i.create_at),this.pagination=_}).catch(o=>c.errorAlert(o)).finally(()=>r.removeLoader("get-articles"))},getArticle(e){r.createLoader("get-articles"),f.get(`${b}/api/${v}/admin/article/${e}`).then(o=>{this.article=o.data.article}).catch(o=>c.errorAlert(o)).finally(()=>r.removeLoader("get-articles"))},createArticle(e,o){r.createLoader("create-article"),f.post(`${b}/api/${v}/admin/article`,{data:e}).then(l=>{c.toastAlert(l.data.message,"success"),o(),this.getArticles()}).catch(l=>c.errorAlert(l)).finally(()=>r.removeLoader("create-article"))},updateArticle(e,o){r.createLoader("update-article"),f.put(`${b}/api/${v}/admin/article/${e.id}`,{data:e}).then(l=>{c.toastAlert(l.data.message,"success"),o(),this.getArticles()}).catch(l=>c.errorAlert(l)).finally(()=>r.removeLoader("update-article"))},deleteArticle(e){const o={title:"確定刪除文章？",text:`名稱：${e.title}`};c.checkAlert(o,()=>{r.createLoader("delete-article"),f.delete(`${b}/api/${v}/admin/article/${e.id}`).then(l=>{c.toastAlert(l.data.message,"success"),this.getArticles()}).catch(l=>c.errorAlert(l)).finally(()=>r.removeLoader("delete-article"))})},switchArticleStatus(e){const o=e.isPublic;r.createLoader("switch-article-status"),f.put(`${b}/api/${v}/admin/article/${e.id}`,{data:{...e,content:e.description,isPublic:!e.isPublic}}).then(()=>{c.toastAlert(`文章已${o?"隱藏":"公開"}`,"success"),this.getArticles()}).catch(l=>c.errorAlert(l)).finally(()=>r.removeLoader("switch-article-status"))}}}),A=["mb-3"],lt={options:[{model:"paragraph",view:{name:"p",classes:["fs-6",...A]},title:"paragraph"},{model:"heading1",view:{name:"h2",classes:["fs-2",...A]},title:"bootstrap - H2"},{model:"heading2",view:{name:"h3",classes:["fs-3",...A]},title:"bootstrap - H3"},{model:"heading3",view:{name:"h4",classes:["fs-4",...A]},title:"bootstrap - H4"},{model:"heading4",view:{name:"h5",classes:["fs-5",...A]},title:"bootstrap - H5"},{model:"text",view:{name:"p",classes:["fs-7",...A]},title:"small text"}]},at={data(){return{editor:R,editorConfig:{plugins:[z,J,W,G,K,Q],toolbar:{items:["undo","redo","|","heading","bold","italic","fontSize","fontFamily","fontColor","|","link"]},heading:lt}}}},rt={mixins:[j,at,$],components:{ckeditor:F.component,UploadForm:X},props:["tempArticle"],data(){return{tab:"config",article:{},category:"",uploadState:!1}},computed:{createAt:{get(){return this.formatDate(this.article.create_at*1e3)},set(e){this.article.create_at=new Date(e).getTime()/1e3}}},methods:{...I(U,["createArticle","updateArticle"]),updateData(){if(this.article=this.tempArticle,Array.isArray(this.tempArticle.tag)){const[e,...o]=this.tempArticle.tag;this.category=e,this.article.tag=o}else this.category="",this.article.tag=[]},confirmUpdate(){this.article.tag=this.article.tag.filter(e=>e),this.article.tag.unshift(this.category),this.article.content=this.article.description,this.article.id?this.updateArticle(this.article,this.hideModal):this.createArticle(this.article,this.hideModal)},addNewImage(e){this.article.image=e},updateUploadState(e){this.uploadState=e}},watch:{tempArticle(){this.updateData()}},mounted(){this.updateData()}},n=e=>(ot("data-v-45ffc0ca"),e=e(),it(),e),nt={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},ct={class:"modal-dialog modal-dialog-centered"},dt={class:"modal-content"},mt={class:"modal-header justify-content-end"},pt=n(()=>t("i",{class:"bi bi-x-circle-fill"},null,-1)),ut=[pt],ht={class:"modal-body"},gt={class:"nav nav-pills bg-light rounded-2 mb-3"},_t={class:"nav-item flex-grow-1"},ft={class:"nav-item flex-grow-1"},bt={class:"nav-item flex-grow-1"},vt={class:"mb-3"},At=n(()=>t("label",{class:"form-label is-required",for:"title"},"文章標題",-1)),yt={class:"mb-3"},wt={class:"row row-cols-2"},kt={class:"col"},St=n(()=>t("label",{class:"form-label is-required",for:"author"},"文章作者",-1)),Vt={class:"col"},Ct={class:"mb-3"},Pt=n(()=>t("label",{class:"form-label is-required",for:"create_at"},[t("span",null,"發表日期")],-1)),xt={class:"mb-3"},Mt=n(()=>t("label",{class:"form-label is-required",for:"category"},[t("span",null,"文章分類")],-1)),Ut={class:"mb-3"},Lt=n(()=>t("p",null,"標籤",-1)),$t={class:"row g-3 mb-3"},It=["onUpdate:modelValue"],Et=["onClick"],qt=n(()=>t("i",{class:"bi bi-x-lg"},null,-1)),Dt=[qt],Tt={class:"mb-3"},Ht=n(()=>t("label",{class:"form-label is-required",for:"image"},"文章圖片",-1)),Nt=["src","alt"],Bt=n(()=>t("hr",null,null,-1)),Ft=n(()=>t("hr",null,null,-1)),jt=n(()=>t("p",{class:"is-required"},"文章內容",-1)),Ot={class:"modal-footer justify-content-between align-items-center"},Rt={class:"form-check"},zt=n(()=>t("label",{class:"form-label",for:"isPublic"}," 是否公開",-1)),Jt=["disabled"];function Wt(e,o,l,_,i,m){const S=g("loading-overlay"),h=g("v-field"),a=g("upload-form"),k=g("ckeditor"),D=g("v-form");return p(),u("div",nt,[t("div",ct,[d(S,{"is-loading":i.uploadState,"is-full":!1},null,8,["is-loading"]),t("div",dt,[t("div",mt,[t("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:o[0]||(o[0]=(...V)=>e.hideModal&&e.hideModal(...V))},ut)]),d(D,{onSubmit:m.confirmUpdate},{default:tt(({meta:V})=>[t("div",ht,[t("ul",gt,[t("li",_t,[t("button",{type:"button",onClick:o[1]||(o[1]=s=>i.tab="config"),class:x(["w-100 nav-link",{active:i.tab==="config"}])}," 文章設定",2)]),t("li",ft,[t("button",{type:"button",onClick:o[2]||(o[2]=s=>i.tab="category"),class:x(["w-100 nav-link",{active:i.tab==="category"}])}," 文章分類",2)]),t("li",bt,[t("button",{type:"button",onClick:o[3]||(o[3]=s=>i.tab="image"),class:x(["w-100 nav-link",{active:i.tab==="image"}])}," 文章圖片",2)])]),y(t("div",null,[t("div",vt,[At,d(h,{id:"title",type:"text",class:"form-control",modelValue:i.article.title,"onUpdate:modelValue":o[4]||(o[4]=s=>i.article.title=s),modelModifiers:{trim:!0},name:"title",rules:"required"},null,8,["modelValue"])]),t("div",yt,[t("div",wt,[t("div",kt,[St,d(h,{id:"author",type:"text",class:"form-control",modelValue:i.article.author,"onUpdate:modelValue":o[5]||(o[5]=s=>i.article.author=s),modelModifiers:{trim:!0},name:"author",rules:"required"},null,8,["modelValue"])]),t("div",Vt,[t("div",Ct,[Pt,d(h,{id:"create_at",type:"date",class:"form-control",modelValue:m.createAt,"onUpdate:modelValue":o[6]||(o[6]=s=>m.createAt=s),name:"create_at",rules:"required"},null,8,["modelValue"])])])])])],512),[[P,i.tab==="config"]]),y(t("div",null,[t("div",xt,[Mt,d(h,{id:"category",type:"text",class:"form-control",modelValue:i.category,"onUpdate:modelValue":o[7]||(o[7]=s=>i.category=s),modelModifiers:{trim:!0},name:"category",rules:"required"},null,8,["modelValue"])]),t("div",Ut,[Lt,t("div",$t,[(p(!0),u(M,null,q(i.article.tag,(s,C)=>(p(),u("div",{class:"col-md-3 position-relative",key:s},[y(t("input",{type:"text",class:"form-control","onUpdate:modelValue":L=>i.article.tag[C]=L},null,8,It),[[Y,i.article.tag[C]]]),t("button",{type:"button",class:"btn btn-origin btn-inline",onClick:L=>i.article.tag.splice(C,1)},Dt,8,Et)]))),128))]),t("button",{type:"button",class:"btn btn-primary",onClick:o[8]||(o[8]=s=>i.article.tag.push(""))}," 新增標籤")])],512),[[P,i.tab==="category"]]),y(t("div",null,[t("div",Tt,[Ht,d(h,{id:"image",type:"text",class:"form-control",modelValue:i.article.image,"onUpdate:modelValue":o[9]||(o[9]=s=>i.article.image=s),modelModifiers:{trim:!0},name:"image",rules:"required|url"},null,8,["modelValue"]),i.article.image?(p(),u("img",{key:0,class:"mt-3",src:i.article.image,alt:i.article.title},null,8,Nt)):et("",!0)]),Bt,d(a,{"use-clipboard":!1,"upload-state":i.uploadState,disabled:i.article.image,onAddNewImage:m.addNewImage,onUpdateUploadState:m.updateUploadState},null,8,["upload-state","disabled","onAddNewImage","onUpdateUploadState"])],512),[[P,i.tab==="image"]]),Ft,jt,d(k,{editor:e.editor,config:e.editorConfig,modelValue:i.article.description,"onUpdate:modelValue":o[10]||(o[10]=s=>i.article.description=s)},null,8,["editor","config","modelValue"])]),t("div",Ot,[t("div",Rt,[y(t("input",{id:"isPublic",type:"checkbox",class:"form-check-input","onUpdate:modelValue":o[11]||(o[11]=s=>i.article.isPublic=s)},null,512),[[Z,i.article.isPublic]]),zt]),t("div",null,[t("button",{type:"submit",class:"btn btn-primary me-2",disabled:!V.valid},"確認更新",8,Jt),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:o[12]||(o[12]=(...s)=>e.hideModal&&e.hideModal(...s))},"取消")])])]),_:1},8,["onSubmit"])])])],512)}const Gt=E(rt,[["render",Wt],["__scopeId","data-v-45ffc0ca"]]),Kt={mixins:[$],components:{AdminArticleModal:Gt,PaginationComponent:O},data(){return{tempArticle:{}}},computed:{...H(U,["articles","pagination"])},methods:{...I(U,["getArticles","deleteArticle","switchArticleStatus"]),openModal(e){this.tempArticle=e?{...e}:{isPublic:!1,create_at:this.now()},this.$refs.articleModal.showModal()}},mounted(){this.getArticles()}},Qt={class:"text-end mb-7"},Xt=t("h3",{class:"fs-2 mb-2"},"文章",-1),Yt={class:"alert bg-light flex-classic mb-5"},Zt={key:0,class:"table-responsive"},te={class:"table table-hover text-nowrap"},ee=t("thead",null,[t("tr",null,[t("th",{scope:"col",width:"10%"},"日期"),t("th",{scope:"col",width:"10%"},"分類"),t("th",{scope:"col",width:"50%"},"文章"),t("th",{scope:"col",width:"15%",class:"text-center"},"狀態"),t("th",{scope:"col",width:"15%",class:"text-center"},"處理")])],-1),oe={class:"align-middle"},ie={class:"badge bg-highlight text-dark py-2"},se={class:"fw-bold mb-2"},le={class:"text-muted fs-7"},ae={class:"text-center"},re={class:"form-switch"},ne=["checked","onChange"],ce={class:"text-center"},de={class:"d-flex flex-column gap-2"},me=["onClick"],pe=["onClick"],ue={key:1,class:"alert bg-light"};function he(e,o,l,_,i,m){const S=g("pagination-component"),h=g("admin-article-modal");return p(),u(M,null,[t("div",Qt,[Xt,t("span",null,"目前共有 "+w(e.articles.length)+" 篇文章 (꜆꜄꜆ ˙꒳˙)꜆꜄꜆ｵﾗｵﾗｵﾗｵﾗ",1)]),t("div",Yt,[t("div",null,[t("button",{type:"button",class:"btn btn-highlight",onClick:o[0]||(o[0]=a=>m.openModal())},"新增文章")]),d(S,{current:e.pagination.current_page,total:e.pagination.total_pages,onSwitchPage:e.getArticles},null,8,["current","total","onSwitchPage"])]),e.articles.length?(p(),u("div",Zt,[t("table",te,[ee,t("tbody",oe,[(p(!0),u(M,null,q(e.articles,a=>(p(),u("tr",{key:a.id},[t("td",null,w(e.formatDate(a.create_at*1e3,"/")),1),t("td",null,[t("span",ie,w(a.tag[0]),1)]),t("td",null,[t("p",se,w(a.title),1),t("span",le,"作者｜"+w(a.author),1)]),t("td",ae,[t("div",re,[t("input",{type:"checkbox",role:"switch",class:"form-check-input",checked:a.isPublic,onChange:k=>e.switchArticleStatus(a)},null,40,ne)])]),t("td",ce,[t("div",de,[t("button",{type:"button",class:"w-100 btn btn-outline-secondary",onClick:k=>m.openModal(a)}," 編輯",8,me),t("button",{type:"button",class:"w-100 btn btn-outline-danger",onClick:k=>e.deleteArticle(a)}," 刪除",8,pe)])])]))),128))])])])):(p(),u("div",ue,"還沒有任何文章！趕快新增一篇吧！")),d(h,{ref:"articleModal","temp-article":i.tempArticle},null,8,["temp-article"])],64)}const co=E(Kt,[["render",he]]);export{co as default};
