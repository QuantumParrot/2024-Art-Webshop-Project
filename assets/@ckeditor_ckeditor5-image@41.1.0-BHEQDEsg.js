import{F as L,D as De,g as R,U as O,K as D,l as w,m as re,e as Pe,C as We,h as Me}from"./@ckeditor_ckeditor5-utils@41.1.0-D1rfIdEO.js";import{P as p,C,i as I}from"./@ckeditor_ckeditor5-core@41.1.0-FknGk_Vk.js";import{O as qe,U as P,e as je,h as $e}from"./@ckeditor_ckeditor5-engine@41.1.0-B08yYX20.js";import{t as He,i as Ge,f as Ke,W as le,a as Je,b as V,c as Z}from"./@ckeditor_ckeditor5-widget@41.1.0-DuP0tInB.js";import{V as W,e as M,F as q,s as ce,B as y,L as me,h as ge,i as Ze,j as Qe,k as Xe,l as Ye,m as ue,o as de,c as j,N as Q,p as he,M as et,b as tt,q as it}from"./@ckeditor_ckeditor5-ui@41.1.0-B2bM0IQy.js";import"./color-convert@2.0.1-CxsEO2Hm.js";import{a as $}from"./@ckeditor_ckeditor5-clipboard@41.1.0-CR0n6K3c.js";import{F as nt,a as k}from"./@ckeditor_ckeditor5-upload@41.1.0-DLDxYD_K.js";import{d as pe,n as E}from"./lodash-es@4.17.21-DPYE078p.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function st(a){return a.createContainerElement("span",{class:"image-inline"},a.createEmptyElement("img"))}function X(a){return a.createContainerElement("figure",{class:"image"},[a.createEmptyElement("img"),a.createSlot("children")])}function fe(a,e){const t=a.plugins.get("ImageUtils"),i=a.plugins.has("ImageInlineEditing")&&a.plugins.has("ImageBlockEditing");return o=>t.isInlineImageView(o)?i&&(o.getStyle("display")=="block"||o.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==e?null:n(o):null;function n(o){const s={name:!0};return o.hasAttribute("src")&&(s.attributes=["src"]),s}}function H(a,e){const t=L(e.getSelectedBlocks());return!t||a.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}function U(a){return a&&a.endsWith("px")?parseInt(a):null}function A(a){const e=U(a.getStyle("width")),t=U(a.getStyle("height"));return!!(e&&t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ot=/^(image|image-inline)$/;class f extends p{constructor(){super(...arguments),this._domEmitter=new(De())}static get pluginName(){return"ImageUtils"}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},t=null,i=null,n={}){const o=this.editor,s=o.model,r=s.document.selection,l=Ie(o,t||r,i);e={...Object.fromEntries(r.getAttributes()),...e};for(const c in e)s.schema.checkAttribute(l,c)||delete e[c];return s.change(c=>{const{setImageSizes:m=!0}=n,g=c.createElement(l,e);return s.insertObject(g,t,null,{setSelection:"on",findOptimalPosition:!t&&l!="imageInline"?"auto":void 0}),g.parent?(m&&this.setImageNaturalSizeAttributes(g),g):null})}setImageNaturalSizeAttributes(e){const t=e.getAttribute("src");t&&(e.getAttribute("width")||e.getAttribute("height")||this.editor.model.change(i=>{const n=new R.window.Image;this._domEmitter.listenTo(n,"load",()=>{!e.getAttribute("width")&&!e.getAttribute("height")&&this.editor.model.enqueueChange(i.batch,o=>{o.setAttribute("width",n.naturalWidth,e),o.setAttribute("height",n.naturalHeight,e)}),this._domEmitter.stopListening(n,"load")}),n.src=t}))}getClosestSelectedImageWidget(e){const t=e.getFirstPosition();if(!t)return null;const i=e.getSelectedElement();if(i&&this.isImageWidget(i))return i;let n=t.parent;for(;n;){if(n.is("element")&&this.isImageWidget(n))return n;n=n.parent}return null}getClosestSelectedImageElement(e){const t=e.getSelectedElement();return this.isImage(t)?t:e.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(e){return e.findAncestor({classes:ot})}isImageAllowed(){const t=this.editor.model.document.selection;return at(this.editor,t)&&rt(t)}toImageWidget(e,t,i){return t.setCustomProperty("image",!0,e),He(e,t,{label:()=>{const s=this.findViewImgElement(e).getAttribute("alt");return s?`${s} ${i}`:i}})}isImageWidget(e){return!!e.getCustomProperty("image")&&Ge(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const t=this.editor.editing.view;for(const{item:i}of t.createRangeIn(e))if(this.isInlineImageView(i))return i}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function at(a,e){if(Ie(a,e,null)=="imageBlock"){const i=lt(e,a.model);if(a.model.schema.checkChild(i,"imageBlock"))return!0}else if(a.model.schema.checkChild(e.focus,"imageInline"))return!0;return!1}function rt(a){return[...a.focus.getAncestors()].every(e=>!e.is("element","imageBlock"))}function lt(a,e){const i=Ke(a,e).start.parent;return i.isEmpty&&!i.is("element","$root")?i.parent:i}function Ie(a,e,t){const i=a.model.schema,n=a.config.get("image.insert.type");return a.plugins.has("ImageBlockEditing")?a.plugins.has("ImageInlineEditing")?t||(n==="inline"?"imageInline":n!=="auto"?"imageBlock":e.is("selection")?H(i,e):i.checkChild(e,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ct extends C{refresh(){const i=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!i,this.isEnabled&&i.hasAttribute("alt")?this.value=i.getAttribute("alt"):this.value=!1}execute(e){const t=this.editor,i=t.plugins.get("ImageUtils"),n=t.model,o=i.getClosestSelectedImageElement(n.document.selection);n.change(s=>{s.setAttribute("alt",e.newValue,o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mt extends p{static get requires(){return[f]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new ct(this.editor))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gt extends W{constructor(e){super(e);const t=this.locale.t;this.focusTracker=new O,this.keystrokes=new D,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(t("Save"),I.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(t("Cancel"),I.cancel,"ck-button-cancel","cancel"),this._focusables=new M,this._focusCycler=new q({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),ce({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,t,i,n){const o=new y(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:i}}),n&&o.delegate("execute").to(this,n),o}_createLabeledInputView(){const e=this.locale.t,t=new me(this.locale,ge);return t.label=e("Text alternative"),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ut(a){const e=a.plugins.get("ContextualBalloon");if(a.plugins.get("ImageUtils").getClosestSelectedImageWidget(a.editing.view.document.selection)){const i=be(a);e.updatePosition(i)}}function be(a){const e=a.editing.view,t=Ze.defaultPositions,i=a.plugins.get("ImageUtils");return{target:e.domConverter.mapViewToDom(i.getClosestSelectedImageWidget(e.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dt extends p{static get requires(){return[Qe]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const e=this.editor,t=e.t;e.ui.componentFactory.add("imageTextAlternative",i=>{const n=e.commands.get("imageTextAlternative"),o=new y(i);return o.set({label:t("Change image text alternative"),icon:I.textAlternative,tooltip:!0}),o.bind("isEnabled").to(n,"isEnabled"),o.bind("isOn").to(n,"value",s=>!!s),this.listenTo(o,"execute",()=>{this._showForm()}),o})}_createForm(){const e=this.editor,i=e.editing.view.document,n=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(Xe(gt))(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(o,s)=>{this._hideForm(!0),s()}),this.listenTo(e.ui,"update",()=>{n.getClosestSelectedImageWidget(i.selection)?this._isVisible&&ut(e):this._hideForm(!0)}),Ye({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const e=this.editor,t=e.commands.get("imageTextAlternative"),i=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:be(e)}),i.fieldView.value=i.fieldView.element.value=t.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class we extends p{static get requires(){return[mt,dt]}static get pluginName(){return"ImageTextAlternative"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ht(a){const e=(t,i,n)=>{if(!n.consumable.test(i.viewItem,{name:!0,classes:"image"}))return;const o=a.findViewImgElement(i.viewItem);if(!o||!n.consumable.test(o,{name:!0}))return;n.consumable.consume(i.viewItem,{name:!0,classes:"image"});const s=n.convertItem(o,i.modelCursor),r=L(s.modelRange.getItems());if(!r){n.consumable.revert(i.viewItem,{name:!0,classes:"image"});return}n.convertChildren(i.viewItem,r),n.updateConversionResult(r,i)};return t=>{t.on("element:figure",e)}}function ye(a,e){const t=(i,n,o)=>{if(!o.consumable.consume(n.item,i.name))return;const s=o.writer,r=o.mapper.toViewElement(n.item),l=a.findViewImgElement(r);n.attributeNewValue===null?(s.removeAttribute("srcset",l),s.removeAttribute("sizes",l)):n.attributeNewValue&&(s.setAttribute("srcset",n.attributeNewValue,l),s.setAttribute("sizes","100vw",l))};return i=>{i.on(`attribute:srcset:${e}`,t)}}function B(a,e,t){const i=(n,o,s)=>{if(!s.consumable.consume(o.item,n.name))return;const r=s.writer,l=s.mapper.toViewElement(o.item),c=a.findViewImgElement(l);r.setAttribute(o.attributeKey,o.attributeNewValue||"",c)};return n=>{n.on(`attribute:${t}:${e}`,i)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G extends qe{observe(e){this.listenTo(e,"load",(t,i)=>{const n=i.target;this.checkShouldIgnoreEventFromTarget(n)||n.tagName=="IMG"&&this._fireEvents(i)},{useCapture:!0})}stopObserving(e){this.stopListening(e)}_fireEvents(e){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",e))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pt extends C{constructor(e){super(e);const t=e.config.get("image.insert.type");e.plugins.has("ImageBlockEditing")||t==="block"&&w("image-block-plugin-required"),e.plugins.has("ImageInlineEditing")||t==="inline"&&w("image-inline-plugin-required")}refresh(){const e=this.editor.plugins.get("ImageUtils");this.isEnabled=e.isImageAllowed()}execute(e){const t=re(e.source),i=this.editor.model.document.selection,n=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(i.getAttributes());t.forEach((s,r)=>{const l=i.getSelectedElement();if(typeof s=="string"&&(s={src:s}),r&&l&&n.isImage(l)){const c=this.editor.model.createPositionAfter(l);n.insertImage({...s,...o},c)}else n.insertImage({...s,...o})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ft extends C{constructor(e){super(e),this.decorate("cleanupImage")}refresh(){const t=this.editor.plugins.get("ImageUtils"),i=this.editor.model.document.selection.getSelectedElement();this.isEnabled=t.isImage(i),this.value=this.isEnabled?i.getAttribute("src"):null}execute(e){const t=this.editor.model.document.selection.getSelectedElement(),i=this.editor.plugins.get("ImageUtils");this.editor.model.change(n=>{n.setAttribute("src",e.source,t),this.cleanupImage(n,t),i.setImageNaturalSizeAttributes(t)})}cleanupImage(e,t){e.removeAttribute("srcset",t),e.removeAttribute("sizes",t),e.removeAttribute("sources",t),e.removeAttribute("width",t),e.removeAttribute("height",t),e.removeAttribute("alt",t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ce extends p{static get requires(){return[f]}static get pluginName(){return"ImageEditing"}init(){const e=this.editor,t=e.conversion;e.editing.view.addObserver(G),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const i=new pt(e),n=new ft(e);e.commands.add("insertImage",i),e.commands.add("replaceImageSource",n),e.commands.add("imageInsert",i)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ve extends p{static get requires(){return[f]}static get pluginName(){return"ImageSizeAttributes"}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(e){const t=this.editor,i=t.plugins.get("ImageUtils"),n=e==="imageBlock"?"figure":"img";t.conversion.for("upcast").attributeToAttribute({view:{name:n,styles:{width:/.+/}},model:{key:"width",value:s=>A(s)?U(s.getStyle("width")):null}}).attributeToAttribute({view:{name:n,key:"width"},model:"width"}).attributeToAttribute({view:{name:n,styles:{height:/.+/}},model:{key:"height",value:s=>A(s)?U(s.getStyle("height")):null}}).attributeToAttribute({view:{name:n,key:"height"},model:"height"}),t.conversion.for("editingDowncast").add(s=>{o(s,"width","width",!0),o(s,"height","height",!0)}),t.conversion.for("dataDowncast").add(s=>{o(s,"width","width",!1),o(s,"height","height",!1)});function o(s,r,l,c){s.on(`attribute:${r}:${e}`,(m,g,d)=>{if(!d.consumable.consume(g.item,m.name))return;const u=d.writer,h=d.mapper.toViewElement(g.item),b=i.findViewImgElement(h);if(g.attributeNewValue!==null?u.setAttribute(l,g.attributeNewValue,b):u.removeAttribute(l,b),g.item.hasAttribute("sources"))return;const v=g.item.hasAttribute("resizedWidth");if(e==="imageInline"&&!v&&!c)return;const K=g.item.getAttribute("width"),J=g.item.getAttribute("height");K&&J&&u.setStyle("aspect-ratio",`${K}/${J}`,b)})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ee extends C{constructor(e,t){super(e),this._modelElementName=t}refresh(){const t=this.editor.plugins.get("ImageUtils"),i=t.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=t.isInlineImage(i):this.isEnabled=t.isBlockImage(i)}execute(e={}){const t=this.editor,i=this.editor.model,n=t.plugins.get("ImageUtils"),o=n.getClosestSelectedImageElement(i.document.selection),s=Object.fromEntries(o.getAttributes());return!s.src&&!s.uploadId?null:i.change(r=>{const{setImageSizes:l=!0}=e,c=Array.from(i.markers).filter(d=>d.getRange().containsItem(o)),m=n.insertImage(s,i.createSelection(o,"on"),this._modelElementName,{setImageSizes:l});if(!m)return null;const g=r.createRangeOn(m);for(const d of c){const u=d.getRange(),h=u.root.rootName!="$graveyard"?u.getJoined(g,!0):g;r.updateMarker(d,{range:h})}return{oldElement:o,newElement:m}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ke extends p{static get requires(){return[f]}static get pluginName(){return"ImagePlaceholder"}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const e=this.editor.model.schema;e.isRegistered("imageBlock")&&e.extend("imageBlock",{allowAttributes:["placeholder"]}),e.isRegistered("imageInline")&&e.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const e=this.editor,t=e.conversion,i=e.plugins.get("ImageUtils");t.for("editingDowncast").add(n=>{n.on("attribute:placeholder",(o,s,r)=>{if(!r.consumable.test(s.item,o.name)||!s.item.is("element","imageBlock")&&!s.item.is("element","imageInline"))return;r.consumable.consume(s.item,o.name);const l=r.writer,c=r.mapper.toViewElement(s.item),m=i.findViewImgElement(c);s.attributeNewValue?(l.addClass("image_placeholder",m),l.setStyle("background-image",`url(${s.attributeNewValue})`,m),l.setCustomProperty("editingPipeline:doNotReuseOnce",!0,m)):(l.removeClass("image_placeholder",m),l.removeStyle("background-image",m))})})}_setupLoadListener(){const e=this.editor,t=e.model,i=e.editing,n=i.view,o=e.plugins.get("ImageUtils");n.addObserver(G),this.listenTo(n.document,"imageLoaded",(s,r)=>{const l=n.domConverter.mapDomToView(r.target);if(!l)return;const c=o.getImageWidgetFromImageView(l);if(!c)return;const m=i.mapper.toModelElement(c);!m||!m.hasAttribute("placeholder")||t.enqueueChange({isUndoable:!1},g=>{g.removeAttribute("placeholder",m)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Se extends p{static get requires(){return[Ce,ve,f,ke,$]}static get pluginName(){return"ImageBlockEditing"}init(){const e=this.editor;e.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),e.plugins.has("ImageInlineEditing")&&(e.commands.add("imageTypeBlock",new Ee(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,i=e.conversion,n=e.plugins.get("ImageUtils");i.for("dataDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:s})=>X(s)}),i.for("editingDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:s})=>n.toImageWidget(X(s),s,t("image widget"))}),i.for("downcast").add(B(n,"imageBlock","src")).add(B(n,"imageBlock","alt")).add(ye(n,"imageBlock")),i.for("upcast").elementToElement({view:fe(e,"imageBlock"),model:(o,{writer:s})=>s.createElement("imageBlock",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)}).add(ht(n))}_setupClipboardIntegration(){const e=this.editor,t=e.model,i=e.editing.view,n=e.plugins.get("ImageUtils"),o=e.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(s,r)=>{const l=Array.from(r.content.getChildren());let c;if(!l.every(n.isInlineImageView))return;r.targetRanges?c=e.editing.mapper.toModelRange(r.targetRanges[0]):c=t.document.selection.getFirstRange();const m=t.createSelection(c);if(H(t.schema,m)==="imageBlock"){const g=new P(i.document),d=l.map(u=>g.createElement("figure",{class:"image"},u));r.content=g.createDocumentFragment(d)}}),this.listenTo(o,"contentInsertion",(s,r)=>{r.method==="paste"&&t.change(l=>{const c=l.createRangeIn(r.content);for(const m of c.getItems())m.is("element","imageBlock")&&n.setImageNaturalSizeAttributes(m)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class It extends W{constructor(e,t=[]){super(e),this.focusTracker=new O,this.keystrokes=new D,this._focusables=new M,this.children=this.createCollection(),this._focusCycler=new q({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const i of t)this.children.add(i),this._focusables.add(i),i instanceof ue&&this._focusables.addMany(i.children);if(this._focusables.length>1)for(const i of this._focusables)bt(i)&&(i.focusCycler.on("forwardCycle",n=>{this._focusCycler.focusNext(),n.stop()}),i.focusCycler.on("backwardCycle",n=>{this._focusCycler.focusPrevious(),n.stop()}));this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),ce({view:this});for(const t of this._focusables)this.focusTracker.add(t.element);this.keystrokes.listenTo(this.element);const e=t=>t.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}function bt(a){return"focusCycler"in a}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class S extends p{static get pluginName(){return"ImageInsertUI"}static get requires(){return[f]}constructor(e){super(e),this._integrations=new Map,e.config.define("image.insert.integrations",["upload","assetManager","url"])}init(){const e=this.editor,t=e.model.document.selection,i=e.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(e.model.document,"change",()=>{this.isImageSelected=i.isImage(t.getSelectedElement())});const n=o=>this._createToolbarComponent(o);e.ui.componentFactory.add("insertImage",n),e.ui.componentFactory.add("imageInsert",n)}registerIntegration({name:e,observable:t,buttonViewCreator:i,formViewCreator:n,requiresForm:o}){this._integrations.has(e)&&w("image-insert-integration-exists",{name:e}),this._integrations.set(e,{observable:t,buttonViewCreator:i,formViewCreator:n,requiresForm:!!o})}_createToolbarComponent(e){const t=this.editor,i=e.t,n=this._prepareIntegrations();if(!n.length)return null;let o;const s=n[0];if(n.length==1){if(!s.requiresForm)return s.buttonViewCreator(!0);o=s.buttonViewCreator(!0)}else{const c=s.buttonViewCreator(!1);o=new de(e,c),o.tooltip=!0,o.bind("label").to(this,"isImageSelected",m=>i(m?"Replace image":"Insert image"))}const r=this.dropdownView=j(e,o),l=n.map(({observable:c})=>c);return r.bind("isEnabled").toMany(l,"isEnabled",(...c)=>c.some(m=>m)),r.once("change:isOpen",()=>{const c=n.map(({formViewCreator:g})=>g(n.length==1)),m=new It(t.locale,c);r.panelView.children.add(m)}),r}_prepareIntegrations(){const t=this.editor.config.get("image.insert.integrations"),i=[];if(!t.length)return w("image-insert-integrations-not-specified"),i;for(const n of t){if(!this._integrations.has(n)){["upload","assetManager","url"].includes(n)||w("image-insert-unknown-integration",{item:n});continue}i.push(this._integrations.get(n))}return i.length||w("image-insert-integrations-not-registered"),i}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wt extends p{static get requires(){return[Se,le,we,S]}static get pluginName(){return"ImageBlock"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yt extends p{static get requires(){return[Ce,ve,f,ke,$]}static get pluginName(){return"ImageInlineEditing"}init(){const e=this.editor,t=e.model.schema;t.register("imageInline",{inheritAllFrom:"$inlineObject",allowAttributes:["alt","src","srcset"]}),t.addChildCheck((i,n)=>{if(i.endsWith("caption")&&n.name==="imageInline")return!1}),this._setupConversion(),e.plugins.has("ImageBlockEditing")&&(e.commands.add("imageTypeInline",new Ee(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,i=e.conversion,n=e.plugins.get("ImageUtils");i.for("dataDowncast").elementToElement({model:"imageInline",view:(o,{writer:s})=>s.createEmptyElement("img")}),i.for("editingDowncast").elementToStructure({model:"imageInline",view:(o,{writer:s})=>n.toImageWidget(st(s),s,t("image widget"))}),i.for("downcast").add(B(n,"imageInline","src")).add(B(n,"imageInline","alt")).add(ye(n,"imageInline")),i.for("upcast").elementToElement({view:fe(e,"imageInline"),model:(o,{writer:s})=>s.createElement("imageInline",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)})}_setupClipboardIntegration(){const e=this.editor,t=e.model,i=e.editing.view,n=e.plugins.get("ImageUtils"),o=e.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(s,r)=>{const l=Array.from(r.content.getChildren());let c;if(!l.every(n.isBlockImageView))return;r.targetRanges?c=e.editing.mapper.toModelRange(r.targetRanges[0]):c=t.document.selection.getFirstRange();const m=t.createSelection(c);if(H(t.schema,m)==="imageInline"){const g=new P(i.document),d=l.map(u=>u.childCount===1?(Array.from(u.getAttributes()).forEach(h=>g.setAttribute(...h,n.findViewImgElement(u))),u.getChild(0)):u);r.content=g.createDocumentFragment(d)}}),this.listenTo(o,"contentInsertion",(s,r)=>{r.method==="paste"&&t.change(l=>{const c=l.createRangeIn(r.content);for(const m of c.getItems())m.is("element","imageInline")&&n.setImageNaturalSizeAttributes(m)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ct extends p{static get requires(){return[yt,le,we,S]}static get pluginName(){return"ImageInline"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fi extends p{static get requires(){return[wt,Ct]}static get pluginName(){return"Image"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _e extends p{static get pluginName(){return"ImageCaptionUtils"}static get requires(){return[f]}getCaptionFromImageModelElement(e){for(const t of e.getChildren())if(t&&t.is("element","caption"))return t;return null}getCaptionFromModelSelection(e){const t=this.editor.plugins.get("ImageUtils"),i=e.getFirstPosition().findAncestor("caption");return i&&t.isBlockImage(i.parent)?i:null}matchImageCaptionViewElement(e){const t=this.editor.plugins.get("ImageUtils");return e.name=="figcaption"&&t.isBlockImageView(e.parent)?{name:!0}:null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vt extends C{refresh(){const e=this.editor,t=e.plugins.get("ImageCaptionUtils"),i=e.plugins.get("ImageUtils");if(!e.plugins.has(Se)){this.isEnabled=!1,this.value=!1;return}const n=e.model.document.selection,o=n.getSelectedElement();if(!o){const s=t.getCaptionFromModelSelection(n);this.isEnabled=!!s,this.value=!!s;return}this.isEnabled=i.isImage(o),this.isEnabled?this.value=!!t.getCaptionFromImageModelElement(o):this.value=!1}execute(e={}){const{focusCaptionOnShow:t}=e;this.editor.model.change(i=>{this.value?this._hideImageCaption(i):this._showImageCaption(i,t)})}_showImageCaption(e,t){const n=this.editor.model.document.selection,o=this.editor.plugins.get("ImageCaptionEditing"),s=this.editor.plugins.get("ImageUtils");let r=n.getSelectedElement();const l=o._getSavedCaption(r);s.isInlineImage(r)&&(this.editor.execute("imageTypeBlock"),r=n.getSelectedElement());const c=l||e.createElement("caption");e.append(c,r),t&&e.setSelection(c,"in")}_hideImageCaption(e){const t=this.editor,i=t.model.document.selection,n=t.plugins.get("ImageCaptionEditing"),o=t.plugins.get("ImageCaptionUtils");let s=i.getSelectedElement(),r;s?r=o.getCaptionFromImageModelElement(s):(r=o.getCaptionFromModelSelection(i),s=r.parent),n._saveCaption(s,r),e.setSelection(s,"on"),e.remove(r)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Et extends p{static get requires(){return[f,_e]}static get pluginName(){return"ImageCaptionEditing"}constructor(e){super(e),this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema;t.isRegistered("caption")?t.extend("caption",{allowIn:"imageBlock"}):t.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleImageCaption",new vt(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration(),this._registerCaptionReconversion()}_setupConversion(){const e=this.editor,t=e.editing.view,i=e.plugins.get("ImageUtils"),n=e.plugins.get("ImageCaptionUtils"),o=e.t;e.conversion.for("upcast").elementToElement({view:s=>n.matchImageCaptionViewElement(s),model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(s,{writer:r})=>i.isBlockImage(s.parent)?r.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(s,{writer:r})=>{if(!i.isBlockImage(s.parent))return null;const l=r.createEditableElement("figcaption");r.setCustomProperty("imageCaption",!0,l),l.placeholder=o("Enter image caption"),je({view:t,element:l,keepOnFocus:!0});const c=s.parent.getAttribute("alt"),m=c?o("Caption for image: %0",[c]):o("Caption for the image");return Je(l,r,{label:m})}})}_setupImageTypeCommandsIntegration(){const e=this.editor,t=e.plugins.get("ImageUtils"),i=e.plugins.get("ImageCaptionUtils"),n=e.commands.get("imageTypeInline"),o=e.commands.get("imageTypeBlock"),s=r=>{if(!r.return)return;const{oldElement:l,newElement:c}=r.return;/* istanbul ignore if: paranoid check -- @preserve */if(!l)return;if(t.isBlockImage(l)){const g=i.getCaptionFromImageModelElement(l);if(g){this._saveCaption(c,g);return}}const m=this._getSavedCaption(l);m&&this._saveCaption(c,m)};n&&this.listenTo(n,"execute",s,{priority:"low"}),o&&this.listenTo(o,"execute",s,{priority:"low"})}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?$e.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}_registerCaptionReconversion(){const e=this.editor,t=e.model,i=e.plugins.get("ImageUtils"),n=e.plugins.get("ImageCaptionUtils");t.document.on("change:data",()=>{const o=t.document.differ.getChanges();for(const s of o){if(s.attributeKey!=="alt")continue;const r=s.range.start.nodeAfter;if(i.isBlockImage(r)){const l=n.getCaptionFromImageModelElement(r);if(!l)return;e.editing.reconvertItem(l)}}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kt extends p{static get requires(){return[_e]}static get pluginName(){return"ImageCaptionUI"}init(){const e=this.editor,t=e.editing.view,i=e.plugins.get("ImageCaptionUtils"),n=e.t;e.ui.componentFactory.add("toggleImageCaption",o=>{const s=e.commands.get("toggleImageCaption"),r=new y(o);return r.set({icon:I.caption,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(s,"value","isEnabled"),r.bind("label").to(s,"value",l=>n(l?"Toggle caption off":"Toggle caption on")),this.listenTo(r,"execute",()=>{e.execute("toggleImageCaption",{focusCaptionOnShow:!0});const l=i.getCaptionFromModelSelection(e.model.document.selection);if(l){const c=e.editing.mapper.toViewElement(l);t.scrollToTheSelection(),t.change(m=>{m.addClass("image__caption_highlighted",c)})}e.editing.view.focus()}),r})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ii extends p{static get requires(){return[Et,kt]}static get pluginName(){return"ImageCaption"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ue(a){const e=a.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${e.join("|")})$`)}function St(a){return new Promise((e,t)=>{const i=a.getAttribute("src");fetch(i).then(n=>n.blob()).then(n=>{const o=Ae(n,i),r=`image.${o.replace("image/","")}`,l=new File([n],r,{type:o});e(l)}).catch(n=>n&&n.name==="TypeError"?Ut(i).then(e).catch(t):t(n))})}function _t(a,e){return!a.isInlineImageView(e)||!e.getAttribute("src")?!1:!!e.getAttribute("src").match(/^data:image\/\w+;base64,/g)||!!e.getAttribute("src").match(/^blob:/g)}function Ae(a,e){return a.type?a.type:e.match(/data:(image\/\w+);base64/)?e.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function Ut(a){return At(a).then(e=>{const t=Ae(e,a),n=`image.${t.replace("image/","")}`;return new File([e],n,{type:t})})}function At(a){return new Promise((e,t)=>{const i=R.document.createElement("img");i.addEventListener("load",()=>{const n=R.document.createElement("canvas");n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(i,0,0),n.toBlob(s=>s?e(s):t())}),i.addEventListener("error",()=>t()),i.src=a})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bt extends p{static get pluginName(){return"ImageUploadUI"}init(){const e=this.editor,t=e.t,i=n=>{const o=new nt(n),s=e.commands.get("uploadImage"),r=e.config.get("image.upload.types"),l=Ue(r);return o.set({acceptedType:r.map(c=>`image/${c}`).join(","),allowMultipleFiles:!0,label:t("Upload image from computer"),icon:I.imageUpload,tooltip:!0}),o.bind("isEnabled").to(s),o.on("done",(c,m)=>{const g=Array.from(m).filter(d=>l.test(d.type));g.length&&(e.execute("uploadImage",{file:g}),e.editing.view.focus())}),o};if(e.ui.componentFactory.add("uploadImage",i),e.ui.componentFactory.add("imageUpload",i),e.plugins.has("ImageInsertUI")){const n=e.plugins.get("ImageInsertUI"),o=e.commands.get("uploadImage");n.registerIntegration({name:"upload",observable:o,buttonViewCreator:()=>{const s=e.ui.componentFactory.create("uploadImage");return s.bind("label").to(n,"isImageSelected",r=>t(r?"Replace image from computer":"Upload image from computer")),s},formViewCreator:()=>{const s=e.ui.componentFactory.create("uploadImage");return s.withText=!0,s.bind("label").to(n,"isImageSelected",r=>t(r?"Replace from computer":"Upload from computer")),s.on("execute",()=>{n.dropdownView.isOpen=!1}),s}})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vt extends p{static get pluginName(){return"ImageUploadProgress"}constructor(e){super(e),this.uploadStatusChange=(t,i,n)=>{const o=this.editor,s=i.item,r=s.getAttribute("uploadId");if(!n.consumable.consume(i.item,t.name))return;const l=o.plugins.get("ImageUtils"),c=o.plugins.get(k),m=r?i.attributeNewValue:null,g=this.placeholder,d=o.editing.mapper.toViewElement(s),u=n.writer;if(m=="reading"){Y(d,u),ee(l,g,d,u);return}if(m=="uploading"){const h=c.loaders.get(r);Y(d,u),h?(te(d,u),Tt(d,u,h,o.editing.view),Lt(l,d,u,h)):ee(l,g,d,u);return}m=="complete"&&c.loaders.get(r)&&zt(d,u,o.editing.view),Rt(d,u),te(d,u),xt(d,u)},this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}init(){const e=this.editor;e.plugins.has("ImageBlockEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",this.uploadStatusChange),e.plugins.has("ImageInlineEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",this.uploadStatusChange)}}function Y(a,e){a.hasClass("ck-appear")||e.addClass("ck-appear",a)}function xt(a,e){e.removeClass("ck-appear",a)}function ee(a,e,t,i){t.hasClass("ck-image-upload-placeholder")||i.addClass("ck-image-upload-placeholder",t);const n=a.findViewImgElement(t);n.getAttribute("src")!==e&&i.setAttribute("src",e,n),Be(t,"placeholder")||i.insert(i.createPositionAfter(n),Ft(i))}function te(a,e){a.hasClass("ck-image-upload-placeholder")&&e.removeClass("ck-image-upload-placeholder",a),Ve(a,e,"placeholder")}function Tt(a,e,t,i){const n=Nt(e);e.insert(e.createPositionAt(a,"end"),n),t.on("change:uploadedPercent",(o,s,r)=>{i.change(l=>{l.setStyle("width",r+"%",n)})})}function Rt(a,e){Ve(a,e,"progressBar")}function zt(a,e,t){const i=e.createUIElement("div",{class:"ck-image-upload-complete-icon"});e.insert(e.createPositionAt(a,"end"),i),setTimeout(()=>{t.change(n=>n.remove(n.createRangeOn(i)))},3e3)}function Nt(a){const e=a.createUIElement("div",{class:"ck-progress-bar"});return a.setCustomProperty("progressBar",!0,e),e}function Ft(a){const e=a.createUIElement("div",{class:"ck-upload-placeholder-loader"});return a.setCustomProperty("placeholder",!0,e),e}function Be(a,e){for(const t of a.getChildren())if(t.getCustomProperty(e))return t}function Ve(a,e,t){const i=Be(a,t);i&&e.remove(e.createRangeOn(i))}function Lt(a,e,t,i){if(i.data){const n=a.findViewImgElement(e);t.setAttribute("src",i.data,n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ot extends C{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils"),i=e.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(i)}execute(e){const t=re(e.file),i=this.editor.model.document.selection,n=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(i.getAttributes());t.forEach((s,r)=>{const l=i.getSelectedElement();if(r&&l&&n.isImage(l)){const c=this.editor.model.createPositionAfter(l);this._uploadImage(s,o,c)}else this._uploadImage(s,o)})}_uploadImage(e,t,i){const n=this.editor,s=n.plugins.get(k).createLoader(e),r=n.plugins.get("ImageUtils");s&&r.insertImage({...t,uploadId:s.id},i)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Dt extends p{static get requires(){return[k,Q,$,f]}static get pluginName(){return"ImageUploadEditing"}constructor(e){super(e),e.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}init(){const e=this.editor,t=e.model.document,i=e.conversion,n=e.plugins.get(k),o=e.plugins.get("ImageUtils"),s=e.plugins.get("ClipboardPipeline"),r=Ue(e.config.get("image.upload.types")),l=new Ot(e);e.commands.add("uploadImage",l),e.commands.add("imageUpload",l),i.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(e.editing.view.document,"clipboardInput",(c,m)=>{if(Pt(m.dataTransfer))return;const g=Array.from(m.dataTransfer.files).filter(d=>d?r.test(d.type):!1);g.length&&(c.stop(),e.model.change(d=>{m.targetRanges&&d.setSelection(m.targetRanges.map(u=>e.editing.mapper.toModelRange(u))),e.execute("uploadImage",{file:g})}))}),this.listenTo(s,"inputTransformation",(c,m)=>{const g=Array.from(e.editing.view.createRangeIn(m.content)).map(u=>u.item).filter(u=>_t(o,u)&&!u.getAttribute("uploadProcessed")).map(u=>({promise:St(u),imageElement:u}));if(!g.length)return;const d=new P(e.editing.view.document);for(const u of g){d.setAttribute("uploadProcessed",!0,u.imageElement);const h=n.createLoader(u.promise);h&&(d.setAttribute("src","",u.imageElement),d.setAttribute("uploadId",h.id,u.imageElement))}}),e.editing.view.document.on("dragover",(c,m)=>{m.preventDefault()}),t.on("change",()=>{const c=t.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),m=new Set;for(const g of c)if(g.type=="insert"&&g.name!="$text"){const d=g.position.nodeAfter,u=g.position.root.rootName=="$graveyard";for(const h of Wt(e,d)){const b=h.getAttribute("uploadId");if(!b)continue;const v=n.loaders.get(b);v&&(u?m.has(b)||v.abort():(m.add(b),this._uploadImageElements.set(b,h),v.status=="idle"&&this._readAndUpload(v)))}}}),this.on("uploadComplete",(c,{imageElement:m,data:g})=>{const d=g.urls?g.urls:g;this.editor.model.change(u=>{u.setAttribute("src",d.default,m),this._parseAndSetSrcsetAttributeOnImage(d,m,u),o.setImageNaturalSizeAttributes(m)})},{priority:"low"})}afterInit(){const e=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&e.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(e){const t=this.editor,i=t.model,n=t.locale.t,o=t.plugins.get(k),s=t.plugins.get(Q),r=t.plugins.get("ImageUtils"),l=this._uploadImageElements;return i.enqueueChange({isUndoable:!1},m=>{m.setAttribute("uploadStatus","reading",l.get(e.id))}),e.read().then(()=>{const m=e.upload(),g=l.get(e.id);/* istanbul ignore next -- @preserve */if(Pe.isSafari){const d=t.editing.mapper.toViewElement(g),u=r.findViewImgElement(d);t.editing.view.once("render",()=>{if(!u.parent)return;const h=t.editing.view.domConverter.mapViewToDom(u.parent);if(!h)return;const b=h.style.display;h.style.display="none",h._ckHack=h.offsetHeight,h.style.display=b})}return i.enqueueChange({isUndoable:!1},d=>{d.setAttribute("uploadStatus","uploading",g)}),m}).then(m=>{i.enqueueChange({isUndoable:!1},g=>{const d=l.get(e.id);g.setAttribute("uploadStatus","complete",d),this.fire("uploadComplete",{data:m,imageElement:d})}),c()}).catch(m=>{if(e.status!=="error"&&e.status!=="aborted")throw m;e.status=="error"&&m&&s.showWarning(m,{title:n("Upload failed"),namespace:"upload"}),i.enqueueChange({isUndoable:!1},g=>{g.remove(l.get(e.id))}),c()});function c(){i.enqueueChange({isUndoable:!1},m=>{const g=l.get(e.id);m.removeAttribute("uploadId",g),m.removeAttribute("uploadStatus",g),l.delete(e.id)}),o.destroyLoader(e)}}_parseAndSetSrcsetAttributeOnImage(e,t,i){let n=0;const o=Object.keys(e).filter(s=>{const r=parseInt(s,10);if(!isNaN(r))return n=Math.max(n,r),!0}).map(s=>`${e[s]} ${s}w`).join(", ");if(o!=""){const s={srcset:o};!t.hasAttribute("width")&&!t.hasAttribute("height")&&(s.width=n),i.setAttributes(s,t)}}}function Pt(a){return Array.from(a.types).includes("text/html")&&a.getData("text/html")!==""}function Wt(a,e){const t=a.plugins.get("ImageUtils");return Array.from(a.model.createRangeOn(e)).filter(i=>t.isImage(i.item)).map(i=>i.item)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mt extends p{static get pluginName(){return"ImageUpload"}static get requires(){return[Dt,Bt,Vt]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qt extends W{constructor(e){super(e),this.set("imageURLInputValue",""),this.set("isImageSelected",!1),this.set("isEnabled",!0),this.focusTracker=new O,this.keystrokes=new D,this._focusables=new M,this.focusCycler=new q({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.urlInputView=this._createUrlInputView(),this.insertButtonView=this._createInsertButton(),this.cancelButtonView=this._createCancelButton(),this._focusables.addMany([this.urlInputView,this.insertButtonView,this.cancelButtonView]),this.setTemplate({tag:"div",attributes:{class:["ck","ck-image-insert-url"]},children:[this.urlInputView,{tag:"div",attributes:{class:["ck","ck-image-insert-url__action-row"]},children:[this.insertButtonView,this.cancelButtonView]}]})}render(){super.render();for(const e of this._focusables)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createUrlInputView(){const e=this.locale,t=e.t,i=new me(e,ge);return i.bind("label").to(this,"isImageSelected",n=>t(n?"Update image URL":"Insert image via URL")),i.bind("isEnabled").to(this),i.fieldView.placeholder="https://example.com/image.png",i.fieldView.bind("value").to(this,"imageURLInputValue",n=>n||""),i.fieldView.on("input",()=>{this.imageURLInputValue=i.fieldView.element.value.trim()}),i}_createInsertButton(){const e=this.locale,t=e.t,i=new y(e);return i.set({icon:I.check,class:"ck-button-save",type:"submit",withText:!0}),i.bind("label").to(this,"isImageSelected",n=>t(n?"Update":"Insert")),i.bind("isEnabled").to(this,"imageURLInputValue",this,"isEnabled",(...n)=>n.every(o=>o)),i.delegate("execute").to(this,"submit"),i}_createCancelButton(){const e=this.locale,t=e.t,i=new y(e);return i.set({label:t("Cancel"),icon:I.cancel,class:"ck-button-cancel",withText:!0}),i.bind("isEnabled").to(this),i.delegate("execute").to(this,"cancel"),i}focus(e){e===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class jt extends p{static get pluginName(){return"ImageInsertViaUrlUI"}static get requires(){return[S]}init(){this._imageInsertUI=this.editor.plugins.get("ImageInsertUI");const e=this.editor.commands.get("insertImage");this._imageInsertUI.registerIntegration({name:"url",observable:e,requiresForm:!0,buttonViewCreator:t=>this._createInsertUrlButton(t),formViewCreator:t=>this._createInsertUrlView(t)})}_createInsertUrlView(e){const t=this.editor,i=t.locale,n=i.t,o=t.commands.get("replaceImageSource"),s=t.commands.get("insertImage"),r=new qt(i),l=e?null:new ue(i,[r]);return r.bind("isImageSelected").to(this._imageInsertUI),r.bind("isEnabled").toMany([s,o],"isEnabled",(...c)=>c.some(m=>m)),r.imageURLInputValue=o.value||"",this._imageInsertUI.dropdownView.on("change:isOpen",()=>{this._imageInsertUI.dropdownView.isOpen&&(r.imageURLInputValue=o.value||"",l&&(l.isCollapsed=!0))},{priority:"low"}),r.on("submit",()=>{o.isEnabled?t.execute("replaceImageSource",{source:r.imageURLInputValue}):t.execute("insertImage",{source:r.imageURLInputValue}),this._closePanel()}),r.on("cancel",()=>this._closePanel()),l?(l.set({isCollapsed:!0}),l.bind("label").to(this._imageInsertUI,"isImageSelected",c=>n(c?"Update image URL":"Insert image via URL")),l):r}_createInsertUrlButton(e){const t=e?he:y,i=this.editor,n=new t(i.locale),o=i.locale.t;return n.set({icon:I.imageUrl,tooltip:!0}),n.bind("label").to(this._imageInsertUI,"isImageSelected",s=>o(s?"Update image URL":"Insert image via URL")),n}_closePanel(){this.editor.editing.view.focus(),this._imageInsertUI.dropdownView.isOpen=!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $t extends p{static get pluginName(){return"ImageInsertViaUrl"}static get requires(){return[jt,S]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bi extends p{static get pluginName(){return"ImageInsert"}static get requires(){return[Mt,$t,S]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ht extends C{refresh(){const e=this.editor,i=e.plugins.get("ImageUtils").getClosestSelectedImageElement(e.model.document.selection);this.isEnabled=!!i,!i||!i.hasAttribute("resizedWidth")?this.value=null:this.value={width:i.getAttribute("resizedWidth"),height:null}}execute(e){const t=this.editor,i=t.model,n=t.plugins.get("ImageUtils"),o=n.getClosestSelectedImageElement(i.document.selection);this.value={width:e.width,height:null},o&&i.change(s=>{s.setAttribute("resizedWidth",e.width,o),s.removeAttribute("resizedHeight",o),n.setImageNaturalSizeAttributes(o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gt extends p{static get requires(){return[f]}static get pluginName(){return"ImageResizeEditing"}constructor(e){super(e),e.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const e=this.editor,t=new Ht(e);this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline"),e.commands.add("resizeImage",t),e.commands.add("imageResize",t)}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["resizedWidth","resizedHeight"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["resizedWidth","resizedHeight"]})}_registerConverters(e){const t=this.editor,i=t.plugins.get("ImageUtils");t.conversion.for("downcast").add(n=>n.on(`attribute:resizedWidth:${e}`,(o,s,r)=>{if(!r.consumable.consume(s.item,o.name))return;const l=r.writer,c=r.mapper.toViewElement(s.item);s.attributeNewValue!==null?(l.setStyle("width",s.attributeNewValue,c),l.addClass("image_resized",c)):(l.removeStyle("width",c),l.removeClass("image_resized",c))})),t.conversion.for("dataDowncast").attributeToAttribute({model:{name:e,key:"resizedHeight"},view:n=>({key:"style",value:{height:n}})}),t.conversion.for("editingDowncast").add(n=>n.on(`attribute:resizedHeight:${e}`,(o,s,r)=>{if(!r.consumable.consume(s.item,o.name))return;const l=r.writer,c=r.mapper.toViewElement(s.item),m=e==="imageInline"?i.findViewImgElement(c):c;s.attributeNewValue!==null?l.setStyle("height",s.attributeNewValue,m):l.removeStyle("height",m)})),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"resizedWidth",value:n=>A(n)?null:n.getStyle("width")}}),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{height:/.+/}},model:{key:"resizedHeight",value:n=>A(n)?null:n.getStyle("height")}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const x={small:I.objectSizeSmall,medium:I.objectSizeMedium,large:I.objectSizeLarge,original:I.objectSizeFull};class wi extends p{static get requires(){return[Gt]}static get pluginName(){return"ImageResizeButtons"}constructor(e){super(e),this._resizeUnit=e.config.get("image.resizeUnit")}init(){const e=this.editor,t=e.config.get("image.resizeOptions"),i=e.commands.get("resizeImage");this.bind("isEnabled").to(i);for(const n of t)this._registerImageResizeButton(n);this._registerImageResizeDropdown(t)}_registerImageResizeButton(e){const t=this.editor,{name:i,value:n,icon:o}=e,s=n?n+this._resizeUnit:null;t.ui.componentFactory.add(i,r=>{const l=new y(r),c=t.commands.get("resizeImage"),m=this._getOptionLabelValue(e,!0);if(!x[o])throw new We("imageresizebuttons-missing-icon",t,e);return l.set({label:m,icon:x[o],tooltip:m,isToggleable:!0}),l.bind("isEnabled").to(this),l.bind("isOn").to(c,"value",ie(s)),this.listenTo(l,"execute",()=>{t.execute("resizeImage",{width:s})}),l})}_registerImageResizeDropdown(e){const t=this.editor,i=t.t,n=e.find(s=>!s.value),o=s=>{const r=t.commands.get("resizeImage"),l=j(s,he),c=l.buttonView,m=i("Resize image");return c.set({tooltip:m,commandValue:n.value,icon:x.medium,isToggleable:!0,label:this._getOptionLabelValue(n),withText:!0,class:"ck-resize-image-button",ariaLabel:m,ariaLabelledBy:void 0}),c.bind("label").to(r,"value",g=>g&&g.width?g.width:this._getOptionLabelValue(n)),l.bind("isEnabled").to(this),tt(l,()=>this._getResizeDropdownListItemDefinitions(e,r),{ariaLabel:i("Image resize list"),role:"menu"}),this.listenTo(l,"execute",g=>{t.execute(g.source.commandName,{width:g.source.commandValue}),t.editing.view.focus()}),l};t.ui.componentFactory.add("resizeImage",o),t.ui.componentFactory.add("imageResize",o)}_getOptionLabelValue(e,t=!1){const i=this.editor.t;return e.label?e.label:t?e.value?i("Resize image to %0",e.value+this._resizeUnit):i("Resize image to the original size"):e.value?e.value+this._resizeUnit:i("Original")}_getResizeDropdownListItemDefinitions(e,t){const i=new Me;return e.map(n=>{const o=n.value?n.value+this._resizeUnit:null,s={type:"button",model:new et({commandName:"resizeImage",commandValue:o,label:this._getOptionLabelValue(n),role:"menuitemradio",withText:!0,icon:null})};s.model.bind("isOn").to(t,"value",ie(o)),i.add(s)}),i}}function ie(a){return e=>{const t=e;return a===null&&t===a?!0:t!==null&&t.width===a}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Kt="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",T="image_resized";class yi extends p{static get requires(){return[V,f]}static get pluginName(){return"ImageResizeHandles"}init(){const e=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(e),this._setupResizerCreator()}_setupResizerCreator(){const e=this.editor,t=e.editing.view,i=e.plugins.get("ImageUtils");t.addObserver(G),this.listenTo(t.document,"imageLoaded",(n,o)=>{if(!o.target.matches(Kt))return;const s=e.editing.view.domConverter,r=s.domToView(o.target),l=i.getImageWidgetFromImageView(r);let c=this.editor.plugins.get(V).getResizerByViewElement(l);if(c){c.redraw();return}const m=e.editing.mapper,g=m.toModelElement(l);c=e.plugins.get(V).attachTo({unit:e.config.get("image.resizeUnit"),modelElement:g,viewElement:l,editor:e,getHandleHost(d){return d.querySelector("img")},getResizeHost(){return s.mapViewToDom(m.toViewElement(g.parent))},isCentered(){const d=g.getAttribute("imageStyle");return!d||d=="block"||d=="alignCenter"},onCommit(d){t.change(u=>{u.removeClass(T,l)}),e.execute("resizeImage",{width:d})}}),c.on("updateSize",()=>{l.hasClass(T)||t.change(u=>{u.addClass(T,l)});const d=g.name==="imageInline"?r:l;d.getStyle("height")&&t.change(u=>{u.removeStyle("height",d)})}),c.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jt extends C{constructor(e,t){super(e),this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(t.map(i=>{if(i.isDefault)for(const n of i.modelElements)this._defaultStyles[n]=i.name;return[i.name,i]}))}refresh(){const i=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!i,this.isEnabled?i.hasAttribute("imageStyle")?this.value=i.getAttribute("imageStyle"):this.value=this._defaultStyles[i.name]:this.value=!1}execute(e={}){const t=this.editor,i=t.model,n=t.plugins.get("ImageUtils");i.change(o=>{const s=e.value,{setImageSizes:r=!0}=e;let l=n.getClosestSelectedImageElement(i.document.selection);s&&this.shouldConvertImageType(s,l)&&(this.editor.execute(n.isBlockImage(l)?"imageTypeInline":"imageTypeBlock",{setImageSizes:r}),l=n.getClosestSelectedImageElement(i.document.selection)),!s||this._styles.get(s).isDefault?o.removeAttribute("imageStyle",l):o.setAttribute("imageStyle",s,l),r&&n.setImageNaturalSizeAttributes(l)})}shouldConvertImageType(e,t){return!this._styles.get(e).modelElements.includes(t.name)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const{objectFullWidth:Zt,objectInline:xe,objectLeft:Te,objectRight:z,objectCenter:N,objectBlockLeft:Re,objectBlockRight:ze}=I,_={get inline(){return{name:"inline",title:"In line",icon:xe,modelElements:["imageInline"],isDefault:!0}},get alignLeft(){return{name:"alignLeft",title:"Left aligned image",icon:Te,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"}},get alignBlockLeft(){return{name:"alignBlockLeft",title:"Left aligned image",icon:Re,modelElements:["imageBlock"],className:"image-style-block-align-left"}},get alignCenter(){return{name:"alignCenter",title:"Centered image",icon:N,modelElements:["imageBlock"],className:"image-style-align-center"}},get alignRight(){return{name:"alignRight",title:"Right aligned image",icon:z,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"}},get alignBlockRight(){return{name:"alignBlockRight",title:"Right aligned image",icon:ze,modelElements:["imageBlock"],className:"image-style-block-align-right"}},get block(){return{name:"block",title:"Centered image",icon:N,modelElements:["imageBlock"],isDefault:!0}},get side(){return{name:"side",title:"Side image",icon:z,modelElements:["imageBlock"],className:"image-style-side"}}},Ne={full:Zt,left:Re,right:ze,center:N,inlineLeft:Te,inlineRight:z,inline:xe},Fe=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function Qt(a){return(a.configuredStyles.options||[]).map(i=>ei(i)).filter(i=>ti(i,a))}function Xt(a,e){return a&&e?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:a?{options:["block","side"]}:e?{options:["inline","alignLeft","alignRight"]}:{}}function Yt(a){return a.has("ImageBlockEditing")&&a.has("ImageInlineEditing")?[...Fe]:[]}function ei(a){return typeof a=="string"?_[a]?a={..._[a]}:a={name:a}:a=ii(_[a.name],a),typeof a.icon=="string"&&(a.icon=Ne[a.icon]||a.icon),a}function ti(a,{isBlockPluginLoaded:e,isInlinePluginLoaded:t}){const{modelElements:i,name:n}=a;if(!i||!i.length||!n)return Le({style:a}),!1;{const o=[e?"imageBlock":null,t?"imageInline":null];if(!i.some(s=>o.includes(s)))return w("image-style-missing-dependency",{style:a,missingPlugins:i.map(s=>s==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function ii(a,e){const t={...e};for(const i in a)Object.prototype.hasOwnProperty.call(e,i)||(t[i]=a[i]);return t}function Le(a){w("image-style-configuration-definition-invalid",a)}const F={normalizeStyles:Qt,getDefaultStylesConfiguration:Xt,getDefaultDropdownDefinitions:Yt,warnInvalidStyle:Le,DEFAULT_OPTIONS:_,DEFAULT_ICONS:Ne,DEFAULT_DROPDOWN_DEFINITIONS:Fe};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ni(a){return(e,t,i)=>{if(!i.consumable.consume(t.item,e.name))return;const n=ne(t.attributeNewValue,a),o=ne(t.attributeOldValue,a),s=i.mapper.toViewElement(t.item),r=i.writer;o&&r.removeClass(o.className,s),n&&r.addClass(n.className,s)}}function si(a){const e={imageInline:a.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:a.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,i,n)=>{if(!i.modelRange)return;const o=i.viewItem,s=L(i.modelRange.getItems());if(s&&n.schema.checkAttribute(s,"imageStyle"))for(const r of e[s.name])n.consumable.consume(o,{classes:r.className})&&n.writer.setAttribute("imageStyle",r.name,s)}}function ne(a,e){for(const t of e)if(t.name===a)return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Oe extends p{static get pluginName(){return"ImageStyleEditing"}static get requires(){return[f]}init(){const{normalizeStyles:e,getDefaultStylesConfiguration:t}=F,i=this.editor,n=i.plugins.has("ImageBlockEditing"),o=i.plugins.has("ImageInlineEditing");i.config.define("image.styles",t(n,o)),this.normalizedStyles=e({configuredStyles:i.config.get("image.styles"),isBlockPluginLoaded:n,isInlinePluginLoaded:o}),this._setupConversion(n,o),this._setupPostFixer(),i.commands.add("imageStyle",new Jt(i,this.normalizedStyles))}_setupConversion(e,t){const i=this.editor,n=i.model.schema,o=ni(this.normalizedStyles),s=si(this.normalizedStyles);i.editing.downcastDispatcher.on("attribute:imageStyle",o),i.data.downcastDispatcher.on("attribute:imageStyle",o),e&&(n.extend("imageBlock",{allowAttributes:"imageStyle"}),i.data.upcastDispatcher.on("element:figure",s,{priority:"low"})),t&&(n.extend("imageInline",{allowAttributes:"imageStyle"}),i.data.upcastDispatcher.on("element:img",s,{priority:"low"}))}_setupPostFixer(){const e=this.editor,t=e.model.document,i=e.plugins.get(f),n=new Map(this.normalizedStyles.map(o=>[o.name,o]));t.registerPostFixer(o=>{let s=!1;for(const r of t.differ.getChanges())if(r.type=="insert"||r.type=="attribute"&&r.attributeKey=="imageStyle"){let l=r.type=="insert"?r.position.nodeAfter:r.range.start.nodeAfter;if(l&&l.is("element","paragraph")&&l.childCount>0&&(l=l.getChild(0)),!i.isImage(l))continue;const c=l.getAttribute("imageStyle");if(!c)continue;const m=n.get(c);(!m||!m.modelElements.includes(l.name))&&(o.removeAttribute("imageStyle",l),s=!0)}return s})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class oi extends p{static get requires(){return[Oe]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const e=this.editor.t;return{"Wrap text":e("Wrap text"),"Break text":e("Break text"),"In line":e("In line"),"Full size image":e("Full size image"),"Side image":e("Side image"),"Left aligned image":e("Left aligned image"),"Centered image":e("Centered image"),"Right aligned image":e("Right aligned image")}}init(){const e=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],i=e.get("ImageStyleEditing"),n=se(i.normalizedStyles,this.localizedDefaultStylesTitles);for(const s of n)this._createButton(s);const o=se([...t.filter(pe),...F.getDefaultDropdownDefinitions(e)],this.localizedDefaultStylesTitles);for(const s of o)this._createDropdown(s,n)}_createDropdown(e,t){const i=this.editor.ui.componentFactory;i.add(e.name,n=>{let o;const{defaultItem:s,items:r,title:l}=e,c=r.filter(u=>t.find(({name:h})=>oe(h)===u)).map(u=>{const h=i.create(u);return u===s&&(o=h),h});r.length!==c.length&&F.warnInvalidStyle({dropdown:e});const m=j(n,de),g=m.buttonView,d=g.arrowView;return it(m,c,{enableActiveItemFocusOnDropdownOpen:!0}),g.set({label:ae(l,o.label),class:null,tooltip:!0}),d.unbind("label"),d.set({label:l}),g.bind("icon").toMany(c,"isOn",(...u)=>{const h=u.findIndex(E);return h<0?o.icon:c[h].icon}),g.bind("label").toMany(c,"isOn",(...u)=>{const h=u.findIndex(E);return ae(l,h<0?o.label:c[h].label)}),g.bind("isOn").toMany(c,"isOn",(...u)=>u.some(E)),g.bind("class").toMany(c,"isOn",(...u)=>u.some(E)?"ck-splitbutton_flatten":void 0),g.on("execute",()=>{c.some(({isOn:u})=>u)?m.isOpen=!m.isOpen:o.fire("execute")}),m.bind("isEnabled").toMany(c,"isEnabled",(...u)=>u.some(E)),this.listenTo(m,"execute",()=>{this.editor.editing.view.focus()}),m})}_createButton(e){const t=e.name;this.editor.ui.componentFactory.add(oe(t),i=>{const n=this.editor.commands.get("imageStyle"),o=new y(i);return o.set({label:e.title,icon:e.icon,tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(n,"isEnabled"),o.bind("isOn").to(n,"value",s=>s===t),o.on("execute",this._executeCommand.bind(this,t)),o})}_executeCommand(e){this.editor.execute("imageStyle",{value:e}),this.editor.editing.view.focus()}}function se(a,e){for(const t of a)e[t.title]&&(t.title=e[t.title]);return a}function oe(a){return`imageStyle:${a}`}function ae(a,e){return(a?a+": ":"")+e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ci extends p{static get requires(){return[Oe,oi]}static get pluginName(){return"ImageStyle"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vi extends p{static get requires(){return[Z,f]}static get pluginName(){return"ImageToolbar"}afterInit(){const e=this.editor,t=e.t,i=e.plugins.get(Z),n=e.plugins.get("ImageUtils");i.register("image",{ariaLabel:t("Image toolbar"),items:ai(e.config.get("image.toolbar")||[]),getRelatedElement:o=>n.getClosestSelectedImageWidget(o)})}}function ai(a){return a.map(e=>pe(e)?e.name:e)}export{fi as I,Ii as a,Ci as b,vi as c,bi as d,Gt as e,yi as f,wi as g};
