import{l as L,b as N,C as f,k as O,m as ie,n as pe,o as re,O as q,p as Vt,E as mt,h as St,q as ue,r as T,e as x,v as $t,w as ks,x as it,y as Qe,z as Oe,A as yn,g as se,B as bn,F as Et,G as Je,H as vn,D as Pn,I as Cn,J as kn,M as An,N as Sn,u as En,P as rt,Q as As,S as Ss,T as Rn}from"./@ckeditor_ckeditor5-utils@41.1.0-D1rfIdEO.js";import{c as Es,b as Ae,d as Ze,u as Tn,g as et,m as Rs,s as Mn,e as xn,f as gt,h as Nn,j as oe,k as Ge,l as Lt}from"./lodash-es@4.17.21-DPYE078p.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ye=new WeakMap;let Wt=!1;function Ea({view:n,element:e,text:t,isDirectHost:s=!0,keepOnFocus:i=!1}){const r=n.document;Ye.has(r)||(Ye.set(r,new Map),r.registerPostFixer(a=>ot(r,a)),r.on("change:isComposing",()=>{n.change(a=>ot(r,a))},{priority:"high"})),e.is("editableElement")&&e.on("change:placeholder",(a,l,c)=>{o(c)}),e.placeholder?o(e.placeholder):t&&o(t),t&&Dn();function o(a){Ye.get(r).set(e,{text:a,isDirectHost:s,keepOnFocus:i,hostElement:s?e:null}),n.change(l=>ot(r,l))}}function On(n,e){return e.hasClass("ck-placeholder")?!1:(n.addClass("ck-placeholder",e),!0)}function In(n,e){return e.hasClass("ck-placeholder")?(n.removeClass("ck-placeholder",e),!0):!1}function Fn(n,e){if(!n.isAttached()||Array.from(n.getChildren()).some(o=>!o.is("uiElement")))return!1;const s=n.document,r=s.selection.anchor;return s.isComposing&&r&&r.parent===n?!1:e||!s.isFocused?!0:!!r&&r.parent!==n}function ot(n,e){const t=Ye.get(n),s=[];let i=!1;for(const[r,o]of t)o.isDirectHost&&(s.push(r),qt(e,r,o)&&(i=!0));for(const[r,o]of t){if(o.isDirectHost)continue;const a=Bn(r);a&&(s.includes(a)||(o.hostElement=a,qt(e,r,o)&&(i=!0)))}return i}function qt(n,e,t){const{text:s,isDirectHost:i,hostElement:r}=t;let o=!1;return r.getAttribute("data-placeholder")!==s&&(n.setAttribute("data-placeholder",s,r),o=!0),(i||e.childCount==1)&&Fn(r,t.keepOnFocus)?On(n,r)&&(o=!0):In(n,r)&&(o=!0),o}function Bn(n){if(n.childCount){const e=n.getChild(0);if(e.is("element")&&!e.is("uiElement")&&!e.is("attributeElement"))return e}return null}function Dn(){Wt||L("enableplaceholder-deprecated-text-option"),Wt=!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let we=class{is(){throw new Error("is() method is abstract")}};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let ye=class extends N(we){constructor(e){super(),this.document=e,this.parent=null}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))==-1)throw new f("view-node-not-found-in-parent",this);return e}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.root.is("rootElement")}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.index),t=t.parent;return e}getAncestors(e={}){const t=[];let s=e.includeSelf?this:this.parent;for(;s;)t[e.parentFirst?"push":"unshift"](s),s=s.parent;return t}getCommonAncestor(e,t={}){const s=this.getAncestors(t),i=e.getAncestors(t);let r=0;for(;s[r]==i[r]&&s[r];)r++;return r===0?null:s[r-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),s=e.getPath(),i=O(t,s);switch(i){case"prefix":return!0;case"extension":return!1;default:return t[i]<s[i]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}_remove(){this.parent._removeChildren(this.index)}_fireChange(e,t){this.fire(`change:${e}`,t),this.parent&&this.parent._fireChange(e,t)}toJSON(){const e=Es(this);return delete e.parent,e}};ye.prototype.is=function(n){return n==="node"||n==="view:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let A=class pt extends ye{constructor(e,t){super(e),this._textData=t}get data(){return this._textData}get _data(){return this.data}set _data(e){this._fireChange("text",this),this._textData=e}isSimilar(e){return e instanceof pt?this===e||this.data===e.data:!1}_clone(){return new pt(this.document,this.data)}};A.prototype.is=function(n){return n==="$text"||n==="view:$text"||n==="text"||n==="view:text"||n==="node"||n==="view:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let H=class extends we{constructor(e,t,s){if(super(),this.textNode=e,t<0||t>e.data.length)throw new f("view-textproxy-wrong-offsetintext",this);if(s<0||t+s>e.data.length)throw new f("view-textproxy-wrong-length",this);this.data=e.data.substring(t,t+s),this.offsetInText=t}get offsetSize(){return this.data.length}get isPartial(){return this.data.length!==this.textNode.data.length}get parent(){return this.textNode.parent}get root(){return this.textNode.root}get document(){return this.textNode.document}getAncestors(e={}){const t=[];let s=e.includeSelf?this.textNode:this.parent;for(;s!==null;)t[e.parentFirst?"push":"unshift"](s),s=s.parent;return t}};H.prototype.is=function(n){return n==="$textProxy"||n==="view:$textProxy"||n==="textProxy"||n==="view:textProxy"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class De{constructor(...e){this._patterns=[],this.add(...e)}add(...e){for(let t of e)(typeof t=="string"||t instanceof RegExp)&&(t={name:t}),this._patterns.push(t)}match(...e){for(const t of e)for(const s of this._patterns){const i=Ut(t,s);if(i)return{element:t,pattern:s,match:i}}return null}matchAll(...e){const t=[];for(const s of e)for(const i of this._patterns){const r=Ut(s,i);r&&t.push({element:s,pattern:i,match:r})}return t.length>0?t:null}getElementName(){if(this._patterns.length!==1)return null;const e=this._patterns[0],t=e.name;return typeof e!="function"&&t&&!(t instanceof RegExp)?t:null}}function Ut(n,e){if(typeof e=="function")return e(n);const t={};return e.name&&(t.name=Vn(e.name,n.name),!t.name)||e.attributes&&(t.attributes=qn(e.attributes,n),!t.attributes)||e.classes&&(t.classes=Un(e.classes,n),!t.classes)||e.styles&&(t.styles=zn(e.styles,n),!t.styles)?null:t}function Vn(n,e){return n instanceof RegExp?!!e.match(n):n===e}function Rt(n,e,t){const s=$n(n),i=Array.from(e),r=[];if(s.forEach(([o,a])=>{i.forEach(l=>{Ln(o,l)&&Wn(a,l,t)&&r.push(l)})}),!(!s.length||r.length<s.length))return r}function $n(n){return Array.isArray(n)?n.map(e=>Ae(e)?((e.key===void 0||e.value===void 0)&&L("matcher-pattern-missing-key-or-value",e),[e.key,e.value]):[e,!0]):Ae(n)?Object.entries(n):[[n,!0]]}function Ln(n,e){return n===!0||n===e||n instanceof RegExp&&e.match(n)}function Wn(n,e,t){if(n===!0)return!0;const s=t(e);return n===s||n instanceof RegExp&&!!String(s).match(n)}function qn(n,e){const t=new Set(e.getAttributeKeys());return Ae(n)?(n.style!==void 0&&L("matcher-pattern-deprecated-attributes-style-key",n),n.class!==void 0&&L("matcher-pattern-deprecated-attributes-class-key",n)):(t.delete("style"),t.delete("class")),Rt(n,t,s=>e.getAttribute(s))}function Un(n,e){return Rt(n,e.getClassNames(),()=>{})}function zn(n,e){return Rt(n,e.getStyleNames(!0),t=>e.getStyle(t))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _t{constructor(e){this._styles={},this._styleProcessor=e}get isEmpty(){return!Object.entries(this._styles).length}get size(){return this.isEmpty?0:this.getStyleNames().length}setTo(e){this.clear();const t=Jn(e);for(const[s,i]of t)this._styleProcessor.toNormalizedForm(s,i,this._styles)}has(e){if(this.isEmpty)return!1;const s=this._styleProcessor.getReducedForm(e,this._styles).find(([i])=>i===e);return Array.isArray(s)}set(e,t){if(Ze(e))for(const[s,i]of Object.entries(e))this._styleProcessor.toNormalizedForm(s,i,this._styles);else this._styleProcessor.toNormalizedForm(e,t,this._styles)}remove(e){const t=wt(e);Tn(this._styles,t),delete this._styles[e],this._cleanEmptyObjectsOnPath(t)}getNormalized(e){return this._styleProcessor.getNormalized(e,this._styles)}toString(){return this.isEmpty?"":this.getStylesEntries().map(e=>e.join(":")).sort().join(";")+";"}getAsString(e){if(this.isEmpty)return;if(this._styles[e]&&!Ze(this._styles[e]))return this._styles[e];const s=this._styleProcessor.getReducedForm(e,this._styles).find(([i])=>i===e);if(Array.isArray(s))return s[1]}getStyleNames(e=!1){return this.isEmpty?[]:e?this._styleProcessor.getStyleNames(this._styles):this.getStylesEntries().map(([s])=>s)}clear(){this._styles={}}getStylesEntries(){const e=[],t=Object.keys(this._styles);for(const s of t)e.push(...this._styleProcessor.getReducedForm(s,this._styles));return e}_cleanEmptyObjectsOnPath(e){const t=e.split(".");if(!(t.length>1))return;const i=t.splice(0,t.length-1).join("."),r=et(this._styles,i);if(!r)return;!Object.keys(r).length&&this.remove(i)}}class xa{constructor(){this._normalizers=new Map,this._extractors=new Map,this._reducers=new Map,this._consumables=new Map}toNormalizedForm(e,t,s){if(Ze(t)){at(s,wt(e),t);return}if(this._normalizers.has(e)){const i=this._normalizers.get(e),{path:r,value:o}=i(t);at(s,r,o)}else at(s,e,t)}getNormalized(e,t){if(!e)return Rs({},t);if(t[e]!==void 0)return t[e];if(this._extractors.has(e)){const s=this._extractors.get(e);if(typeof s=="string")return et(t,s);const i=s(e,t);if(i)return i}return et(t,wt(e))}getReducedForm(e,t){const s=this.getNormalized(e,t);return s===void 0?[]:this._reducers.has(e)?this._reducers.get(e)(s):[[e,s]]}getStyleNames(e){const t=Array.from(this._consumables.keys()).filter(i=>{const r=this.getNormalized(i,e);return r&&typeof r=="object"?Object.keys(r).length:r}),s=new Set([...t,...Object.keys(e)]);return Array.from(s)}getRelatedStyles(e){return this._consumables.get(e)||[]}setNormalizer(e,t){this._normalizers.set(e,t)}setExtractor(e,t){this._extractors.set(e,t)}setReducer(e,t){this._reducers.set(e,t)}setStyleRelation(e,t){this._mapStyleNames(e,t);for(const s of t)this._mapStyleNames(s,[e])}_mapStyleNames(e,t){this._consumables.has(e)||this._consumables.set(e,[]),this._consumables.get(e).push(...t)}}function Jn(n){let e=null,t=0,s=0,i=null;const r=new Map;if(n==="")return r;n.charAt(n.length-1)!=";"&&(n=n+";");for(let o=0;o<n.length;o++){const a=n.charAt(o);if(e===null)switch(a){case":":i||(i=n.substr(t,o-t),s=o+1);break;case'"':case"'":e=a;break;case";":{const l=n.substr(s,o-s);i&&r.set(i.trim(),l.trim()),i=null,t=o+1;break}}else a===e&&(e=null)}return r}function wt(n){return n.replace("-",".")}function at(n,e,t){let s=t;Ze(t)&&(s=Rs({},et(n,e),t)),Mn(n,e,s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let G=class Ts extends ye{constructor(e,t,s,i){if(super(e),this._unsafeAttributesToRender=[],this._customProperties=new Map,this.name=t,this._attrs=Gn(s),this._children=[],i&&this._insertChild(0,i),this._classes=new Set,this._attrs.has("class")){const r=this._attrs.get("class");zt(this._classes,r),this._attrs.delete("class")}this._styles=new _t(this.document.stylesProcessor),this._attrs.has("style")&&(this._styles.setTo(this._attrs.get("style")),this._attrs.delete("style"))}get childCount(){return this._children.length}get isEmpty(){return this._children.length===0}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}*getAttributeKeys(){this._classes.size>0&&(yield"class"),this._styles.isEmpty||(yield"style"),yield*this._attrs.keys()}*getAttributes(){yield*this._attrs.entries(),this._classes.size>0&&(yield["class",this.getAttribute("class")]),this._styles.isEmpty||(yield["style",this.getAttribute("style")])}getAttribute(e){if(e=="class")return this._classes.size>0?[...this._classes].join(" "):void 0;if(e=="style"){const t=this._styles.toString();return t==""?void 0:t}return this._attrs.get(e)}hasAttribute(e){return e=="class"?this._classes.size>0:e=="style"?!this._styles.isEmpty:this._attrs.has(e)}isSimilar(e){if(!(e instanceof Ts))return!1;if(this===e)return!0;if(this.name!=e.name||this._attrs.size!==e._attrs.size||this._classes.size!==e._classes.size||this._styles.size!==e._styles.size)return!1;for(const[t,s]of this._attrs)if(!e._attrs.has(t)||e._attrs.get(t)!==s)return!1;for(const t of this._classes)if(!e._classes.has(t))return!1;for(const t of this._styles.getStyleNames())if(!e._styles.has(t)||e._styles.getAsString(t)!==this._styles.getAsString(t))return!1;return!0}hasClass(...e){for(const t of e)if(!this._classes.has(t))return!1;return!0}getClassNames(){return this._classes.keys()}getStyle(e){return this._styles.getAsString(e)}getNormalizedStyle(e){return this._styles.getNormalized(e)}getStyleNames(e){return this._styles.getStyleNames(e)}hasStyle(...e){for(const t of e)if(!this._styles.has(t))return!1;return!0}findAncestor(...e){const t=new De(...e);let s=this.parent;for(;s&&!s.is("documentFragment");){if(t.match(s))return s;s=s.parent}return null}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}getIdentity(){const e=Array.from(this._classes).sort().join(","),t=this._styles.toString(),s=Array.from(this._attrs).map(i=>`${i[0]}="${i[1]}"`).sort().join(" ");return this.name+(e==""?"":` class="${e}"`)+(t?` style="${t}"`:"")+(s==""?"":` ${s}`)}shouldRenderUnsafeAttribute(e){return this._unsafeAttributesToRender.includes(e)}_clone(e=!1){const t=[];if(e)for(const i of this.getChildren())t.push(i._clone(e));const s=new this.constructor(this.document,this.name,this._attrs,t);return s._classes=new Set(this._classes),s._styles.set(this._styles.getNormalized()),s._customProperties=new Map(this._customProperties),s.getFillerOffset=this.getFillerOffset,s._unsafeAttributesToRender=this._unsafeAttributesToRender,s}_appendChild(e){return this._insertChild(this.childCount,e)}_insertChild(e,t){this._fireChange("children",this);let s=0;const i=Kn(this.document,t);for(const r of i)r.parent!==null&&r._remove(),r.parent=this,r.document=this.document,this._children.splice(e,0,r),e++,s++;return s}_removeChildren(e,t=1){this._fireChange("children",this);for(let s=e;s<e+t;s++)this._children[s].parent=null;return this._children.splice(e,t)}_setAttribute(e,t){const s=String(t);this._fireChange("attributes",this),e=="class"?zt(this._classes,s):e=="style"?this._styles.setTo(s):this._attrs.set(e,s)}_removeAttribute(e){return this._fireChange("attributes",this),e=="class"?this._classes.size>0?(this._classes.clear(),!0):!1:e=="style"?this._styles.isEmpty?!1:(this._styles.clear(),!0):this._attrs.delete(e)}_addClass(e){this._fireChange("attributes",this);for(const t of ie(e))this._classes.add(t)}_removeClass(e){this._fireChange("attributes",this);for(const t of ie(e))this._classes.delete(t)}_setStyle(e,t){this._fireChange("attributes",this),typeof e!="string"?this._styles.set(e):this._styles.set(e,t)}_removeStyle(e){this._fireChange("attributes",this);for(const t of ie(e))this._styles.remove(t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}};G.prototype.is=function(n,e){return e?e===this.name&&(n==="element"||n==="view:element"):n==="element"||n==="view:element"||n==="node"||n==="view:node"};function Gn(n){const e=pe(n);for(const[t,s]of e)s===null?e.delete(t):typeof s!="string"&&e.set(t,String(s));return e}function zt(n,e){const t=e.split(/\s+/);n.clear(),t.forEach(s=>n.add(s))}function Kn(n,e){return typeof e=="string"?[new A(n,e)]:(re(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new A(n,t):t instanceof H?new A(n,t.data):t))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ve extends G{constructor(e,t,s,i){super(e,t,s,i),this.getFillerOffset=Hn}}Ve.prototype.is=function(n,e){return e?e===this.name&&(n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"):n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};function Hn(){const n=[...this.getChildren()],e=n[this.childCount-1];if(e&&e.is("element","br"))return this.childCount;for(const t of n)if(!t.is("uiElement"))return null;return this.childCount}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class st extends q(Ve){constructor(e,t,s,i){super(e,t,s,i),this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("placeholder",void 0),this.bind("isReadOnly").to(e),this.bind("isFocused").to(e,"isFocused",r=>r&&e.selection.editableElement==this),this.listenTo(e.selection,"change",()=>{this.isFocused=e.isFocused&&e.selection.editableElement==this})}destroy(){this.stopListening()}}st.prototype.is=function(n,e){return e?e===this.name&&(n==="editableElement"||n==="view:editableElement"||n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"):n==="editableElement"||n==="view:editableElement"||n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Jt=Symbol("rootName");class Ms extends st{constructor(e,t){super(e,t),this.rootName="main"}get rootName(){return this.getCustomProperty(Jt)}set rootName(e){this._setCustomProperty(Jt,e)}set _name(e){this.name=e}}Ms.prototype.is=function(n,e){return e?e===this.name&&(n==="rootElement"||n==="view:rootElement"||n==="editableElement"||n==="view:editableElement"||n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"):n==="rootElement"||n==="view:rootElement"||n==="editableElement"||n==="view:editableElement"||n==="containerElement"||n==="view:containerElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let fe=class{constructor(e={}){if(!e.boundaries&&!e.startPosition)throw new f("view-tree-walker-no-start-position",null);if(e.direction&&e.direction!="forward"&&e.direction!="backward")throw new f("view-tree-walker-unknown-direction",e.startPosition,{direction:e.direction});this.boundaries=e.boundaries||null,e.startPosition?this._position=g._createAt(e.startPosition):this._position=g._createAt(e.boundaries[e.direction=="backward"?"end":"start"]),this.direction=e.direction||"forward",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null}[Symbol.iterator](){return this}get position(){return this._position}skip(e){let t,s;do s=this.position,t=this.next();while(!t.done&&e(t.value));t.done||(this._position=s)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){let e=this.position.clone();const t=this.position,s=e.parent;if(s.parent===null&&e.offset===s.childCount)return{done:!0,value:void 0};if(s===this._boundaryEndParent&&e.offset==this.boundaries.end.offset)return{done:!0,value:void 0};let i;if(s instanceof A){if(e.isAtEnd)return this._position=g._createAfter(s),this._next();i=s.data[e.offset]}else i=s.getChild(e.offset);if(i instanceof G){if(!this.shallow)e=new g(i,0);else{if(this.boundaries&&this.boundaries.end.isBefore(e))return{done:!0,value:void 0};e.offset++}return this._position=e,this._formatReturnValue("elementStart",i,t,e,1)}if(i instanceof A){if(this.singleCharacters)return e=new g(i,0),this._position=e,this._next();let r=i.data.length,o;return i==this._boundaryEndParent?(r=this.boundaries.end.offset,o=new H(i,0,r),e=g._createAfter(o)):(o=new H(i,0,i.data.length),e.offset++),this._position=e,this._formatReturnValue("text",o,t,e,r)}if(typeof i=="string"){let r;this.singleCharacters?r=1:r=(s===this._boundaryEndParent?this.boundaries.end.offset:s.data.length)-e.offset;const o=new H(s,e.offset,r);return e.offset+=r,this._position=e,this._formatReturnValue("text",o,t,e,r)}return e=g._createAfter(s),this._position=e,this.ignoreElementEnd?this._next():this._formatReturnValue("elementEnd",s,t,e)}_previous(){let e=this.position.clone();const t=this.position,s=e.parent;if(s.parent===null&&e.offset===0)return{done:!0,value:void 0};if(s==this._boundaryStartParent&&e.offset==this.boundaries.start.offset)return{done:!0,value:void 0};let i;if(s instanceof A){if(e.isAtStart)return this._position=g._createBefore(s),this._previous();i=s.data[e.offset-1]}else i=s.getChild(e.offset-1);if(i instanceof G)return this.shallow?(e.offset--,this._position=e,this._formatReturnValue("elementStart",i,t,e,1)):(e=new g(i,i.childCount),this._position=e,this.ignoreElementEnd?this._previous():this._formatReturnValue("elementEnd",i,t,e));if(i instanceof A){if(this.singleCharacters)return e=new g(i,i.data.length),this._position=e,this._previous();let r=i.data.length,o;if(i==this._boundaryStartParent){const a=this.boundaries.start.offset;o=new H(i,a,i.data.length-a),r=o.data.length,e=g._createBefore(o)}else o=new H(i,0,i.data.length),e.offset--;return this._position=e,this._formatReturnValue("text",o,t,e,r)}if(typeof i=="string"){let r;if(this.singleCharacters)r=1;else{const a=s===this._boundaryStartParent?this.boundaries.start.offset:0;r=e.offset-a}e.offset-=r;const o=new H(s,e.offset,r);return this._position=e,this._formatReturnValue("text",o,t,e,r)}return e=g._createBefore(s),this._position=e,this._formatReturnValue("elementStart",s,t,e,1)}_formatReturnValue(e,t,s,i,r){return t instanceof H&&(t.offsetInText+t.data.length==t.textNode.data.length&&(this.direction=="forward"&&!(this.boundaries&&this.boundaries.end.isEqual(this.position))?(i=g._createAfter(t.textNode),this._position=i):s=g._createAfter(t.textNode)),t.offsetInText===0&&(this.direction=="backward"&&!(this.boundaries&&this.boundaries.start.isEqual(this.position))?(i=g._createBefore(t.textNode),this._position=i):s=g._createBefore(t.textNode))),{done:!1,value:{type:e,item:t,previousPosition:s,nextPosition:i,length:r}}}};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let g=class X extends we{constructor(e,t){super(),this.parent=e,this.offset=t}get nodeAfter(){return this.parent.is("$text")?null:this.parent.getChild(this.offset)||null}get nodeBefore(){return this.parent.is("$text")?null:this.parent.getChild(this.offset-1)||null}get isAtStart(){return this.offset===0}get isAtEnd(){const e=this.parent.is("$text")?this.parent.data.length:this.parent.childCount;return this.offset===e}get root(){return this.parent.root}get editableElement(){let e=this.parent;for(;!(e instanceof st);)if(e.parent)e=e.parent;else return null;return e}getShiftedBy(e){const t=X._createAt(this),s=t.offset+e;return t.offset=s<0?0:s,t}getLastMatchingPosition(e,t={}){t.startPosition=this;const s=new fe(t);return s.skip(e),s.position}getAncestors(){return this.parent.is("documentFragment")?[this.parent]:this.parent.getAncestors({includeSelf:!0})}getCommonAncestor(e){const t=this.getAncestors(),s=e.getAncestors();let i=0;for(;t[i]==s[i]&&t[i];)i++;return i===0?null:t[i-1]}isEqual(e){return this.parent==e.parent&&this.offset==e.offset}isBefore(e){return this.compareWith(e)=="before"}isAfter(e){return this.compareWith(e)=="after"}compareWith(e){if(this.root!==e.root)return"different";if(this.isEqual(e))return"same";const t=this.parent.is("node")?this.parent.getPath():[],s=e.parent.is("node")?e.parent.getPath():[];t.push(this.offset),s.push(e.offset);const i=O(t,s);switch(i){case"prefix":return"before";case"extension":return"after";default:return t[i]<s[i]?"before":"after"}}getWalker(e={}){return e.startPosition=this,new fe(e)}clone(){return new X(this.parent,this.offset)}static _createAt(e,t){if(e instanceof X)return new this(e.parent,e.offset);{const s=e;if(t=="end")t=s.is("$text")?s.data.length:s.childCount;else{if(t=="before")return this._createBefore(s);if(t=="after")return this._createAfter(s);if(t!==0&&!t)throw new f("view-createpositionat-offset-required",s)}return new X(s,t)}}static _createAfter(e){if(e.is("$textProxy"))return new X(e.textNode,e.offsetInText+e.data.length);if(!e.parent)throw new f("view-position-after-root",e,{root:e});return new X(e.parent,e.index+1)}static _createBefore(e){if(e.is("$textProxy"))return new X(e.textNode,e.offsetInText);if(!e.parent)throw new f("view-position-before-root",e,{root:e});return new X(e.parent,e.index)}};g.prototype.is=function(n){return n==="position"||n==="view:position"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let w=class te extends we{constructor(e,t=null){super(),this.start=e.clone(),this.end=t?t.clone():e.clone()}*[Symbol.iterator](){yield*new fe({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){return this.start.parent===this.end.parent}get root(){return this.start.root}getEnlarged(){let e=this.start.getLastMatchingPosition(Ke,{direction:"backward"}),t=this.end.getLastMatchingPosition(Ke);return e.parent.is("$text")&&e.isAtStart&&(e=g._createBefore(e.parent)),t.parent.is("$text")&&t.isAtEnd&&(t=g._createAfter(t.parent)),new te(e,t)}getTrimmed(){let e=this.start.getLastMatchingPosition(Ke);if(e.isAfter(this.end)||e.isEqual(this.end))return new te(e,e);let t=this.end.getLastMatchingPosition(Ke,{direction:"backward"});const s=e.nodeAfter,i=t.nodeBefore;return s&&s.is("$text")&&(e=new g(s,0)),i&&i.is("$text")&&(t=new g(i,i.data.length)),new te(e,t)}isEqual(e){return this==e||this.start.isEqual(e.start)&&this.end.isEqual(e.end)}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const s=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),i=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return s&&i}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new te(this.start,e.start)),this.containsPosition(e.end)&&t.push(new te(e.end,this.end))):t.push(this.clone()),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,s=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(s=e.end),new te(t,s)}return null}getWalker(e={}){return e.boundaries=this,new fe(e)}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;let e=this.start.nodeAfter,t=this.end.nodeBefore;return this.start.parent.is("$text")&&this.start.isAtEnd&&this.start.parent.nextSibling&&(e=this.start.parent.nextSibling),this.end.parent.is("$text")&&this.end.isAtStart&&this.end.parent.previousSibling&&(t=this.end.parent.previousSibling),e&&e.is("element")&&e===t?e:null}clone(){return new te(this.start,this.end)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new fe(e);for(const s of t)yield s.item}*getPositions(e={}){e.boundaries=this;const t=new fe(e);yield t.position;for(const s of t)yield s.nextPosition}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}static _createFromParentsAndOffsets(e,t,s,i){return new this(new g(e,t),new g(s,i))}static _createFromPositionAndShift(e,t){const s=e,i=e.getShiftedBy(t);return t>0?new this(s,i):new this(i,s)}static _createIn(e){return this._createFromParentsAndOffsets(e,0,e,e.childCount)}static _createOn(e){const t=e.is("$textProxy")?e.offsetSize:1;return this._createFromPositionAndShift(g._createBefore(e),t)}};w.prototype.is=function(n){return n==="range"||n==="view:range"};function Ke(n){return!!(n.item.is("attributeElement")||n.item.is("uiElement"))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let Q=class xs extends N(we){constructor(...e){super(),this._ranges=[],this._lastRangeBackward=!1,this._isFake=!1,this._fakeSelectionLabel="",e.length&&this.setTo(...e)}get isFake(){return this._isFake}get fakeSelectionLabel(){return this._fakeSelectionLabel}get anchor(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.end:e.start).clone()}get focus(){if(!this._ranges.length)return null;const e=this._ranges[this._ranges.length-1];return(this._lastRangeBackward?e.start:e.end).clone()}get isCollapsed(){return this.rangeCount===1&&this._ranges[0].isCollapsed}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}get editableElement(){return this.anchor?this.anchor.editableElement:null}*getRanges(){for(const e of this._ranges)yield e.clone()}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?e.clone():null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?e.clone():null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}isEqual(e){if(this.isFake!=e.isFake||this.isFake&&this.fakeSelectionLabel!=e.fakeSelectionLabel||this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let s=!1;for(const i of e._ranges)if(t.isEqual(i)){s=!0;break}if(!s)return!1}return!0}isSimilar(e){if(this.isBackward!=e.isBackward)return!1;const t=Vt(this.getRanges()),s=Vt(e.getRanges());if(t!=s)return!1;if(t==0)return!0;for(let i of this.getRanges()){i=i.getTrimmed();let r=!1;for(let o of e.getRanges())if(o=o.getTrimmed(),i.start.isEqual(o.start)&&i.end.isEqual(o.end)){r=!0;break}if(!r)return!1}return!0}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}setTo(...e){let[t,s,i]=e;if(typeof s=="object"&&(i=s,s=void 0),t===null)this._setRanges([]),this._setFakeOptions(i);else if(t instanceof xs||t instanceof Tt)this._setRanges(t.getRanges(),t.isBackward),this._setFakeOptions({fake:t.isFake,label:t.fakeSelectionLabel});else if(t instanceof w)this._setRanges([t],i&&i.backward),this._setFakeOptions(i);else if(t instanceof g)this._setRanges([new w(t)]),this._setFakeOptions(i);else if(t instanceof ye){const r=!!i&&!!i.backward;let o;if(s===void 0)throw new f("view-selection-setto-required-second-parameter",this);s=="in"?o=w._createIn(t):s=="on"?o=w._createOn(t):o=new w(g._createAt(t,s)),this._setRanges([o],r),this._setFakeOptions(i)}else if(re(t))this._setRanges(t,i&&i.backward),this._setFakeOptions(i);else throw new f("view-selection-setto-not-selectable",this);this.fire("change")}setFocus(e,t){if(this.anchor===null)throw new f("view-selection-setfocus-no-ranges",this);const s=g._createAt(e,t);if(s.compareWith(this.focus)=="same")return;const i=this.anchor;this._ranges.pop(),s.compareWith(i)=="before"?this._addRange(new w(s,i),!0):this._addRange(new w(i,s)),this.fire("change")}_setRanges(e,t=!1){e=Array.from(e),this._ranges=[];for(const s of e)this._addRange(s);this._lastRangeBackward=!!t}_setFakeOptions(e={}){this._isFake=!!e.fake,this._fakeSelectionLabel=e.fake&&e.label||""}_addRange(e,t=!1){if(!(e instanceof w))throw new f("view-selection-add-range-not-range",this);this._pushRange(e),this._lastRangeBackward=!!t}_pushRange(e){for(const t of this._ranges)if(e.isIntersecting(t))throw new f("view-selection-range-intersects",this,{addedRange:e,intersectingRange:t});this._ranges.push(new w(e.start,e.end))}};Q.prototype.is=function(n){return n==="selection"||n==="view:selection"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let Tt=class extends N(we){constructor(...e){super(),this._selection=new Q,this._selection.delegate("change").to(this),e.length&&this._selection.setTo(...e)}get isFake(){return this._selection.isFake}get fakeSelectionLabel(){return this._selection.fakeSelectionLabel}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get isCollapsed(){return this._selection.isCollapsed}get rangeCount(){return this._selection.rangeCount}get isBackward(){return this._selection.isBackward}get editableElement(){return this._selection.editableElement}get _ranges(){return this._selection._ranges}*getRanges(){yield*this._selection.getRanges()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getSelectedElement(){return this._selection.getSelectedElement()}isEqual(e){return this._selection.isEqual(e)}isSimilar(e){return this._selection.isSimilar(e)}_setTo(...e){this._selection.setTo(...e)}_setFocus(e,t){this._selection.setFocus(e,t)}};Tt.prototype.is=function(n){return n==="selection"||n=="documentSelection"||n=="view:selection"||n=="view:documentSelection"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mt extends mt{constructor(e,t,s){super(e,t),this.startRange=s,this._eventPhase="none",this._currentTarget=null}get eventPhase(){return this._eventPhase}get currentTarget(){return this._currentTarget}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const lt=Symbol("bubbling contexts");function yt(n){class e extends n{fire(s,...i){try{const r=s instanceof mt?s:new mt(this,s),o=ct(this);if(!o.size)return;if(Re(r,"capturing",this),ve(o,"$capture",r,...i))return r.return;const a=r.startRange||this.selection.getFirstRange(),l=a?a.getContainedElement():null,c=l?!!Ns(o,l):!1;let h=l||jn(a);if(Re(r,"atTarget",h),!c){if(ve(o,"$text",r,...i))return r.return;Re(r,"bubbling",h)}for(;h;){if(h.is("rootElement")){if(ve(o,"$root",r,...i))return r.return}else if(h.is("element")&&ve(o,h.name,r,...i))return r.return;if(ve(o,h,r,...i))return r.return;h=h.parent,Re(r,"bubbling",h)}return Re(r,"bubbling",this),ve(o,"$document",r,...i),r.return}catch(r){/* istanbul ignore next -- @preserve */f.rethrowUnexpectedError(r,this)}}_addEventListener(s,i,r){const o=ie(r.context||"$document"),a=ct(this);for(const l of o){let c=a.get(l);c||(c=new(N()),a.set(l,c)),this.listenTo(c,s,i,r)}}_removeEventListener(s,i){const r=ct(this);for(const o of r.values())this.stopListening(o,s,i)}}return e}{const n=yt(Object);["fire","_addEventListener","_removeEventListener"].forEach(e=>{yt[e]=n.prototype[e]})}function Re(n,e,t){n instanceof Mt&&(n._eventPhase=e,n._currentTarget=t)}function ve(n,e,t,...s){const i=typeof e=="string"?n.get(e):Ns(n,e);return i?(i.fire(t,...s),t.stop.called):!1}function Ns(n,e){for(const[t,s]of n)if(typeof t=="function"&&t(e))return s;return null}function ct(n){return n[lt]||(n[lt]=new Map),n[lt]}function jn(n){if(!n)return null;const e=n.start.parent,t=n.end.parent,s=e.getPath(),i=t.getPath();return s.length>i.length?e:t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let Os=class extends yt(q()){constructor(e){super(),this._postFixers=new Set,this.selection=new Tt,this.roots=new St({idProperty:"rootName"}),this.stylesProcessor=e,this.set("isReadOnly",!1),this.set("isFocused",!1),this.set("isSelecting",!1),this.set("isComposing",!1)}getRoot(e="main"){return this.roots.get(e)}registerPostFixer(e){this._postFixers.add(e)}destroy(){this.roots.forEach(e=>e.destroy()),this.stopListening()}_callPostFixers(e){let t=!1;do for(const s of this._postFixers)if(t=s(e),t)break;while(t)}};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Is=10;class de extends G{constructor(e,t,s,i){super(e,t,s,i),this._priority=Is,this._id=null,this._clonesGroup=null,this.getFillerOffset=Xn}get priority(){return this._priority}get id(){return this._id}getElementsWithSameId(){if(this.id===null)throw new f("attribute-element-get-elements-with-same-id-no-id",this);return new Set(this._clonesGroup)}isSimilar(e){return this.id!==null||e.id!==null?this.id===e.id:super.isSimilar(e)&&this.priority==e.priority}_clone(e=!1){const t=super._clone(e);return t._priority=this._priority,t._id=this._id,t}}de.DEFAULT_PRIORITY=Is;de.prototype.is=function(n,e){return e?e===this.name&&(n==="attributeElement"||n==="view:attributeElement"||n==="element"||n==="view:element"):n==="attributeElement"||n==="view:attributeElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};function Xn(){if(ht(this))return null;let n=this.parent;for(;n&&n.is("attributeElement");){if(ht(n)>1)return null;n=n.parent}return!n||ht(n)>1?null:this.childCount}function ht(n){return Array.from(n.getChildren()).filter(e=>!e.is("uiElement")).length}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xt extends G{constructor(e,t,s,i){super(e,t,s,i),this.getFillerOffset=Yn}_insertChild(e,t){if(t&&(t instanceof ye||Array.from(t).length>0))throw new f("view-emptyelement-cannot-add",[this,t]);return 0}}xt.prototype.is=function(n,e){return e?e===this.name&&(n==="emptyElement"||n==="view:emptyElement"||n==="element"||n==="view:element"):n==="emptyElement"||n==="view:emptyElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};function Yn(){return null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nt extends G{constructor(e,t,s,i){super(e,t,s,i),this.getFillerOffset=Zn}_insertChild(e,t){if(t&&(t instanceof ye||Array.from(t).length>0))throw new f("view-uielement-cannot-add",[this,t]);return 0}render(e,t){return this.toDomElement(e)}toDomElement(e){const t=e.createElement(this.name);for(const s of this.getAttributeKeys())t.setAttribute(s,this.getAttribute(s));return t}}nt.prototype.is=function(n,e){return e?e===this.name&&(n==="uiElement"||n==="view:uiElement"||n==="element"||n==="view:element"):n==="uiElement"||n==="view:uiElement"||n==="element"||n==="view:element"||n==="node"||n==="view:node"};function Qn(n){n.document.on("arrowKey",(e,t)=>ei(e,t,n.domConverter),{priority:"low"})}function Zn(){return null}function ei(n,e,t){if(e.keyCode==ue.arrowright){const s=e.domTarget.ownerDocument.defaultView.getSelection(),i=s.rangeCount==1&&s.getRangeAt(0).collapsed;if(i||e.shiftKey){const r=s.focusNode,o=s.focusOffset,a=t.domPositionToView(r,o);if(a===null)return;let l=!1;const c=a.getLastMatchingPosition(h=>(h.item.is("uiElement")&&(l=!0),!!(h.item.is("uiElement")||h.item.is("attributeElement"))));if(l){const h=t.viewPositionToDom(c);i?s.collapse(h.parent,h.offset):s.extend(h.parent,h.offset)}}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nt extends G{constructor(e,t,s,i){super(e,t,s,i),this.getFillerOffset=ti}_insertChild(e,t){if(t&&(t instanceof ye||Array.from(t).length>0))throw new f("view-rawelement-cannot-add",[this,t]);return 0}render(e,t){}}Nt.prototype.is=function(n,e){return e?e===this.name&&(n==="rawElement"||n==="view:rawElement"||n==="element"||n==="view:element"):n==="rawElement"||n==="view:rawElement"||n===this.name||n==="view:"+this.name||n==="element"||n==="view:element"||n==="node"||n==="view:node"};function ti(){return null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let me=class extends N(we){constructor(e,t){super(),this._children=[],this._customProperties=new Map,this.document=e,t&&this._insertChild(0,t)}[Symbol.iterator](){return this._children[Symbol.iterator]()}get childCount(){return this._children.length}get isEmpty(){return this.childCount===0}get root(){return this}get parent(){return null}get name(){}get getFillerOffset(){}getCustomProperty(e){return this._customProperties.get(e)}*getCustomProperties(){yield*this._customProperties.entries()}_appendChild(e){return this._insertChild(this.childCount,e)}getChild(e){return this._children[e]}getChildIndex(e){return this._children.indexOf(e)}getChildren(){return this._children[Symbol.iterator]()}_insertChild(e,t){this._fireChange("children",this);let s=0;const i=si(this.document,t);for(const r of i)r.parent!==null&&r._remove(),r.parent=this,this._children.splice(e,0,r),e++,s++;return s}_removeChildren(e,t=1){this._fireChange("children",this);for(let s=e;s<e+t;s++)this._children[s].parent=null;return this._children.splice(e,t)}_fireChange(e,t){this.fire("change:"+e,t)}_setCustomProperty(e,t){this._customProperties.set(e,t)}_removeCustomProperty(e){return this._customProperties.delete(e)}};me.prototype.is=function(n){return n==="documentFragment"||n==="view:documentFragment"};function si(n,e){return typeof e=="string"?[new A(n,e)]:(re(e)||(e=[e]),Array.from(e).map(t=>typeof t=="string"?new A(n,t):t instanceof H?new A(n,t.data):t))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fs{constructor(e){this._cloneGroups=new Map,this._slotFactory=null,this.document=e}setSelection(...e){this.document.selection._setTo(...e)}setSelectionFocus(e,t){this.document.selection._setFocus(e,t)}createDocumentFragment(e){return new me(this.document,e)}createText(e){return new A(this.document,e)}createAttributeElement(e,t,s={}){const i=new de(this.document,e,t);return typeof s.priority=="number"&&(i._priority=s.priority),s.id&&(i._id=s.id),s.renderUnsafeAttributes&&i._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),i}createContainerElement(e,t,s={},i={}){let r=null;Ae(s)?i=s:r=s;const o=new Ve(this.document,e,t,r);return i.renderUnsafeAttributes&&o._unsafeAttributesToRender.push(...i.renderUnsafeAttributes),o}createEditableElement(e,t,s={}){const i=new st(this.document,e,t);return s.renderUnsafeAttributes&&i._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),i}createEmptyElement(e,t,s={}){const i=new xt(this.document,e,t);return s.renderUnsafeAttributes&&i._unsafeAttributesToRender.push(...s.renderUnsafeAttributes),i}createUIElement(e,t,s){const i=new nt(this.document,e,t);return s&&(i.render=s),i}createRawElement(e,t,s,i={}){const r=new Nt(this.document,e,t);return s&&(r.render=s),i.renderUnsafeAttributes&&r._unsafeAttributesToRender.push(...i.renderUnsafeAttributes),r}setAttribute(e,t,s){s._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,s){Ae(e)&&s===void 0?t._setStyle(e):s._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,s){s._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}breakAttributes(e){return e instanceof g?this._breakAttributes(e):this._breakAttributesRange(e)}breakContainer(e){const t=e.parent;if(!t.is("containerElement"))throw new f("view-writer-break-non-container-element",this.document);if(!t.parent)throw new f("view-writer-break-root",this.document);if(e.isAtStart)return g._createBefore(t);if(!e.isAtEnd){const s=t._clone(!1);this.insert(g._createAfter(t),s);const i=new w(e,g._createAt(t,"end")),r=new g(s,0);this.move(i,r)}return g._createAfter(t)}mergeAttributes(e){const t=e.offset,s=e.parent;if(s.is("$text"))return e;if(s.is("attributeElement")&&s.childCount===0){const o=s.parent,a=s.index;return s._remove(),this._removeFromClonedElementsGroup(s),this.mergeAttributes(new g(o,a))}const i=s.getChild(t-1),r=s.getChild(t);if(!i||!r)return e;if(i.is("$text")&&r.is("$text"))return Kt(i,r);if(i.is("attributeElement")&&r.is("attributeElement")&&i.isSimilar(r)){const o=i.childCount;return i._appendChild(r.getChildren()),r._remove(),this._removeFromClonedElementsGroup(r),this.mergeAttributes(new g(i,o))}return e}mergeContainers(e){const t=e.nodeBefore,s=e.nodeAfter;if(!t||!s||!t.is("containerElement")||!s.is("containerElement"))throw new f("view-writer-merge-containers-invalid-position",this.document);const i=t.getChild(t.childCount-1),r=i instanceof A?g._createAt(i,"end"):g._createAt(t,"end");return this.move(w._createIn(s),g._createAt(t,"end")),this.remove(w._createOn(s)),r}insert(e,t){t=re(t)?[...t]:[t],Bs(t,this.document);const s=t.reduce((o,a)=>{const l=o[o.length-1],c=!a.is("uiElement");return!l||l.breakAttributes!=c?o.push({breakAttributes:c,nodes:[a]}):l.nodes.push(a),o},[]);let i=null,r=e;for(const{nodes:o,breakAttributes:a}of s){const l=this._insertNodes(r,o,a);i||(i=l.start),r=l.end}return i?new w(i,r):new w(e)}remove(e){const t=e instanceof w?e:w._createOn(e);if(Te(t,this.document),t.isCollapsed)return new me(this.document);const{start:s,end:i}=this._breakAttributesRange(t,!0),r=s.parent,o=i.offset-s.offset,a=r._removeChildren(s.offset,o);for(const c of a)this._removeFromClonedElementsGroup(c);const l=this.mergeAttributes(s);return t.start=l,t.end=l.clone(),new me(this.document,a)}clear(e,t){Te(e,this.document);const s=e.getWalker({direction:"backward",ignoreElementEnd:!0});for(const i of s){const r=i.item;let o;if(r.is("element")&&t.isSimilar(r))o=w._createOn(r);else if(!i.nextPosition.isAfter(e.start)&&r.is("$textProxy")){const a=r.getAncestors().find(l=>l.is("element")&&t.isSimilar(l));a&&(o=w._createIn(a))}o&&(o.end.isAfter(e.end)&&(o.end=e.end),o.start.isBefore(e.start)&&(o.start=e.start),this.remove(o))}}move(e,t){let s;if(t.isAfter(e.end)){t=this._breakAttributes(t,!0);const i=t.parent,r=i.childCount;e=this._breakAttributesRange(e,!0),s=this.remove(e),t.offset+=i.childCount-r}else s=this.remove(e);return this.insert(t,s)}wrap(e,t){if(!(t instanceof de))throw new f("view-writer-wrap-invalid-attribute",this.document);if(Te(e,this.document),e.isCollapsed){let s=e.start;s.parent.is("element")&&!ni(s.parent)&&(s=s.getLastMatchingPosition(r=>r.item.is("uiElement"))),s=this._wrapPosition(s,t);const i=this.document.selection;return i.isCollapsed&&i.getFirstPosition().isEqual(e.start)&&this.setSelection(s),new w(s)}else return this._wrapRange(e,t)}unwrap(e,t){if(!(t instanceof de))throw new f("view-writer-unwrap-invalid-attribute",this.document);if(Te(e,this.document),e.isCollapsed)return e;const{start:s,end:i}=this._breakAttributesRange(e,!0),r=s.parent,o=this._unwrapChildren(r,s.offset,i.offset,t),a=this.mergeAttributes(o.start);a.isEqual(o.start)||o.end.offset--;const l=this.mergeAttributes(o.end);return new w(a,l)}rename(e,t){const s=new Ve(this.document,e,t.getAttributes());return this.insert(g._createAfter(t),s),this.move(w._createIn(t),g._createAt(s,0)),this.remove(w._createOn(t)),s}clearClonedElementsGroup(e){this._cloneGroups.delete(e)}createPositionAt(e,t){return g._createAt(e,t)}createPositionAfter(e){return g._createAfter(e)}createPositionBefore(e){return g._createBefore(e)}createRange(e,t){return new w(e,t)}createRangeOn(e){return w._createOn(e)}createRangeIn(e){return w._createIn(e)}createSelection(...e){return new Q(...e)}createSlot(e="children"){if(!this._slotFactory)throw new f("view-writer-invalid-create-slot-context",this.document);return this._slotFactory(this,e)}_registerSlotFactory(e){this._slotFactory=e}_clearSlotFactory(){this._slotFactory=null}_insertNodes(e,t,s){let i;if(s?i=bt(e):i=e.parent.is("$text")?e.parent.parent:e.parent,!i)throw new f("view-writer-invalid-position-container",this.document);let r;s?r=this._breakAttributes(e,!0):r=e.parent.is("$text")?ut(e):e;const o=i._insertChild(r.offset,t);for(const h of t)this._addToClonedElementsGroup(h);const a=r.getShiftedBy(o),l=this.mergeAttributes(r);l.isEqual(r)||a.offset--;const c=this.mergeAttributes(a);return new w(l,c)}_wrapChildren(e,t,s,i){let r=t;const o=[];for(;r<s;){const l=e.getChild(r),c=l.is("$text"),h=l.is("attributeElement");if(h&&this._wrapAttributeElement(i,l))o.push(new g(e,r));else if(c||!h||ii(i,l)){const d=i._clone();l._remove(),d._appendChild(l),e._insertChild(r,d),this._addToClonedElementsGroup(d),o.push(new g(e,r))}else this._wrapChildren(l,0,l.childCount,i);r++}let a=0;for(const l of o){if(l.offset-=a,l.offset==t)continue;this.mergeAttributes(l).isEqual(l)||(a++,s--)}return w._createFromParentsAndOffsets(e,t,e,s)}_unwrapChildren(e,t,s,i){let r=t;const o=[];for(;r<s;){const l=e.getChild(r);if(!l.is("attributeElement")){r++;continue}if(l.isSimilar(i)){const c=l.getChildren(),h=l.childCount;l._remove(),e._insertChild(r,c),this._removeFromClonedElementsGroup(l),o.push(new g(e,r),new g(e,r+h)),r+=h,s+=h-1;continue}if(this._unwrapAttributeElement(i,l)){o.push(new g(e,r),new g(e,r+1)),r++;continue}this._unwrapChildren(l,0,l.childCount,i),r++}let a=0;for(const l of o){if(l.offset-=a,l.offset==t||l.offset==s)continue;this.mergeAttributes(l).isEqual(l)||(a++,s--)}return w._createFromParentsAndOffsets(e,t,e,s)}_wrapRange(e,t){const{start:s,end:i}=this._breakAttributesRange(e,!0),r=s.parent,o=this._wrapChildren(r,s.offset,i.offset,t),a=this.mergeAttributes(o.start);a.isEqual(o.start)||o.end.offset--;const l=this.mergeAttributes(o.end);return new w(a,l)}_wrapPosition(e,t){if(t.isSimilar(e.parent))return Gt(e.clone());e.parent.is("$text")&&(e=ut(e));const s=this.createAttributeElement("_wrapPosition-fake-element");s._priority=Number.POSITIVE_INFINITY,s.isSimilar=()=>!1,e.parent._insertChild(e.offset,s);const i=new w(e,e.getShiftedBy(1));this.wrap(i,t);const r=new g(s.parent,s.index);s._remove();const o=r.nodeBefore,a=r.nodeAfter;return o instanceof A&&a instanceof A?Kt(o,a):Gt(r)}_wrapAttributeElement(e,t){if(!Ht(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const s of e.getAttributeKeys())if(!(s==="class"||s==="style")&&t.hasAttribute(s)&&t.getAttribute(s)!==e.getAttribute(s))return!1;for(const s of e.getStyleNames())if(t.hasStyle(s)&&t.getStyle(s)!==e.getStyle(s))return!1;for(const s of e.getAttributeKeys())s==="class"||s==="style"||t.hasAttribute(s)||this.setAttribute(s,e.getAttribute(s),t);for(const s of e.getStyleNames())t.hasStyle(s)||this.setStyle(s,e.getStyle(s),t);for(const s of e.getClassNames())t.hasClass(s)||this.addClass(s,t);return!0}_unwrapAttributeElement(e,t){if(!Ht(e,t)||e.name!==t.name||e.priority!==t.priority)return!1;for(const s of e.getAttributeKeys())if(!(s==="class"||s==="style")&&(!t.hasAttribute(s)||t.getAttribute(s)!==e.getAttribute(s)))return!1;if(!t.hasClass(...e.getClassNames()))return!1;for(const s of e.getStyleNames())if(!t.hasStyle(s)||t.getStyle(s)!==e.getStyle(s))return!1;for(const s of e.getAttributeKeys())s==="class"||s==="style"||this.removeAttribute(s,t);return this.removeClass(Array.from(e.getClassNames()),t),this.removeStyle(Array.from(e.getStyleNames()),t),!0}_breakAttributesRange(e,t=!1){const s=e.start,i=e.end;if(Te(e,this.document),e.isCollapsed){const l=this._breakAttributes(e.start,t);return new w(l,l)}const r=this._breakAttributes(i,t),o=r.parent.childCount,a=this._breakAttributes(s,t);return r.offset+=r.parent.childCount-o,new w(a,r)}_breakAttributes(e,t=!1){const s=e.offset,i=e.parent;if(e.parent.is("emptyElement"))throw new f("view-writer-cannot-break-empty-element",this.document);if(e.parent.is("uiElement"))throw new f("view-writer-cannot-break-ui-element",this.document);if(e.parent.is("rawElement"))throw new f("view-writer-cannot-break-raw-element",this.document);if(!t&&i.is("$text")&&vt(i.parent)||vt(i))return e.clone();if(i.is("$text"))return this._breakAttributes(ut(e),t);const r=i.childCount;if(s==r){const o=new g(i.parent,i.index+1);return this._breakAttributes(o,t)}else if(s===0){const o=new g(i.parent,i.index);return this._breakAttributes(o,t)}else{const o=i.index+1,a=i._clone();i.parent._insertChild(o,a),this._addToClonedElementsGroup(a);const l=i.childCount-s,c=i._removeChildren(s,l);a._appendChild(c);const h=new g(i.parent,o);return this._breakAttributes(h,t)}}_addToClonedElementsGroup(e){if(!e.root.is("rootElement"))return;if(e.is("element"))for(const i of e.getChildren())this._addToClonedElementsGroup(i);const t=e.id;if(!t)return;let s=this._cloneGroups.get(t);s||(s=new Set,this._cloneGroups.set(t,s)),s.add(e),e._clonesGroup=s}_removeFromClonedElementsGroup(e){if(e.is("element"))for(const i of e.getChildren())this._removeFromClonedElementsGroup(i);const t=e.id;if(!t)return;const s=this._cloneGroups.get(t);s&&s.delete(e)}}function ni(n){return Array.from(n.getChildren()).some(e=>!e.is("uiElement"))}function bt(n){let e=n.parent;for(;!vt(e);){if(!e)return;e=e.parent}return e}function ii(n,e){return n.priority<e.priority?!0:n.priority>e.priority?!1:n.getIdentity()<e.getIdentity()}function Gt(n){const e=n.nodeBefore;if(e&&e.is("$text"))return new g(e,e.data.length);const t=n.nodeAfter;return t&&t.is("$text")?new g(t,0):n}function ut(n){if(n.offset==n.parent.data.length)return new g(n.parent.parent,n.parent.index+1);if(n.offset===0)return new g(n.parent.parent,n.parent.index);const e=n.parent.data.slice(n.offset);return n.parent._data=n.parent.data.slice(0,n.offset),n.parent.parent._insertChild(n.parent.index+1,new A(n.root.document,e)),new g(n.parent.parent,n.parent.index+1)}function Kt(n,e){const t=n.data.length;return n._data+=e.data,e._remove(),new g(n,t)}const ri=[A,de,Ve,xt,Nt,nt];function Bs(n,e){for(const t of n){if(!ri.some(s=>t instanceof s))throw new f("view-writer-insert-invalid-node-type",e);t.is("$text")||Bs(t.getChildren(),e)}}function vt(n){return n&&(n.is("containerElement")||n.is("documentFragment"))}function Te(n,e){const t=bt(n.start),s=bt(n.end);if(!t||!s||t!==s)throw new f("view-writer-invalid-range-container",e)}function Ht(n,e){return n.id===null&&e.id===null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ds=n=>n.createTextNode(" "),Vs=n=>{const e=n.createElement("span");return e.dataset.ckeFiller="true",e.innerText=" ",e},$s=n=>{const e=n.createElement("br");return e.dataset.ckeFiller="true",e},z=7,$e="⁠".repeat(z);function V(n){return typeof n=="string"?n.substr(0,z)===$e:T(n)&&n.data.substr(0,z)===$e}function Ne(n){return n.data.length==z&&V(n)}function jt(n){const e=typeof n=="string"?n:n.data;return V(n)?e.slice(z):e}function oi(n){n.document.on("arrowKey",ai,{priority:"low"})}function ai(n,e){if(e.keyCode==ue.arrowleft){const t=e.domTarget.ownerDocument.defaultView.getSelection();if(t.rangeCount==1&&t.getRangeAt(0).collapsed){const s=t.getRangeAt(0).startContainer,i=t.getRangeAt(0).startOffset;V(s)&&i<=z&&t.collapse(s,0)}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class li extends q(){constructor(e,t){super(),this.domDocuments=new Set,this.markedAttributes=new Set,this.markedChildren=new Set,this.markedTexts=new Set,this._inlineFiller=null,this._fakeSelectionContainer=null,this.domConverter=e,this.selection=t,this.set("isFocused",!1),this.set("isSelecting",!1),x.isBlink&&!x.isAndroid&&this.on("change:isSelecting",()=>{this.isSelecting||this.render()}),this.set("isComposing",!1),this.on("change:isComposing",()=>{this.isComposing||this.render()})}markToSync(e,t){if(e==="text")this.domConverter.mapViewToDom(t.parent)&&this.markedTexts.add(t);else{if(!this.domConverter.mapViewToDom(t))return;if(e==="attributes")this.markedAttributes.add(t);else if(e==="children")this.markedChildren.add(t);else throw new f("view-renderer-unknown-type",this)}}render(){if(this.isComposing&&!x.isAndroid)return;let e=null;const t=x.isBlink&&!x.isAndroid?!this.isSelecting:!0;for(const s of this.markedChildren)this._updateChildrenMappings(s);t?(this._inlineFiller&&!this._isSelectionInInlineFiller()&&this._removeInlineFiller(),this._inlineFiller?e=this._getInlineFillerPosition():this._needsInlineFillerAtSelection()&&(e=this.selection.getFirstPosition(),this.markedChildren.add(e.parent))):this._inlineFiller&&this._inlineFiller.parentNode&&(e=this.domConverter.domPositionToView(this._inlineFiller),e&&e.parent.is("$text")&&(e=g._createBefore(e.parent)));for(const s of this.markedAttributes)this._updateAttrs(s);for(const s of this.markedChildren)this._updateChildren(s,{inlineFillerPosition:e});for(const s of this.markedTexts)!this.markedChildren.has(s.parent)&&this.domConverter.mapViewToDom(s.parent)&&this._updateText(s,{inlineFillerPosition:e});if(t)if(e){const s=this.domConverter.viewPositionToDom(e),i=s.parent.ownerDocument;V(s.parent)?this._inlineFiller=s.parent:this._inlineFiller=Xt(i,s.parent,s.offset)}else this._inlineFiller=null;this._updateFocus(),this._updateSelection(),this.domConverter._clearTemporaryCustomProperties(),this.markedTexts.clear(),this.markedAttributes.clear(),this.markedChildren.clear()}_updateChildrenMappings(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const s=Array.from(t.childNodes),i=Array.from(this.domConverter.viewChildrenToDom(e,{withChildren:!1})),r=this._diffNodeLists(s,i),o=this._findUpdateActions(r,s,i,hi);if(o.indexOf("update")!==-1){const a={equal:0,insert:0,delete:0};for(const l of o)if(l==="update"){const c=a.equal+a.insert,h=a.equal+a.delete,d=e.getChild(c);d&&!d.is("uiElement")&&!d.is("rawElement")&&this._updateElementMappings(d,s[h]),$t(i[c]),a.equal++}else a[l]++}}_updateElementMappings(e,t){this.domConverter.unbindDomElement(t),this.domConverter.bindElements(t,e),this.markedChildren.add(e),this.markedAttributes.add(e)}_getInlineFillerPosition(){const e=this.selection.getFirstPosition();return e.parent.is("$text")?g._createBefore(e.parent):e}_isSelectionInInlineFiller(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=this.domConverter.viewPositionToDom(e);return!!(t&&T(t.parent)&&V(t.parent))}_removeInlineFiller(){const e=this._inlineFiller;if(!V(e))throw new f("view-renderer-filler-was-lost",this);Ne(e)?e.remove():e.data=e.data.substr(z),this._inlineFiller=null}_needsInlineFillerAtSelection(){if(this.selection.rangeCount!=1||!this.selection.isCollapsed)return!1;const e=this.selection.getFirstPosition(),t=e.parent,s=e.offset;if(!this.domConverter.mapViewToDom(t.root)||!t.is("element")||!ci(t)||s===t.getFillerOffset())return!1;const i=e.nodeBefore,r=e.nodeAfter;return!(i instanceof A||r instanceof A||x.isAndroid&&(i||r))}_updateText(e,t){const s=this.domConverter.findCorrespondingDomText(e);let r=this.domConverter.viewToDom(e).data;const o=t.inlineFillerPosition;o&&o.parent==e.parent&&o.offset==e.index&&(r=$e+r),Yt(s,r)}_updateAttrs(e){const t=this.domConverter.mapViewToDom(e);if(!t)return;const s=Array.from(t.attributes).map(r=>r.name),i=e.getAttributeKeys();for(const r of i)this.domConverter.setDomElementAttribute(t,r,e.getAttribute(r),e);for(const r of s)e.hasAttribute(r)||this.domConverter.removeDomElementAttribute(t,r)}_updateChildren(e,t){const s=this.domConverter.mapViewToDom(e);if(!s)return;if(x.isAndroid){let d=null;for(const _ of Array.from(s.childNodes)){if(d&&T(d)&&T(_)){s.normalize();break}d=_}}const i=t.inlineFillerPosition,r=s.childNodes,o=Array.from(this.domConverter.viewChildrenToDom(e,{bind:!0}));i&&i.parent===e&&Xt(s.ownerDocument,o,i.offset);const a=this._diffNodeLists(r,o),l=this._findUpdateActions(a,r,o,ui);let c=0;const h=new Set;for(const d of l)d==="delete"?(h.add(r[c]),$t(r[c])):(d==="equal"||d==="update")&&c++;c=0;for(const d of l)d==="insert"?(ks(s,c,o[c]),c++):d==="update"?(Yt(r[c],o[c].data),c++):d==="equal"&&(this._markDescendantTextToSync(this.domConverter.domToView(o[c])),c++);for(const d of h)d.parentNode||this.domConverter.unbindDomElement(d)}_diffNodeLists(e,t){return e=mi(e,this._fakeSelectionContainer),it(e,t,fi.bind(null,this.domConverter))}_findUpdateActions(e,t,s,i){if(e.indexOf("insert")===-1||e.indexOf("delete")===-1)return e;let r=[],o=[],a=[];const l={equal:0,insert:0,delete:0};for(const c of e)c==="insert"?a.push(s[l.equal+l.insert]):c==="delete"?o.push(t[l.equal+l.delete]):(r=r.concat(it(o,a,i).map(h=>h==="equal"?"update":h)),r.push("equal"),o=[],a=[]),l[c]++;return r.concat(it(o,a,i).map(c=>c==="equal"?"update":c))}_markDescendantTextToSync(e){if(e){if(e.is("$text"))this.markedTexts.add(e);else if(e.is("element"))for(const t of e.getChildren())this._markDescendantTextToSync(t)}}_updateSelection(){if(x.isBlink&&!x.isAndroid&&this.isSelecting&&!this.markedChildren.size)return;if(this.selection.rangeCount===0){this._removeDomSelection(),this._removeFakeSelection();return}const e=this.domConverter.mapViewToDom(this.selection.editableElement);!this.isFocused||!e||(this.selection.isFake?this._updateFakeSelection(e):this._fakeSelectionContainer&&this._fakeSelectionContainer.isConnected?(this._removeFakeSelection(),this._updateDomSelection(e)):this.isComposing&&x.isAndroid||this._updateDomSelection(e))}_updateFakeSelection(e){const t=e.ownerDocument;this._fakeSelectionContainer||(this._fakeSelectionContainer=gi(t));const s=this._fakeSelectionContainer;if(this.domConverter.bindFakeSelection(s,this.selection),!this._fakeSelectionNeedsUpdate(e))return;(!s.parentElement||s.parentElement!=e)&&e.appendChild(s),s.textContent=this.selection.fakeSelectionLabel||" ";const i=t.getSelection(),r=t.createRange();i.removeAllRanges(),r.selectNodeContents(s),i.addRange(r)}_updateDomSelection(e){const t=e.ownerDocument.defaultView.getSelection();if(!this._domSelectionNeedsUpdate(t))return;const s=this.domConverter.viewPositionToDom(this.selection.anchor),i=this.domConverter.viewPositionToDom(this.selection.focus);t.setBaseAndExtent(s.parent,s.offset,i.parent,i.offset),x.isGecko&&di(i,t)}_domSelectionNeedsUpdate(e){if(!this.domConverter.isDomSelectionCorrect(e))return!0;const t=e&&this.domConverter.domSelectionToView(e);return!(t&&this.selection.isEqual(t)||!this.selection.isCollapsed&&this.selection.isSimilar(t))}_fakeSelectionNeedsUpdate(e){const t=this._fakeSelectionContainer,s=e.ownerDocument.getSelection();return!t||t.parentElement!==e||s.anchorNode!==t&&!t.contains(s.anchorNode)?!0:t.textContent!==this.selection.fakeSelectionLabel}_removeDomSelection(){for(const e of this.domDocuments){const t=e.getSelection();if(t.rangeCount){const s=e.activeElement,i=this.domConverter.mapDomToView(s);s&&i&&t.removeAllRanges()}}}_removeFakeSelection(){const e=this._fakeSelectionContainer;e&&e.remove()}_updateFocus(){if(this.isFocused){const e=this.selection.editableElement;e&&this.domConverter.focus(e)}}}function ci(n){if(n.getAttribute("contenteditable")=="false")return!1;const e=n.findAncestor(t=>t.hasAttribute("contenteditable"));return!e||e.getAttribute("contenteditable")=="true"}function Xt(n,e,t){const s=e instanceof Array?e:e.childNodes,i=s[t];if(T(i))return i.data=$e+i.data,i;{const r=n.createTextNode($e);return Array.isArray(e)?s.splice(t,0,r):ks(e,t,r),r}}function hi(n,e){return Qe(n)&&Qe(e)&&!T(n)&&!T(e)&&!Oe(n)&&!Oe(e)&&n.tagName.toLowerCase()===e.tagName.toLowerCase()}function ui(n,e){return Qe(n)&&Qe(e)&&T(n)&&T(e)}function fi(n,e,t){return e===t?!0:T(e)&&T(t)?e.data===t.data:!!(n.isBlockFiller(e)&&n.isBlockFiller(t))}function di(n,e){const t=n.parent;if(t.nodeType!=Node.ELEMENT_NODE||n.offset!=t.childNodes.length-1)return;const s=t.childNodes[n.offset];s&&s.tagName=="BR"&&e.addRange(e.getRangeAt(0))}function mi(n,e){const t=Array.from(n);return t.length==0||!e||t[t.length-1]==e&&t.pop(),t}function gi(n){const e=n.createElement("div");return e.className="ck-fake-selection-container",Object.assign(e.style,{position:"fixed",top:0,left:"-9999px",width:"42px"}),e.textContent=" ",e}function Yt(n,e){const t=n.data;if(t==e)return;const s=yn(t,e);for(const i of s)i.type==="insert"?n.insertData(i.index,i.values.join("")):n.deleteData(i.index,i.howMany)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const pi=$s(se.document),_i=Ds(se.document),wi=Vs(se.document),He="data-ck-unsafe-attribute-",Qt="data-ck-unsafe-element";class Ls{constructor(e,{blockFillerMode:t,renderingMode:s="editing"}={}){this._domToViewMapping=new WeakMap,this._viewToDomMapping=new WeakMap,this._fakeSelectionMapping=new WeakMap,this._rawContentElementMatcher=new De,this._inlineObjectElementMatcher=new De,this._elementsWithTemporaryCustomProperties=new Set,this.document=e,this.renderingMode=s,this.blockFillerMode=t||(s==="editing"?"br":"nbsp"),this.preElements=["pre"],this.blockElements=["address","article","aside","blockquote","caption","center","dd","details","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","legend","li","main","menu","nav","ol","p","pre","section","summary","table","tbody","td","tfoot","th","thead","tr","ul"],this.inlineObjectElements=["object","iframe","input","button","textarea","select","option","video","embed","audio","img","canvas"],this.unsafeElements=["script","style"],this._domDocument=this.renderingMode==="editing"?se.document:se.document.implementation.createHTMLDocument("")}bindFakeSelection(e,t){this._fakeSelectionMapping.set(e,new Q(t))}fakeSelectionToView(e){return this._fakeSelectionMapping.get(e)}bindElements(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}unbindDomElement(e){const t=this._domToViewMapping.get(e);if(t){this._domToViewMapping.delete(e),this._viewToDomMapping.delete(t);for(const s of Array.from(e.children))this.unbindDomElement(s)}}bindDocumentFragments(e,t){this._domToViewMapping.set(e,t),this._viewToDomMapping.set(t,e)}shouldRenderAttribute(e,t,s){return this.renderingMode==="data"?!0:(e=e.toLowerCase(),e.startsWith("on")||e==="srcdoc"&&t.match(/\bon\S+\s*=|javascript:|<\s*\/*script/i)?!1:s==="img"&&(e==="src"||e==="srcset")||s==="source"&&e==="srcset"?!0:!t.match(/^\s*(javascript:|data:(image\/svg|text\/x?html))/i))}setContentOf(e,t){if(this.renderingMode==="data"){e.innerHTML=t;return}const s=new DOMParser().parseFromString(t,"text/html"),i=s.createDocumentFragment(),r=s.body.childNodes;for(;r.length>0;)i.appendChild(r[0]);const o=s.createTreeWalker(i,NodeFilter.SHOW_ELEMENT),a=[];let l;for(;l=o.nextNode();)a.push(l);for(const c of a){for(const d of c.getAttributeNames())this.setDomElementAttribute(c,d,c.getAttribute(d));const h=c.tagName.toLowerCase();this._shouldRenameElement(h)&&(es(h),c.replaceWith(this._createReplacementDomElement(h,c)))}for(;e.firstChild;)e.firstChild.remove();e.append(i)}viewToDom(e,t={}){if(e.is("$text")){const s=this._processDataFromViewText(e);return this._domDocument.createTextNode(s)}else{const s=e;if(this.mapViewToDom(s))if(s.getCustomProperty("editingPipeline:doNotReuseOnce"))this._elementsWithTemporaryCustomProperties.add(s);else return this.mapViewToDom(s);let i;if(s.is("documentFragment"))i=this._domDocument.createDocumentFragment(),t.bind&&this.bindDocumentFragments(i,s);else{if(s.is("uiElement"))return s.name==="$comment"?i=this._domDocument.createComment(s.getCustomProperty("$rawContent")):i=s.render(this._domDocument,this),t.bind&&this.bindElements(i,s),i;this._shouldRenameElement(s.name)?(es(s.name),i=this._createReplacementDomElement(s.name)):s.hasAttribute("xmlns")?i=this._domDocument.createElementNS(s.getAttribute("xmlns"),s.name):i=this._domDocument.createElement(s.name),s.is("rawElement")&&s.render(i,this),t.bind&&this.bindElements(i,s);for(const r of s.getAttributeKeys())this.setDomElementAttribute(i,r,s.getAttribute(r),s)}if(t.withChildren!==!1)for(const r of this.viewChildrenToDom(s,t))i.appendChild(r);return i}}setDomElementAttribute(e,t,s,i){const r=this.shouldRenderAttribute(t,s,e.tagName.toLowerCase())||i&&i.shouldRenderUnsafeAttribute(t);if(r||L("domconverter-unsafe-attribute-detected",{domElement:e,key:t,value:s}),!bn(t)){L("domconverter-invalid-attribute-detected",{domElement:e,key:t,value:s});return}e.hasAttribute(t)&&!r?e.removeAttribute(t):e.hasAttribute(He+t)&&r&&e.removeAttribute(He+t),e.setAttribute(r?t:He+t,s)}removeDomElementAttribute(e,t){t!=Qt&&(e.removeAttribute(t),e.removeAttribute(He+t))}*viewChildrenToDom(e,t={}){const s=e.getFillerOffset&&e.getFillerOffset();let i=0;for(const r of e.getChildren()){s===i&&(yield this._getBlockFiller());const o=r.is("element")&&!!r.getCustomProperty("dataPipeline:transparentRendering")&&!Et(r.getAttributes());o&&this.renderingMode=="data"?yield*this.viewChildrenToDom(r,t):(o&&L("domconverter-transparent-rendering-unsupported-in-editing-pipeline",{viewElement:r}),yield this.viewToDom(r,t)),i++}s===i&&(yield this._getBlockFiller())}viewRangeToDom(e){const t=this.viewPositionToDom(e.start),s=this.viewPositionToDom(e.end),i=this._domDocument.createRange();return i.setStart(t.parent,t.offset),i.setEnd(s.parent,s.offset),i}viewPositionToDom(e){const t=e.parent;if(t.is("$text")){const s=this.findCorrespondingDomText(t);if(!s)return null;let i=e.offset;return V(s)&&(i+=z),{parent:s,offset:i}}else{let s,i,r;if(e.offset===0){if(s=this.mapViewToDom(t),!s)return null;r=s.childNodes[0]}else{const a=e.nodeBefore;if(i=a.is("$text")?this.findCorrespondingDomText(a):this.mapViewToDom(a),!i)return null;s=i.parentNode,r=i.nextSibling}if(T(r)&&V(r))return{parent:r,offset:z};const o=i?Je(i)+1:0;return{parent:s,offset:o}}}domToView(e,t={}){const s=[],i=this._domToView(e,t,s),r=i.next().value;return!r||(i.next(),this._processDomInlineNodes(null,s,t),r.is("$text")&&r.data.length==0)?null:r}*domChildrenToView(e,t={},s=[]){for(let i=0;i<e.childNodes.length;i++){const r=e.childNodes[i],o=this._domToView(r,t,s),a=o.next().value;a!==null&&(this._isBlockViewElement(a)&&this._processDomInlineNodes(e,s,t),yield a,o.next())}this._processDomInlineNodes(e,s,t)}domSelectionToView(e){if(vi(e))return new Q([]);if(e.rangeCount===1){let i=e.getRangeAt(0).startContainer;T(i)&&(i=i.parentNode);const r=this.fakeSelectionToView(i);if(r)return r}const t=this.isDomSelectionBackward(e),s=[];for(let i=0;i<e.rangeCount;i++){const r=e.getRangeAt(i),o=this.domRangeToView(r);o&&s.push(o)}return new Q(s,{backward:t})}domRangeToView(e){const t=this.domPositionToView(e.startContainer,e.startOffset),s=this.domPositionToView(e.endContainer,e.endOffset);return t&&s?new w(t,s):null}domPositionToView(e,t=0){if(this.isBlockFiller(e))return this.domPositionToView(e.parentNode,Je(e));const s=this.mapDomToView(e);if(s&&(s.is("uiElement")||s.is("rawElement")))return g._createBefore(s);if(T(e)){if(Ne(e))return this.domPositionToView(e.parentNode,Je(e));const i=this.findCorrespondingViewText(e);let r=t;return i?(V(e)&&(r-=z,r=r<0?0:r),new g(i,r)):null}else{if(t===0){const i=this.mapDomToView(e);if(i)return new g(i,0)}else{const i=e.childNodes[t-1];if(T(i)&&Ne(i)||i&&this.isBlockFiller(i))return this.domPositionToView(i.parentNode,Je(i));const r=T(i)?this.findCorrespondingViewText(i):this.mapDomToView(i);if(r&&r.parent)return new g(r.parent,r.index+1)}return null}}mapDomToView(e){return this.getHostViewElement(e)||this._domToViewMapping.get(e)}findCorrespondingViewText(e){if(Ne(e))return null;const t=this.getHostViewElement(e);if(t)return t;const s=e.previousSibling;if(s){if(!this.isElement(s))return null;const i=this.mapDomToView(s);if(i){const r=i.nextSibling;return r instanceof A?r:null}}else{const i=this.mapDomToView(e.parentNode);if(i){const r=i.getChild(0);return r instanceof A?r:null}}return null}mapViewToDom(e){return this._viewToDomMapping.get(e)}findCorrespondingDomText(e){const t=e.previousSibling;return t&&this.mapViewToDom(t)?this.mapViewToDom(t).nextSibling:!t&&e.parent&&this.mapViewToDom(e.parent)?this.mapViewToDom(e.parent).childNodes[0]:null}focus(e){const t=this.mapViewToDom(e);if(t&&t.ownerDocument.activeElement!==t){const{scrollX:s,scrollY:i}=se.window,r=[];Zt(t,o=>{const{scrollLeft:a,scrollTop:l}=o;r.push([a,l])}),t.focus(),Zt(t,o=>{const[a,l]=r.shift();o.scrollLeft=a,o.scrollTop=l}),se.window.scrollTo(s,i)}}_clearDomSelection(){const e=this.mapViewToDom(this.document.selection.editableElement);if(!e)return;const t=e.ownerDocument.defaultView.getSelection(),s=this.domSelectionToView(t);s&&s.rangeCount>0&&t.removeAllRanges()}isElement(e){return e&&e.nodeType==Node.ELEMENT_NODE}isDocumentFragment(e){return e&&e.nodeType==Node.DOCUMENT_FRAGMENT_NODE}isBlockFiller(e){return this.blockFillerMode=="br"?e.isEqualNode(pi):e.tagName==="BR"&&Ws(e,this.blockElements)&&e.parentNode.childNodes.length===1?!0:e.isEqualNode(wi)||bi(e,this.blockElements)}isDomSelectionBackward(e){if(e.isCollapsed)return!1;const t=this._domDocument.createRange();try{t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset)}catch{return!1}const s=t.collapsed;return t.detach(),s}getHostViewElement(e){const t=vn(e);for(t.pop();t.length;){const s=t.pop(),i=this._domToViewMapping.get(s);if(i&&(i.is("uiElement")||i.is("rawElement")))return i}return null}isDomSelectionCorrect(e){return this._isDomSelectionPositionCorrect(e.anchorNode,e.anchorOffset)&&this._isDomSelectionPositionCorrect(e.focusNode,e.focusOffset)}registerRawContentMatcher(e){this._rawContentElementMatcher.add(e)}registerInlineObjectMatcher(e){this._inlineObjectElementMatcher.add(e)}_clearTemporaryCustomProperties(){for(const e of this._elementsWithTemporaryCustomProperties)e._removeCustomProperty("editingPipeline:doNotReuseOnce");this._elementsWithTemporaryCustomProperties.clear()}_getBlockFiller(){switch(this.blockFillerMode){case"nbsp":return Ds(this._domDocument);case"markedNbsp":return Vs(this._domDocument);case"br":return $s(this._domDocument)}}_isDomSelectionPositionCorrect(e,t){if(T(e)&&V(e)&&t<z||this.isElement(e)&&V(e.childNodes[t]))return!1;const s=this.mapDomToView(e);return!(s&&(s.is("uiElement")||s.is("rawElement")))}*_domToView(e,t,s){if(this.isBlockFiller(e))return null;const i=this.getHostViewElement(e);if(i)return i;if(Oe(e)&&t.skipComments)return null;if(T(e)){if(Ne(e))return null;{const r=e.data;if(r==="")return null;const o=new A(this.document,r);return s.push(o),o}}else{let r=this.mapDomToView(e);if(r)return this._isInlineObjectElement(r)&&s.push(r),r;if(this.isDocumentFragment(e))r=new me(this.document),t.bind&&this.bindDocumentFragments(e,r);else{r=this._createViewElement(e,t),t.bind&&this.bindElements(e,r);const a=e.attributes;if(a)for(let l=a.length,c=0;c<l;c++)r._setAttribute(a[c].name,a[c].value);if(this._isViewElementWithRawContent(r,t))return r._setCustomProperty("$rawContent",e.innerHTML),this._isBlockViewElement(r)||s.push(r),r;if(Oe(e))return r._setCustomProperty("$rawContent",e.data),r}yield r;const o=[];if(t.withChildren!==!1)for(const a of this.domChildrenToView(e,t,o))r._appendChild(a);if(this._isInlineObjectElement(r))s.push(r);else for(const a of o)s.push(a)}}_processDomInlineNodes(e,t,s){if(!t.length||e&&!this.isDocumentFragment(e)&&!this._isBlockDomElement(e))return;let i=!1;for(let r=0;r<t.length;r++){const o=t[r];if(!o.is("$text")){i=!1;continue}let a,l=!1;if(yi(o,this.preElements))a=jt(o.data);else{a=o.data.replace(/[ \n\t\r]{1,}/g," "),l=/[^\S\u00A0]/.test(a.charAt(a.length-1));const c=r>0?t[r-1]:null,h=r+1<t.length?t[r+1]:null,d=!c||c.is("element")&&c.name=="br"||i,_=h?!1:!V(o.data);s.withChildren!==!1&&(d&&(a=a.replace(/^ /,"")),_&&(a=a.replace(/ $/,""))),a=jt(a),a=a.replace(/ \u00A0/g,"  ");const p=h&&h.is("element")&&h.name!="br",v=h&&h.is("$text")&&h.data.charAt(0)==" ";(/[ \u00A0]\u00A0$/.test(a)||!h||p||v)&&(a=a.replace(/\u00A0$/," ")),(d||c&&c.is("element")&&c.name!="br")&&(a=a.replace(/^\u00A0/," "))}a.length==0&&o.parent?(o._remove(),t.splice(r,1),r--):(o._data=a,i=l)}t.length=0}_processDataFromViewText(e){let t=e.data;if(e.getAncestors().some(s=>this.preElements.includes(s.name)))return t;if(t.charAt(0)==" "){const s=this._getTouchingInlineViewNode(e,!1);(s&&s.is("$textProxy")&&this._nodeEndsWithSpace(s)||!s)&&(t=" "+t.substr(1))}if(t.charAt(t.length-1)==" "){const s=this._getTouchingInlineViewNode(e,!0),i=s&&s.is("$textProxy")&&s.data.charAt(0)==" ";(t.charAt(t.length-2)==" "||!s||i)&&(t=t.substr(0,t.length-1)+" ")}return t.replace(/ {2}/g,"  ")}_nodeEndsWithSpace(e){if(e.getAncestors().some(s=>this.preElements.includes(s.name)))return!1;const t=this._processDataFromViewText(e);return t.charAt(t.length-1)==" "}_getTouchingInlineViewNode(e,t){const s=new fe({startPosition:t?g._createAfter(e):g._createBefore(e),direction:t?"forward":"backward"});for(const i of s){if(i.item.is("element","br"))return null;if(this._isInlineObjectElement(i.item))return i.item;if(i.item.is("containerElement"))return null;if(i.item.is("$textProxy"))return i.item}return null}_isBlockDomElement(e){return this.isElement(e)&&this.blockElements.includes(e.tagName.toLowerCase())}_isBlockViewElement(e){return e.is("element")&&this.blockElements.includes(e.name)}_isInlineObjectElement(e){return e.is("element")?e.name=="br"||this.inlineObjectElements.includes(e.name)||!!this._inlineObjectElementMatcher.match(e):!1}_createViewElement(e,t){if(Oe(e))return new nt(this.document,"$comment");const s=t.keepOriginalCase?e.tagName:e.tagName.toLowerCase();return new G(this.document,s)}_isViewElementWithRawContent(e,t){return t.withChildren!==!1&&e.is("element")&&!!this._rawContentElementMatcher.match(e)}_shouldRenameElement(e){const t=e.toLowerCase();return this.renderingMode==="editing"&&this.unsafeElements.includes(t)}_createReplacementDomElement(e,t){const s=this._domDocument.createElement("span");if(s.setAttribute(Qt,e),t){for(;t.firstChild;)s.appendChild(t.firstChild);for(const i of t.getAttributeNames())s.setAttribute(i,t.getAttribute(i))}return s}}function yi(n,e){return n.getAncestors().some(t=>t.is("element")&&e.includes(t.name))}function Zt(n,e){let t=n;for(;t;)e(t),t=t.parentElement}function bi(n,e){return n.isEqualNode(_i)&&Ws(n,e)&&n.parentNode.childNodes.length===1}function Ws(n,e){const t=n.parentNode;return!!t&&!!t.tagName&&e.includes(t.tagName.toLowerCase())}function es(n){n==="script"&&L("domconverter-unsafe-script-element-detected"),n==="style"&&L("domconverter-unsafe-style-element-detected")}function vi(n){if(!x.isGecko||!n.rangeCount)return!1;const e=n.getRangeAt(0).startContainer;try{Object.prototype.toString.call(e)}catch{return!0}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Se extends Pn(){constructor(e){super(),this._isEnabled=!1,this.view=e,this.document=e.document}get isEnabled(){return this._isEnabled}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}destroy(){this.disable(),this.stopListening()}checkShouldIgnoreEventFromTarget(e){return e&&e.nodeType===3&&(e=e.parentNode),!e||e.nodeType!==1?!1:e.matches("[data-cke-ignore-events], [data-cke-ignore-events] *")}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pi{constructor(e,t,s){this.view=e,this.document=e.document,this.domEvent=t,this.domTarget=t.target,xn(this,s)}get target(){return this.view.domConverter.mapDomToView(this.domTarget)}preventDefault(){this.domEvent.preventDefault()}stopPropagation(){this.domEvent.stopPropagation()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ee extends Se{constructor(){super(...arguments),this.useCapture=!1}observe(e){(typeof this.domEventType=="string"?[this.domEventType]:this.domEventType).forEach(s=>{this.listenTo(e,s,(i,r)=>{this.isEnabled&&!this.checkShouldIgnoreEventFromTarget(r.target)&&this.onDomEvent(r)},{useCapture:this.useCapture})})}stopObserving(e){this.stopListening(e)}fire(e,t,s){this.isEnabled&&this.document.fire(e,new Pi(this.view,t,s))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ci extends Ee{constructor(){super(...arguments),this.domEventType=["keydown","keyup"]}onDomEvent(e){const t={keyCode:e.keyCode,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,get keystroke(){return Cn(this)}};this.fire(e.type,e,t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ki extends Se{constructor(e){super(e),this._fireSelectionChangeDoneDebounced=gt(t=>{this.document.fire("selectionChangeDone",t)},200)}observe(){const e=this.document;e.on("arrowKey",(t,s)=>{e.selection.isFake&&this.isEnabled&&s.preventDefault()},{context:"$capture"}),e.on("arrowKey",(t,s)=>{e.selection.isFake&&this.isEnabled&&this._handleSelectionMove(s.keyCode)},{priority:"lowest"})}stopObserving(){}destroy(){super.destroy(),this._fireSelectionChangeDoneDebounced.cancel()}_handleSelectionMove(e){const t=this.document.selection,s=new Q(t.getRanges(),{backward:t.isBackward,fake:!1});(e==ue.arrowleft||e==ue.arrowup)&&s.setTo(s.getFirstPosition()),(e==ue.arrowright||e==ue.arrowdown)&&s.setTo(s.getLastPosition());const i={oldSelection:t,newSelection:s,domSelection:null};this.document.fire("selectionChange",i),this._fireSelectionChangeDoneDebounced(i)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qs extends Se{constructor(e){super(e),this._config={childList:!0,characterData:!0,subtree:!0},this.domConverter=e.domConverter,this.renderer=e._renderer,this._domElements=new Set,this._mutationObserver=new window.MutationObserver(this._onMutations.bind(this))}flush(){this._onMutations(this._mutationObserver.takeRecords())}observe(e){this._domElements.add(e),this.isEnabled&&this._mutationObserver.observe(e,this._config)}stopObserving(e){if(this._domElements.delete(e),this.isEnabled){this._mutationObserver.disconnect();for(const t of this._domElements)this._mutationObserver.observe(t,this._config)}}enable(){super.enable();for(const e of this._domElements)this._mutationObserver.observe(e,this._config)}disable(){super.disable(),this._mutationObserver.disconnect()}destroy(){super.destroy(),this._mutationObserver.disconnect()}_onMutations(e){if(e.length===0)return;const t=this.domConverter,s=new Set,i=new Set;for(const o of e){const a=t.mapDomToView(o.target);a&&(a.is("uiElement")||a.is("rawElement")||o.type==="childList"&&!this._isBogusBrMutation(o)&&i.add(a))}for(const o of e){const a=t.mapDomToView(o.target);if(!(a&&(a.is("uiElement")||a.is("rawElement")))&&o.type==="characterData"){const l=t.findCorrespondingViewText(o.target);l&&!i.has(l.parent)?s.add(l):!l&&V(o.target)&&i.add(t.mapDomToView(o.target.parentNode))}}let r=!1;for(const o of s)r=!0,this.renderer.markToSync("text",o);for(const o of i){const a=t.mapViewToDom(o),l=Array.from(o.getChildren()),c=Array.from(t.domChildrenToView(a,{withChildren:!1}));Nn(l,c,Ai)||(r=!0,this.renderer.markToSync("children",o))}r&&this.view.forceRender()}_isBogusBrMutation(e){let t=null;return e.nextSibling===null&&e.removedNodes.length===0&&e.addedNodes.length==1&&(t=this.domConverter.domToView(e.addedNodes[0],{withChildren:!1})),t&&t.is("element","br")}}function Ai(n,e){if(!Array.isArray(n))return n===e?!0:n.is("$text")&&e.is("$text")?n.data===e.data:!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pt extends Ee{constructor(e){super(e),this._isFocusChanging=!1,this.domEventType=["focus","blur"],this.useCapture=!0;const t=this.document;t.on("focus",()=>{this._isFocusChanging=!0,this._renderTimeoutId=setTimeout(()=>{this.flush(),e.change(()=>{})},50)}),t.on("blur",(s,i)=>{const r=t.selection.editableElement;(r===null||r===i.target)&&(t.isFocused=!1,this._isFocusChanging=!1,e.change(()=>{}))})}flush(){this._isFocusChanging&&(this._isFocusChanging=!1,this.document.isFocused=!0)}onDomEvent(e){this.fire(e.type,e)}destroy(){this._renderTimeoutId&&clearTimeout(this._renderTimeoutId),super.destroy()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Si extends Se{constructor(e){super(e),this.mutationObserver=e.getObserver(qs),this.focusObserver=e.getObserver(Pt),this.selection=this.document.selection,this.domConverter=e.domConverter,this._documents=new WeakSet,this._fireSelectionChangeDoneDebounced=gt(t=>{this.document.fire("selectionChangeDone",t)},200),this._clearInfiniteLoopInterval=setInterval(()=>this._clearInfiniteLoop(),1e3),this._documentIsSelectingInactivityTimeoutDebounced=gt(()=>this.document.isSelecting=!1,5e3),this._loopbackCounter=0}observe(e){const t=e.ownerDocument,s=()=>{this.document.isSelecting=!0,this._documentIsSelectingInactivityTimeoutDebounced()},i=()=>{this.document.isSelecting&&(this._handleSelectionChange(null,t),this.document.isSelecting=!1,this._documentIsSelectingInactivityTimeoutDebounced.cancel())};this.listenTo(e,"selectstart",s,{priority:"highest"}),this.listenTo(e,"keydown",i,{priority:"highest",useCapture:!0}),this.listenTo(e,"keyup",i,{priority:"highest",useCapture:!0}),!this._documents.has(t)&&(this.listenTo(t,"mouseup",i,{priority:"highest",useCapture:!0}),this.listenTo(t,"selectionchange",(r,o)=>{this.document.isComposing&&!x.isAndroid||(this._handleSelectionChange(o,t),this._documentIsSelectingInactivityTimeoutDebounced())}),this._documents.add(t))}stopObserving(e){this.stopListening(e)}destroy(){super.destroy(),clearInterval(this._clearInfiniteLoopInterval),this._fireSelectionChangeDoneDebounced.cancel(),this._documentIsSelectingInactivityTimeoutDebounced.cancel()}_reportInfiniteLoop(){}_handleSelectionChange(e,t){if(!this.isEnabled)return;const s=t.defaultView.getSelection();if(this.checkShouldIgnoreEventFromTarget(s.anchorNode))return;this.mutationObserver.flush();const i=this.domConverter.domSelectionToView(s);if(i.rangeCount==0){this.view.hasDomSelection=!1;return}if(this.view.hasDomSelection=!0,this.focusObserver.flush(),!(this.selection.isEqual(i)&&this.domConverter.isDomSelectionCorrect(s))){if(++this._loopbackCounter>60){this._reportInfiniteLoop();return}if(this.selection.isSimilar(i))this.view.forceRender();else{const r={oldSelection:this.selection,newSelection:i,domSelection:s};this.document.fire("selectionChange",r),this._fireSelectionChangeDoneDebounced(r)}}}_clearInfiniteLoop(){this._loopbackCounter=0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ei extends Ee{constructor(e){super(e),this.domEventType=["compositionstart","compositionupdate","compositionend"];const t=this.document;t.on("compositionstart",()=>{t.isComposing=!0},{priority:"low"}),t.on("compositionend",()=>{t.isComposing=!1},{priority:"low"})}onDomEvent(e){this.fire(e.type,e,{data:e.data})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ri{constructor(e,t={}){this._files=t.cacheFiles?ts(e):null,this._native=e}get files(){return this._files||(this._files=ts(this._native)),this._files}get types(){return this._native.types}getData(e){return this._native.getData(e)}setData(e,t){this._native.setData(e,t)}set effectAllowed(e){this._native.effectAllowed=e}get effectAllowed(){return this._native.effectAllowed}set dropEffect(e){this._native.dropEffect=e}get dropEffect(){return this._native.dropEffect}setDragImage(e,t,s){this._native.setDragImage(e,t,s)}get isCanceled(){return this._native.dropEffect=="none"||!!this._native.mozUserCancelled}}function ts(n){const e=Array.from(n.files||[]),t=Array.from(n.items||[]);return e.length?e:t.filter(s=>s.kind==="file").map(s=>s.getAsFile())}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ti extends Ee{constructor(){super(...arguments),this.domEventType="beforeinput"}onDomEvent(e){const t=e.getTargetRanges(),s=this.view,i=s.document;let r=null,o=null,a=[];if(e.dataTransfer&&(r=new Ri(e.dataTransfer)),e.data!==null?o=e.data:r&&(o=r.getData("text/plain")),i.selection.isFake)a=Array.from(i.selection.getRanges());else if(t.length)a=t.map(l=>{const c=s.domConverter.domPositionToView(l.startContainer,l.startOffset),h=s.domConverter.domPositionToView(l.endContainer,l.endOffset);if(c)return s.createRange(c,h);if(h)return s.createRange(h)}).filter(l=>!!l);else if(x.isAndroid){const l=e.target.ownerDocument.defaultView.getSelection();a=Array.from(s.domConverter.domSelectionToView(l).getRanges())}if(x.isAndroid&&e.inputType=="insertCompositionText"&&o&&o.endsWith(`
`)){this.fire(e.type,e,{inputType:"insertParagraph",targetRanges:[s.createRange(a[0].end)]});return}if(e.inputType=="insertText"&&o&&o.includes(`
`)){const l=o.split(/\n{1,2}/g);let c=a;for(let h=0;h<l.length;h++){const d=l[h];d!=""&&(this.fire(e.type,e,{data:d,dataTransfer:r,targetRanges:c,inputType:e.inputType,isComposing:e.isComposing}),c=[i.selection.getFirstRange()]),h+1<l.length&&(this.fire(e.type,e,{inputType:"insertParagraph",targetRanges:c}),c=[i.selection.getFirstRange()])}return}this.fire(e.type,e,{data:o,dataTransfer:r,targetRanges:a,inputType:e.inputType,isComposing:e.isComposing})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mi extends Se{constructor(e){super(e),this.document.on("keydown",(t,s)=>{if(this.isEnabled&&kn(s.keyCode)){const i=new Mt(this.document,"arrowKey",this.document.selection.getFirstRange());this.document.fire(i,s),i.stop.called&&t.stop()}})}observe(){}stopObserving(){}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xi extends Se{constructor(e){super(e);const t=this.document;t.on("keydown",(s,i)=>{if(!this.isEnabled||i.keyCode!=ue.tab||i.ctrlKey)return;const r=new Mt(t,"tab",t.selection.getFirstRange());t.fire(r,i),r.stop.called&&s.stop()})}observe(){}stopObserving(){}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ni extends q(){constructor(e){super(),this.domRoots=new Map,this._initialDomRootAttributes=new WeakMap,this._observers=new Map,this._ongoingChange=!1,this._postFixersInProgress=!1,this._renderingDisabled=!1,this._hasChangedSinceTheLastRendering=!1,this.document=new Os(e),this.domConverter=new Ls(this.document),this.set("isRenderingInProgress",!1),this.set("hasDomSelection",!1),this._renderer=new li(this.domConverter,this.document.selection),this._renderer.bind("isFocused","isSelecting","isComposing").to(this.document,"isFocused","isSelecting","isComposing"),this._writer=new Fs(this.document),this.addObserver(qs),this.addObserver(Pt),this.addObserver(Si),this.addObserver(Ci),this.addObserver(ki),this.addObserver(Ei),this.addObserver(Mi),this.addObserver(Ti),this.addObserver(xi),oi(this),Qn(this),this.on("render",()=>{this._render(),this.document.fire("layoutChanged"),this._hasChangedSinceTheLastRendering=!1}),this.listenTo(this.document.selection,"change",()=>{this._hasChangedSinceTheLastRendering=!0}),this.listenTo(this.document,"change:isFocused",()=>{this._hasChangedSinceTheLastRendering=!0}),x.isiOS&&this.listenTo(this.document,"blur",(t,s)=>{this.domConverter.mapDomToView(s.domEvent.relatedTarget)||this.domConverter._clearDomSelection()})}attachDomRoot(e,t="main"){const s=this.document.getRoot(t);s._name=e.tagName.toLowerCase();const i={};for(const{name:o,value:a}of Array.from(e.attributes))i[o]=a,o==="class"?this._writer.addClass(a.split(" "),s):this._writer.setAttribute(o,a,s);this._initialDomRootAttributes.set(e,i);const r=()=>{this._writer.setAttribute("contenteditable",(!s.isReadOnly).toString(),s),s.isReadOnly?this._writer.addClass("ck-read-only",s):this._writer.removeClass("ck-read-only",s)};r(),this.domRoots.set(t,e),this.domConverter.bindElements(e,s),this._renderer.markToSync("children",s),this._renderer.markToSync("attributes",s),this._renderer.domDocuments.add(e.ownerDocument),s.on("change:children",(o,a)=>this._renderer.markToSync("children",a)),s.on("change:attributes",(o,a)=>this._renderer.markToSync("attributes",a)),s.on("change:text",(o,a)=>this._renderer.markToSync("text",a)),s.on("change:isReadOnly",()=>this.change(r)),s.on("change",()=>{this._hasChangedSinceTheLastRendering=!0});for(const o of this._observers.values())o.observe(e,t)}detachDomRoot(e){const t=this.domRoots.get(e);Array.from(t.attributes).forEach(({name:i})=>t.removeAttribute(i));const s=this._initialDomRootAttributes.get(t);for(const i in s)t.setAttribute(i,s[i]);this.domRoots.delete(e),this.domConverter.unbindDomElement(t);for(const i of this._observers.values())i.stopObserving(t)}getDomRoot(e="main"){return this.domRoots.get(e)}addObserver(e){let t=this._observers.get(e);if(t)return t;t=new e(this),this._observers.set(e,t);for(const[s,i]of this.domRoots)t.observe(i,s);return t.enable(),t}getObserver(e){return this._observers.get(e)}disableObservers(){for(const e of this._observers.values())e.disable()}enableObservers(){for(const e of this._observers.values())e.enable()}scrollToTheSelection({alignToTop:e,forceScroll:t,viewportOffset:s=20,ancestorOffset:i=20}={}){const r=this.document.selection.getFirstRange();if(!r)return;const o=oe({alignToTop:e,forceScroll:t,viewportOffset:s,ancestorOffset:i});typeof s=="number"&&(s={top:s,bottom:s,left:s,right:s});const a={target:this.domConverter.viewRangeToDom(r),viewportOffset:s,ancestorOffset:i,alignToTop:e,forceScroll:t};this.fire("scrollToTheSelection",a,o),An(a)}focus(){if(!this.document.isFocused){const e=this.document.selection.editableElement;e&&(this.domConverter.focus(e),this.forceRender())}}change(e){if(this.isRenderingInProgress||this._postFixersInProgress)throw new f("cannot-change-view-tree",this);try{if(this._ongoingChange)return e(this._writer);this._ongoingChange=!0;const t=e(this._writer);return this._ongoingChange=!1,!this._renderingDisabled&&this._hasChangedSinceTheLastRendering&&(this._postFixersInProgress=!0,this.document._callPostFixers(this._writer),this._postFixersInProgress=!1,this.fire("render")),t}catch(t){/* istanbul ignore next -- @preserve */f.rethrowUnexpectedError(t,this)}}forceRender(){this._hasChangedSinceTheLastRendering=!0,this.getObserver(Pt).flush(),this.change(()=>{})}destroy(){for(const e of this._observers.values())e.destroy();this.document.destroy(),this.stopListening()}createPositionAt(e,t){return g._createAt(e,t)}createPositionAfter(e){return g._createAfter(e)}createPositionBefore(e){return g._createBefore(e)}createRange(e,t){return new w(e,t)}createRangeOn(e){return w._createOn(e)}createRangeIn(e){return w._createIn(e)}createSelection(...e){return new Q(...e)}_disableRendering(e){this._renderingDisabled=e,e==!1&&this.change(()=>{})}_render(){this.isRenderingInProgress=!0,this.disableObservers(),this._renderer.render(),this.enableObservers(),this.isRenderingInProgress=!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae{is(){throw new Error("is() method is abstract")}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */let be=class extends ae{constructor(e){super(),this.parent=null,this._attrs=pe(e)}get document(){return null}get index(){let e;if(!this.parent)return null;if((e=this.parent.getChildIndex(this))===null)throw new f("model-node-not-found-in-parent",this);return e}get startOffset(){let e;if(!this.parent)return null;if((e=this.parent.getChildStartOffset(this))===null)throw new f("model-node-not-found-in-parent",this);return e}get offsetSize(){return 1}get endOffset(){return this.parent?this.startOffset+this.offsetSize:null}get nextSibling(){const e=this.index;return e!==null&&this.parent.getChild(e+1)||null}get previousSibling(){const e=this.index;return e!==null&&this.parent.getChild(e-1)||null}get root(){let e=this;for(;e.parent;)e=e.parent;return e}isAttached(){return this.parent===null?!1:this.root.isAttached()}getPath(){const e=[];let t=this;for(;t.parent;)e.unshift(t.startOffset),t=t.parent;return e}getAncestors(e={}){const t=[];let s=e.includeSelf?this:this.parent;for(;s;)t[e.parentFirst?"push":"unshift"](s),s=s.parent;return t}getCommonAncestor(e,t={}){const s=this.getAncestors(t),i=e.getAncestors(t);let r=0;for(;s[r]==i[r]&&s[r];)r++;return r===0?null:s[r-1]}isBefore(e){if(this==e||this.root!==e.root)return!1;const t=this.getPath(),s=e.getPath(),i=O(t,s);switch(i){case"prefix":return!0;case"extension":return!1;default:return t[i]<s[i]}}isAfter(e){return this==e||this.root!==e.root?!1:!this.isBefore(e)}hasAttribute(e){return this._attrs.has(e)}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}toJSON(){const e={};return this._attrs.size&&(e.attributes=Array.from(this._attrs).reduce((t,s)=>(t[s[0]]=s[1],t),{})),e}_clone(e){return new this.constructor(this._attrs)}_remove(){this.parent._removeChildren(this.index)}_setAttribute(e,t){this._attrs.set(e,t)}_setAttributesTo(e){this._attrs=pe(e)}_removeAttribute(e){return this._attrs.delete(e)}_clearAttributes(){this._attrs.clear()}};be.prototype.is=function(n){return n==="node"||n==="model:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ie{constructor(e){this._nodes=[],e&&this._insertNodes(0,e)}[Symbol.iterator](){return this._nodes[Symbol.iterator]()}get length(){return this._nodes.length}get maxOffset(){return this._nodes.reduce((e,t)=>e+t.offsetSize,0)}getNode(e){return this._nodes[e]||null}getNodeIndex(e){const t=this._nodes.indexOf(e);return t==-1?null:t}getNodeStartOffset(e){const t=this.getNodeIndex(e);return t===null?null:this._nodes.slice(0,t).reduce((s,i)=>s+i.offsetSize,0)}indexToOffset(e){if(e==this._nodes.length)return this.maxOffset;const t=this._nodes[e];if(!t)throw new f("model-nodelist-index-out-of-bounds",this);return this.getNodeStartOffset(t)}offsetToIndex(e){let t=0;for(const s of this._nodes){if(e>=t&&e<t+s.offsetSize)return this.getNodeIndex(s);t+=s.offsetSize}if(t!=e)throw new f("model-nodelist-offset-out-of-bounds",this,{offset:e,nodeList:this});return this.length}_insertNodes(e,t){for(const s of t)if(!(s instanceof be))throw new f("model-nodelist-insertnodes-not-node",this);this._nodes=Sn(this._nodes,Array.from(t),e,0)}_removeNodes(e,t=1){return this._nodes.splice(e,t)}toJSON(){return this._nodes.map(e=>e.toJSON())}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class C extends be{constructor(e,t){super(t),this._data=e||""}get offsetSize(){return this.data.length}get data(){return this._data}toJSON(){const e=super.toJSON();return e.data=this.data,e}_clone(){return new C(this.data,this.getAttributes())}static fromJSON(e){return new C(e.data,e.attributes)}}C.prototype.is=function(n){return n==="$text"||n==="model:$text"||n==="text"||n==="model:text"||n==="node"||n==="model:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J extends ae{constructor(e,t,s){if(super(),this.textNode=e,t<0||t>e.offsetSize)throw new f("model-textproxy-wrong-offsetintext",this);if(s<0||t+s>e.offsetSize)throw new f("model-textproxy-wrong-length",this);this.data=e.data.substring(t,t+s),this.offsetInText=t}get startOffset(){return this.textNode.startOffset!==null?this.textNode.startOffset+this.offsetInText:null}get offsetSize(){return this.data.length}get endOffset(){return this.startOffset!==null?this.startOffset+this.offsetSize:null}get isPartial(){return this.offsetSize!==this.textNode.offsetSize}get parent(){return this.textNode.parent}get root(){return this.textNode.root}getPath(){const e=this.textNode.getPath();return e.length>0&&(e[e.length-1]+=this.offsetInText),e}getAncestors(e={}){const t=[];let s=e.includeSelf?this:this.parent;for(;s;)t[e.parentFirst?"push":"unshift"](s),s=s.parent;return t}hasAttribute(e){return this.textNode.hasAttribute(e)}getAttribute(e){return this.textNode.getAttribute(e)}getAttributes(){return this.textNode.getAttributes()}getAttributeKeys(){return this.textNode.getAttributeKeys()}}J.prototype.is=function(n){return n==="$textProxy"||n==="model:$textProxy"||n==="textProxy"||n==="model:textProxy"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P extends be{constructor(e,t,s){super(t),this._children=new Ie,this.name=e,s&&this._insertChild(0,s)}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}offsetToIndex(e){return this._children.offsetToIndex(e)}getNodeByPath(e){let t=this;for(const s of e)t=t.getChild(t.offsetToIndex(s));return t}findAncestor(e,t={}){let s=t.includeSelf?this:this.parent;for(;s;){if(s.name===e)return s;s=s.parent}return null}toJSON(){const e=super.toJSON();if(e.name=this.name,this._children.length>0){e.children=[];for(const t of this._children)e.children.push(t.toJSON())}return e}_clone(e=!1){const t=e?Array.from(this._children).map(s=>s._clone(!0)):void 0;return new P(this.name,this.getAttributes(),t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const s=Oi(t);for(const i of s)i.parent!==null&&i._remove(),i.parent=this;this._children._insertNodes(e,s)}_removeChildren(e,t=1){const s=this._children._removeNodes(e,t);for(const i of s)i.parent=null;return s}static fromJSON(e){let t;if(e.children){t=[];for(const s of e.children)s.name?t.push(P.fromJSON(s)):t.push(C.fromJSON(s))}return new P(e.name,e.attributes,t)}}P.prototype.is=function(n,e){return e?e===this.name&&(n==="element"||n==="model:element"):n==="element"||n==="model:element"||n==="node"||n==="model:node"};function Oi(n){return typeof n=="string"?[new C(n)]:(re(n)||(n=[n]),Array.from(n).map(e=>typeof e=="string"?new C(e):e instanceof J?new C(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ne{constructor(e){if(!e||!e.boundaries&&!e.startPosition)throw new f("model-tree-walker-no-start-position",null);const t=e.direction||"forward";if(t!="forward"&&t!="backward")throw new f("model-tree-walker-unknown-direction",e,{direction:t});this.direction=t,this.boundaries=e.boundaries||null,e.startPosition?this._position=e.startPosition.clone():this._position=m._createAt(this.boundaries[this.direction=="backward"?"end":"start"]),this.position.stickiness="toNone",this.singleCharacters=!!e.singleCharacters,this.shallow=!!e.shallow,this.ignoreElementEnd=!!e.ignoreElementEnd,this._boundaryStartParent=this.boundaries?this.boundaries.start.parent:null,this._boundaryEndParent=this.boundaries?this.boundaries.end.parent:null,this._visitedParent=this.position.parent}[Symbol.iterator](){return this}get position(){return this._position}skip(e){let t,s,i,r;do i=this.position,r=this._visitedParent,{done:t,value:s}=this.next();while(!t&&e(s));t||(this._position=i,this._visitedParent=r)}next(){return this.direction=="forward"?this._next():this._previous()}_next(){const e=this.position,t=this.position.clone(),s=this._visitedParent;if(s.parent===null&&t.offset===s.maxOffset)return{done:!0,value:void 0};if(s===this._boundaryEndParent&&t.offset==this.boundaries.end.offset)return{done:!0,value:void 0};const i=Fe(t,s),r=i||Us(t,s,i);if(r instanceof P){if(!this.shallow)t.path.push(0),this._visitedParent=r;else{if(this.boundaries&&this.boundaries.end.isBefore(t))return{done:!0,value:void 0};t.offset++}return this._position=t,ce("elementStart",r,e,t,1)}if(r instanceof C){let o;if(this.singleCharacters)o=1;else{let c=r.endOffset;this._boundaryEndParent==s&&this.boundaries.end.offset<c&&(c=this.boundaries.end.offset),o=c-t.offset}const a=t.offset-r.startOffset,l=new J(r,a,o);return t.offset+=o,this._position=t,ce("text",l,e,t,o)}return t.path.pop(),t.offset++,this._position=t,this._visitedParent=s.parent,this.ignoreElementEnd?this._next():ce("elementEnd",s,e,t)}_previous(){const e=this.position,t=this.position.clone(),s=this._visitedParent;if(s.parent===null&&t.offset===0)return{done:!0,value:void 0};if(s==this._boundaryStartParent&&t.offset==this.boundaries.start.offset)return{done:!0,value:void 0};const i=t.parent,r=Fe(t,i),o=r||zs(t,i,r);if(o instanceof P)return t.offset--,this.shallow?(this._position=t,ce("elementStart",o,e,t,1)):(t.path.push(o.maxOffset),this._position=t,this._visitedParent=o,this.ignoreElementEnd?this._previous():ce("elementEnd",o,e,t));if(o instanceof C){let a;if(this.singleCharacters)a=1;else{let h=o.startOffset;this._boundaryStartParent==s&&this.boundaries.start.offset>h&&(h=this.boundaries.start.offset),a=t.offset-h}const l=t.offset-o.startOffset,c=new J(o,l-a,a);return t.offset-=a,this._position=t,ce("text",c,e,t,a)}return t.path.pop(),this._position=t,this._visitedParent=s.parent,ce("elementStart",s,e,t,1)}}function ce(n,e,t,s,i){return{done:!1,value:{type:n,item:e,previousPosition:t,nextPosition:s,length:i}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class m extends ae{constructor(e,t,s="toNone"){if(super(),!e.is("element")&&!e.is("documentFragment"))throw new f("model-position-root-invalid",e);if(!(t instanceof Array)||t.length===0)throw new f("model-position-path-incorrect-format",e,{path:t});e.is("rootElement")?t=t.slice():(t=[...e.getPath(),...t],e=e.root),this.root=e,this.path=t,this.stickiness=s}get offset(){return this.path[this.path.length-1]}set offset(e){this.path[this.path.length-1]=e}get parent(){let e=this.root;for(let t=0;t<this.path.length-1;t++)if(e=e.getChild(e.offsetToIndex(this.path[t])),!e)throw new f("model-position-path-incorrect",this,{position:this});if(e.is("$text"))throw new f("model-position-path-incorrect",this,{position:this});return e}get index(){return this.parent.offsetToIndex(this.offset)}get textNode(){return Fe(this,this.parent)}get nodeAfter(){const e=this.parent;return Us(this,e,Fe(this,e))}get nodeBefore(){const e=this.parent;return zs(this,e,Fe(this,e))}get isAtStart(){return this.offset===0}get isAtEnd(){return this.offset==this.parent.maxOffset}compareWith(e){if(this.root!=e.root)return"different";const t=O(this.path,e.path);switch(t){case"same":return"same";case"prefix":return"before";case"extension":return"after";default:return this.path[t]<e.path[t]?"before":"after"}}getLastMatchingPosition(e,t={}){t.startPosition=this;const s=new ne(t);return s.skip(e),s.position}getParentPath(){return this.path.slice(0,-1)}getAncestors(){const e=this.parent;return e.is("documentFragment")?[e]:e.getAncestors({includeSelf:!0})}findAncestor(e){const t=this.parent;return t.is("element")?t.findAncestor(e,{includeSelf:!0}):null}getCommonPath(e){if(this.root!=e.root)return[];const t=O(this.path,e.path),s=typeof t=="string"?Math.min(this.path.length,e.path.length):t;return this.path.slice(0,s)}getCommonAncestor(e){const t=this.getAncestors(),s=e.getAncestors();let i=0;for(;t[i]==s[i]&&t[i];)i++;return i===0?null:t[i-1]}getShiftedBy(e){const t=this.clone(),s=t.offset+e;return t.offset=s<0?0:s,t}isAfter(e){return this.compareWith(e)=="after"}isBefore(e){return this.compareWith(e)=="before"}isEqual(e){return this.compareWith(e)=="same"}isTouching(e){if(this.root!==e.root)return!1;const t=Math.min(this.path.length,e.path.length);for(let s=0;s<t;s++){const i=this.path[s]-e.path[s];if(i<-1||i>1)return!1;if(i===1)return ss(e,this,s);if(i===-1)return ss(this,e,s)}return this.path.length===e.path.length?!0:this.path.length>e.path.length?Ct(this.path,t):Ct(e.path,t)}hasSameParentAs(e){if(this.root!==e.root)return!1;const t=this.getParentPath(),s=e.getParentPath();return O(t,s)=="same"}getTransformedByOperation(e){let t;switch(e.type){case"insert":t=this._getTransformedByInsertOperation(e);break;case"move":case"remove":case"reinsert":t=this._getTransformedByMoveOperation(e);break;case"split":t=this._getTransformedBySplitOperation(e);break;case"merge":t=this._getTransformedByMergeOperation(e);break;default:t=m._createAt(this);break}return t}_getTransformedByInsertOperation(e){return this._getTransformedByInsertion(e.position,e.howMany)}_getTransformedByMoveOperation(e){return this._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany)}_getTransformedBySplitOperation(e){const t=e.movedRange;return t.containsPosition(this)||t.start.isEqual(this)&&this.stickiness=="toNext"?this._getCombined(e.splitPosition,e.moveTargetPosition):e.graveyardPosition?this._getTransformedByMove(e.graveyardPosition,e.insertionPosition,1):this._getTransformedByInsertion(e.insertionPosition,1)}_getTransformedByMergeOperation(e){const t=e.movedRange,s=t.containsPosition(this)||t.start.isEqual(this);let i;return s?(i=this._getCombined(e.sourcePosition,e.targetPosition),e.sourcePosition.isBefore(e.targetPosition)&&(i=i._getTransformedByDeletion(e.deletionPosition,1))):this.isEqual(e.deletionPosition)?i=m._createAt(e.deletionPosition):i=this._getTransformedByMove(e.deletionPosition,e.graveyardPosition,1),i}_getTransformedByDeletion(e,t){const s=m._createAt(this);if(this.root!=e.root)return s;if(O(e.getParentPath(),this.getParentPath())=="same"){if(e.offset<this.offset){if(e.offset+t>this.offset)return null;s.offset-=t}}else if(O(e.getParentPath(),this.getParentPath())=="prefix"){const i=e.path.length-1;if(e.offset<=this.path[i]){if(e.offset+t>this.path[i])return null;s.path[i]-=t}}return s}_getTransformedByInsertion(e,t){const s=m._createAt(this);if(this.root!=e.root)return s;if(O(e.getParentPath(),this.getParentPath())=="same")(e.offset<this.offset||e.offset==this.offset&&this.stickiness!="toPrevious")&&(s.offset+=t);else if(O(e.getParentPath(),this.getParentPath())=="prefix"){const i=e.path.length-1;e.offset<=this.path[i]&&(s.path[i]+=t)}return s}_getTransformedByMove(e,t,s){if(t=t._getTransformedByDeletion(e,s),e.isEqual(t))return m._createAt(this);const i=this._getTransformedByDeletion(e,s);return i===null||e.isEqual(this)&&this.stickiness=="toNext"||e.getShiftedBy(s).isEqual(this)&&this.stickiness=="toPrevious"?this._getCombined(e,t):i._getTransformedByInsertion(t,s)}_getCombined(e,t){const s=e.path.length-1,i=m._createAt(t);return i.stickiness=this.stickiness,i.offset=i.offset+this.path[s]-e.offset,i.path=[...i.path,...this.path.slice(s+1)],i}toJSON(){return{root:this.root.toJSON(),path:Array.from(this.path),stickiness:this.stickiness}}clone(){return new this.constructor(this.root,this.path,this.stickiness)}static _createAt(e,t,s="toNone"){if(e instanceof m)return new m(e.root,e.path,e.stickiness);{const i=e;if(t=="end")t=i.maxOffset;else{if(t=="before")return this._createBefore(i,s);if(t=="after")return this._createAfter(i,s);if(t!==0&&!t)throw new f("model-createpositionat-offset-required",[this,e])}if(!i.is("element")&&!i.is("documentFragment"))throw new f("model-position-parent-incorrect",[this,e]);const r=i.getPath();return r.push(t),new this(i.root,r,s)}}static _createAfter(e,t){if(!e.parent)throw new f("model-position-after-root",[this,e],{root:e});return this._createAt(e.parent,e.endOffset,t)}static _createBefore(e,t){if(!e.parent)throw new f("model-position-before-root",e,{root:e});return this._createAt(e.parent,e.startOffset,t)}static fromJSON(e,t){if(e.root==="$graveyard"){const s=new m(t.graveyard,e.path);return s.stickiness=e.stickiness,s}if(!t.getRoot(e.root))throw new f("model-position-fromjson-no-root",t,{rootName:e.root});return new m(t.getRoot(e.root),e.path,e.stickiness)}}m.prototype.is=function(n){return n==="position"||n==="model:position"};function Fe(n,e){const t=e.getChild(e.offsetToIndex(n.offset));return t&&t.is("$text")&&t.startOffset<n.offset?t:null}function Us(n,e,t){return t!==null?null:e.getChild(e.offsetToIndex(n.offset))}function zs(n,e,t){return t!==null?null:e.getChild(e.offsetToIndex(n.offset)-1)}function ss(n,e,t){return!(t+1===n.path.length||!Ct(e.path,t+1)||!Ii(n,t+1))}function Ct(n,e){for(;e<n.length;){if(n[e]!==0)return!1;e++}return!0}function Ii(n,e){let t=n.parent,s=n.path.length-1,i=0;for(;s>=e;){if(n.path[s]+i!==t.maxOffset)return!1;i=1,s--,t=t.parent}return!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class u extends ae{constructor(e,t){super(),this.start=m._createAt(e),this.end=t?m._createAt(t):m._createAt(e),this.start.stickiness=this.isCollapsed?"toNone":"toNext",this.end.stickiness=this.isCollapsed?"toNone":"toPrevious"}*[Symbol.iterator](){yield*new ne({boundaries:this,ignoreElementEnd:!0})}get isCollapsed(){return this.start.isEqual(this.end)}get isFlat(){const e=this.start.getParentPath(),t=this.end.getParentPath();return O(e,t)=="same"}get root(){return this.start.root}containsPosition(e){return e.isAfter(this.start)&&e.isBefore(this.end)}containsRange(e,t=!1){e.isCollapsed&&(t=!1);const s=this.containsPosition(e.start)||t&&this.start.isEqual(e.start),i=this.containsPosition(e.end)||t&&this.end.isEqual(e.end);return s&&i}containsItem(e){const t=m._createBefore(e);return this.containsPosition(t)||this.start.isEqual(t)}isEqual(e){return this.start.isEqual(e.start)&&this.end.isEqual(e.end)}isIntersecting(e){return this.start.isBefore(e.end)&&this.end.isAfter(e.start)}getDifference(e){const t=[];return this.isIntersecting(e)?(this.containsPosition(e.start)&&t.push(new u(this.start,e.start)),this.containsPosition(e.end)&&t.push(new u(e.end,this.end))):t.push(new u(this.start,this.end)),t}getIntersection(e){if(this.isIntersecting(e)){let t=this.start,s=this.end;return this.containsPosition(e.start)&&(t=e.start),this.containsPosition(e.end)&&(s=e.end),new u(t,s)}return null}getJoined(e,t=!1){let s=this.isIntersecting(e);if(s||(this.start.isBefore(e.start)?s=t?this.end.isTouching(e.start):this.end.isEqual(e.start):s=t?e.end.isTouching(this.start):e.end.isEqual(this.start)),!s)return null;let i=this.start,r=this.end;return e.start.isBefore(i)&&(i=e.start),e.end.isAfter(r)&&(r=e.end),new u(i,r)}getMinimalFlatRanges(){const e=[],t=this.start.getCommonPath(this.end).length,s=m._createAt(this.start);let i=s.parent;for(;s.path.length>t+1;){const r=i.maxOffset-s.offset;r!==0&&e.push(new u(s,s.getShiftedBy(r))),s.path=s.path.slice(0,-1),s.offset++,i=i.parent}for(;s.path.length<=this.end.path.length;){const r=this.end.path[s.path.length-1],o=r-s.offset;o!==0&&e.push(new u(s,s.getShiftedBy(o))),s.offset=r,s.path.push(0)}return e}getWalker(e={}){return e.boundaries=this,new ne(e)}*getItems(e={}){e.boundaries=this,e.ignoreElementEnd=!0;const t=new ne(e);for(const s of t)yield s.item}*getPositions(e={}){e.boundaries=this;const t=new ne(e);yield t.position;for(const s of t)yield s.nextPosition}getTransformedByOperation(e){switch(e.type){case"insert":return this._getTransformedByInsertOperation(e);case"move":case"remove":case"reinsert":return this._getTransformedByMoveOperation(e);case"split":return[this._getTransformedBySplitOperation(e)];case"merge":return[this._getTransformedByMergeOperation(e)]}return[new u(this.start,this.end)]}getTransformedByOperations(e){const t=[new u(this.start,this.end)];for(const s of e)for(let i=0;i<t.length;i++){const r=t[i].getTransformedByOperation(s);t.splice(i,1,...r),i+=r.length-1}for(let s=0;s<t.length;s++){const i=t[s];for(let r=s+1;r<t.length;r++){const o=t[r];(i.containsRange(o)||o.containsRange(i)||i.isEqual(o))&&t.splice(r,1)}}return t}getCommonAncestor(){return this.start.getCommonAncestor(this.end)}getContainedElement(){if(this.isCollapsed)return null;const e=this.start.nodeAfter,t=this.end.nodeBefore;return e&&e.is("element")&&e===t?e:null}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}clone(){return new this.constructor(this.start,this.end)}_getTransformedByInsertOperation(e,t=!1){return this._getTransformedByInsertion(e.position,e.howMany,t)}_getTransformedByMoveOperation(e,t=!1){const s=e.sourcePosition,i=e.howMany,r=e.targetPosition;return this._getTransformedByMove(s,r,i,t)}_getTransformedBySplitOperation(e){const t=this.start._getTransformedBySplitOperation(e);let s=this.end._getTransformedBySplitOperation(e);return this.end.isEqual(e.insertionPosition)&&(s=this.end.getShiftedBy(1)),t.root!=s.root&&(s=this.end.getShiftedBy(-1)),new u(t,s)}_getTransformedByMergeOperation(e){if(this.start.isEqual(e.targetPosition)&&this.end.isEqual(e.deletionPosition))return new u(this.start);let t=this.start._getTransformedByMergeOperation(e),s=this.end._getTransformedByMergeOperation(e);return t.root!=s.root&&(s=this.end.getShiftedBy(-1)),t.isAfter(s)?(e.sourcePosition.isBefore(e.targetPosition)?(t=m._createAt(s),t.offset=0):(e.deletionPosition.isEqual(t)||(s=e.deletionPosition),t=e.targetPosition),new u(t,s)):new u(t,s)}_getTransformedByInsertion(e,t,s=!1){if(s&&this.containsPosition(e))return[new u(this.start,e),new u(e.getShiftedBy(t),this.end._getTransformedByInsertion(e,t))];{const i=new u(this.start,this.end);return i.start=i.start._getTransformedByInsertion(e,t),i.end=i.end._getTransformedByInsertion(e,t),[i]}}_getTransformedByMove(e,t,s,i=!1){if(this.isCollapsed){const d=this.start._getTransformedByMove(e,t,s);return[new u(d)]}const r=u._createFromPositionAndShift(e,s),o=t._getTransformedByDeletion(e,s);if(this.containsPosition(t)&&!i&&(r.containsPosition(this.start)||r.containsPosition(this.end))){const d=this.start._getTransformedByMove(e,t,s),_=this.end._getTransformedByMove(e,t,s);return[new u(d,_)]}let a;const l=this.getDifference(r);let c=null;const h=this.getIntersection(r);if(l.length==1?c=new u(l[0].start._getTransformedByDeletion(e,s),l[0].end._getTransformedByDeletion(e,s)):l.length==2&&(c=new u(this.start,this.end._getTransformedByDeletion(e,s))),c?a=c._getTransformedByInsertion(o,s,h!==null||i):a=[],h){const d=new u(h.start._getCombined(r.start,o),h.end._getCombined(r.start,o));a.length==2?a.splice(1,0,d):a.push(d)}return a}_getTransformedByDeletion(e,t){let s=this.start._getTransformedByDeletion(e,t),i=this.end._getTransformedByDeletion(e,t);return s==null&&i==null?null:(s==null&&(s=e),i==null&&(i=e),new u(s,i))}static _createFromPositionAndShift(e,t){const s=e,i=e.getShiftedBy(t);return t>0?new this(s,i):new this(i,s)}static _createIn(e){return new this(m._createAt(e,0),m._createAt(e,e.maxOffset))}static _createOn(e){return this._createFromPositionAndShift(m._createBefore(e),e.offsetSize)}static _createFromRanges(e){if(e.length===0)throw new f("range-create-from-ranges-empty-array",null);if(e.length==1)return e[0].clone();const t=e[0];e.sort((r,o)=>r.start.isAfter(o.start)?1:-1);const s=e.indexOf(t),i=new this(t.start,t.end);if(s>0)for(let r=s-1;e[r].end.isEqual(i.start);r++)i.start=m._createAt(e[r].start);for(let r=s+1;r<e.length&&e[r].start.isEqual(i.end);r++)i.end=m._createAt(e[r].end);return i}static fromJSON(e,t){return new this(m.fromJSON(e.start,t),m.fromJSON(e.end,t))}}u.prototype.is=function(n){return n==="range"||n==="model:range"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Js extends N(){constructor(){super(),this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._viewToModelLengthCallbacks=new Map,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._deferredBindingRemovals=new Map,this._unboundMarkerNames=new Set,this.on("modelToViewPosition",(e,t)=>{if(t.viewPosition)return;const s=this._modelToViewMapping.get(t.modelPosition.parent);if(!s)throw new f("mapping-model-position-view-parent-not-found",this,{modelPosition:t.modelPosition});t.viewPosition=this.findPositionIn(s,t.modelPosition.offset)},{priority:"low"}),this.on("viewToModelPosition",(e,t)=>{if(t.modelPosition)return;const s=this.findMappedViewAncestor(t.viewPosition),i=this._viewToModelMapping.get(s),r=this._toModelOffset(t.viewPosition.parent,t.viewPosition.offset,s);t.modelPosition=m._createAt(i,r)},{priority:"low"})}bindElements(e,t){this._modelToViewMapping.set(e,t),this._viewToModelMapping.set(t,e)}unbindViewElement(e,t={}){const s=this.toModelElement(e);if(this._elementToMarkerNames.has(e))for(const i of this._elementToMarkerNames.get(e))this._unboundMarkerNames.add(i);t.defer?this._deferredBindingRemovals.set(e,e.root):(this._viewToModelMapping.delete(e),this._modelToViewMapping.get(s)==e&&this._modelToViewMapping.delete(s))}unbindModelElement(e){const t=this.toViewElement(e);this._modelToViewMapping.delete(e),this._viewToModelMapping.get(t)==e&&this._viewToModelMapping.delete(t)}bindElementToMarker(e,t){const s=this._markerNameToElements.get(t)||new Set;s.add(e);const i=this._elementToMarkerNames.get(e)||new Set;i.add(t),this._markerNameToElements.set(t,s),this._elementToMarkerNames.set(e,i)}unbindElementFromMarkerName(e,t){const s=this._markerNameToElements.get(t);s&&(s.delete(e),s.size==0&&this._markerNameToElements.delete(t));const i=this._elementToMarkerNames.get(e);i&&(i.delete(t),i.size==0&&this._elementToMarkerNames.delete(e))}flushUnboundMarkerNames(){const e=Array.from(this._unboundMarkerNames);return this._unboundMarkerNames.clear(),e}flushDeferredBindings(){for(const[e,t]of this._deferredBindingRemovals)e.root==t&&this.unbindViewElement(e);this._deferredBindingRemovals=new Map}clearBindings(){this._modelToViewMapping=new WeakMap,this._viewToModelMapping=new WeakMap,this._markerNameToElements=new Map,this._elementToMarkerNames=new Map,this._unboundMarkerNames=new Set,this._deferredBindingRemovals=new Map}toModelElement(e){return this._viewToModelMapping.get(e)}toViewElement(e){return this._modelToViewMapping.get(e)}toModelRange(e){return new u(this.toModelPosition(e.start),this.toModelPosition(e.end))}toViewRange(e){return new w(this.toViewPosition(e.start),this.toViewPosition(e.end))}toModelPosition(e){const t={viewPosition:e,mapper:this};return this.fire("viewToModelPosition",t),t.modelPosition}toViewPosition(e,t={}){const s={modelPosition:e,mapper:this,isPhantom:t.isPhantom};return this.fire("modelToViewPosition",s),s.viewPosition}markerNameToElements(e){const t=this._markerNameToElements.get(e);if(!t)return null;const s=new Set;for(const i of t)if(i.is("attributeElement"))for(const r of i.getElementsWithSameId())s.add(r);else s.add(i);return s}registerViewToModelLength(e,t){this._viewToModelLengthCallbacks.set(e,t)}findMappedViewAncestor(e){let t=e.parent;for(;!this._viewToModelMapping.has(t);)t=t.parent;return t}_toModelOffset(e,t,s){if(s!=e){const r=this._toModelOffset(e.parent,e.index,s),o=this._toModelOffset(e,t,e);return r+o}if(e.is("$text"))return t;let i=0;for(let r=0;r<t;r++)i+=this.getModelLength(e.getChild(r));return i}getModelLength(e){if(this._viewToModelLengthCallbacks.get(e.name))return this._viewToModelLengthCallbacks.get(e.name)(e);if(this._viewToModelMapping.has(e))return 1;if(e.is("$text"))return e.data.length;if(e.is("uiElement"))return 0;{let t=0;for(const s of e.getChildren())t+=this.getModelLength(s);return t}}findPositionIn(e,t){let s,i=0,r=0,o=0;if(e.is("$text"))return new g(e,t);for(;r<t;)s=e.getChild(o),i=this.getModelLength(s),r+=i,o++;return r==t?this._moveViewPositionToTextNode(new g(e,o)):this.findPositionIn(s,t-(r-i))}_moveViewPositionToTextNode(e){const t=e.nodeBefore,s=e.nodeAfter;return t instanceof A?new g(t,t.data.length):s instanceof A?new g(s,0):e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fi{constructor(){this._consumable=new Map,this._textProxyRegistry=new Map}add(e,t){t=je(t),e instanceof J&&(e=this._getSymbolForTextProxy(e)),this._consumable.has(e)||this._consumable.set(e,new Map),this._consumable.get(e).set(t,!0)}consume(e,t){return t=je(t),e instanceof J&&(e=this._getSymbolForTextProxy(e)),this.test(e,t)?(this._consumable.get(e).set(t,!1),!0):!1}test(e,t){t=je(t),e instanceof J&&(e=this._getSymbolForTextProxy(e));const s=this._consumable.get(e);if(s===void 0)return null;const i=s.get(t);return i===void 0?null:i}revert(e,t){t=je(t),e instanceof J&&(e=this._getSymbolForTextProxy(e));const s=this.test(e,t);return s===!1?(this._consumable.get(e).set(t,!0),!0):s===!0?!1:null}verifyAllConsumed(e){const t=[];for(const[s,i]of this._consumable)for(const[r,o]of i){const a=r.split(":")[0];o&&e==a&&t.push({event:r,item:s.name||s.description})}if(t.length)throw new f("conversion-model-consumable-not-consumed",null,{items:t})}_getSymbolForTextProxy(e){let t=null;const s=this._textProxyRegistry.get(e.startOffset);if(s){const i=s.get(e.endOffset);i&&(t=i.get(e.parent))}return t||(t=this._addSymbolForTextProxy(e)),t}_addSymbolForTextProxy(e){const t=e.startOffset,s=e.endOffset,i=e.parent,r=Symbol("$textProxy:"+e.data);let o,a;return o=this._textProxyRegistry.get(t),o||(o=new Map,this._textProxyRegistry.set(t,o)),a=o.get(s),a||(a=new Map,o.set(s,a)),a.set(i,r),r}}function je(n){const e=n.split(":");return e[0]=="insert"?e[0]:e[0]=="addMarker"||e[0]=="removeMarker"?n:e.length>1?e[0]+":"+e[1]:e[0]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gs extends N(){constructor(e){super(),this._conversionApi={dispatcher:this,...e},this._firedEventsMap=new WeakMap}convertChanges(e,t,s){const i=this._createConversionApi(s,e.getRefreshedItems());for(const o of e.getMarkersToRemove())this._convertMarkerRemove(o.name,o.range,i);const r=this._reduceChanges(e.getChanges());for(const o of r)o.type==="insert"?this._convertInsert(u._createFromPositionAndShift(o.position,o.length),i):o.type==="reinsert"?this._convertReinsert(u._createFromPositionAndShift(o.position,o.length),i):o.type==="remove"?this._convertRemove(o.position,o.length,o.name,i):this._convertAttribute(o.range,o.attributeKey,o.attributeOldValue,o.attributeNewValue,i);i.mapper.flushDeferredBindings();for(const o of i.mapper.flushUnboundMarkerNames()){const a=t.get(o).getRange();this._convertMarkerRemove(o,a,i),this._convertMarkerAdd(o,a,i)}for(const o of e.getMarkersToAdd())this._convertMarkerAdd(o.name,o.range,i);i.consumable.verifyAllConsumed("insert")}convert(e,t,s,i={}){const r=this._createConversionApi(s,void 0,i);this._convertInsert(e,r);for(const[o,a]of t)this._convertMarkerAdd(o,a,r);r.consumable.verifyAllConsumed("insert")}convertSelection(e,t,s){const i=this._createConversionApi(s);this.fire("cleanSelection",{selection:e},i);const r=e.getFirstPosition().root;if(!i.mapper.toViewElement(r))return;const o=Array.from(t.getMarkersAtPosition(e.getFirstPosition()));if(this._addConsumablesForSelection(i.consumable,e,o),this.fire("selection",{selection:e},i),!!e.isCollapsed){for(const a of o)if(i.consumable.test(e,"addMarker:"+a.name)){const l=a.getRange();if(!Bi(e.getFirstPosition(),a,i.mapper))continue;const c={item:e,markerName:a.name,markerRange:l};this.fire(`addMarker:${a.name}`,c,i)}for(const a of e.getAttributeKeys())if(i.consumable.test(e,"attribute:"+a)){const l={item:e,range:e.getFirstRange(),attributeKey:a,attributeOldValue:null,attributeNewValue:e.getAttribute(a)};this.fire(`attribute:${a}:$text`,l,i)}}}_convertInsert(e,t,s={}){s.doNotAddConsumables||this._addConsumablesForInsert(t.consumable,e);for(const i of Array.from(e.getWalker({shallow:!0})).map(ns))this._testAndFire("insert",i,t)}_convertRemove(e,t,s,i){this.fire(`remove:${s}`,{position:e,length:t},i)}_convertAttribute(e,t,s,i,r){this._addConsumablesForRange(r.consumable,e,`attribute:${t}`);for(const o of e){const a={item:o.item,range:u._createFromPositionAndShift(o.previousPosition,o.length),attributeKey:t,attributeOldValue:s,attributeNewValue:i};this._testAndFire(`attribute:${t}`,a,r)}}_convertReinsert(e,t){const s=Array.from(e.getWalker({shallow:!0}));this._addConsumablesForInsert(t.consumable,s);for(const i of s.map(ns))this._testAndFire("insert",{...i,reconversion:!0},t)}_convertMarkerAdd(e,t,s){if(t.root.rootName=="$graveyard")return;const i=`addMarker:${e}`;if(s.consumable.add(t,i),this.fire(i,{markerName:e,markerRange:t},s),!!s.consumable.consume(t,i)){this._addConsumablesForRange(s.consumable,t,i);for(const r of t.getItems()){if(!s.consumable.test(r,i))continue;const o={item:r,range:u._createOn(r),markerName:e,markerRange:t};this.fire(i,o,s)}}}_convertMarkerRemove(e,t,s){t.root.rootName!="$graveyard"&&this.fire(`removeMarker:${e}`,{markerName:e,markerRange:t},s)}_reduceChanges(e){const t={changes:e};return this.fire("reduceChanges",t),t.changes}_addConsumablesForInsert(e,t){for(const s of t){const i=s.item;if(e.test(i,"insert")===null){e.add(i,"insert");for(const r of i.getAttributeKeys())e.add(i,"attribute:"+r)}}return e}_addConsumablesForRange(e,t,s){for(const i of t.getItems())e.add(i,s);return e}_addConsumablesForSelection(e,t,s){e.add(t,"selection");for(const i of s)e.add(t,"addMarker:"+i.name);for(const i of t.getAttributeKeys())e.add(t,"attribute:"+i);return e}_testAndFire(e,t,s){const i=Di(e,t),r=t.item.is("$textProxy")?s.consumable._getSymbolForTextProxy(t.item):t.item,o=this._firedEventsMap.get(s),a=o.get(r);if(!a)o.set(r,new Set([i]));else if(!a.has(i))a.add(i);else return;this.fire(i,t,s)}_testAndFireAddAttributes(e,t){const s={item:e,range:u._createOn(e)};for(const i of s.item.getAttributeKeys())s.attributeKey=i,s.attributeOldValue=null,s.attributeNewValue=s.item.getAttribute(i),this._testAndFire(`attribute:${i}`,s,t)}_createConversionApi(e,t=new Set,s={}){const i={...this._conversionApi,consumable:new Fi,writer:e,options:s,convertItem:r=>this._convertInsert(u._createOn(r),i),convertChildren:r=>this._convertInsert(u._createIn(r),i,{doNotAddConsumables:!0}),convertAttributes:r=>this._testAndFireAddAttributes(r,i),canReuseView:r=>!t.has(i.mapper.toModelElement(r))};return this._firedEventsMap.set(i,new Map),i}}function Bi(n,e,t){const s=e.getRange(),i=Array.from(n.getAncestors());return i.shift(),i.reverse(),!i.some(o=>{if(s.containsItem(o))return!!t.toViewElement(o).getCustomProperty("addHighlight")})}function Di(n,e){const t=e.item.is("element")?e.item.name:"$text";return`${n}:${t}`}function ns(n){const e=n.item,t=u._createFromPositionAndShift(n.previousPosition,n.length);return{item:e,range:t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $ extends N(ae){constructor(...e){super(),this._lastRangeBackward=!1,this._attrs=new Map,this._ranges=[],e.length&&this.setTo(...e)}get anchor(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.end:e.start}return null}get focus(){if(this._ranges.length>0){const e=this._ranges[this._ranges.length-1];return this._lastRangeBackward?e.start:e.end}return null}get isCollapsed(){return this._ranges.length===1?this._ranges[0].isCollapsed:!1}get rangeCount(){return this._ranges.length}get isBackward(){return!this.isCollapsed&&this._lastRangeBackward}isEqual(e){if(this.rangeCount!=e.rangeCount)return!1;if(this.rangeCount===0)return!0;if(!this.anchor.isEqual(e.anchor)||!this.focus.isEqual(e.focus))return!1;for(const t of this._ranges){let s=!1;for(const i of e._ranges)if(t.isEqual(i)){s=!0;break}if(!s)return!1}return!0}*getRanges(){for(const e of this._ranges)yield new u(e.start,e.end)}getFirstRange(){let e=null;for(const t of this._ranges)(!e||t.start.isBefore(e.start))&&(e=t);return e?new u(e.start,e.end):null}getLastRange(){let e=null;for(const t of this._ranges)(!e||t.end.isAfter(e.end))&&(e=t);return e?new u(e.start,e.end):null}getFirstPosition(){const e=this.getFirstRange();return e?e.start.clone():null}getLastPosition(){const e=this.getLastRange();return e?e.end.clone():null}setTo(...e){let[t,s,i]=e;if(typeof s=="object"&&(i=s,s=void 0),t===null)this._setRanges([]);else if(t instanceof $)this._setRanges(t.getRanges(),t.isBackward);else if(t&&typeof t.getRanges=="function")this._setRanges(t.getRanges(),t.isBackward);else if(t instanceof u)this._setRanges([t],!!i&&!!i.backward);else if(t instanceof m)this._setRanges([new u(t)]);else if(t instanceof be){const r=!!i&&!!i.backward;let o;if(s=="in")o=u._createIn(t);else if(s=="on")o=u._createOn(t);else if(s!==void 0)o=new u(m._createAt(t,s));else throw new f("model-selection-setto-required-second-parameter",[this,t]);this._setRanges([o],r)}else if(re(t))this._setRanges(t,i&&!!i.backward);else throw new f("model-selection-setto-not-selectable",[this,t])}_setRanges(e,t=!1){const s=Array.from(e),i=s.some(r=>{if(!(r instanceof u))throw new f("model-selection-set-ranges-not-range",[this,e]);return this._ranges.every(o=>!o.isEqual(r))});s.length===this._ranges.length&&!i||(this._replaceAllRanges(s),this._lastRangeBackward=!!t,this.fire("change:range",{directChange:!0}))}setFocus(e,t){if(this.anchor===null)throw new f("model-selection-setfocus-no-ranges",[this,e]);const s=m._createAt(e,t);if(s.compareWith(this.focus)=="same")return;const i=this.anchor;this._ranges.length&&this._popRange(),s.compareWith(i)=="before"?(this._pushRange(new u(s,i)),this._lastRangeBackward=!0):(this._pushRange(new u(i,s)),this._lastRangeBackward=!1),this.fire("change:range",{directChange:!0})}getAttribute(e){return this._attrs.get(e)}getAttributes(){return this._attrs.entries()}getAttributeKeys(){return this._attrs.keys()}hasAttribute(e){return this._attrs.has(e)}removeAttribute(e){this.hasAttribute(e)&&(this._attrs.delete(e),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}setAttribute(e,t){this.getAttribute(e)!==t&&(this._attrs.set(e,t),this.fire("change:attribute",{attributeKeys:[e],directChange:!0}))}getSelectedElement(){return this.rangeCount!==1?null:this.getFirstRange().getContainedElement()}*getSelectedBlocks(){const e=new WeakSet;for(const t of this.getRanges()){const s=is(t.start,e);$i(s,t)&&(yield s);for(const r of t.getWalker()){const o=r.item;r.type=="elementEnd"&&Vi(o,e,t)&&(yield o)}const i=is(t.end,e);Li(i,t)&&(yield i)}}containsEntireContent(e=this.anchor.root){const t=m._createAt(e,0),s=m._createAt(e,"end");return t.isTouching(this.getFirstPosition())&&s.isTouching(this.getLastPosition())}_pushRange(e){this._checkRange(e),this._ranges.push(new u(e.start,e.end))}_checkRange(e){for(let t=0;t<this._ranges.length;t++)if(e.isIntersecting(this._ranges[t]))throw new f("model-selection-range-intersects",[this,e],{addedRange:e,intersectingRange:this._ranges[t]})}_replaceAllRanges(e){this._removeAllRanges();for(const t of e)this._pushRange(t)}_removeAllRanges(){for(;this._ranges.length>0;)this._popRange()}_popRange(){this._ranges.pop()}}$.prototype.is=function(n){return n==="selection"||n==="model:selection"};function Ks(n,e){return e.has(n)?!1:(e.add(n),n.root.document.model.schema.isBlock(n)&&!!n.parent)}function Vi(n,e,t){return Ks(n,e)&&Ot(n,t)}function is(n,e){const s=n.parent.root.document.model.schema,i=n.parent.getAncestors({parentFirst:!0,includeSelf:!0});let r=!1;const o=i.find(a=>r?!1:(r=s.isLimit(a),!r&&Ks(a,e)));return i.forEach(a=>e.add(a)),o}function Ot(n,e){const t=Wi(n);return t?!e.containsRange(u._createOn(t),!0):!0}function $i(n,e){return n?e.isCollapsed||n.isEmpty?!0:e.start.isTouching(m._createAt(n,n.maxOffset))?!1:Ot(n,e):!1}function Li(n,e){return n?e.isCollapsed||n.isEmpty?!0:e.end.isTouching(m._createAt(n,0))?!1:Ot(n,e):!1}function Wi(n){const e=n.root.document.model.schema;let t=n.parent;for(;t;){if(e.isBlock(t))return t;t=t.parent}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _e extends N(u){constructor(e,t){super(e,t),qi.call(this)}detach(){this.stopListening()}toRange(){return new u(this.start,this.end)}static fromRange(e){return new _e(e.start,e.end)}}_e.prototype.is=function(n){return n==="liveRange"||n==="model:liveRange"||n=="range"||n==="model:range"};function qi(){this.listenTo(this.root.document.model,"applyOperation",(n,e)=>{const t=e[0];t.isDocumentOperation&&Ui.call(this,t)},{priority:"low"})}function Ui(n){const e=this.getTransformedByOperation(n),t=u._createFromRanges(e),s=!t.isEqual(this),i=zi(this,n);let r=null;if(s){t.root.rootName=="$graveyard"&&(n.type=="remove"?r=n.sourcePosition:r=n.deletionPosition);const o=this.toRange();this.start=t.start,this.end=t.end,this.fire("change:range",o,{deletionPosition:r})}else i&&this.fire("change:content",this.toRange(),{deletionPosition:r})}function zi(n,e){switch(e.type){case"insert":return n.containsPosition(e.position);case"move":case"remove":case"reinsert":case"merge":return n.containsPosition(e.sourcePosition)||n.start.isEqual(e.sourcePosition)||n.containsPosition(e.targetPosition);case"split":return n.containsPosition(e.splitPosition)||n.containsPosition(e.insertionPosition)}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Le="selection:";class K extends N(ae){constructor(e){super(),this._selection=new Ji(e),this._selection.delegate("change:range").to(this),this._selection.delegate("change:attribute").to(this),this._selection.delegate("change:marker").to(this)}get isCollapsed(){return this._selection.isCollapsed}get anchor(){return this._selection.anchor}get focus(){return this._selection.focus}get rangeCount(){return this._selection.rangeCount}get hasOwnRange(){return this._selection.hasOwnRange}get isBackward(){return this._selection.isBackward}get isGravityOverridden(){return this._selection.isGravityOverridden}get markers(){return this._selection.markers}get _ranges(){return this._selection._ranges}getRanges(){return this._selection.getRanges()}getFirstPosition(){return this._selection.getFirstPosition()}getLastPosition(){return this._selection.getLastPosition()}getFirstRange(){return this._selection.getFirstRange()}getLastRange(){return this._selection.getLastRange()}getSelectedBlocks(){return this._selection.getSelectedBlocks()}getSelectedElement(){return this._selection.getSelectedElement()}containsEntireContent(e){return this._selection.containsEntireContent(e)}destroy(){this._selection.destroy()}getAttributeKeys(){return this._selection.getAttributeKeys()}getAttributes(){return this._selection.getAttributes()}getAttribute(e){return this._selection.getAttribute(e)}hasAttribute(e){return this._selection.hasAttribute(e)}refresh(){this._selection.updateMarkers(),this._selection._updateAttributes(!1)}observeMarkers(e){this._selection.observeMarkers(e)}_setFocus(e,t){this._selection.setFocus(e,t)}_setTo(...e){this._selection.setTo(...e)}_setAttribute(e,t){this._selection.setAttribute(e,t)}_removeAttribute(e){this._selection.removeAttribute(e)}_getStoredAttributes(){return this._selection.getStoredAttributes()}_overrideGravity(){return this._selection.overrideGravity()}_restoreGravity(e){this._selection.restoreGravity(e)}static _getStoreAttributeKey(e){return Le+e}static _isStoreAttributeKey(e){return e.startsWith(Le)}}K.prototype.is=function(n){return n==="selection"||n=="model:selection"||n=="documentSelection"||n=="model:documentSelection"};class Ji extends ${constructor(e){super(),this.markers=new St({idProperty:"name"}),this._attributePriority=new Map,this._selectionRestorePosition=null,this._hasChangedRange=!1,this._overriddenGravityRegister=new Set,this._observedMarkers=new Set,this._model=e.model,this._document=e,this.listenTo(this._model,"applyOperation",(t,s)=>{const i=s[0];!i.isDocumentOperation||i.type=="marker"||i.type=="rename"||i.type=="noop"||(this._ranges.length==0&&this._selectionRestorePosition&&this._fixGraveyardSelection(this._selectionRestorePosition),this._selectionRestorePosition=null,this._hasChangedRange&&(this._hasChangedRange=!1,this.fire("change:range",{directChange:!1})))},{priority:"lowest"}),this.on("change:range",()=>{this._validateSelectionRanges(this.getRanges())}),this.listenTo(this._model.markers,"update",(t,s,i,r)=>{this._updateMarker(s,r)}),this.listenTo(this._document,"change",(t,s)=>{Gi(this._model,s)})}get isCollapsed(){return this._ranges.length===0?this._document._getDefaultRange().isCollapsed:super.isCollapsed}get anchor(){return super.anchor||this._document._getDefaultRange().start}get focus(){return super.focus||this._document._getDefaultRange().end}get rangeCount(){return this._ranges.length?this._ranges.length:1}get hasOwnRange(){return this._ranges.length>0}get isGravityOverridden(){return!!this._overriddenGravityRegister.size}destroy(){for(let e=0;e<this._ranges.length;e++)this._ranges[e].detach();this.stopListening()}*getRanges(){this._ranges.length?yield*super.getRanges():yield this._document._getDefaultRange()}getFirstRange(){return super.getFirstRange()||this._document._getDefaultRange()}getLastRange(){return super.getLastRange()||this._document._getDefaultRange()}setTo(...e){super.setTo(...e),this._updateAttributes(!0),this.updateMarkers()}setFocus(e,t){super.setFocus(e,t),this._updateAttributes(!0),this.updateMarkers()}setAttribute(e,t){if(this._setAttribute(e,t)){const s=[e];this.fire("change:attribute",{attributeKeys:s,directChange:!0})}}removeAttribute(e){if(this._removeAttribute(e)){const t=[e];this.fire("change:attribute",{attributeKeys:t,directChange:!0})}}overrideGravity(){const e=En();return this._overriddenGravityRegister.add(e),this._overriddenGravityRegister.size===1&&this._updateAttributes(!0),e}restoreGravity(e){if(!this._overriddenGravityRegister.has(e))throw new f("document-selection-gravity-wrong-restore",this,{uid:e});this._overriddenGravityRegister.delete(e),this.isGravityOverridden||this._updateAttributes(!0)}observeMarkers(e){this._observedMarkers.add(e),this.updateMarkers()}_replaceAllRanges(e){this._validateSelectionRanges(e),super._replaceAllRanges(e)}_popRange(){this._ranges.pop().detach()}_pushRange(e){const t=this._prepareRange(e);t&&this._ranges.push(t)}_validateSelectionRanges(e){for(const t of e)if(!this._document._validateSelectionRange(t))throw new f("document-selection-wrong-position",this,{range:t})}_prepareRange(e){if(this._checkRange(e),e.root==this._document.graveyard)return;const t=_e.fromRange(e);return t.on("change:range",(s,i,r)=>{if(this._hasChangedRange=!0,t.root==this._document.graveyard){this._selectionRestorePosition=r.deletionPosition;const o=this._ranges.indexOf(t);this._ranges.splice(o,1),t.detach()}}),t}updateMarkers(){if(!this._observedMarkers.size)return;const e=[];let t=!1;for(const i of this._model.markers){const r=i.name.split(":",1)[0];if(!this._observedMarkers.has(r))continue;const o=i.getRange();for(const a of this.getRanges())o.containsRange(a,!a.isCollapsed)&&e.push(i)}const s=Array.from(this.markers);for(const i of e)this.markers.has(i)||(this.markers.add(i),t=!0);for(const i of Array.from(this.markers))e.includes(i)||(this.markers.remove(i),t=!0);t&&this.fire("change:marker",{oldMarkers:s,directChange:!1})}_updateMarker(e,t){const s=e.name.split(":",1)[0];if(!this._observedMarkers.has(s))return;let i=!1;const r=Array.from(this.markers),o=this.markers.has(e);if(!t)o&&(this.markers.remove(e),i=!0);else{let a=!1;for(const l of this.getRanges())if(t.containsRange(l,!l.isCollapsed)){a=!0;break}a&&!o?(this.markers.add(e),i=!0):!a&&o&&(this.markers.remove(e),i=!0)}i&&this.fire("change:marker",{oldMarkers:r,directChange:!1})}_updateAttributes(e){const t=pe(this._getSurroundingAttributes()),s=pe(this.getAttributes());if(e)this._attributePriority=new Map,this._attrs=new Map;else for(const[r,o]of this._attributePriority)o=="low"&&(this._attrs.delete(r),this._attributePriority.delete(r));this._setAttributesTo(t);const i=[];for(const[r,o]of this.getAttributes())(!s.has(r)||s.get(r)!==o)&&i.push(r);for(const[r]of s)this.hasAttribute(r)||i.push(r);i.length>0&&this.fire("change:attribute",{attributeKeys:i,directChange:!1})}_setAttribute(e,t,s=!0){const i=s?"normal":"low";return i=="low"&&this._attributePriority.get(e)=="normal"||super.getAttribute(e)===t?!1:(this._attrs.set(e,t),this._attributePriority.set(e,i),!0)}_removeAttribute(e,t=!0){const s=t?"normal":"low";return s=="low"&&this._attributePriority.get(e)=="normal"||(this._attributePriority.set(e,s),!super.hasAttribute(e))?!1:(this._attrs.delete(e),!0)}_setAttributesTo(e){const t=new Set;for(const[s,i]of this.getAttributes())e.get(s)!==i&&this._removeAttribute(s,!1);for(const[s,i]of e)this._setAttribute(s,i,!1)&&t.add(s);return t}*getStoredAttributes(){const e=this.getFirstPosition().parent;if(this.isCollapsed&&e.isEmpty)for(const t of e.getAttributeKeys())t.startsWith(Le)&&(yield[t.substr(Le.length),e.getAttribute(t)])}_getSurroundingAttributes(){const e=this.getFirstPosition(),t=this._model.schema;if(e.root.rootName=="$graveyard")return null;let s=null;if(this.isCollapsed){const i=e.textNode?e.textNode:e.nodeBefore,r=e.textNode?e.textNode:e.nodeAfter;if(this.isGravityOverridden||(s=Me(i,t)),s||(s=Me(r,t)),!this.isGravityOverridden&&!s){let o=i;for(;o&&!s;)o=o.previousSibling,s=Me(o,t)}if(!s){let o=r;for(;o&&!s;)o=o.nextSibling,s=Me(o,t)}s||(s=this.getStoredAttributes())}else{const i=this.getFirstRange();for(const r of i){if(r.item.is("element")&&t.isObject(r.item)){s=Me(r.item,t);break}if(r.type=="text"){s=r.item.getAttributes();break}}}return s}_fixGraveyardSelection(e){const t=this._model.schema.getNearestSelectionRange(e);t&&this._pushRange(t)}}function Me(n,e){if(!n)return null;if(n instanceof J||n instanceof C)return n.getAttributes();if(!e.isInline(n))return null;if(!e.isObject(n))return[];const t=[];for(const[s,i]of n.getAttributes())e.checkAttribute("$text",s)&&e.getAttributeProperties(s).copyFromObject!==!1&&t.push([s,i]);return t}function Gi(n,e){const t=n.document.differ;for(const s of t.getChanges()){if(s.type!="insert")continue;const i=s.position.parent;s.length===i.maxOffset&&n.enqueueChange(e,o=>{const a=Array.from(i.getAttributeKeys()).filter(l=>l.startsWith(Le));for(const l of a)o.removeAttribute(l,i)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hs{constructor(e){this._dispatchers=e}add(e){for(const t of this._dispatchers)e(t);return this}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ki extends Hs{elementToElement(e){return this.add(ur(e))}elementToStructure(e){return this.add(fr(e))}attributeToElement(e){return this.add(dr(e))}attributeToAttribute(e){return this.add(mr(e))}markerToElement(e){return this.add(gr(e))}markerToHighlight(e){return this.add(_r(e))}markerToData(e){return this.add(pr(e))}}function js(){return(n,e,t)=>{if(!t.consumable.consume(e.item,n.name))return;const s=t.writer,i=t.mapper.toViewPosition(e.range.start),r=s.createText(e.item.data);s.insert(i,r)}}function Xs(){return(n,e,t)=>{t.convertAttributes(e.item),!e.reconversion&&e.item.is("element")&&!e.item.isEmpty&&t.convertChildren(e.item)}}function Hi(){return(n,e,t)=>{const s=t.mapper.toViewPosition(e.position),i=e.position.getShiftedBy(e.length),r=t.mapper.toViewPosition(i,{isPhantom:!0}),o=t.writer.createRange(s,r),a=t.writer.remove(o.getTrimmed());for(const l of t.writer.createRangeIn(a).getItems())t.mapper.unbindViewElement(l,{defer:!0})}}function Ys(n,e){const t=n.createAttributeElement("span",e.attributes);return e.classes&&t._addClass(e.classes),typeof e.priority=="number"&&(t._priority=e.priority),t._id=e.id,t}function ji(){return(n,e,t)=>{const s=e.selection;if(s.isCollapsed||!t.consumable.consume(s,"selection"))return;const i=[];for(const r of s.getRanges())i.push(t.mapper.toViewRange(r));t.writer.setSelection(i,{backward:s.isBackward})}}function Xi(){return(n,e,t)=>{const s=e.selection;if(!s.isCollapsed||!t.consumable.consume(s,"selection"))return;const i=t.writer,r=s.getFirstPosition(),o=t.mapper.toViewPosition(r),a=i.breakAttributes(o);i.setSelection(a)}}function Yi(){return(n,e,t)=>{const s=t.writer,i=s.document.selection;for(const r of i.getRanges())r.isCollapsed&&r.end.parent.isAttached()&&t.writer.mergeAttributes(r.start);s.setSelection(null)}}function Qi(n){return(e,t,s)=>{if(!s.consumable.test(t.item,e.name))return;const i=n(t.attributeOldValue,s,t),r=n(t.attributeNewValue,s,t);if(!i&&!r)return;s.consumable.consume(t.item,e.name);const o=s.writer,a=o.document.selection;if(t.item instanceof $||t.item instanceof K)o.wrap(a.getFirstRange(),r);else{let l=s.mapper.toViewRange(t.range);t.attributeOldValue!==null&&i&&(l=o.unwrap(l,i)),t.attributeNewValue!==null&&r&&o.wrap(l,r)}}}function Zi(n,e=kr){return(t,s,i)=>{if(!e(s.item,i.consumable,{preflight:!0}))return;const r=n(s.item,i,s);if(!r)return;e(s.item,i.consumable);const o=i.mapper.toViewPosition(s.range.start);i.mapper.bindElements(s.item,r),i.writer.insert(o,r),i.convertAttributes(s.item),sn(r,s.item.getChildren(),i,{reconversion:s.reconversion})}}function er(n,e){return(t,s,i)=>{if(!e(s.item,i.consumable,{preflight:!0}))return;const r=new Map;i.writer._registerSlotFactory(br(s.item,r,i));const o=n(s.item,i,s);if(i.writer._clearSlotFactory(),!o)return;vr(s.item,r,i),e(s.item,i.consumable);const a=i.mapper.toViewPosition(s.range.start);i.mapper.bindElements(s.item,o),i.writer.insert(a,o),i.convertAttributes(s.item),Pr(o,r,i,{reconversion:s.reconversion})}}function tr(n){return(e,t,s)=>{t.isOpening=!0;const i=n(t,s);t.isOpening=!1;const r=n(t,s);if(!i||!r)return;const o=t.markerRange;if(o.isCollapsed&&!s.consumable.consume(o,e.name))return;for(const c of o)if(!s.consumable.consume(c.item,e.name))return;const a=s.mapper,l=s.writer;l.insert(a.toViewPosition(o.start),i),s.mapper.bindElementToMarker(i,t.markerName),o.isCollapsed||(l.insert(a.toViewPosition(o.end),r),s.mapper.bindElementToMarker(r,t.markerName)),e.stop()}}function sr(){return(n,e,t)=>{const s=t.mapper.markerNameToElements(e.markerName);if(s){for(const i of s)t.mapper.unbindElementFromMarkerName(i,e.markerName),t.writer.clear(t.writer.createRangeOn(i),i);t.writer.clearClonedElementsGroup(e.markerName),n.stop()}}}function nr(n){return(e,t,s)=>{const i=n(t.markerName,s);if(!i)return;const r=t.markerRange;s.consumable.consume(r,e.name)&&(rs(r,!1,s,t,i),rs(r,!0,s,t,i),e.stop())}}function rs(n,e,t,s,i){const r=e?n.start:n.end,o=r.nodeAfter&&r.nodeAfter.is("element")?r.nodeAfter:null,a=r.nodeBefore&&r.nodeBefore.is("element")?r.nodeBefore:null;if(o||a){let c,h;e&&o||!e&&!a?(c=o,h=!0):(c=a,h=!1);const d=t.mapper.toViewElement(c);if(d){ir(d,e,h,t,s,i);return}}const l=t.mapper.toViewPosition(r);rr(l,e,t,s,i)}function ir(n,e,t,s,i,r){const o=`data-${r.group}-${e?"start":"end"}-${t?"before":"after"}`,a=n.hasAttribute(o)?n.getAttribute(o).split(","):[];a.unshift(r.name),s.writer.setAttribute(o,a.join(","),n),s.mapper.bindElementToMarker(n,i.markerName)}function rr(n,e,t,s,i){const r=`${i.group}-${e?"start":"end"}`,o=i.name?{name:i.name}:null,a=t.writer.createUIElement(r,o);t.writer.insert(n,a),t.mapper.bindElementToMarker(a,s.markerName)}function or(n){return(e,t,s)=>{const i=n(t.markerName,s);if(!i)return;const r=s.mapper.markerNameToElements(t.markerName);if(!r)return;for(const a of r)s.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("containerElement")?(o(`data-${i.group}-start-before`,a),o(`data-${i.group}-start-after`,a),o(`data-${i.group}-end-before`,a),o(`data-${i.group}-end-after`,a)):s.writer.clear(s.writer.createRangeOn(a),a);s.writer.clearClonedElementsGroup(t.markerName),e.stop();function o(a,l){if(l.hasAttribute(a)){const c=new Set(l.getAttribute(a).split(","));c.delete(i.name),c.size==0?s.writer.removeAttribute(a,l):s.writer.setAttribute(a,Array.from(c).join(","),l)}}}}function ar(n){return(e,t,s)=>{if(!s.consumable.test(t.item,e.name))return;const i=n(t.attributeOldValue,s,t),r=n(t.attributeNewValue,s,t);if(!i&&!r)return;s.consumable.consume(t.item,e.name);const o=s.mapper.toViewElement(t.item),a=s.writer;if(!o)throw new f("conversion-attribute-to-attribute-on-text",s.dispatcher,t);if(t.attributeOldValue!==null&&i)if(i.key=="class"){const l=typeof i.value=="string"?i.value.split(/\s+/):i.value;for(const c of l)a.removeClass(c,o)}else if(i.key=="style")if(typeof i.value=="string"){const l=new _t(a.document.stylesProcessor);l.setTo(i.value);for(const[c]of l.getStylesEntries())a.removeStyle(c,o)}else{const l=Object.keys(i.value);for(const c of l)a.removeStyle(c,o)}else a.removeAttribute(i.key,o);if(t.attributeNewValue!==null&&r)if(r.key=="class"){const l=typeof r.value=="string"?r.value.split(/\s+/):r.value;for(const c of l)a.addClass(c,o)}else if(r.key=="style")if(typeof r.value=="string"){const l=new _t(a.document.stylesProcessor);l.setTo(r.value);for(const[c,h]of l.getStylesEntries())a.setStyle(c,h,o)}else{const l=Object.keys(r.value);for(const c of l)a.setStyle(c,r.value[c],o)}else a.setAttribute(r.key,r.value,o)}}function lr(n){return(e,t,s)=>{if(!t.item||!(t.item instanceof $||t.item instanceof K)&&!t.item.is("$textProxy"))return;const i=It(n,t,s);if(!i||!s.consumable.consume(t.item,e.name))return;const r=s.writer,o=Ys(r,i),a=r.document.selection;if(t.item instanceof $||t.item instanceof K)r.wrap(a.getFirstRange(),o);else{const l=s.mapper.toViewRange(t.range),c=r.wrap(l,o);for(const h of c.getItems())if(h.is("attributeElement")&&h.isSimilar(o)){s.mapper.bindElementToMarker(h,t.markerName);break}}}}function cr(n){return(e,t,s)=>{if(!t.item||!(t.item instanceof P))return;const i=It(n,t,s);if(!i||!s.consumable.test(t.item,e.name))return;const r=s.mapper.toViewElement(t.item);if(r&&r.getCustomProperty("addHighlight")){s.consumable.consume(t.item,e.name);for(const a of u._createIn(t.item))s.consumable.consume(a.item,e.name);r.getCustomProperty("addHighlight")(r,i,s.writer),s.mapper.bindElementToMarker(r,t.markerName)}}}function hr(n){return(e,t,s)=>{if(t.markerRange.isCollapsed)return;const i=It(n,t,s);if(!i)return;const r=Ys(s.writer,i),o=s.mapper.markerNameToElements(t.markerName);if(o){for(const a of o)s.mapper.unbindElementFromMarkerName(a,t.markerName),a.is("attributeElement")?s.writer.unwrap(s.writer.createRangeOn(a),r):a.getCustomProperty("removeHighlight")(a,i.id,s.writer);s.writer.clearClonedElementsGroup(t.markerName),e.stop()}}}function ur(n){const e=Qs(n.model),t=We(n.view,"container");return e.attributes.length&&(e.children=!0),s=>{s.on(`insert:${e.name}`,Zi(t,tn(e)),{priority:n.converterPriority||"normal"}),(e.children||e.attributes.length)&&s.on("reduceChanges",en(e),{priority:"low"})}}function fr(n){const e=Qs(n.model),t=We(n.view,"container");return e.children=!0,s=>{if(s._conversionApi.schema.checkChild(e.name,"$text"))throw new f("conversion-element-to-structure-disallowed-text",s,{elementName:e.name});s.on(`insert:${e.name}`,er(t,tn(e)),{priority:n.converterPriority||"normal"}),s.on("reduceChanges",en(e),{priority:"low"})}}function dr(n){n=oe(n);let e=n.model;typeof e=="string"&&(e={key:e});let t=`attribute:${e.key}`;if(e.name&&(t+=":"+e.name),e.values)for(const i of e.values)n.view[i]=We(n.view[i],"attribute");else n.view=We(n.view,"attribute");const s=Zs(n);return i=>{i.on(t,Qi(s),{priority:n.converterPriority||"normal"})}}function mr(n){n=oe(n);let e=n.model;typeof e=="string"&&(e={key:e});let t=`attribute:${e.key}`;if(e.name&&(t+=":"+e.name),e.values)for(const i of e.values)n.view[i]=os(n.view[i]);else n.view=os(n.view);const s=Zs(n);return i=>{i.on(t,ar(s),{priority:n.converterPriority||"normal"})}}function gr(n){const e=We(n.view,"ui");return t=>{t.on(`addMarker:${n.model}`,tr(e),{priority:n.converterPriority||"normal"}),t.on(`removeMarker:${n.model}`,sr(),{priority:n.converterPriority||"normal"})}}function pr(n){n=oe(n);const e=n.model;let t=n.view;return t||(t=s=>({group:e,name:s.substr(n.model.length+1)})),s=>{s.on(`addMarker:${e}`,nr(t),{priority:n.converterPriority||"normal"}),s.on(`removeMarker:${e}`,or(t),{priority:n.converterPriority||"normal"})}}function _r(n){return e=>{e.on(`addMarker:${n.model}`,lr(n.view),{priority:n.converterPriority||"normal"}),e.on(`addMarker:${n.model}`,cr(n.view),{priority:n.converterPriority||"normal"}),e.on(`removeMarker:${n.model}`,hr(n.view),{priority:n.converterPriority||"normal"})}}function Qs(n){return typeof n=="string"&&(n={name:n}),{name:n.name,attributes:n.attributes?ie(n.attributes):[],children:!!n.children}}function We(n,e){return typeof n=="function"?n:(t,s)=>wr(n,s,e)}function wr(n,e,t){typeof n=="string"&&(n={name:n});let s;const i=e.writer,r=Object.assign({},n.attributes);if(t=="container")s=i.createContainerElement(n.name,r);else if(t=="attribute"){const o={priority:n.priority||de.DEFAULT_PRIORITY};s=i.createAttributeElement(n.name,r,o)}else s=i.createUIElement(n.name,r);if(n.styles){const o=Object.keys(n.styles);for(const a of o)i.setStyle(a,n.styles[a],s)}if(n.classes){const o=n.classes;if(typeof o=="string")i.addClass(o,s);else for(const a of o)i.addClass(a,s)}return s}function Zs(n){return n.model.values?(e,t,s)=>{const i=n.view[e];return i?i(e,t,s):null}:n.view}function os(n){return typeof n=="string"?e=>({key:n,value:e}):typeof n=="object"?n.value?()=>n:e=>({key:n.key,value:e}):n}function It(n,e,t){const s=typeof n=="function"?n(e,t):n;return s?(s.priority||(s.priority=10),s.id||(s.id=e.markerName),s):null}function yr(n){return(e,t)=>{if(!e.is("element",n.name))return!1;if(t.type=="attribute"){if(n.attributes.includes(t.attributeKey))return!0}else{/* istanbul ignore else: This is always true because otherwise it would not register a reducer callback. -- @preserve */if(n.children)return!0}return!1}}function en(n){const e=yr(n);return(t,s)=>{const i=[];s.reconvertedElements||(s.reconvertedElements=new Set);for(const r of s.changes){const o=r.type=="attribute"?r.range.start.nodeAfter:r.position.parent;if(!o||!e(o,r)){i.push(r);continue}if(!s.reconvertedElements.has(o)){s.reconvertedElements.add(o);const a=m._createBefore(o);let l=i.length;for(let c=i.length-1;c>=0;c--){const h=i[c],_=(h.type=="attribute"?h.range.start:h.position).compareWith(a);if(_=="before"||h.type=="remove"&&_=="same")break;l=c}i.splice(l,0,{type:"remove",name:o.name,position:a,length:1},{type:"reinsert",name:o.name,position:a,length:1})}}s.changes=i}}function tn(n){return(e,t,s={})=>{const i=["insert"];for(const r of n.attributes)e.hasAttribute(r)&&i.push(`attribute:${r}`);return i.every(r=>t.test(e,r))?(s.preflight||i.forEach(r=>t.consume(e,r)),!0):!1}}function br(n,e,t){return(s,i)=>{const r=s.createContainerElement("$slot");let o=null;if(i==="children")o=Array.from(n.getChildren());else if(typeof i=="function")o=Array.from(n.getChildren()).filter(a=>i(a));else throw new f("conversion-slot-mode-unknown",t.dispatcher,{modeOrFilter:i});return e.set(r,o),r}}function vr(n,e,t){const s=Array.from(e.values()).flat(),i=new Set(s);if(i.size!=s.length)throw new f("conversion-slot-filter-overlap",t.dispatcher,{element:n});if(i.size!=n.childCount)throw new f("conversion-slot-filter-incomplete",t.dispatcher,{element:n})}function Pr(n,e,t,s){t.mapper.on("modelToViewPosition",o,{priority:"highest"});let i=null,r=null;for([i,r]of e)sn(n,r,t,s),t.writer.move(t.writer.createRangeIn(i),t.writer.createPositionBefore(i)),t.writer.remove(i);t.mapper.off("modelToViewPosition",o);function o(a,l){const c=l.modelPosition.nodeAfter,h=r.indexOf(c);h<0||(l.viewPosition=l.mapper.findPositionIn(i,h))}}function sn(n,e,t,s){for(const i of e)Cr(n.root,i,t,s)||t.convertItem(i)}function Cr(n,e,t,s){const{writer:i,mapper:r}=t;if(!s.reconversion)return!1;const o=r.toViewElement(e);return!o||o.root==n||!t.canReuseView(o)?!1:(i.move(i.createRangeOn(o),r.toViewPosition(m._createBefore(e))),!0)}function kr(n,e,{preflight:t}={}){return t?e.test(n,"insert"):e.consume(n,"insert")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nn(n){const{schema:e,document:t}=n.model;for(const s of t.getRoots())if(s.isEmpty&&!e.checkChild(s,"$text")&&e.checkChild(s,"paragraph"))return n.insertElement("paragraph",s),!0;return!1}function rn(n,e,t){const s=t.createContext(n);return!(!t.checkChild(s,"paragraph")||!t.checkChild(s.push("paragraph"),e))}function on(n,e){const t=e.createElement("paragraph");return e.insert(t,n),e.createPositionAt(t,0)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ar extends Hs{elementToElement(e){return this.add(an(e))}elementToAttribute(e){return this.add(Rr(e))}attributeToAttribute(e){return this.add(Tr(e))}elementToMarker(e){return this.add(Mr(e))}dataToMarker(e){return this.add(xr(e))}}function as(){return(n,e,t)=>{if(!e.modelRange&&t.consumable.consume(e.viewItem,{name:!0})){const{modelRange:s,modelCursor:i}=t.convertChildren(e.viewItem,e.modelCursor);e.modelRange=s,e.modelCursor=i}}}function Sr(){return(n,e,{schema:t,consumable:s,writer:i})=>{let r=e.modelCursor;if(!s.test(e.viewItem))return;if(!t.checkChild(r,"$text")){if(!rn(r,"$text",t)||e.viewItem.data.trim().length==0)return;const a=r.nodeBefore;r=on(r,i),a&&a.is("element","$marker")&&(i.move(i.createRangeOn(a),r),r=i.createPositionAfter(a))}s.consume(e.viewItem);const o=i.createText(e.viewItem.data);i.insert(o,r),e.modelRange=i.createRange(r,r.getShiftedBy(o.offsetSize)),e.modelCursor=e.modelRange.end}}function Er(n,e){return(t,s)=>{const i=s.newSelection,r=[];for(const a of i.getRanges())r.push(e.toModelRange(a));const o=n.createSelection(r,{backward:i.isBackward});o.isEqual(n.document.selection)||n.change(a=>{a.setSelection(o)})}}function an(n){n=oe(n);const e=kt(n),t=Ft(n.view),s=t?`element:${t}`:"element";return i=>{i.on(s,e,{priority:n.converterPriority||"normal"})}}function Rr(n){n=oe(n),ln(n);const e=cn(n,!1),t=Ft(n.view),s=t?`element:${t}`:"element";return i=>{i.on(s,e,{priority:n.converterPriority||"low"})}}function Tr(n){n=oe(n);let e=null;(typeof n.view=="string"||n.view.key)&&(e=Ir(n)),ln(n,e);const t=cn(n,!0);return s=>{s.on("element",t,{priority:n.converterPriority||"low"})}}function Mr(n){const e=Dr(n.model);return an({...n,model:e})}function xr(n){n=oe(n),n.model||(n.model=i=>i?n.view+":"+i:n.view);const e={view:n.view,model:n.model},t=kt(ls(e,"start")),s=kt(ls(e,"end"));return i=>{i.on(`element:${n.view}-start`,t,{priority:n.converterPriority||"normal"}),i.on(`element:${n.view}-end`,s,{priority:n.converterPriority||"normal"});const r=rt.low,o=rt.highest,a=rt.get(n.converterPriority)/o;i.on("element",Nr(e),{priority:r+a})}}function Nr(n){return(e,t,s)=>{const i=`data-${n.view}`;if(!s.consumable.test(t.viewItem,{attributes:i+"-end-after"})&&!s.consumable.test(t.viewItem,{attributes:i+"-start-after"})&&!s.consumable.test(t.viewItem,{attributes:i+"-end-before"})&&!s.consumable.test(t.viewItem,{attributes:i+"-start-before"}))return;t.modelRange||Object.assign(t,s.convertChildren(t.viewItem,t.modelCursor)),s.consumable.consume(t.viewItem,{attributes:i+"-end-after"})&&r(t.modelRange.end,t.viewItem.getAttribute(i+"-end-after").split(",")),s.consumable.consume(t.viewItem,{attributes:i+"-start-after"})&&r(t.modelRange.end,t.viewItem.getAttribute(i+"-start-after").split(",")),s.consumable.consume(t.viewItem,{attributes:i+"-end-before"})&&r(t.modelRange.start,t.viewItem.getAttribute(i+"-end-before").split(",")),s.consumable.consume(t.viewItem,{attributes:i+"-start-before"})&&r(t.modelRange.start,t.viewItem.getAttribute(i+"-start-before").split(","));function r(o,a){for(const l of a){const c=n.model(l,s),h=s.writer.createElement("$marker",{"data-name":c});s.writer.insert(h,o),t.modelCursor.isEqual(o)?t.modelCursor=t.modelCursor.getShiftedBy(1):t.modelCursor=t.modelCursor._getTransformedByInsertion(o,1),t.modelRange=t.modelRange._getTransformedByInsertion(o,1)[0]}}}}function Ft(n){return typeof n=="string"?n:typeof n=="object"&&typeof n.name=="string"?n.name:null}function kt(n){const e=new De(n.view);return(t,s,i)=>{const r=e.match(s.viewItem);if(!r)return;const o=r.match;if(o.name=!0,!i.consumable.test(s.viewItem,o))return;const a=Or(n.model,s.viewItem,i);a&&i.safeInsert(a,s.modelCursor)&&(i.consumable.consume(s.viewItem,o),i.convertChildren(s.viewItem,a),i.updateConversionResult(a,s))}}function Or(n,e,t){return n instanceof Function?n(e,t):t.writer.createElement(n)}function Ir(n){typeof n.view=="string"&&(n.view={key:n.view});const e=n.view.key,t=typeof n.view.value>"u"?/[\s\S]*/:n.view.value;let s;return e=="class"||e=="style"?s={[e=="class"?"classes":"styles"]:t}:s={attributes:{[e]:t}},n.view.name&&(s.name=n.view.name),n.view=s,e}function ln(n,e=null){const t=e===null?!0:r=>r.getAttribute(e),s=typeof n.model!="object"?n.model:n.model.key,i=typeof n.model!="object"||typeof n.model.value>"u"?t:n.model.value;n.model={key:s,value:i}}function cn(n,e){const t=new De(n.view);return(s,i,r)=>{if(!i.modelRange&&e)return;const o=t.match(i.viewItem);if(!o||(Fr(n.view,i.viewItem)?o.match.name=!0:delete o.match.name,!r.consumable.test(i.viewItem,o.match)))return;const a=n.model.key,l=typeof n.model.value=="function"?n.model.value(i.viewItem,r):n.model.value;if(l===null)return;i.modelRange||Object.assign(i,r.convertChildren(i.viewItem,i.modelCursor)),Br(i.modelRange,{key:a,value:l},e,r)&&(r.consumable.test(i.viewItem,{name:!0})&&(o.match.name=!0),r.consumable.consume(i.viewItem,o.match))}}function Fr(n,e){const t=typeof n=="function"?n(e):n;return typeof t=="object"&&!Ft(t)?!1:!t.classes&&!t.attributes&&!t.styles}function Br(n,e,t,s){let i=!1;for(const r of Array.from(n.getItems({shallow:t})))s.schema.checkAttribute(r,e.key)&&(i=!0,!r.hasAttribute(e.key)&&s.writer.setAttribute(e.key,e.value,r));return i}function Dr(n){return(e,t)=>{const s=typeof n=="string"?n:n(e,t);return t.writer.createElement("$marker",{"data-name":s})}}function ls(n,e){const t=(s,i)=>{const r=s.getAttribute("name"),o=n.model(r,i);return i.writer.createElement("$marker",{"data-name":o})};return{view:`${n.view}-${e}`,model:t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Vr(n){n.document.registerPostFixer(e=>$r(e,n))}function $r(n,e){const t=e.document.selection,s=e.schema,i=[];let r=!1;for(const o of t.getRanges()){const a=hn(o,s);a&&!a.isEqual(o)?(i.push(a),r=!0):i.push(o)}return r&&n.setSelection(Ur(i),{backward:t.isBackward}),!1}function hn(n,e){return n.isCollapsed?Lr(n,e):Wr(n,e)}function Lr(n,e){const t=n.start,s=e.getNearestSelectionRange(t);if(!s){const r=t.getAncestors().reverse().find(o=>e.isObject(o));return r?u._createOn(r):null}if(!s.isCollapsed)return s;const i=s.start;return t.isEqual(i)?null:new u(i)}function Wr(n,e){const{start:t,end:s}=n,i=e.checkChild(t,"$text"),r=e.checkChild(s,"$text"),o=e.getLimitElement(t),a=e.getLimitElement(s);if(o===a){if(i&&r)return null;if(qr(t,s,e)){const d=t.nodeAfter&&e.isSelectable(t.nodeAfter)?null:e.getNearestSelectionRange(t,"forward"),p=s.nodeBefore&&e.isSelectable(s.nodeBefore)?null:e.getNearestSelectionRange(s,"backward"),v=d?d.start:t,D=p?p.end:s;return new u(v,D)}}const l=o&&!o.is("rootElement"),c=a&&!a.is("rootElement");if(l||c){const h=t.nodeAfter&&s.nodeBefore&&t.nodeAfter.parent===s.nodeBefore.parent,d=l&&(!h||!hs(t.nodeAfter,e)),_=c&&(!h||!hs(s.nodeBefore,e));let p=t,v=s;return d&&(p=m._createBefore(cs(o,e))),_&&(v=m._createAfter(cs(a,e))),new u(p,v)}return null}function cs(n,e){let t=n,s=t;for(;e.isLimit(s)&&s.parent;)t=s,s=s.parent;return t}function qr(n,e,t){const s=n.nodeAfter&&!t.isLimit(n.nodeAfter)||t.checkChild(n,"$text"),i=e.nodeBefore&&!t.isLimit(e.nodeBefore)||t.checkChild(e,"$text");return s||i}function Ur(n){const e=[...n],t=new Set;let s=1;for(;s<e.length;){const r=e[s],o=e.slice(0,s);for(const[a,l]of o.entries())if(!t.has(a)){if(r.isEqual(l))t.add(a);else if(r.isIntersecting(l)){t.add(a),t.add(s);const c=r.getJoined(l);e.push(c)}}s++}return e.filter((r,o)=>!t.has(o))}function hs(n,e){return n&&e.isSelectable(n)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Da extends q(){constructor(e,t){super(),this.model=e,this.view=new Ni(t),this.mapper=new Js,this.downcastDispatcher=new Gs({mapper:this.mapper,schema:e.schema});const s=this.model.document,i=s.selection,r=this.model.markers;this.listenTo(this.model,"_beforeChanges",()=>{this.view._disableRendering(!0)},{priority:"highest"}),this.listenTo(this.model,"_afterChanges",()=>{this.view._disableRendering(!1)},{priority:"lowest"}),this.listenTo(s,"change",()=>{this.view.change(o=>{this.downcastDispatcher.convertChanges(s.differ,r,o),this.downcastDispatcher.convertSelection(i,r,o)})},{priority:"low"}),this.listenTo(this.view.document,"selectionChange",Er(this.model,this.mapper)),this.listenTo(this.view.document,"beforeinput",zr(this.mapper,this.model.schema,this.view),{priority:"high"}),this.downcastDispatcher.on("insert:$text",js(),{priority:"lowest"}),this.downcastDispatcher.on("insert",Xs(),{priority:"lowest"}),this.downcastDispatcher.on("remove",Hi(),{priority:"low"}),this.downcastDispatcher.on("cleanSelection",Yi()),this.downcastDispatcher.on("selection",ji(),{priority:"low"}),this.downcastDispatcher.on("selection",Xi(),{priority:"low"}),this.view.document.roots.bindTo(this.model.document.roots).using(o=>{if(o.rootName=="$graveyard")return null;const a=new Ms(this.view.document,o.name);return a.rootName=o.rootName,this.mapper.bindElements(o,a),a})}destroy(){this.view.destroy(),this.stopListening()}reconvertMarker(e){const t=typeof e=="string"?e:e.name,s=this.model.markers.get(t);if(!s)throw new f("editingcontroller-reconvertmarker-marker-not-exist",this,{markerName:t});this.model.change(()=>{this.model.markers._refresh(s)})}reconvertItem(e){this.model.change(()=>{this.model.document.differ._refreshItem(e)})}}function zr(n,e,t){return(s,i)=>{if(!(t.document.isComposing&&!x.isAndroid))for(let r=0;r<i.targetRanges.length;r++){const o=i.targetRanges[r],a=n.toModelRange(o),l=hn(a,e);!l||l.isEqual(a)||(i.targetRanges[r]=n.toViewRange(l))}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Be{constructor(){this._consumables=new Map}add(e,t){let s;if(e.is("$text")||e.is("documentFragment")){this._consumables.set(e,!0);return}this._consumables.has(e)?s=this._consumables.get(e):(s=new Jr(e),this._consumables.set(e,s)),s.add(t)}test(e,t){const s=this._consumables.get(e);return s===void 0?null:e.is("$text")||e.is("documentFragment")?s:s.test(t)}consume(e,t){return this.test(e,t)?(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!1):this._consumables.get(e).consume(t),!0):!1}revert(e,t){const s=this._consumables.get(e);s!==void 0&&(e.is("$text")||e.is("documentFragment")?this._consumables.set(e,!0):s.revert(t))}static consumablesFromElement(e){const t={element:e,name:!0,attributes:[],classes:[],styles:[]},s=e.getAttributeKeys();for(const o of s)o=="style"||o=="class"||t.attributes.push(o);const i=e.getClassNames();for(const o of i)t.classes.push(o);const r=e.getStyleNames();for(const o of r)t.styles.push(o);return t}static createFrom(e,t){if(t||(t=new Be),e.is("$text"))return t.add(e),t;e.is("element")&&t.add(e,Be.consumablesFromElement(e)),e.is("documentFragment")&&t.add(e);for(const s of e.getChildren())t=Be.createFrom(s,t);return t}}const Xe=["attributes","classes","styles"];class Jr{constructor(e){this.element=e,this._canConsumeName=null,this._consumables={attributes:new Map,styles:new Map,classes:new Map}}add(e){e.name&&(this._canConsumeName=!0);for(const t of Xe)t in e&&this._add(t,e[t])}test(e){if(e.name&&!this._canConsumeName)return this._canConsumeName;for(const t of Xe)if(t in e){const s=this._test(t,e[t]);if(s!==!0)return s}return!0}consume(e){e.name&&(this._canConsumeName=!1);for(const t of Xe)t in e&&this._consume(t,e[t])}revert(e){e.name&&(this._canConsumeName=!0);for(const t of Xe)t in e&&this._revert(t,e[t])}_add(e,t){const s=Ge(t)?t:[t],i=this._consumables[e];for(const r of s){if(e==="attributes"&&(r==="class"||r==="style"))throw new f("viewconsumable-invalid-attribute",this);if(i.set(r,!0),e==="styles")for(const o of this.element.document.stylesProcessor.getRelatedStyles(r))i.set(o,!0)}}_test(e,t){const s=Ge(t)?t:[t],i=this._consumables[e];for(const r of s)if(e==="attributes"&&(r==="class"||r==="style")){const o=r=="class"?"classes":"styles",a=this._test(o,[...this._consumables[o].keys()]);if(a!==!0)return a}else{const o=i.get(r);if(o===void 0)return null;if(!o)return!1}return!0}_consume(e,t){const s=Ge(t)?t:[t],i=this._consumables[e];for(const r of s)if(e==="attributes"&&(r==="class"||r==="style")){const o=r=="class"?"classes":"styles";this._consume(o,[...this._consumables[o].keys()])}else if(i.set(r,!1),e=="styles")for(const o of this.element.document.stylesProcessor.getRelatedStyles(r))i.set(o,!1)}_revert(e,t){const s=Ge(t)?t:[t],i=this._consumables[e];for(const r of s)if(e==="attributes"&&(r==="class"||r==="style")){const o=r=="class"?"classes":"styles";this._revert(o,[...this._consumables[o].keys()])}else i.get(r)===!1&&i.set(r,!0)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gr extends q(){constructor(){super(),this._sourceDefinitions={},this._attributeProperties={},this.decorate("checkChild"),this.decorate("checkAttribute"),this.on("checkAttribute",(e,t)=>{t[0]=new ge(t[0])},{priority:"highest"}),this.on("checkChild",(e,t)=>{t[0]=new ge(t[0]),t[1]=this.getDefinition(t[1])},{priority:"highest"})}register(e,t){if(this._sourceDefinitions[e])throw new f("schema-cannot-register-item-twice",this,{itemName:e});this._sourceDefinitions[e]=[Object.assign({},t)],this._clearCache()}extend(e,t){if(!this._sourceDefinitions[e])throw new f("schema-cannot-extend-missing-item",this,{itemName:e});this._sourceDefinitions[e].push(Object.assign({},t)),this._clearCache()}getDefinitions(){return this._compiledDefinitions||this._compile(),this._compiledDefinitions}getDefinition(e){let t;return typeof e=="string"?t=e:"is"in e&&(e.is("$text")||e.is("$textProxy"))?t="$text":t=e.name,this.getDefinitions()[t]}isRegistered(e){return!!this.getDefinition(e)}isBlock(e){const t=this.getDefinition(e);return!!(t&&t.isBlock)}isLimit(e){const t=this.getDefinition(e);return t?!!(t.isLimit||t.isObject):!1}isObject(e){const t=this.getDefinition(e);return t?!!(t.isObject||t.isLimit&&t.isSelectable&&t.isContent):!1}isInline(e){const t=this.getDefinition(e);return!!(t&&t.isInline)}isSelectable(e){const t=this.getDefinition(e);return t?!!(t.isSelectable||t.isObject):!1}isContent(e){const t=this.getDefinition(e);return t?!!(t.isContent||t.isObject):!1}checkChild(e,t){return t?this._checkContextMatch(t,e):!1}checkAttribute(e,t){const s=this.getDefinition(e.last);return s?s.allowAttributes.includes(t):!1}checkMerge(e,t){if(e instanceof m){const s=e.nodeBefore,i=e.nodeAfter;if(!(s instanceof P))throw new f("schema-check-merge-no-element-before",this);if(!(i instanceof P))throw new f("schema-check-merge-no-element-after",this);return this.checkMerge(s,i)}for(const s of t.getChildren())if(!this.checkChild(e,s))return!1;return!0}addChildCheck(e){this.on("checkChild",(t,[s,i])=>{if(!i)return;const r=e(s,i);typeof r=="boolean"&&(t.stop(),t.return=r)},{priority:"high"})}addAttributeCheck(e){this.on("checkAttribute",(t,[s,i])=>{const r=e(s,i);typeof r=="boolean"&&(t.stop(),t.return=r)},{priority:"high"})}setAttributeProperties(e,t){this._attributeProperties[e]=Object.assign(this.getAttributeProperties(e),t)}getAttributeProperties(e){return this._attributeProperties[e]||{}}getLimitElement(e){let t;for(e instanceof m?t=e.parent:t=(e instanceof u?[e]:Array.from(e.getRanges())).reduce((i,r)=>{const o=r.getCommonAncestor();return i?i.getCommonAncestor(o,{includeSelf:!0}):o},null);!this.isLimit(t)&&t.parent;)t=t.parent;return t}checkAttributeInSelection(e,t){if(e.isCollapsed){const i=[...e.getFirstPosition().getAncestors(),new C("",e.getAttributes())];return this.checkAttribute(i,t)}else{const s=e.getRanges();for(const i of s)for(const r of i)if(this.checkAttribute(r.item,t))return!0}return!1}*getValidRanges(e,t){e=lo(e);for(const s of e)yield*this._getValidRangesForRange(s,t)}getNearestSelectionRange(e,t="both"){if(e.root.rootName=="$graveyard")return null;if(this.checkChild(e,"$text"))return new u(e);let s,i;const r=e.getAncestors().reverse().find(o=>this.isLimit(o))||e.root;(t=="both"||t=="backward")&&(s=new ne({boundaries:u._createIn(r),startPosition:e,direction:"backward"})),(t=="both"||t=="forward")&&(i=new ne({boundaries:u._createIn(r),startPosition:e}));for(const o of ao(s,i)){const a=o.walker==s?"elementEnd":"elementStart",l=o.value;if(l.type==a&&this.isObject(l.item))return u._createOn(l.item);if(this.checkChild(l.nextPosition,"$text"))return new u(l.nextPosition)}return null}findAllowedParent(e,t){let s=e.parent;for(;s;){if(this.checkChild(s,t))return s;if(this.isLimit(s))return null;s=s.parent}return null}setAllowedAttributes(e,t,s){const i=s.model;for(const[r,o]of Object.entries(t))i.schema.checkAttribute(e,r)&&s.setAttribute(r,o,e)}removeDisallowedAttributes(e,t){for(const s of e)if(s.is("$text"))us(this,s,t);else{const r=u._createIn(s).getPositions();for(const o of r){const a=o.nodeBefore||o.parent;us(this,a,t)}}}getAttributesWithProperty(e,t,s){const i={};for(const[r,o]of e.getAttributes()){const a=this.getAttributeProperties(r);a[t]!==void 0&&(s===void 0||s===a[t])&&(i[r]=o)}return i}createContext(e){return new ge(e)}_clearCache(){this._compiledDefinitions=null}_compile(){const e={},t=this._sourceDefinitions,s=Object.keys(t);for(const i of s)e[i]=Kr(t[i],i);for(const i of s)Hr(e,i);for(const i of s)jr(e,i);for(const i of s)Xr(e,i);for(const i of s)Yr(e,i),Qr(e,i);for(const i of s)Zr(e,i),eo(e,i),to(e,i);this._compiledDefinitions=e}_checkContextMatch(e,t,s=t.length-1){const i=t.getItem(s);if(e.allowIn.includes(i.name)){if(s==0)return!0;{const r=this.getDefinition(i);return this._checkContextMatch(r,t,s-1)}}else return!1}*_getValidRangesForRange(e,t){let s=e.start,i=e.start;for(const r of e.getItems({shallow:!0}))r.is("element")&&(yield*this._getValidRangesForRange(u._createIn(r),t)),this.checkAttribute(r,t)||(s.isEqual(i)||(yield new u(s,i)),s=m._createAfter(r)),i=m._createAfter(r);s.isEqual(i)||(yield new u(s,i))}findOptimalInsertionRange(e,t){const s=e.getSelectedElement();if(s&&this.isObject(s)&&!this.isInline(s))return t=="before"||t=="after"?new u(m._createAt(s,t)):u._createOn(s);const i=Et(e.getSelectedBlocks());if(!i)return new u(e.focus);if(i.isEmpty)return new u(m._createAt(i,0));const r=m._createAfter(i);return e.focus.isTouching(r)?new u(r):new u(m._createBefore(i))}}class ge{constructor(e){if(e instanceof ge)return e;let t;typeof e=="string"?t=[e]:Array.isArray(e)?t=e:t=e.getAncestors({includeSelf:!0}),this._items=t.map(oo)}get length(){return this._items.length}get last(){return this._items[this._items.length-1]}[Symbol.iterator](){return this._items[Symbol.iterator]()}push(e){const t=new ge([e]);return t._items=[...this._items,...t._items],t}getItem(e){return this._items[e]}*getNames(){yield*this._items.map(e=>e.name)}endsWith(e){return Array.from(this.getNames()).join(" ").endsWith(e)}startsWith(e){return Array.from(this.getNames()).join(" ").startsWith(e)}}function Kr(n,e){const t={name:e,allowIn:[],allowContentOf:[],allowWhere:[],allowAttributes:[],allowAttributesOf:[],allowChildren:[],inheritTypesFrom:[]};return so(n,t),he(n,t,"allowIn"),he(n,t,"allowContentOf"),he(n,t,"allowWhere"),he(n,t,"allowAttributes"),he(n,t,"allowAttributesOf"),he(n,t,"allowChildren"),he(n,t,"inheritTypesFrom"),no(n,t),t}function Hr(n,e){const t=n[e];for(const s of t.allowChildren){const i=n[s];i&&i.allowIn.push(e)}t.allowChildren.length=0}function jr(n,e){for(const t of n[e].allowContentOf)n[t]&&io(n,t).forEach(i=>{i.allowIn.push(e)});delete n[e].allowContentOf}function Xr(n,e){for(const t of n[e].allowWhere){const s=n[t];if(s){const i=s.allowIn;n[e].allowIn.push(...i)}}delete n[e].allowWhere}function Yr(n,e){for(const t of n[e].allowAttributesOf){const s=n[t];if(s){const i=s.allowAttributes;n[e].allowAttributes.push(...i)}}delete n[e].allowAttributesOf}function Qr(n,e){const t=n[e];for(const s of t.inheritTypesFrom){const i=n[s];if(i){const r=Object.keys(i).filter(o=>o.startsWith("is"));for(const o of r)o in t||(t[o]=i[o])}}delete t.inheritTypesFrom}function Zr(n,e){const t=n[e],s=t.allowIn.filter(i=>n[i]);t.allowIn=Array.from(new Set(s))}function eo(n,e){const t=n[e];for(const s of t.allowIn)n[s].allowChildren.push(e)}function to(n,e){const t=n[e];t.allowAttributes=Array.from(new Set(t.allowAttributes))}function so(n,e){for(const t of n){const s=Object.keys(t).filter(i=>i.startsWith("is"));for(const i of s)e[i]=!!t[i]}}function he(n,e,t){for(const s of n){const i=s[t];typeof i=="string"?e[t].push(i):Array.isArray(i)&&e[t].push(...i)}}function no(n,e){for(const t of n){const s=t.inheritAllFrom;s&&(e.allowContentOf.push(s),e.allowWhere.push(s),e.allowAttributesOf.push(s),e.inheritTypesFrom.push(s))}}function io(n,e){const t=n[e];return ro(n).filter(s=>s.allowIn.includes(t.name))}function ro(n){return Object.keys(n).map(e=>n[e])}function oo(n){return typeof n=="string"||n.is("documentFragment")?{name:typeof n=="string"?n:"$documentFragment",*getAttributeKeys(){},getAttribute(){}}:{name:n.is("element")?n.name:"$text",*getAttributeKeys(){yield*n.getAttributeKeys()},getAttribute(e){return n.getAttribute(e)}}}function*ao(n,e){let t=!1;for(;!t;){if(t=!0,n){const s=n.next();s.done||(t=!1,yield{walker:n,value:s.value})}if(e){const s=e.next();s.done||(t=!1,yield{walker:e,value:s.value})}}}function*lo(n){for(const e of n)yield*e.getMinimalFlatRanges()}function us(n,e,t){for(const s of e.getAttributeKeys())n.checkAttribute(e,s)||t.removeAttribute(s,e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class co extends N(){constructor(e){super(),this._splitParts=new Map,this._cursorParents=new Map,this._modelCursor=null,this._emptyElementsToKeep=new Set,this.conversionApi={...e,consumable:null,writer:null,store:null,convertItem:(t,s)=>this._convertItem(t,s),convertChildren:(t,s)=>this._convertChildren(t,s),safeInsert:(t,s)=>this._safeInsert(t,s),updateConversionResult:(t,s)=>this._updateConversionResult(t,s),splitToAllowedParent:(t,s)=>this._splitToAllowedParent(t,s),getSplitParts:t=>this._getSplitParts(t),keepEmptyElement:t=>this._keepEmptyElement(t)}}convert(e,t,s=["$root"]){this.fire("viewCleanup",e),this._modelCursor=uo(s,t),this.conversionApi.writer=t,this.conversionApi.consumable=Be.createFrom(e),this.conversionApi.store={};const{modelRange:i}=this._convertItem(e,this._modelCursor),r=t.createDocumentFragment();if(i){this._removeEmptyElements();for(const o of Array.from(this._modelCursor.parent.getChildren()))t.append(o,r);r.markers=ho(r,t)}return this._modelCursor=null,this._splitParts.clear(),this._cursorParents.clear(),this._emptyElementsToKeep.clear(),this.conversionApi.writer=null,this.conversionApi.store=null,r}_convertItem(e,t){const s={viewItem:e,modelCursor:t,modelRange:null};if(e.is("element")?this.fire(`element:${e.name}`,s,this.conversionApi):e.is("$text")?this.fire("text",s,this.conversionApi):this.fire("documentFragment",s,this.conversionApi),s.modelRange&&!(s.modelRange instanceof u))throw new f("view-conversion-dispatcher-incorrect-result",this);return{modelRange:s.modelRange,modelCursor:s.modelCursor}}_convertChildren(e,t){let s=t.is("position")?t:m._createAt(t,0);const i=new u(s);for(const r of Array.from(e.getChildren())){const o=this._convertItem(r,s);o.modelRange instanceof u&&(i.end=o.modelRange.end,s=o.modelCursor)}return{modelRange:i,modelCursor:s}}_safeInsert(e,t){const s=this._splitToAllowedParent(e,t);return s?(this.conversionApi.writer.insert(e,s.position),!0):!1}_updateConversionResult(e,t){const s=this._getSplitParts(e),i=this.conversionApi.writer;t.modelRange||(t.modelRange=i.createRange(i.createPositionBefore(e),i.createPositionAfter(s[s.length-1])));const r=this._cursorParents.get(e);r?t.modelCursor=i.createPositionAt(r,0):t.modelCursor=t.modelRange.end}_splitToAllowedParent(e,t){const{schema:s,writer:i}=this.conversionApi;let r=s.findAllowedParent(t,e);if(r){if(r===t.parent)return{position:t};this._modelCursor.parent.getAncestors().includes(r)&&(r=null)}if(!r)return rn(t,e,s)?{position:on(t,i)}:null;const o=this.conversionApi.writer.split(t,r),a=[];for(const c of o.range.getWalker())if(c.type=="elementEnd")a.push(c.item);else{const h=a.pop(),d=c.item;this._registerSplitPair(h,d)}const l=o.range.end.parent;return this._cursorParents.set(e,l),{position:o.position,cursorParent:l}}_registerSplitPair(e,t){this._splitParts.has(e)||this._splitParts.set(e,[e]);const s=this._splitParts.get(e);this._splitParts.set(t,s),s.push(t)}_getSplitParts(e){let t;return this._splitParts.has(e)?t=this._splitParts.get(e):t=[e],t}_keepEmptyElement(e){this._emptyElementsToKeep.add(e)}_removeEmptyElements(){let e=!1;for(const t of this._splitParts.keys())t.isEmpty&&!this._emptyElementsToKeep.has(t)&&(this.conversionApi.writer.remove(t),this._splitParts.delete(t),e=!0);e&&this._removeEmptyElements()}}function ho(n,e){const t=new Set,s=new Map,i=u._createIn(n).getItems();for(const r of i)r.is("element","$marker")&&t.add(r);for(const r of t){const o=r.getAttribute("data-name"),a=e.createPositionBefore(r);s.has(o)?s.get(o).end=a.clone():s.set(o,new u(a.clone())),e.remove(r)}return s}function uo(n,e){let t;for(const s of new ge(n)){const i={};for(const o of s.getAttributeKeys())i[o]=s.getAttribute(o);const r=e.createElement(s.name,i);t&&e.insert(r,t),t=m._createAt(r,0)}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fo{getHtml(e){const s=se.document.implementation.createHTMLDocument("").createElement("div");return s.appendChild(e),s.innerHTML}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mo{constructor(e){this.skipComments=!0,this.domParser=new DOMParser,this.domConverter=new Ls(e,{renderingMode:"data"}),this.htmlWriter=new fo}toData(e){const t=this.domConverter.viewToDom(e);return this.htmlWriter.getHtml(t)}toView(e){const t=this._toDom(e);return this.domConverter.domToView(t,{skipComments:this.skipComments})}registerRawContentMatcher(e){this.domConverter.registerRawContentMatcher(e)}useFillerType(e){this.domConverter.blockFillerMode=e=="marked"?"markedNbsp":"nbsp"}_toDom(e){e.match(/<(?:html|body|head|meta)(?:\s[^>]*)?>/i)||(e=`<body>${e}</body>`);const t=this.domParser.parseFromString(e,"text/html"),s=t.createDocumentFragment(),i=t.body.childNodes;for(;i.length>0;)s.appendChild(i[0]);return s}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Va extends N(){constructor(e,t){super(),this.model=e,this.mapper=new Js,this.downcastDispatcher=new Gs({mapper:this.mapper,schema:e.schema}),this.downcastDispatcher.on("insert:$text",js(),{priority:"lowest"}),this.downcastDispatcher.on("insert",Xs(),{priority:"lowest"}),this.upcastDispatcher=new co({schema:e.schema}),this.viewDocument=new Os(t),this.stylesProcessor=t,this.htmlProcessor=new mo(this.viewDocument),this.processor=this.htmlProcessor,this._viewWriter=new Fs(this.viewDocument),this.upcastDispatcher.on("text",Sr(),{priority:"lowest"}),this.upcastDispatcher.on("element",as(),{priority:"lowest"}),this.upcastDispatcher.on("documentFragment",as(),{priority:"lowest"}),q().prototype.decorate.call(this,"init"),q().prototype.decorate.call(this,"set"),q().prototype.decorate.call(this,"get"),q().prototype.decorate.call(this,"toView"),q().prototype.decorate.call(this,"toModel"),this.on("init",()=>{this.fire("ready")},{priority:"lowest"}),this.on("ready",()=>{this.model.enqueueChange({isUndoable:!1},nn)},{priority:"lowest"})}get(e={}){const{rootName:t="main",trim:s="empty"}=e;if(!this._checkIfRootsExists([t]))throw new f("datacontroller-get-non-existent-root",this);const i=this.model.document.getRoot(t);return i.isAttached()||L("datacontroller-get-detached-root",this),s==="empty"&&!this.model.hasContent(i,{ignoreWhitespaces:!0})?"":this.stringify(i,e)}stringify(e,t={}){const s=this.toView(e,t);return this.processor.toData(s)}toView(e,t={}){const s=this.viewDocument,i=this._viewWriter;this.mapper.clearBindings();const r=u._createIn(e),o=new me(s);this.mapper.bindElements(e,o);const a=e.is("documentFragment")?e.markers:go(e);return this.downcastDispatcher.convert(r,a,i,t),o}init(e){if(this.model.document.version)throw new f("datacontroller-init-document-not-empty",this);let t={};if(typeof e=="string"?t.main=e:t=e,!this._checkIfRootsExists(Object.keys(t)))throw new f("datacontroller-init-non-existent-root",this);return this.model.enqueueChange({isUndoable:!1},s=>{for(const i of Object.keys(t)){const r=this.model.document.getRoot(i);s.insert(this.parse(t[i],r),r,0)}}),Promise.resolve()}set(e,t={}){let s={};if(typeof e=="string"?s.main=e:s=e,!this._checkIfRootsExists(Object.keys(s)))throw new f("datacontroller-set-non-existent-root",this);this.model.enqueueChange(t.batchType||{},i=>{i.setSelection(null),i.removeSelectionAttribute(this.model.document.selection.getAttributeKeys());for(const r of Object.keys(s)){const o=this.model.document.getRoot(r);i.remove(i.createRangeIn(o)),i.insert(this.parse(s[r],o),o,0)}})}parse(e,t="$root"){const s=this.processor.toView(e);return this.toModel(s,t)}toModel(e,t="$root"){return this.model.change(s=>this.upcastDispatcher.convert(e,s,t))}addStyleProcessorRules(e){e(this.stylesProcessor)}registerRawContentMatcher(e){this.processor&&this.processor!==this.htmlProcessor&&this.processor.registerRawContentMatcher(e),this.htmlProcessor.registerRawContentMatcher(e)}destroy(){this.stopListening()}_checkIfRootsExists(e){for(const t of e)if(!this.model.document.getRoot(t))return!1;return!0}}function go(n){const e=[],t=n.root.document;if(!t)return new Map;const s=u._createIn(n);for(const i of t.model.markers){const r=i.getRange(),o=r.isCollapsed,a=r.start.isEqual(s.start)||r.end.isEqual(s.end);if(o&&a)e.push([i.name,r]);else{const l=s.getIntersection(r);l&&e.push([i.name,l])}}return e.sort(([i,r],[o,a])=>{if(r.end.compareWith(a.start)!=="after")return 1;if(r.start.compareWith(a.end)!=="before")return-1;switch(r.start.compareWith(a.start)){case"before":return 1;case"after":return-1;default:switch(r.end.compareWith(a.end)){case"before":return 1;case"after":return-1;default:return o.localeCompare(i)}}}),new Map(e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $a{constructor(e,t){this._helpers=new Map,this._downcast=ie(e),this._createConversionHelpers({name:"downcast",dispatchers:this._downcast,isDowncast:!0}),this._upcast=ie(t),this._createConversionHelpers({name:"upcast",dispatchers:this._upcast,isDowncast:!1})}addAlias(e,t){const s=this._downcast.includes(t);if(!this._upcast.includes(t)&&!s)throw new f("conversion-add-alias-dispatcher-not-registered",this);this._createConversionHelpers({name:e,dispatchers:[t],isDowncast:s})}for(e){if(!this._helpers.has(e))throw new f("conversion-for-unknown-group",this);return this._helpers.get(e)}elementToElement(e){this.for("downcast").elementToElement(e);for(const{model:t,view:s}of ft(e))this.for("upcast").elementToElement({model:t,view:s,converterPriority:e.converterPriority})}attributeToElement(e){this.for("downcast").attributeToElement(e);for(const{model:t,view:s}of ft(e))this.for("upcast").elementToAttribute({view:s,model:t,converterPriority:e.converterPriority})}attributeToAttribute(e){this.for("downcast").attributeToAttribute(e);for(const{model:t,view:s}of ft(e))this.for("upcast").attributeToAttribute({view:s,model:t})}_createConversionHelpers({name:e,dispatchers:t,isDowncast:s}){if(this._helpers.has(e))throw new f("conversion-group-exists",this);const i=s?new Ki(t):new Ar(t);this._helpers.set(e,i)}}function*ft(n){if(n.model.values)for(const e of n.model.values){const t={key:n.model.key,value:e},s=n.view[e],i=n.upcastAlso?n.upcastAlso[e]:void 0;yield*fs(t,s,i)}else yield*fs(n.model,n.view,n.upcastAlso)}function*fs(n,e,t){if(yield{model:n,view:e},t)for(const s of ie(t))yield{model:n,view:s}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class W{constructor(e){this.baseVersion=e,this.isDocumentOperation=this.baseVersion!==null,this.batch=null}_validate(){}toJSON(){const e=Object.assign({},this);return e.__className=this.constructor.className,delete e.batch,delete e.isDocumentOperation,e}static get className(){return"Operation"}static fromJSON(e,t){return new this(e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Bt(n,e){const t=fn(e),s=t.reduce((o,a)=>o+a.offsetSize,0),i=n.parent;ze(n);const r=n.index;return i._insertChild(r,t),Ue(i,r+t.length),Ue(i,r),new u(n,n.getShiftedBy(s))}function un(n){if(!n.isFlat)throw new f("operation-utils-remove-range-not-flat",this);const e=n.start.parent;ze(n.start),ze(n.end);const t=e._removeChildren(n.start.index,n.end.index-n.start.index);return Ue(e,n.start.index),t}function qe(n,e){if(!n.isFlat)throw new f("operation-utils-move-range-not-flat",this);const t=un(n);return e=e._getTransformedByDeletion(n.start,n.end.offset-n.start.offset),Bt(e,t)}function po(n,e,t){ze(n.start),ze(n.end);for(const s of n.getItems({shallow:!0})){const i=s.is("$textProxy")?s.textNode:s;t!==null?i._setAttribute(e,t):i._removeAttribute(e),Ue(i.parent,i.index)}Ue(n.end.parent,n.end.index)}function fn(n){const e=[];function t(s){if(typeof s=="string")e.push(new C(s));else if(s instanceof J)e.push(new C(s.data,s.getAttributes()));else if(s instanceof be)e.push(s);else if(re(s))for(const i of s)t(i)}t(n);for(let s=1;s<e.length;s++){const i=e[s],r=e[s-1];i instanceof C&&r instanceof C&&dn(i,r)&&(e.splice(s-1,2,new C(r.data+i.data,r.getAttributes())),s--)}return e}function Ue(n,e){const t=n.getChild(e-1),s=n.getChild(e);if(t&&s&&t.is("$text")&&s.is("$text")&&dn(t,s)){const i=new C(t.data+s.data,t.getAttributes());n._removeChildren(e-1,2),n._insertChild(e-1,i)}}function ze(n){const e=n.textNode,t=n.parent;if(e){const s=n.offset-e.startOffset,i=e.index;t._removeChildren(i,1);const r=new C(e.data.substr(0,s),e.getAttributes()),o=new C(e.data.substr(s),e.getAttributes());t._insertChild(i,[r,o])}}function dn(n,e){const t=n.getAttributes(),s=e.getAttributes();for(const i of t){if(i[1]!==e.getAttribute(i[0]))return!1;s.next()}return s.next().done}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class b extends W{constructor(e,t,s,i){super(i),this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toNext",this.howMany=t,this.targetPosition=s.clone(),this.targetPosition.stickiness="toNone"}get type(){return this.targetPosition.root.rootName=="$graveyard"?"remove":this.sourcePosition.root.rootName=="$graveyard"?"reinsert":"move"}get affectedSelectable(){return[u._createFromPositionAndShift(this.sourcePosition,this.howMany),u._createFromPositionAndShift(this.targetPosition,0)]}clone(){return new b(this.sourcePosition,this.howMany,this.targetPosition,this.baseVersion)}getMovedRangeStart(){return this.targetPosition._getTransformedByDeletion(this.sourcePosition,this.howMany)}getReversed(){const e=this.sourcePosition._getTransformedByInsertion(this.targetPosition,this.howMany);return new b(this.getMovedRangeStart(),this.howMany,e,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent,s=this.sourcePosition.offset,i=this.targetPosition.offset;if(s+this.howMany>e.maxOffset)throw new f("move-operation-nodes-do-not-exist",this);if(e===t&&s<i&&i<s+this.howMany)throw new f("move-operation-range-into-itself",this);if(this.sourcePosition.root==this.targetPosition.root&&O(this.sourcePosition.getParentPath(),this.targetPosition.getParentPath())=="prefix"){const r=this.sourcePosition.path.length-1;if(this.targetPosition.path[r]>=s&&this.targetPosition.path[r]<s+this.howMany)throw new f("move-operation-node-into-itself",this)}}_execute(){qe(u._createFromPositionAndShift(this.sourcePosition,this.howMany),this.targetPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e.targetPosition=this.targetPosition.toJSON(),e}static get className(){return"MoveOperation"}static fromJSON(e,t){const s=m.fromJSON(e.sourcePosition,t),i=m.fromJSON(e.targetPosition,t);return new this(s,e.howMany,i,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class M extends W{constructor(e,t,s){super(s),this.position=e.clone(),this.position.stickiness="toNone",this.nodes=new Ie(fn(t)),this.shouldReceiveAttributes=!1}get type(){return"insert"}get howMany(){return this.nodes.maxOffset}get affectedSelectable(){return this.position.clone()}clone(){const e=new Ie([...this.nodes].map(s=>s._clone(!0))),t=new M(this.position,e,this.baseVersion);return t.shouldReceiveAttributes=this.shouldReceiveAttributes,t}getReversed(){const e=this.position.root.document.graveyard,t=new m(e,[0]);return new b(this.position,this.nodes.maxOffset,t,this.baseVersion+1)}_validate(){const e=this.position.parent;if(!e||e.maxOffset<this.position.offset)throw new f("insert-operation-position-invalid",this)}_execute(){const e=this.nodes;this.nodes=new Ie([...e].map(t=>t._clone(!0))),Bt(this.position,e)}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e.nodes=this.nodes.toJSON(),e}static get className(){return"InsertOperation"}static fromJSON(e,t){const s=[];for(const r of e.nodes)r.name?s.push(P.fromJSON(r)):s.push(C.fromJSON(r));const i=new M(m.fromJSON(e.position,t),s,e.baseVersion);return i.shouldReceiveAttributes=e.shouldReceiveAttributes,i}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class k extends W{constructor(e,t,s,i,r){super(r),this.splitPosition=e.clone(),this.splitPosition.stickiness="toNext",this.howMany=t,this.insertionPosition=s,this.graveyardPosition=i?i.clone():null,this.graveyardPosition&&(this.graveyardPosition.stickiness="toNext")}get type(){return"split"}get moveTargetPosition(){const e=this.insertionPosition.path.slice();return e.push(0),new m(this.insertionPosition.root,e)}get movedRange(){const e=this.splitPosition.getShiftedBy(Number.POSITIVE_INFINITY);return new u(this.splitPosition,e)}get affectedSelectable(){const e=[u._createFromPositionAndShift(this.splitPosition,0),u._createFromPositionAndShift(this.insertionPosition,0)];return this.graveyardPosition&&e.push(u._createFromPositionAndShift(this.graveyardPosition,0)),e}clone(){return new k(this.splitPosition,this.howMany,this.insertionPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.splitPosition.root.document.graveyard,t=new m(e,[0]);return new S(this.moveTargetPosition,this.howMany,this.splitPosition,t,this.baseVersion+1)}_validate(){const e=this.splitPosition.parent,t=this.splitPosition.offset;if(!e||e.maxOffset<t)throw new f("split-operation-position-invalid",this);if(e.parent){if(this.howMany!=e.maxOffset-this.splitPosition.offset)throw new f("split-operation-how-many-invalid",this);if(this.graveyardPosition&&!this.graveyardPosition.nodeAfter)throw new f("split-operation-graveyard-position-invalid",this)}else throw new f("split-operation-split-in-root",this)}_execute(){const e=this.splitPosition.parent;if(this.graveyardPosition)qe(u._createFromPositionAndShift(this.graveyardPosition,1),this.insertionPosition);else{const s=e._clone();Bt(this.insertionPosition,s)}const t=new u(m._createAt(e,this.splitPosition.offset),m._createAt(e,e.maxOffset));qe(t,this.moveTargetPosition)}toJSON(){const e=super.toJSON();return e.splitPosition=this.splitPosition.toJSON(),e.insertionPosition=this.insertionPosition.toJSON(),this.graveyardPosition&&(e.graveyardPosition=this.graveyardPosition.toJSON()),e}static get className(){return"SplitOperation"}static getInsertionPosition(e){const t=e.path.slice(0,-1);return t[t.length-1]++,new m(e.root,t,"toPrevious")}static fromJSON(e,t){const s=m.fromJSON(e.splitPosition,t),i=m.fromJSON(e.insertionPosition,t),r=e.graveyardPosition?m.fromJSON(e.graveyardPosition,t):null;return new this(s,e.howMany,i,r,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class S extends W{constructor(e,t,s,i,r){super(r),this.sourcePosition=e.clone(),this.sourcePosition.stickiness="toPrevious",this.howMany=t,this.targetPosition=s.clone(),this.targetPosition.stickiness="toNext",this.graveyardPosition=i.clone()}get type(){return"merge"}get deletionPosition(){return new m(this.sourcePosition.root,this.sourcePosition.path.slice(0,-1))}get movedRange(){const e=this.sourcePosition.getShiftedBy(Number.POSITIVE_INFINITY);return new u(this.sourcePosition,e)}get affectedSelectable(){const e=this.sourcePosition.parent;return[u._createOn(e),u._createFromPositionAndShift(this.targetPosition,0),u._createFromPositionAndShift(this.graveyardPosition,0)]}clone(){return new S(this.sourcePosition,this.howMany,this.targetPosition,this.graveyardPosition,this.baseVersion)}getReversed(){const e=this.targetPosition._getTransformedByMergeOperation(this),t=this.sourcePosition.path.slice(0,-1),s=new m(this.sourcePosition.root,t)._getTransformedByMergeOperation(this);return new k(e,this.howMany,s,this.graveyardPosition,this.baseVersion+1)}_validate(){const e=this.sourcePosition.parent,t=this.targetPosition.parent;if(e.parent)if(t.parent){if(this.howMany!=e.maxOffset)throw new f("merge-operation-how-many-invalid",this)}else throw new f("merge-operation-target-position-invalid",this);else throw new f("merge-operation-source-position-invalid",this)}_execute(){const e=this.sourcePosition.parent,t=u._createIn(e);qe(t,this.targetPosition),qe(u._createOn(e),this.graveyardPosition)}toJSON(){const e=super.toJSON();return e.sourcePosition=e.sourcePosition.toJSON(),e.targetPosition=e.targetPosition.toJSON(),e.graveyardPosition=e.graveyardPosition.toJSON(),e}static get className(){return"MergeOperation"}static fromJSON(e,t){const s=m.fromJSON(e.sourcePosition,t),i=m.fromJSON(e.targetPosition,t),r=m.fromJSON(e.graveyardPosition,t);return new this(s,e.howMany,i,r,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class F extends W{constructor(e,t,s,i,r,o){super(o),this.name=e,this.oldRange=t?t.clone():null,this.newRange=s?s.clone():null,this.affectsData=r,this._markers=i}get type(){return"marker"}get affectedSelectable(){const e=[];return this.oldRange&&e.push(this.oldRange.clone()),this.newRange&&(this.oldRange?e.push(...this.newRange.getDifference(this.oldRange)):e.push(this.newRange.clone())),e}clone(){return new F(this.name,this.oldRange,this.newRange,this._markers,this.affectsData,this.baseVersion)}getReversed(){return new F(this.name,this.newRange,this.oldRange,this._markers,this.affectsData,this.baseVersion+1)}_execute(){this.newRange?this._markers._set(this.name,this.newRange,!0,this.affectsData):this._markers._remove(this.name)}toJSON(){const e=super.toJSON();return this.oldRange&&(e.oldRange=this.oldRange.toJSON()),this.newRange&&(e.newRange=this.newRange.toJSON()),delete e._markers,e}static get className(){return"MarkerOperation"}static fromJSON(e,t){return new F(e.name,e.oldRange?u.fromJSON(e.oldRange,t):null,e.newRange?u.fromJSON(e.newRange,t):null,t.model.markers,e.affectsData,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class E extends W{constructor(e,t,s,i,r){super(r),this.range=e.clone(),this.key=t,this.oldValue=s===void 0?null:s,this.newValue=i===void 0?null:i}get type(){return this.oldValue===null?"addAttribute":this.newValue===null?"removeAttribute":"changeAttribute"}get affectedSelectable(){return this.range.clone()}clone(){return new E(this.range,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new E(this.range,this.key,this.newValue,this.oldValue,this.baseVersion+1)}toJSON(){const e=super.toJSON();return e.range=this.range.toJSON(),e}_validate(){if(!this.range.isFlat)throw new f("attribute-operation-range-not-flat",this);for(const e of this.range.getItems({shallow:!0})){if(this.oldValue!==null&&!Lt(e.getAttribute(this.key),this.oldValue))throw new f("attribute-operation-wrong-old-value",this,{item:e,key:this.key,value:this.oldValue});if(this.oldValue===null&&this.newValue!==null&&e.hasAttribute(this.key))throw new f("attribute-operation-attribute-exists",this,{node:e,key:this.key})}}_execute(){Lt(this.oldValue,this.newValue)||po(this.range,this.key,this.newValue)}static get className(){return"AttributeOperation"}static fromJSON(e,t){return new E(u.fromJSON(e.range,t),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class R extends W{get type(){return"noop"}get affectedSelectable(){return null}clone(){return new R(this.baseVersion)}getReversed(){return new R(this.baseVersion+1)}_execute(){}static get className(){return"NoOperation"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class B extends W{constructor(e,t,s,i){super(i),this.position=e,this.position.stickiness="toNext",this.oldName=t,this.newName=s}get type(){return"rename"}get affectedSelectable(){return this.position.nodeAfter}clone(){return new B(this.position.clone(),this.oldName,this.newName,this.baseVersion)}getReversed(){return new B(this.position.clone(),this.newName,this.oldName,this.baseVersion+1)}_validate(){const e=this.position.nodeAfter;if(e instanceof P){if(e.name!==this.oldName)throw new f("rename-operation-wrong-name",this)}else throw new f("rename-operation-wrong-position",this)}_execute(){const e=this.position.nodeAfter;e.name=this.newName}toJSON(){const e=super.toJSON();return e.position=this.position.toJSON(),e}static get className(){return"RenameOperation"}static fromJSON(e,t){return new B(m.fromJSON(e.position,t),e.oldName,e.newName,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Z extends W{constructor(e,t,s,i,r){super(r),this.root=e,this.key=t,this.oldValue=s===void 0?null:s,this.newValue=i===void 0?null:i}get type(){return this.oldValue===null?"addRootAttribute":this.newValue===null?"removeRootAttribute":"changeRootAttribute"}get affectedSelectable(){return this.root}clone(){return new Z(this.root,this.key,this.oldValue,this.newValue,this.baseVersion)}getReversed(){return new Z(this.root,this.key,this.newValue,this.oldValue,this.baseVersion+1)}_validate(){if(this.root!=this.root.root||this.root.is("documentFragment"))throw new f("rootattribute-operation-not-a-root",this,{root:this.root,key:this.key});if(this.oldValue!==null&&this.root.getAttribute(this.key)!==this.oldValue)throw new f("rootattribute-operation-wrong-old-value",this,{root:this.root,key:this.key});if(this.oldValue===null&&this.newValue!==null&&this.root.hasAttribute(this.key))throw new f("rootattribute-operation-attribute-exists",this,{root:this.root,key:this.key})}_execute(){this.newValue!==null?this.root._setAttribute(this.key,this.newValue):this.root._removeAttribute(this.key)}toJSON(){const e=super.toJSON();return e.root=this.root.toJSON(),e}static get className(){return"RootAttributeOperation"}static fromJSON(e,t){if(!t.getRoot(e.root))throw new f("rootattribute-operation-fromjson-no-root",this,{rootName:e.root});return new Z(t.getRoot(e.root),e.key,e.oldValue,e.newValue,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class j extends W{constructor(e,t,s,i,r){if(super(r),this.rootName=e,this.elementName=t,this.isAdd=s,this._document=i,!this._document.getRoot(this.rootName)){const o=this._document.createRoot(this.elementName,this.rootName);o._isAttached=!1}}get type(){return this.isAdd?"addRoot":"detachRoot"}get affectedSelectable(){return this._document.getRoot(this.rootName)}clone(){return new j(this.rootName,this.elementName,this.isAdd,this._document,this.baseVersion)}getReversed(){return new j(this.rootName,this.elementName,!this.isAdd,this._document,this.baseVersion+1)}_execute(){this._document.getRoot(this.rootName)._isAttached=this.isAdd}toJSON(){const e=super.toJSON();return delete e._document,e}static get className(){return"RootOperation"}static fromJSON(e,t){return new j(e.rootName,e.elementName,e.isAdd,t,e.baseVersion)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const U={};U[E.className]=E;U[M.className]=M;U[F.className]=F;U[b.className]=b;U[R.className]=R;U[W.className]=W;U[B.className]=B;U[Z.className]=Z;U[j.className]=j;U[k.className]=k;U[S.className]=S;class _o{static fromJSON(e,t){return U[e.__className].fromJSON(e,t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const At=new Map;function y(n,e,t){let s=At.get(n);s||(s=new Map,At.set(n,s)),s.set(e,t)}function wo(n,e){const t=At.get(n);return t&&t.has(e)?t.get(e):yo}function yo(n){return[n]}function ds(n,e,t={}){const s=wo(n.constructor,e.constructor);try{return n=n.clone(),s(n,e,t)}catch(i){throw i}}function La(n,e,t){n=n.slice(),e=e.slice();const s=new bo(t.document,t.useRelations,t.forceWeakRemove);s.setOriginalOperations(n),s.setOriginalOperations(e);const i=s.originalOperations;if(n.length==0||e.length==0)return{operationsA:n,operationsB:e,originalOperations:i};const r=new WeakMap;for(const l of n)r.set(l,0);const o={nextBaseVersionA:n[n.length-1].baseVersion+1,nextBaseVersionB:e[e.length-1].baseVersion+1,originalOperationsACount:n.length,originalOperationsBCount:e.length};let a=0;for(;a<n.length;){const l=n[a],c=r.get(l);if(c==e.length){a++;continue}const h=e[c],d=ds(l,h,s.getContext(l,h,!0)),_=ds(h,l,s.getContext(h,l,!1));s.updateRelation(l,h),s.setOriginalOperations(d,l),s.setOriginalOperations(_,h);for(const p of d)r.set(p,c+_.length);n.splice(a,1,...d),e.splice(c,1,..._)}if(t.padWithNoOps){const l=n.length-o.originalOperationsACount,c=e.length-o.originalOperationsBCount;gs(n,c-l),gs(e,l-c)}return ms(n,o.nextBaseVersionB),ms(e,o.nextBaseVersionA),{operationsA:n,operationsB:e,originalOperations:i}}class bo{constructor(e,t,s=!1){this.originalOperations=new Map,this._history=e.history,this._useRelations=t,this._forceWeakRemove=!!s,this._relations=new Map}setOriginalOperations(e,t=null){const s=t?this.originalOperations.get(t):null;for(const i of e)this.originalOperations.set(i,s||i)}updateRelation(e,t){if(e instanceof b)t instanceof S?e.targetPosition.isEqual(t.sourcePosition)||t.movedRange.containsPosition(e.targetPosition)?this._setRelation(e,t,"insertAtSource"):e.targetPosition.isEqual(t.deletionPosition)?this._setRelation(e,t,"insertBetween"):e.targetPosition.isAfter(t.sourcePosition)&&this._setRelation(e,t,"moveTargetAfter"):t instanceof b&&(e.targetPosition.isEqual(t.sourcePosition)||e.targetPosition.isBefore(t.sourcePosition)?this._setRelation(e,t,"insertBefore"):this._setRelation(e,t,"insertAfter"));else if(e instanceof k){if(t instanceof S)e.splitPosition.isBefore(t.sourcePosition)&&this._setRelation(e,t,"splitBefore");else if(t instanceof b)if(e.splitPosition.isEqual(t.sourcePosition)||e.splitPosition.isBefore(t.sourcePosition))this._setRelation(e,t,"splitBefore");else{const s=u._createFromPositionAndShift(t.sourcePosition,t.howMany);if(e.splitPosition.hasSameParentAs(t.sourcePosition)&&s.containsPosition(e.splitPosition)){const i=s.end.offset-e.splitPosition.offset,r=e.splitPosition.offset-s.start.offset;this._setRelation(e,t,{howMany:i,offset:r})}}}else if(e instanceof S)t instanceof S?(e.targetPosition.isEqual(t.sourcePosition)||this._setRelation(e,t,"mergeTargetNotMoved"),e.sourcePosition.isEqual(t.targetPosition)&&this._setRelation(e,t,"mergeSourceNotMoved"),e.sourcePosition.isEqual(t.sourcePosition)&&this._setRelation(e,t,"mergeSameElement")):t instanceof k&&e.sourcePosition.isEqual(t.splitPosition)&&this._setRelation(e,t,"splitAtSource");else if(e instanceof F){const s=e.newRange;if(!s)return;if(t instanceof b){const i=u._createFromPositionAndShift(t.sourcePosition,t.howMany),r=i.containsPosition(s.start)||i.start.isEqual(s.start),o=i.containsPosition(s.end)||i.end.isEqual(s.end);(r||o)&&!i.containsRange(s)&&this._setRelation(e,t,{side:r?"left":"right",path:r?s.start.path.slice():s.end.path.slice()})}else if(t instanceof S){const i=s.start.isEqual(t.targetPosition),r=s.start.isEqual(t.deletionPosition),o=s.end.isEqual(t.deletionPosition),a=s.end.isEqual(t.sourcePosition);(i||r||o||a)&&this._setRelation(e,t,{wasInLeftElement:i,wasStartBeforeMergedElement:r,wasEndBeforeMergedElement:o,wasInRightElement:a})}}}getContext(e,t,s){return{aIsStrong:s,aWasUndone:this._wasUndone(e),bWasUndone:this._wasUndone(t),abRelation:this._useRelations?this._getRelation(e,t):null,baRelation:this._useRelations?this._getRelation(t,e):null,forceWeakRemove:this._forceWeakRemove}}_wasUndone(e){const t=this.originalOperations.get(e);return t.wasUndone||this._history.isUndoneOperation(t)}_getRelation(e,t){const s=this.originalOperations.get(t),i=this._history.getUndoneOperation(s);if(!i)return null;const r=this.originalOperations.get(e),o=this._relations.get(r);return o&&o.get(i)||null}_setRelation(e,t,s){const i=this.originalOperations.get(e),r=this.originalOperations.get(t);let o=this._relations.get(i);o||(o=new Map,this._relations.set(i,o)),o.set(r,s)}}function ms(n,e){for(const t of n)t.baseVersion=e++}function gs(n,e){for(let t=0;t<e;t++)n.push(new R(0))}y(E,E,(n,e,t)=>{if(n.key===e.key&&n.range.start.hasSameParentAs(e.range.start)){const s=n.range.getDifference(e.range).map(r=>new E(r,n.key,n.oldValue,n.newValue,0)),i=n.range.getIntersection(e.range);return i&&t.aIsStrong&&s.push(new E(i,e.key,e.newValue,n.newValue,0)),s.length==0?[new R(0)]:s}else return[n]});y(E,M,(n,e)=>{if(n.range.start.hasSameParentAs(e.position)&&n.range.containsPosition(e.position)){const s=n.range._getTransformedByInsertion(e.position,e.howMany,!e.shouldReceiveAttributes).map(i=>new E(i,n.key,n.oldValue,n.newValue,n.baseVersion));if(e.shouldReceiveAttributes){const i=mn(e,n.key,n.oldValue);i&&s.unshift(i)}return s}return n.range=n.range._getTransformedByInsertion(e.position,e.howMany,!1)[0],[n]});function mn(n,e,t){const i=n.nodes.getNode(0).getAttribute(e);if(i==t)return null;const r=new u(n.position,n.position.getShiftedBy(n.howMany));return new E(r,e,i,t,0)}y(E,S,(n,e)=>{const t=[];n.range.start.hasSameParentAs(e.deletionPosition)&&(n.range.containsPosition(e.deletionPosition)||n.range.start.isEqual(e.deletionPosition))&&t.push(u._createFromPositionAndShift(e.graveyardPosition,1));const s=n.range._getTransformedByMergeOperation(e);return s.isCollapsed||t.push(s),t.map(i=>new E(i,n.key,n.oldValue,n.newValue,n.baseVersion))});y(E,b,(n,e)=>vo(n.range,e).map(s=>new E(s,n.key,n.oldValue,n.newValue,n.baseVersion)));function vo(n,e){const t=u._createFromPositionAndShift(e.sourcePosition,e.howMany);let s=null,i=[];t.containsRange(n,!0)?s=n:n.start.hasSameParentAs(t.start)?(i=n.getDifference(t),s=n.getIntersection(t)):i=[n];const r=[];for(let o of i){o=o._getTransformedByDeletion(e.sourcePosition,e.howMany);const a=e.getMovedRangeStart(),l=o.start.hasSameParentAs(a),c=o._getTransformedByInsertion(a,e.howMany,l);r.push(...c)}return s&&r.push(s._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany,!1)[0]),r}y(E,k,(n,e)=>{if(n.range.end.isEqual(e.insertionPosition))return e.graveyardPosition||n.range.end.offset++,[n];if(n.range.start.hasSameParentAs(e.splitPosition)&&n.range.containsPosition(e.splitPosition)){const t=n.clone();return t.range=new u(e.moveTargetPosition.clone(),n.range.end._getCombined(e.splitPosition,e.moveTargetPosition)),n.range.end=e.splitPosition.clone(),n.range.end.stickiness="toPrevious",[n,t]}return n.range=n.range._getTransformedBySplitOperation(e),[n]});y(M,E,(n,e)=>{const t=[n];if(n.shouldReceiveAttributes&&n.position.hasSameParentAs(e.range.start)&&e.range.containsPosition(n.position)){const s=mn(n,e.key,e.newValue);s&&t.push(s)}return t});y(M,M,(n,e,t)=>n.position.isEqual(e.position)&&t.aIsStrong?[n]:(n.position=n.position._getTransformedByInsertOperation(e),[n]));y(M,b,(n,e)=>(n.position=n.position._getTransformedByMoveOperation(e),[n]));y(M,k,(n,e)=>(n.position=n.position._getTransformedBySplitOperation(e),[n]));y(M,S,(n,e)=>(n.position=n.position._getTransformedByMergeOperation(e),[n]));y(F,M,(n,e)=>(n.oldRange&&(n.oldRange=n.oldRange._getTransformedByInsertOperation(e)[0]),n.newRange&&(n.newRange=n.newRange._getTransformedByInsertOperation(e)[0]),[n]));y(F,F,(n,e,t)=>{if(n.name==e.name)if(t.aIsStrong)n.oldRange=e.newRange?e.newRange.clone():null;else return[new R(0)];return[n]});y(F,S,(n,e)=>(n.oldRange&&(n.oldRange=n.oldRange._getTransformedByMergeOperation(e)),n.newRange&&(n.newRange=n.newRange._getTransformedByMergeOperation(e)),[n]));y(F,b,(n,e,t)=>{if(n.oldRange&&(n.oldRange=u._createFromRanges(n.oldRange._getTransformedByMoveOperation(e))),n.newRange){if(t.abRelation){const s=u._createFromRanges(n.newRange._getTransformedByMoveOperation(e));if(t.abRelation.side=="left"&&e.targetPosition.isEqual(n.newRange.start))return n.newRange.end=s.end,n.newRange.start.path=t.abRelation.path,[n];if(t.abRelation.side=="right"&&e.targetPosition.isEqual(n.newRange.end))return n.newRange.start=s.start,n.newRange.end.path=t.abRelation.path,[n]}n.newRange=u._createFromRanges(n.newRange._getTransformedByMoveOperation(e))}return[n]});y(F,k,(n,e,t)=>{if(n.oldRange&&(n.oldRange=n.oldRange._getTransformedBySplitOperation(e)),n.newRange){if(t.abRelation){const s=n.newRange._getTransformedBySplitOperation(e);return n.newRange.start.isEqual(e.splitPosition)&&t.abRelation.wasStartBeforeMergedElement?n.newRange.start=m._createAt(e.insertionPosition):n.newRange.start.isEqual(e.splitPosition)&&!t.abRelation.wasInLeftElement&&(n.newRange.start=m._createAt(e.moveTargetPosition)),n.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasInRightElement?n.newRange.end=m._createAt(e.moveTargetPosition):n.newRange.end.isEqual(e.splitPosition)&&t.abRelation.wasEndBeforeMergedElement?n.newRange.end=m._createAt(e.insertionPosition):n.newRange.end=s.end,[n]}n.newRange=n.newRange._getTransformedBySplitOperation(e)}return[n]});y(S,M,(n,e)=>(n.sourcePosition.hasSameParentAs(e.position)&&(n.howMany+=e.howMany),n.sourcePosition=n.sourcePosition._getTransformedByInsertOperation(e),n.targetPosition=n.targetPosition._getTransformedByInsertOperation(e),[n]));y(S,S,(n,e,t)=>{if(n.sourcePosition.isEqual(e.sourcePosition)&&n.targetPosition.isEqual(e.targetPosition))if(t.bWasUndone){const s=e.graveyardPosition.path.slice();return s.push(0),n.sourcePosition=new m(e.graveyardPosition.root,s),n.howMany=0,[n]}else return[new R(0)];if(n.sourcePosition.isEqual(e.sourcePosition)&&!n.targetPosition.isEqual(e.targetPosition)&&!t.bWasUndone&&t.abRelation!="splitAtSource"){const s=n.targetPosition.root.rootName=="$graveyard",i=e.targetPosition.root.rootName=="$graveyard";if(i&&!s||!(s&&!i)&&t.aIsStrong){const l=e.targetPosition._getTransformedByMergeOperation(e),c=n.targetPosition._getTransformedByMergeOperation(e);return[new b(l,n.howMany,c,0)]}else return[new R(0)]}return n.sourcePosition.hasSameParentAs(e.targetPosition)&&(n.howMany+=e.howMany),n.sourcePosition=n.sourcePosition._getTransformedByMergeOperation(e),n.targetPosition=n.targetPosition._getTransformedByMergeOperation(e),(!n.graveyardPosition.isEqual(e.graveyardPosition)||!t.aIsStrong)&&(n.graveyardPosition=n.graveyardPosition._getTransformedByMergeOperation(e)),[n]});y(S,b,(n,e,t)=>{const s=u._createFromPositionAndShift(e.sourcePosition,e.howMany);return e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&n.deletionPosition.hasSameParentAs(e.sourcePosition)&&s.containsPosition(n.sourcePosition)?[new R(0)]:(n.sourcePosition.hasSameParentAs(e.targetPosition)&&(n.howMany+=e.howMany),n.sourcePosition.hasSameParentAs(e.sourcePosition)&&(n.howMany-=e.howMany),n.sourcePosition=n.sourcePosition._getTransformedByMoveOperation(e),n.targetPosition=n.targetPosition._getTransformedByMoveOperation(e),n.graveyardPosition.isEqual(e.targetPosition)||(n.graveyardPosition=n.graveyardPosition._getTransformedByMoveOperation(e)),[n])});y(S,k,(n,e,t)=>{if(e.graveyardPosition&&(n.graveyardPosition=n.graveyardPosition._getTransformedByDeletion(e.graveyardPosition,1),n.deletionPosition.isEqual(e.graveyardPosition)&&(n.howMany=e.howMany)),n.targetPosition.isEqual(e.splitPosition)){const s=e.howMany!=0,i=e.graveyardPosition&&n.deletionPosition.isEqual(e.graveyardPosition);if(s||i||t.abRelation=="mergeTargetNotMoved")return n.sourcePosition=n.sourcePosition._getTransformedBySplitOperation(e),[n]}if(n.sourcePosition.isEqual(e.splitPosition)){if(t.abRelation=="mergeSourceNotMoved")return n.howMany=0,n.targetPosition=n.targetPosition._getTransformedBySplitOperation(e),[n];if(t.abRelation=="mergeSameElement"||n.sourcePosition.offset>0)return n.sourcePosition=e.moveTargetPosition.clone(),n.targetPosition=n.targetPosition._getTransformedBySplitOperation(e),[n]}return n.sourcePosition.hasSameParentAs(e.splitPosition)&&(n.howMany=e.splitPosition.offset),n.sourcePosition=n.sourcePosition._getTransformedBySplitOperation(e),n.targetPosition=n.targetPosition._getTransformedBySplitOperation(e),[n]});y(b,M,(n,e)=>{const s=u._createFromPositionAndShift(n.sourcePosition,n.howMany)._getTransformedByInsertOperation(e,!1)[0];return n.sourcePosition=s.start,n.howMany=s.end.offset-s.start.offset,n.targetPosition.isEqual(e.position)||(n.targetPosition=n.targetPosition._getTransformedByInsertOperation(e)),[n]});y(b,b,(n,e,t)=>{const s=u._createFromPositionAndShift(n.sourcePosition,n.howMany),i=u._createFromPositionAndShift(e.sourcePosition,e.howMany);let r=t.aIsStrong,o=!t.aIsStrong;t.abRelation=="insertBefore"||t.baRelation=="insertAfter"?o=!0:(t.abRelation=="insertAfter"||t.baRelation=="insertBefore")&&(o=!1);let a;if(n.targetPosition.isEqual(e.targetPosition)&&o?a=n.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany):a=n.targetPosition._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),ps(n,e)&&ps(e,n))return[e.getReversed()];if(s.containsPosition(e.targetPosition)&&s.containsRange(i,!0))return s.start=s.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),s.end=s.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),ke([s],a);if(i.containsPosition(n.targetPosition)&&i.containsRange(s,!0))return s.start=s.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),s.end=s.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),ke([s],a);const h=O(n.sourcePosition.getParentPath(),e.sourcePosition.getParentPath());if(h=="prefix"||h=="extension")return s.start=s.start._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),s.end=s.end._getTransformedByMove(e.sourcePosition,e.targetPosition,e.howMany),ke([s],a);n.type=="remove"&&e.type!="remove"&&!t.aWasUndone&&!t.forceWeakRemove?r=!0:n.type!="remove"&&e.type=="remove"&&!t.bWasUndone&&!t.forceWeakRemove&&(r=!1);const d=[],_=s.getDifference(i);for(const v of _){v.start=v.start._getTransformedByDeletion(e.sourcePosition,e.howMany),v.end=v.end._getTransformedByDeletion(e.sourcePosition,e.howMany);const D=O(v.start.getParentPath(),e.getMovedRangeStart().getParentPath())=="same",le=v._getTransformedByInsertion(e.getMovedRangeStart(),e.howMany,D);d.push(...le)}const p=s.getIntersection(i);return p!==null&&r&&(p.start=p.start._getCombined(e.sourcePosition,e.getMovedRangeStart()),p.end=p.end._getCombined(e.sourcePosition,e.getMovedRangeStart()),d.length===0?d.push(p):d.length==1?i.start.isBefore(s.start)||i.start.isEqual(s.start)?d.unshift(p):d.push(p):d.splice(1,0,p)),d.length===0?[new R(n.baseVersion)]:ke(d,a)});y(b,k,(n,e,t)=>{let s=n.targetPosition.clone();(!n.targetPosition.isEqual(e.insertionPosition)||!e.graveyardPosition||t.abRelation=="moveTargetAfter")&&(s=n.targetPosition._getTransformedBySplitOperation(e));const i=u._createFromPositionAndShift(n.sourcePosition,n.howMany);if(i.end.isEqual(e.insertionPosition))return e.graveyardPosition||n.howMany++,n.targetPosition=s,[n];if(i.start.hasSameParentAs(e.splitPosition)&&i.containsPosition(e.splitPosition)){let a=new u(e.splitPosition,i.end);a=a._getTransformedBySplitOperation(e);const l=[new u(i.start,e.splitPosition),a];return ke(l,s)}n.targetPosition.isEqual(e.splitPosition)&&t.abRelation=="insertAtSource"&&(s=e.moveTargetPosition),n.targetPosition.isEqual(e.insertionPosition)&&t.abRelation=="insertBetween"&&(s=n.targetPosition);const o=[i._getTransformedBySplitOperation(e)];if(e.graveyardPosition){const a=i.start.isEqual(e.graveyardPosition)||i.containsPosition(e.graveyardPosition);n.howMany>1&&a&&!t.aWasUndone&&o.push(u._createFromPositionAndShift(e.insertionPosition,1))}return ke(o,s)});y(b,S,(n,e,t)=>{const s=u._createFromPositionAndShift(n.sourcePosition,n.howMany);if(e.deletionPosition.hasSameParentAs(n.sourcePosition)&&s.containsPosition(e.sourcePosition)){if(n.type=="remove"&&!t.forceWeakRemove){if(!t.aWasUndone){const o=[];let a=e.graveyardPosition.clone(),l=e.targetPosition._getTransformedByMergeOperation(e);n.howMany>1&&(o.push(new b(n.sourcePosition,n.howMany-1,n.targetPosition,0)),a=a._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany-1),l=l._getTransformedByMove(n.sourcePosition,n.targetPosition,n.howMany-1));const c=e.deletionPosition._getCombined(n.sourcePosition,n.targetPosition),h=new b(a,1,c,0),d=h.getMovedRangeStart().path.slice();d.push(0);const _=new m(h.targetPosition.root,d);l=l._getTransformedByMove(a,c,1);const p=new b(l,e.howMany,_,0);return o.push(h),o.push(p),o}}else if(n.howMany==1)return t.bWasUndone?(n.sourcePosition=e.graveyardPosition.clone(),n.targetPosition=n.targetPosition._getTransformedByMergeOperation(e),[n]):[new R(0)]}const r=u._createFromPositionAndShift(n.sourcePosition,n.howMany)._getTransformedByMergeOperation(e);return n.sourcePosition=r.start,n.howMany=r.end.offset-r.start.offset,n.targetPosition=n.targetPosition._getTransformedByMergeOperation(e),[n]});y(B,M,(n,e)=>(n.position=n.position._getTransformedByInsertOperation(e),[n]));y(B,S,(n,e)=>n.position.isEqual(e.deletionPosition)?(n.position=e.graveyardPosition.clone(),n.position.stickiness="toNext",[n]):(n.position=n.position._getTransformedByMergeOperation(e),[n]));y(B,b,(n,e)=>(n.position=n.position._getTransformedByMoveOperation(e),[n]));y(B,B,(n,e,t)=>{if(n.position.isEqual(e.position))if(t.aIsStrong)n.oldName=e.newName;else return[new R(0)];return[n]});y(B,k,(n,e)=>{const t=n.position.path,s=e.splitPosition.getParentPath();if(O(t,s)=="same"&&!e.graveyardPosition){const i=new B(n.position.getShiftedBy(1),n.oldName,n.newName,0);return[n,i]}return n.position=n.position._getTransformedBySplitOperation(e),[n]});y(Z,Z,(n,e,t)=>{if(n.root===e.root&&n.key===e.key){if(!t.aIsStrong||n.newValue===e.newValue)return[new R(0)];n.oldValue=e.newValue}return[n]});y(j,j,(n,e)=>n.rootName===e.rootName&&n.isAdd===e.isAdd?[new R(0)]:[n]);y(k,M,(n,e)=>(n.splitPosition.hasSameParentAs(e.position)&&n.splitPosition.offset<e.position.offset&&(n.howMany+=e.howMany),n.splitPosition=n.splitPosition._getTransformedByInsertOperation(e),n.insertionPosition=n.insertionPosition._getTransformedByInsertOperation(e),[n]));y(k,S,(n,e,t)=>{if(!n.graveyardPosition&&!t.bWasUndone&&n.splitPosition.hasSameParentAs(e.sourcePosition)){const s=e.graveyardPosition.path.slice();s.push(0);const i=new m(e.graveyardPosition.root,s),r=k.getInsertionPosition(new m(e.graveyardPosition.root,s)),o=new k(i,0,r,null,0);return n.splitPosition=n.splitPosition._getTransformedByMergeOperation(e),n.insertionPosition=k.getInsertionPosition(n.splitPosition),n.graveyardPosition=o.insertionPosition.clone(),n.graveyardPosition.stickiness="toNext",[o,n]}return n.splitPosition.hasSameParentAs(e.deletionPosition)&&!n.splitPosition.isAfter(e.deletionPosition)&&n.howMany--,n.splitPosition.hasSameParentAs(e.targetPosition)&&(n.howMany+=e.howMany),n.splitPosition=n.splitPosition._getTransformedByMergeOperation(e),n.insertionPosition=k.getInsertionPosition(n.splitPosition),n.graveyardPosition&&(n.graveyardPosition=n.graveyardPosition._getTransformedByMergeOperation(e)),[n]});y(k,b,(n,e,t)=>{const s=u._createFromPositionAndShift(e.sourcePosition,e.howMany);if(n.graveyardPosition){const r=s.start.isEqual(n.graveyardPosition)||s.containsPosition(n.graveyardPosition);if(!t.bWasUndone&&r){const o=n.splitPosition._getTransformedByMoveOperation(e),a=n.graveyardPosition._getTransformedByMoveOperation(e),l=a.path.slice();l.push(0);const c=new m(a.root,l);return[new b(o,n.howMany,c,0)]}n.graveyardPosition=n.graveyardPosition._getTransformedByMoveOperation(e)}const i=n.splitPosition.isEqual(e.targetPosition);if(i&&(t.baRelation=="insertAtSource"||t.abRelation=="splitBefore"))return n.howMany+=e.howMany,n.splitPosition=n.splitPosition._getTransformedByDeletion(e.sourcePosition,e.howMany),n.insertionPosition=k.getInsertionPosition(n.splitPosition),[n];if(i&&t.abRelation&&t.abRelation.howMany){const{howMany:r,offset:o}=t.abRelation;return n.howMany+=r,n.splitPosition=n.splitPosition.getShiftedBy(o),[n]}if(n.splitPosition.hasSameParentAs(e.sourcePosition)&&s.containsPosition(n.splitPosition)){const r=e.howMany-(n.splitPosition.offset-e.sourcePosition.offset);return n.howMany-=r,n.splitPosition.hasSameParentAs(e.targetPosition)&&n.splitPosition.offset<e.targetPosition.offset&&(n.howMany+=e.howMany),n.splitPosition=e.sourcePosition.clone(),n.insertionPosition=k.getInsertionPosition(n.splitPosition),[n]}return e.sourcePosition.isEqual(e.targetPosition)||(n.splitPosition.hasSameParentAs(e.sourcePosition)&&n.splitPosition.offset<=e.sourcePosition.offset&&(n.howMany-=e.howMany),n.splitPosition.hasSameParentAs(e.targetPosition)&&n.splitPosition.offset<e.targetPosition.offset&&(n.howMany+=e.howMany)),n.splitPosition.stickiness="toNone",n.splitPosition=n.splitPosition._getTransformedByMoveOperation(e),n.splitPosition.stickiness="toNext",n.graveyardPosition?n.insertionPosition=n.insertionPosition._getTransformedByMoveOperation(e):n.insertionPosition=k.getInsertionPosition(n.splitPosition),[n]});y(k,k,(n,e,t)=>{if(n.splitPosition.isEqual(e.splitPosition)){if(!n.graveyardPosition&&!e.graveyardPosition)return[new R(0)];if(n.graveyardPosition&&e.graveyardPosition&&n.graveyardPosition.isEqual(e.graveyardPosition))return[new R(0)];if(t.abRelation=="splitBefore")return n.howMany=0,n.graveyardPosition=n.graveyardPosition._getTransformedBySplitOperation(e),[n]}if(n.graveyardPosition&&e.graveyardPosition&&n.graveyardPosition.isEqual(e.graveyardPosition)){const s=n.splitPosition.root.rootName=="$graveyard",i=e.splitPosition.root.rootName=="$graveyard";if(i&&!s||!(s&&!i)&&t.aIsStrong){const l=[];return e.howMany&&l.push(new b(e.moveTargetPosition,e.howMany,e.splitPosition,0)),n.howMany&&l.push(new b(n.splitPosition,n.howMany,n.moveTargetPosition,0)),l}else return[new R(0)]}if(n.graveyardPosition&&(n.graveyardPosition=n.graveyardPosition._getTransformedBySplitOperation(e)),n.splitPosition.isEqual(e.insertionPosition)&&t.abRelation=="splitBefore")return n.howMany++,[n];if(e.splitPosition.isEqual(n.insertionPosition)&&t.baRelation=="splitBefore"){const s=e.insertionPosition.path.slice();s.push(0);const i=new m(e.insertionPosition.root,s),r=new b(n.insertionPosition,1,i,0);return[n,r]}return n.splitPosition.hasSameParentAs(e.splitPosition)&&n.splitPosition.offset<e.splitPosition.offset&&(n.howMany-=e.howMany),n.splitPosition=n.splitPosition._getTransformedBySplitOperation(e),n.insertionPosition=k.getInsertionPosition(n.splitPosition),[n]});function ps(n,e){return n.targetPosition._getTransformedByDeletion(e.sourcePosition,e.howMany)===null}function ke(n,e){const t=[];for(let s=0;s<n.length;s++){const i=n[s],r=new b(i.start,i.end.offset-i.start.offset,e,0);t.push(r);for(let o=s+1;o<n.length;o++)n[o]=n[o]._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)[0];e=e._getTransformedByMove(r.sourcePosition,r.targetPosition,r.howMany)}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class I extends N(m){constructor(e,t,s="toNone"){if(super(e,t,s),!this.root.is("rootElement"))throw new f("model-liveposition-root-not-rootelement",e);Po.call(this)}detach(){this.stopListening()}toPosition(){return new m(this.root,this.path.slice(),this.stickiness)}static fromPosition(e,t){return new this(e.root,e.path.slice(),t||e.stickiness)}}I.prototype.is=function(n){return n==="livePosition"||n==="model:livePosition"||n=="position"||n==="model:position"};function Po(){this.listenTo(this.root.document.model,"applyOperation",(n,e)=>{const t=e[0];t.isDocumentOperation&&Co.call(this,t)},{priority:"low"})}function Co(n){const e=this.getTransformedByOperation(n);if(!this.isEqual(e)){const t=this.toPosition();this.path=e.path,this.root=e.root,this.fire("change",t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pe{constructor(e={}){typeof e=="string"&&(e=e==="transparent"?{isUndoable:!1}:{},L("batch-constructor-deprecated-string-type"));const{isUndoable:t=!0,isLocal:s=!0,isUndo:i=!1,isTyping:r=!1}=e;this.operations=[],this.isUndoable=t,this.isLocal=s,this.isUndo=i,this.isTyping=r}get type(){return L("batch-type-deprecated"),"default"}get baseVersion(){for(const e of this.operations)if(e.baseVersion!==null)return e.baseVersion;return null}addOperation(e){return e.batch=this,this.operations.push(e),e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ko{constructor(e){this._changesInElement=new Map,this._elementSnapshots=new Map,this._changedMarkers=new Map,this._changedRoots=new Map,this._changeCount=0,this._cachedChanges=null,this._cachedChangesWithGraveyard=null,this._refreshedItems=new Set,this._markerCollection=e}get isEmpty(){return this._changesInElement.size==0&&this._changedMarkers.size==0&&this._changedRoots.size==0}bufferOperation(e){const t=e;switch(t.type){case"insert":{if(this._isInInsertedElement(t.position.parent))return;this._markInsert(t.position.parent,t.position.offset,t.nodes.maxOffset);break}case"addAttribute":case"removeAttribute":case"changeAttribute":{for(const s of t.range.getItems({shallow:!0}))this._isInInsertedElement(s.parent)||this._markAttribute(s);break}case"remove":case"move":case"reinsert":{if(t.sourcePosition.isEqual(t.targetPosition)||t.sourcePosition.getShiftedBy(t.howMany).isEqual(t.targetPosition))return;const s=this._isInInsertedElement(t.sourcePosition.parent),i=this._isInInsertedElement(t.targetPosition.parent);s||this._markRemove(t.sourcePosition.parent,t.sourcePosition.offset,t.howMany),i||this._markInsert(t.targetPosition.parent,t.getMovedRangeStart().offset,t.howMany);break}case"rename":{if(this._isInInsertedElement(t.position.parent))return;this._markRemove(t.position.parent,t.position.offset,1),this._markInsert(t.position.parent,t.position.offset,1);const s=u._createFromPositionAndShift(t.position,1);for(const i of this._markerCollection.getMarkersIntersectingRange(s)){const r=i.getData();this.bufferMarkerChange(i.name,r,r)}break}case"split":{const s=t.splitPosition.parent;this._isInInsertedElement(s)||this._markRemove(s,t.splitPosition.offset,t.howMany),this._isInInsertedElement(t.insertionPosition.parent)||this._markInsert(t.insertionPosition.parent,t.insertionPosition.offset,1),t.graveyardPosition&&this._markRemove(t.graveyardPosition.parent,t.graveyardPosition.offset,1);break}case"merge":{const s=t.sourcePosition.parent;this._isInInsertedElement(s.parent)||this._markRemove(s.parent,s.startOffset,1);const i=t.graveyardPosition.parent;this._markInsert(i,t.graveyardPosition.offset,1);const r=t.targetPosition.parent;this._isInInsertedElement(r)||this._markInsert(r,t.targetPosition.offset,s.maxOffset);break}case"detachRoot":case"addRoot":{const s=t.affectedSelectable;if(!s._isLoaded||s.isAttached()==t.isAdd)return;this._bufferRootStateChange(t.rootName,t.isAdd);break}case"addRootAttribute":case"removeRootAttribute":case"changeRootAttribute":{if(!t.root._isLoaded)return;const s=t.root.rootName;this._bufferRootAttributeChange(s,t.key,t.oldValue,t.newValue);break}}this._cachedChanges=null}bufferMarkerChange(e,t,s){t.range&&t.range.root.is("rootElement")&&!t.range.root._isLoaded&&(t.range=null),s.range&&s.range.root.is("rootElement")&&!s.range.root._isLoaded&&(s.range=null);let i=this._changedMarkers.get(e);i?i.newMarkerData=s:(i={newMarkerData:s,oldMarkerData:t},this._changedMarkers.set(e,i)),i.oldMarkerData.range==null&&s.range==null&&this._changedMarkers.delete(e)}getMarkersToRemove(){const e=[];for(const[t,s]of this._changedMarkers)s.oldMarkerData.range!=null&&e.push({name:t,range:s.oldMarkerData.range});return e}getMarkersToAdd(){const e=[];for(const[t,s]of this._changedMarkers)s.newMarkerData.range!=null&&e.push({name:t,range:s.newMarkerData.range});return e}getChangedMarkers(){return Array.from(this._changedMarkers).map(([e,t])=>({name:e,data:{oldRange:t.oldMarkerData.range,newRange:t.newMarkerData.range}}))}hasDataChanges(){if(this._changesInElement.size>0||this._changedRoots.size>0)return!0;for(const{newMarkerData:e,oldMarkerData:t}of this._changedMarkers.values()){if(e.affectsData!==t.affectsData)return!0;if(e.affectsData){const s=e.range&&!t.range,i=!e.range&&t.range,r=e.range&&t.range&&!e.range.isEqual(t.range);if(s||i||r)return!0}}return!1}getChanges(e={}){if(this._cachedChanges)return e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice();let t=[];for(const s of this._changesInElement.keys()){const i=this._changesInElement.get(s).sort((h,d)=>h.offset===d.offset?h.type!=d.type?h.type=="remove"?-1:1:0:h.offset<d.offset?-1:1),r=this._elementSnapshots.get(s),o=_s(s.getChildren()),a=Ao(r.length,i);let l=0,c=0;for(const h of a)if(h==="i")t.push(this._getInsertDiff(s,l,o[l])),l++;else if(h==="r")t.push(this._getRemoveDiff(s,l,r[c])),c++;else if(h==="a"){const d=o[l].attributes,_=r[c].attributes;let p;if(o[l].name=="$text")p=new u(m._createAt(s,l),m._createAt(s,l+1));else{const v=s.offsetToIndex(l);p=new u(m._createAt(s,l),m._createAt(s.getChild(v),0))}t.push(...this._getAttributesDiff(p,_,d)),l++,c++}else l++,c++}t.sort((s,i)=>s.position.root!=i.position.root?s.position.root.rootName<i.position.root.rootName?-1:1:s.position.isEqual(i.position)?s.changeCount-i.changeCount:s.position.isBefore(i.position)?-1:1);for(let s=1,i=0;s<t.length;s++){const r=t[i],o=t[s],a=r.type=="remove"&&o.type=="remove"&&r.name=="$text"&&o.name=="$text"&&r.position.isEqual(o.position),l=r.type=="insert"&&o.type=="insert"&&r.name=="$text"&&o.name=="$text"&&r.position.parent==o.position.parent&&r.position.offset+r.length==o.position.offset,c=r.type=="attribute"&&o.type=="attribute"&&r.position.parent==o.position.parent&&r.range.isFlat&&o.range.isFlat&&r.position.offset+r.length==o.position.offset&&r.attributeKey==o.attributeKey&&r.attributeOldValue==o.attributeOldValue&&r.attributeNewValue==o.attributeNewValue;a||l||c?(r.length++,c&&(r.range.end=r.range.end.getShiftedBy(1)),t[s]=null):i=s}t=t.filter(s=>s);for(const s of t)delete s.changeCount,s.type=="attribute"&&(delete s.position,delete s.length);return this._changeCount=0,this._cachedChangesWithGraveyard=t,this._cachedChanges=t.filter(So),e.includeChangesInGraveyard?this._cachedChangesWithGraveyard.slice():this._cachedChanges.slice()}getChangedRoots(){return Array.from(this._changedRoots.values()).map(e=>{const t={...e};return t.state!==void 0&&delete t.attributes,t})}getRefreshedItems(){return new Set(this._refreshedItems)}reset(){this._changesInElement.clear(),this._elementSnapshots.clear(),this._changedMarkers.clear(),this._changedRoots.clear(),this._refreshedItems=new Set,this._cachedChanges=null}_bufferRootStateChange(e,t){if(!this._changedRoots.has(e)){this._changedRoots.set(e,{name:e,state:t?"attached":"detached"});return}const s=this._changedRoots.get(e);s.state!==void 0?(delete s.state,s.attributes===void 0&&this._changedRoots.delete(e)):s.state=t?"attached":"detached"}_bufferRootAttributeChange(e,t,s,i){const r=this._changedRoots.get(e)||{name:e},o=r.attributes||{};if(o[t]){const a=o[t];i===a.oldValue?delete o[t]:a.newValue=i}else o[t]={oldValue:s,newValue:i};Object.entries(o).length===0?(delete r.attributes,r.state===void 0&&this._changedRoots.delete(e)):(r.attributes=o,this._changedRoots.set(e,r))}_refreshItem(e){if(this._isInInsertedElement(e.parent))return;this._markRemove(e.parent,e.startOffset,e.offsetSize),this._markInsert(e.parent,e.startOffset,e.offsetSize),this._refreshedItems.add(e);const t=u._createOn(e);for(const s of this._markerCollection.getMarkersIntersectingRange(t)){const i=s.getData();this.bufferMarkerChange(s.name,i,i)}this._cachedChanges=null}_bufferRootLoad(e){if(e.isAttached()){this._bufferRootStateChange(e.rootName,!0),this._markInsert(e,0,e.maxOffset);for(const t of e.getAttributeKeys())this._bufferRootAttributeChange(e.rootName,t,null,e.getAttribute(t));for(const t of this._markerCollection)if(t.getRange().root==e){const s=t.getData();this.bufferMarkerChange(t.name,{...s,range:null},s)}}}_markInsert(e,t,s){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const i={type:"insert",offset:t,howMany:s,count:this._changeCount++};this._markChange(e,i)}_markRemove(e,t,s){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const i={type:"remove",offset:t,howMany:s,count:this._changeCount++};this._markChange(e,i),this._removeAllNestedChanges(e,t,s)}_markAttribute(e){if(e.root.is("rootElement")&&!e.root._isLoaded)return;const t={type:"attribute",offset:e.startOffset,howMany:e.offsetSize,count:this._changeCount++};this._markChange(e.parent,t)}_markChange(e,t){this._makeSnapshot(e);const s=this._getChangesForElement(e);this._handleChange(t,s),s.push(t);for(let i=0;i<s.length;i++)s[i].howMany<1&&(s.splice(i,1),i--)}_getChangesForElement(e){let t;return this._changesInElement.has(e)?t=this._changesInElement.get(e):(t=[],this._changesInElement.set(e,t)),t}_makeSnapshot(e){this._elementSnapshots.has(e)||this._elementSnapshots.set(e,_s(e.getChildren()))}_handleChange(e,t){e.nodesToHandle=e.howMany;for(const s of t){const i=e.offset+e.howMany,r=s.offset+s.howMany;if(e.type=="insert"&&(s.type=="insert"&&(e.offset<=s.offset?s.offset+=e.howMany:e.offset<r&&(s.howMany+=e.nodesToHandle,e.nodesToHandle=0)),s.type=="remove"&&e.offset<s.offset&&(s.offset+=e.howMany),s.type=="attribute")){if(e.offset<=s.offset)s.offset+=e.howMany;else if(e.offset<r){const o=s.howMany;s.howMany=e.offset-s.offset,t.unshift({type:"attribute",offset:i,howMany:o-s.howMany,count:this._changeCount++})}}if(e.type=="remove"){if(s.type=="insert"){if(i<=s.offset)s.offset-=e.howMany;else if(i<=r)if(e.offset<s.offset){const o=i-s.offset;s.offset=e.offset,s.howMany-=o,e.nodesToHandle-=o}else s.howMany-=e.nodesToHandle,e.nodesToHandle=0;else if(e.offset<=s.offset)e.nodesToHandle-=s.howMany,s.howMany=0;else if(e.offset<r){const o=r-e.offset;s.howMany-=o,e.nodesToHandle-=o}}if(s.type=="remove"&&(i<=s.offset?s.offset-=e.howMany:e.offset<s.offset&&(e.nodesToHandle+=s.howMany,s.howMany=0)),s.type=="attribute"){if(i<=s.offset)s.offset-=e.howMany;else if(e.offset<s.offset){const o=i-s.offset;s.offset=e.offset,s.howMany-=o}else if(e.offset<r)if(i<=r){const o=s.howMany;s.howMany=e.offset-s.offset;const a=o-s.howMany-e.nodesToHandle;t.unshift({type:"attribute",offset:e.offset,howMany:a,count:this._changeCount++})}else s.howMany-=r-e.offset}}if(e.type=="attribute"){if(s.type=="insert")if(e.offset<s.offset&&i>s.offset){if(i>r){const o={type:"attribute",offset:r,howMany:i-r,count:this._changeCount++};this._handleChange(o,t),t.push(o)}e.nodesToHandle=s.offset-e.offset,e.howMany=e.nodesToHandle}else e.offset>=s.offset&&e.offset<r&&(i>r?(e.nodesToHandle=i-r,e.offset=r):e.nodesToHandle=0);if(s.type=="remove"&&e.offset<s.offset&&i>s.offset){const o={type:"attribute",offset:s.offset,howMany:i-s.offset,count:this._changeCount++};this._handleChange(o,t),t.push(o),e.nodesToHandle=s.offset-e.offset,e.howMany=e.nodesToHandle}s.type=="attribute"&&(e.offset>=s.offset&&i<=r?(e.nodesToHandle=0,e.howMany=0,e.offset=0):e.offset<=s.offset&&i>=r&&(s.howMany=0))}}e.howMany=e.nodesToHandle,delete e.nodesToHandle}_getInsertDiff(e,t,s){return{type:"insert",position:m._createAt(e,t),name:s.name,attributes:new Map(s.attributes),length:1,changeCount:this._changeCount++,_element:s.element}}_getRemoveDiff(e,t,s){return{type:"remove",position:m._createAt(e,t),name:s.name,attributes:new Map(s.attributes),length:1,changeCount:this._changeCount++,_element:s.element}}_getAttributesDiff(e,t,s){const i=[];s=new Map(s);for(const[r,o]of t){const a=s.has(r)?s.get(r):null;a!==o&&i.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:r,attributeOldValue:o,attributeNewValue:a,changeCount:this._changeCount++}),s.delete(r)}for(const[r,o]of s)i.push({type:"attribute",position:e.start,range:e.clone(),length:1,attributeKey:r,attributeOldValue:null,attributeNewValue:o,changeCount:this._changeCount++});return i}_isInInsertedElement(e){const t=e.parent;if(!t)return!1;const s=this._changesInElement.get(t),i=e.startOffset;if(s){for(const r of s)if(r.type=="insert"&&i>=r.offset&&i<r.offset+r.howMany)return!0}return this._isInInsertedElement(t)}_removeAllNestedChanges(e,t,s){const i=new u(m._createAt(e,t),m._createAt(e,t+s));for(const r of i.getItems({shallow:!0}))r.is("element")&&(this._elementSnapshots.delete(r),this._changesInElement.delete(r),this._removeAllNestedChanges(r,0,r.maxOffset))}}function _s(n){const e=[];for(const t of n)if(t.is("$text"))for(let s=0;s<t.data.length;s++)e.push({name:"$text",attributes:new Map(t.getAttributes())});else e.push({name:t.name,attributes:new Map(t.getAttributes()),element:t});return e}function Ao(n,e){const t=[];let s=0,i=0;for(const r of e){if(r.offset>s){for(let o=0;o<r.offset-s;o++)t.push("e");i+=r.offset-s}if(r.type=="insert"){for(let o=0;o<r.howMany;o++)t.push("i");s=r.offset+r.howMany}else if(r.type=="remove"){for(let o=0;o<r.howMany;o++)t.push("r");s=r.offset,i+=r.howMany}else t.push(..."a".repeat(r.howMany).split("")),s=r.offset+r.howMany,i+=r.howMany}if(i<n)for(let r=0;r<n-i-s;r++)t.push("e");return t}function So(n){const e="position"in n&&n.position.root.rootName=="$graveyard",t="range"in n&&n.range.root.rootName=="$graveyard";return!e&&!t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Eo{constructor(){this._operations=[],this._undoPairs=new Map,this._undoneOperations=new Set,this._baseVersionToOperationIndex=new Map,this._version=0,this._gaps=new Map}get version(){return this._version}set version(e){this._operations.length&&e>this._version+1&&this._gaps.set(this._version,e),this._version=e}get lastOperation(){return this._operations[this._operations.length-1]}addOperation(e){if(e.baseVersion!==this.version)throw new f("model-document-history-addoperation-incorrect-version",this,{operation:e,historyVersion:this.version});this._operations.push(e),this._version++,this._baseVersionToOperationIndex.set(e.baseVersion,this._operations.length-1)}getOperations(e,t=this.version){if(!this._operations.length)return[];const s=this._operations[0];e===void 0&&(e=s.baseVersion);let i=t-1;for(const[a,l]of this._gaps)e>a&&e<l&&(e=l),i>a&&i<l&&(i=a-1);if(i<s.baseVersion||e>this.lastOperation.baseVersion)return[];let r=this._baseVersionToOperationIndex.get(e);r===void 0&&(r=0);let o=this._baseVersionToOperationIndex.get(i);return o===void 0&&(o=this._operations.length-1),this._operations.slice(r,o+1)}getOperation(e){const t=this._baseVersionToOperationIndex.get(e);if(t!==void 0)return this._operations[t]}setOperationAsUndone(e,t){this._undoPairs.set(t,e),this._undoneOperations.add(e)}isUndoingOperation(e){return this._undoPairs.has(e)}isUndoneOperation(e){return this._undoneOperations.has(e)}getUndoneOperation(e){return this._undoPairs.get(e)}reset(){this._version=0,this._undoPairs=new Map,this._operations=[],this._undoneOperations=new Set,this._gaps=new Map,this._baseVersionToOperationIndex=new Map}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tt extends P{constructor(e,t,s="main"){super(t),this._isAttached=!0,this._isLoaded=!0,this._document=e,this.rootName=s}get document(){return this._document}isAttached(){return this._isAttached}toJSON(){return this.rootName}}tt.prototype.is=function(n,e){return e?e===this.name&&(n==="rootElement"||n==="model:rootElement"||n==="element"||n==="model:element"):n==="rootElement"||n==="model:rootElement"||n==="element"||n==="model:element"||n==="node"||n==="model:node"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ws="$graveyard";class Ro extends N(){constructor(e){super(),this.model=e,this.history=new Eo,this.selection=new K(this),this.roots=new St({idProperty:"rootName"}),this.differ=new ko(e.markers),this.isReadOnly=!1,this._postFixers=new Set,this._hasSelectionChangedFromTheLastChangeBlock=!1,this.createRoot("$root",ws),this.listenTo(e,"applyOperation",(t,s)=>{const i=s[0];i.isDocumentOperation&&this.differ.bufferOperation(i)},{priority:"high"}),this.listenTo(e,"applyOperation",(t,s)=>{const i=s[0];i.isDocumentOperation&&this.history.addOperation(i)},{priority:"low"}),this.listenTo(this.selection,"change",()=>{this._hasSelectionChangedFromTheLastChangeBlock=!0}),this.listenTo(e.markers,"update",(t,s,i,r,o)=>{const a={...s.getData(),range:r};this.differ.bufferMarkerChange(s.name,o,a),i===null&&s.on("change",(l,c)=>{const h=s.getData();this.differ.bufferMarkerChange(s.name,{...h,range:c},h)})}),this.registerPostFixer(t=>{let s=!1;for(const i of this.roots)!i.isAttached()&&!i.isEmpty&&(t.remove(t.createRangeIn(i)),s=!0);for(const i of this.model.markers)i.getRange().root.isAttached()||(t.removeMarker(i),s=!0);return s})}get version(){return this.history.version}set version(e){this.history.version=e}get graveyard(){return this.getRoot(ws)}createRoot(e="$root",t="main"){if(this.roots.get(t))throw new f("model-document-createroot-name-exists",this,{name:t});const s=new tt(this,e,t);return this.roots.add(s),s}destroy(){this.selection.destroy(),this.stopListening()}getRoot(e="main"){return this.roots.get(e)}getRootNames(e=!1){return this.getRoots(e).map(t=>t.rootName)}getRoots(e=!1){return this.roots.filter(t=>t!=this.graveyard&&(e||t.isAttached())&&t._isLoaded)}registerPostFixer(e){this._postFixers.add(e)}toJSON(){const e=Es(this);return e.selection="[engine.model.DocumentSelection]",e.model="[engine.model.Model]",e}_handleChangeBlock(e){this._hasDocumentChangedFromTheLastChangeBlock()&&(this._callPostFixers(e),this.selection.refresh(),this.differ.hasDataChanges()?this.fire("change:data",e.batch):this.fire("change",e.batch),this.selection.refresh(),this.differ.reset()),this._hasSelectionChangedFromTheLastChangeBlock=!1}_hasDocumentChangedFromTheLastChangeBlock(){return!this.differ.isEmpty||this._hasSelectionChangedFromTheLastChangeBlock}_getDefaultRoot(){const e=this.getRoots();return e.length?e[0]:this.graveyard}_getDefaultRange(){const e=this._getDefaultRoot(),t=this.model,s=t.schema,i=t.createPositionFromPath(e,[0]);return s.getNearestSelectionRange(i)||t.createRange(i)}_validateSelectionRange(e){return ys(e.start)&&ys(e.end)}_callPostFixers(e){let t=!1;do for(const s of this._postFixers)if(this.selection.refresh(),t=s(e),t)break;while(t)}}function ys(n){const e=n.textNode;if(e){const t=e.data,s=n.offset-e.startOffset;return!As(t,s)&&!Ss(t,s)}return!0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class To extends N(){constructor(){super(...arguments),this._markers=new Map}[Symbol.iterator](){return this._markers.values()}has(e){const t=e instanceof Ce?e.name:e;return this._markers.has(t)}get(e){return this._markers.get(e)||null}_set(e,t,s=!1,i=!1){const r=e instanceof Ce?e.name:e;if(r.includes(","))throw new f("markercollection-incorrect-marker-name",this);const o=this._markers.get(r);if(o){const c=o.getData(),h=o.getRange();let d=!1;return h.isEqual(t)||(o._attachLiveRange(_e.fromRange(t)),d=!0),s!=o.managedUsingOperations&&(o._managedUsingOperations=s,d=!0),typeof i=="boolean"&&i!=o.affectsData&&(o._affectsData=i,d=!0),d&&this.fire(`update:${r}`,o,h,t,c),o}const a=_e.fromRange(t),l=new Ce(r,a,s,i);return this._markers.set(r,l),this.fire(`update:${r}`,l,null,t,{...l.getData(),range:null}),l}_remove(e){const t=e instanceof Ce?e.name:e,s=this._markers.get(t);return s?(this._markers.delete(t),this.fire(`update:${t}`,s,s.getRange(),null,s.getData()),this._destroyMarker(s),!0):!1}_refresh(e){const t=e instanceof Ce?e.name:e,s=this._markers.get(t);if(!s)throw new f("markercollection-refresh-marker-not-exists",this);const i=s.getRange();this.fire(`update:${t}`,s,i,i,s.getData())}*getMarkersAtPosition(e){for(const t of this)t.getRange().containsPosition(e)&&(yield t)}*getMarkersIntersectingRange(e){for(const t of this)t.getRange().getIntersection(e)!==null&&(yield t)}destroy(){for(const e of this._markers.values())this._destroyMarker(e);this._markers=null,this.stopListening()}*getMarkersGroup(e){for(const t of this._markers.values())t.name.startsWith(e+":")&&(yield t)}_destroyMarker(e){e.stopListening(),e._detachLiveRange()}}class Ce extends N(ae){constructor(e,t,s,i){super(),this.name=e,this._liveRange=this._attachLiveRange(t),this._managedUsingOperations=s,this._affectsData=i}get managedUsingOperations(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._managedUsingOperations}get affectsData(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._affectsData}getData(){return{range:this.getRange(),affectsData:this.affectsData,managedUsingOperations:this.managedUsingOperations}}getStart(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.start.clone()}getEnd(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.end.clone()}getRange(){if(!this._liveRange)throw new f("marker-destroyed",this);return this._liveRange.toRange()}_attachLiveRange(e){return this._liveRange&&this._detachLiveRange(),e.delegate("change:range").to(this),e.delegate("change:content").to(this),this._liveRange=e,e}_detachLiveRange(){this._liveRange.stopDelegating("change:range",this),this._liveRange.stopDelegating("change:content",this),this._liveRange.detach(),this._liveRange=null}}Ce.prototype.is=function(n){return n==="marker"||n==="model:marker"};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mo extends W{constructor(e,t){super(null),this.sourcePosition=e.clone(),this.howMany=t}get type(){return"detach"}get affectedSelectable(){return null}toJSON(){const e=super.toJSON();return e.sourcePosition=this.sourcePosition.toJSON(),e}_validate(){if(this.sourcePosition.root.document)throw new f("detach-operation-on-document-node",this)}_execute(){un(u._createFromPositionAndShift(this.sourcePosition,this.howMany))}static get className(){return"DetachOperation"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Y extends ae{constructor(e){super(),this.markers=new Map,this._children=new Ie,e&&this._insertChild(0,e)}[Symbol.iterator](){return this.getChildren()}get childCount(){return this._children.length}get maxOffset(){return this._children.maxOffset}get isEmpty(){return this.childCount===0}get nextSibling(){return null}get previousSibling(){return null}get root(){return this}get parent(){return null}get document(){return null}isAttached(){return!1}getAncestors(){return[]}getChild(e){return this._children.getNode(e)}getChildren(){return this._children[Symbol.iterator]()}getChildIndex(e){return this._children.getNodeIndex(e)}getChildStartOffset(e){return this._children.getNodeStartOffset(e)}getPath(){return[]}getNodeByPath(e){let t=this;for(const s of e)t=t.getChild(t.offsetToIndex(s));return t}offsetToIndex(e){return this._children.offsetToIndex(e)}toJSON(){const e=[];for(const t of this._children)e.push(t.toJSON());return e}static fromJSON(e){const t=[];for(const s of e)s.name?t.push(P.fromJSON(s)):t.push(C.fromJSON(s));return new Y(t)}_appendChild(e){this._insertChild(this.childCount,e)}_insertChild(e,t){const s=xo(t);for(const i of s)i.parent!==null&&i._remove(),i.parent=this;this._children._insertNodes(e,s)}_removeChildren(e,t=1){const s=this._children._removeNodes(e,t);for(const i of s)i.parent=null;return s}}Y.prototype.is=function(n){return n==="documentFragment"||n==="model:documentFragment"};function xo(n){return typeof n=="string"?[new C(n)]:(re(n)||(n=[n]),Array.from(n).map(e=>typeof e=="string"?new C(e):e instanceof J?new C(e.data,e.getAttributes()):e))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class No{constructor(e,t){this.model=e,this.batch=t}createText(e,t){return new C(e,t)}createElement(e,t){return new P(e,t)}createDocumentFragment(){return new Y}cloneElement(e,t=!0){return e._clone(t)}insert(e,t,s=0){if(this._assertWriterUsedCorrectly(),e instanceof C&&e.data=="")return;const i=m._createAt(t,s);if(e.parent)if(Ps(e.root,i.root)){this.move(u._createOn(e),i);return}else{if(e.root.document)throw new f("model-writer-insert-forbidden-move",this);this.remove(e)}const r=i.root.document?i.root.document.version:null,o=new M(i,e,r);if(e instanceof C&&(o.shouldReceiveAttributes=!0),this.batch.addOperation(o),this.model.applyOperation(o),e instanceof Y)for(const[a,l]of e.markers){const c=m._createAt(l.root,0),d={range:new u(l.start._getCombined(c,i),l.end._getCombined(c,i)),usingOperation:!0,affectsData:!0};this.model.markers.has(a)?this.updateMarker(a,d):this.addMarker(a,d)}}insertText(e,t,s,i){t instanceof Y||t instanceof P||t instanceof m?this.insert(this.createText(e),t,s):this.insert(this.createText(e,t),s,i)}insertElement(e,t,s,i){t instanceof Y||t instanceof P||t instanceof m?this.insert(this.createElement(e),t,s):this.insert(this.createElement(e,t),s,i)}append(e,t){this.insert(e,t,"end")}appendText(e,t,s){t instanceof Y||t instanceof P?this.insert(this.createText(e),t,"end"):this.insert(this.createText(e,t),s,"end")}appendElement(e,t,s){t instanceof Y||t instanceof P?this.insert(this.createElement(e),t,"end"):this.insert(this.createElement(e,t),s,"end")}setAttribute(e,t,s){if(this._assertWriterUsedCorrectly(),s instanceof u){const i=s.getMinimalFlatRanges();for(const r of i)bs(this,e,t,r)}else vs(this,e,t,s)}setAttributes(e,t){for(const[s,i]of pe(e))this.setAttribute(s,i,t)}removeAttribute(e,t){if(this._assertWriterUsedCorrectly(),t instanceof u){const s=t.getMinimalFlatRanges();for(const i of s)bs(this,e,null,i)}else vs(this,e,null,t)}clearAttributes(e){this._assertWriterUsedCorrectly();const t=s=>{for(const i of s.getAttributeKeys())this.removeAttribute(i,s)};if(!(e instanceof u))t(e);else for(const s of e.getItems())t(s)}move(e,t,s){if(this._assertWriterUsedCorrectly(),!(e instanceof u))throw new f("writer-move-invalid-range",this);if(!e.isFlat)throw new f("writer-move-range-not-flat",this);const i=m._createAt(t,s);if(i.isEqual(e.start))return;if(this._addOperationForAffectedMarkers("move",e),!Ps(e.root,i.root))throw new f("writer-move-different-document",this);const r=e.root.document?e.root.document.version:null,o=new b(e.start,e.end.offset-e.start.offset,i,r);this.batch.addOperation(o),this.model.applyOperation(o)}remove(e){this._assertWriterUsedCorrectly();const s=(e instanceof u?e:u._createOn(e)).getMinimalFlatRanges().reverse();for(const i of s)this._addOperationForAffectedMarkers("move",i),Oo(i.start,i.end.offset-i.start.offset,this.batch,this.model)}merge(e){this._assertWriterUsedCorrectly();const t=e.nodeBefore,s=e.nodeAfter;if(this._addOperationForAffectedMarkers("merge",e),!(t instanceof P))throw new f("writer-merge-no-element-before",this);if(!(s instanceof P))throw new f("writer-merge-no-element-after",this);e.root.document?this._merge(e):this._mergeDetached(e)}createPositionFromPath(e,t,s){return this.model.createPositionFromPath(e,t,s)}createPositionAt(e,t){return this.model.createPositionAt(e,t)}createPositionAfter(e){return this.model.createPositionAfter(e)}createPositionBefore(e){return this.model.createPositionBefore(e)}createRange(e,t){return this.model.createRange(e,t)}createRangeIn(e){return this.model.createRangeIn(e)}createRangeOn(e){return this.model.createRangeOn(e)}createSelection(...e){return this.model.createSelection(...e)}_mergeDetached(e){const t=e.nodeBefore,s=e.nodeAfter;this.move(u._createIn(s),m._createAt(t,"end")),this.remove(s)}_merge(e){const t=m._createAt(e.nodeBefore,"end"),s=m._createAt(e.nodeAfter,0),i=e.root.document.graveyard,r=new m(i,[0]),o=e.root.document.version,a=new S(s,e.nodeAfter.maxOffset,t,r,o);this.batch.addOperation(a),this.model.applyOperation(a)}rename(e,t){if(this._assertWriterUsedCorrectly(),!(e instanceof P))throw new f("writer-rename-not-element-instance",this);const s=e.root.document?e.root.document.version:null,i=new B(m._createBefore(e),e.name,t,s);this.batch.addOperation(i),this.model.applyOperation(i)}split(e,t){this._assertWriterUsedCorrectly();let s=e.parent;if(!s.parent)throw new f("writer-split-element-no-parent",this);if(t||(t=s.parent),!e.parent.getAncestors({includeSelf:!0}).includes(t))throw new f("writer-split-invalid-limit-element",this);let i,r;do{const o=s.root.document?s.root.document.version:null,a=s.maxOffset-e.offset,l=k.getInsertionPosition(e),c=new k(e,a,l,null,o);this.batch.addOperation(c),this.model.applyOperation(c),!i&&!r&&(i=s,r=e.parent.nextSibling),e=this.createPositionAfter(e.parent),s=e.parent}while(s!==t);return{position:e,range:new u(m._createAt(i,"end"),m._createAt(r,0))}}wrap(e,t){if(this._assertWriterUsedCorrectly(),!e.isFlat)throw new f("writer-wrap-range-not-flat",this);const s=t instanceof P?t:new P(t);if(s.childCount>0)throw new f("writer-wrap-element-not-empty",this);if(s.parent!==null)throw new f("writer-wrap-element-attached",this);this.insert(s,e.start);const i=new u(e.start.getShiftedBy(1),e.end.getShiftedBy(1));this.move(i,m._createAt(s,0))}unwrap(e){if(this._assertWriterUsedCorrectly(),e.parent===null)throw new f("writer-unwrap-element-no-parent",this);this.move(u._createIn(e),this.createPositionAfter(e)),this.remove(e)}addMarker(e,t){if(this._assertWriterUsedCorrectly(),!t||typeof t.usingOperation!="boolean")throw new f("writer-addmarker-no-usingoperation",this);const s=t.usingOperation,i=t.range,r=t.affectsData===void 0?!1:t.affectsData;if(this.model.markers.has(e))throw new f("writer-addmarker-marker-exists",this);if(!i)throw new f("writer-addmarker-no-range",this);return s?(xe(this,e,null,i,r),this.model.markers.get(e)):this.model.markers._set(e,i,s,r)}updateMarker(e,t){this._assertWriterUsedCorrectly();const s=typeof e=="string"?e:e.name,i=this.model.markers.get(s);if(!i)throw new f("writer-updatemarker-marker-not-exists",this);if(!t){L("writer-updatemarker-reconvert-using-editingcontroller",{markerName:s}),this.model.markers._refresh(i);return}const r=typeof t.usingOperation=="boolean",o=typeof t.affectsData=="boolean",a=o?t.affectsData:i.affectsData;if(!r&&!t.range&&!o)throw new f("writer-updatemarker-wrong-options",this);const l=i.getRange(),c=t.range?t.range:l;if(r&&t.usingOperation!==i.managedUsingOperations){t.usingOperation?xe(this,s,null,c,a):(xe(this,s,l,null,a),this.model.markers._set(s,c,void 0,a));return}i.managedUsingOperations?xe(this,s,l,c,a):this.model.markers._set(s,c,void 0,a)}removeMarker(e){this._assertWriterUsedCorrectly();const t=typeof e=="string"?e:e.name;if(!this.model.markers.has(t))throw new f("writer-removemarker-no-marker",this);const s=this.model.markers.get(t);if(!s.managedUsingOperations){this.model.markers._remove(t);return}const i=s.getRange();xe(this,t,i,null,s.affectsData)}addRoot(e,t="$root"){this._assertWriterUsedCorrectly();const s=this.model.document.getRoot(e);if(s&&s.isAttached())throw new f("writer-addroot-root-exists",this);const i=this.model.document,r=new j(e,t,!0,i,i.version);return this.batch.addOperation(r),this.model.applyOperation(r),this.model.document.getRoot(e)}detachRoot(e){this._assertWriterUsedCorrectly();const t=typeof e=="string"?this.model.document.getRoot(e):e;if(!t||!t.isAttached())throw new f("writer-detachroot-no-root",this);for(const r of this.model.markers)r.getRange().root===t&&this.removeMarker(r);for(const r of t.getAttributeKeys())this.removeAttribute(r,t);this.remove(this.createRangeIn(t));const s=this.model.document,i=new j(t.rootName,t.name,!1,s,s.version);this.batch.addOperation(i),this.model.applyOperation(i)}setSelection(...e){this._assertWriterUsedCorrectly(),this.model.document.selection._setTo(...e)}setSelectionFocus(e,t){this._assertWriterUsedCorrectly(),this.model.document.selection._setFocus(e,t)}setSelectionAttribute(e,t){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._setSelectionAttribute(e,t);else for(const[s,i]of pe(e))this._setSelectionAttribute(s,i)}removeSelectionAttribute(e){if(this._assertWriterUsedCorrectly(),typeof e=="string")this._removeSelectionAttribute(e);else for(const t of e)this._removeSelectionAttribute(t)}overrideSelectionGravity(){return this.model.document.selection._overrideGravity()}restoreSelectionGravity(e){this.model.document.selection._restoreGravity(e)}_setSelectionAttribute(e,t){const s=this.model.document.selection;if(s.isCollapsed&&s.anchor.parent.isEmpty){const i=K._getStoreAttributeKey(e);this.setAttribute(i,t,s.anchor.parent)}s._setAttribute(e,t)}_removeSelectionAttribute(e){const t=this.model.document.selection;if(t.isCollapsed&&t.anchor.parent.isEmpty){const s=K._getStoreAttributeKey(e);this.removeAttribute(s,t.anchor.parent)}t._removeAttribute(e)}_assertWriterUsedCorrectly(){if(this.model._currentWriter!==this)throw new f("writer-incorrect-use",this)}_addOperationForAffectedMarkers(e,t){for(const s of this.model.markers){if(!s.managedUsingOperations)continue;const i=s.getRange();let r=!1;if(e==="move"){const o=t;r=o.containsPosition(i.start)||o.start.isEqual(i.start)||o.containsPosition(i.end)||o.end.isEqual(i.end)}else{const o=t,a=o.nodeBefore,l=o.nodeAfter,c=i.start.parent==a&&i.start.isAtEnd,h=i.end.parent==l&&i.end.offset==0,d=i.end.nodeAfter==l,_=i.start.nodeAfter==l;r=c||h||d||_}r&&this.updateMarker(s.name,{range:i})}}}function bs(n,e,t,s){const i=n.model,r=i.document;let o=s.start,a,l,c;for(const d of s.getWalker({shallow:!0}))c=d.item.getAttribute(e),a&&l!=c&&(l!=t&&h(),o=a),a=d.nextPosition,l=c;a instanceof m&&a!=o&&l!=t&&h();function h(){const d=new u(o,a),_=d.root.document?r.version:null,p=new E(d,e,l,t,_);n.batch.addOperation(p),i.applyOperation(p)}}function vs(n,e,t,s){const i=n.model,r=i.document,o=s.getAttribute(e);let a,l;if(o!=t){if(s.root===s){const h=s.document?r.version:null;l=new Z(s,e,o,t,h)}else{a=new u(m._createBefore(s),n.createPositionAfter(s));const h=a.root.document?r.version:null;l=new E(a,e,o,t,h)}n.batch.addOperation(l),i.applyOperation(l)}}function xe(n,e,t,s,i){const r=n.model,o=r.document,a=new F(e,t,s,r.markers,!!i,o.version);n.batch.addOperation(a),r.applyOperation(a)}function Oo(n,e,t,s){let i;if(n.root.document){const r=s.document,o=new m(r.graveyard,[0]);i=new b(n,e,o,r.version)}else i=new Mo(n,e);t.addOperation(i),s.applyOperation(i)}function Ps(n,e){return n===e||n instanceof tt&&e instanceof tt}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Io(n,e,t={}){if(e.isCollapsed)return;const s=e.getFirstRange();if(s.root.rootName=="$graveyard")return;const i=n.schema;n.change(r=>{if(!t.doNotResetEntireContent&&Uo(i,e)){qo(r,e);return}const o={};if(!t.doNotAutoparagraph){const c=e.getSelectedElement();c&&Object.assign(o,i.getAttributesWithProperty(c,"copyOnReplace",!0))}const[a,l]=Fo(s);a.isTouching(l)||r.remove(r.createRange(a,l)),t.leaveUnmerged||(Do(r,a,l),i.removeDisallowedAttributes(a.parent.getChildren(),r)),wn(r,e,a),!t.doNotAutoparagraph&&Lo(i,a)&&_n(r,a,e,o),a.detach(),l.detach()})}function Fo(n){const e=n.root.document.model,t=n.start;let s=n.end;if(e.hasContent(n,{ignoreMarkers:!0})){const i=Bo(s);if(i&&s.isTouching(e.createPositionAt(i,0))){const r=e.createSelection(n);e.modifySelection(r,{direction:"backward"});const o=r.getLastPosition(),a=e.createRange(o,s);e.hasContent(a,{ignoreMarkers:!0})||(s=o)}}return[I.fromPosition(t,"toPrevious"),I.fromPosition(s,"toNext")]}function Bo(n){const e=n.parent,t=e.root.document.model.schema,s=e.getAncestors({parentFirst:!0,includeSelf:!0});for(const i of s){if(t.isLimit(i))return null;if(t.isBlock(i))return i}}function Do(n,e,t){const s=n.model;if(!Dt(n.model.schema,e,t))return;const[i,r]=$o(e,t);!i||!r||(!s.hasContent(i,{ignoreMarkers:!0})&&s.hasContent(r,{ignoreMarkers:!0})?pn(n,e,t,i.parent):gn(n,e,t,i.parent))}function gn(n,e,t,s){const i=e.parent,r=t.parent;if(!(i==s||r==s)){for(e=n.createPositionAfter(i),t=n.createPositionBefore(r),t.isEqual(e)||n.insert(r,e),n.merge(e);t.parent.isEmpty;){const o=t.parent;t=n.createPositionBefore(o),n.remove(o)}Dt(n.model.schema,e,t)&&gn(n,e,t,s)}}function pn(n,e,t,s){const i=e.parent,r=t.parent;if(!(i==s||r==s)){for(e=n.createPositionAfter(i),t=n.createPositionBefore(r),t.isEqual(e)||n.insert(i,t);e.parent.isEmpty;){const o=e.parent;e=n.createPositionBefore(o),n.remove(o)}t=n.createPositionBefore(r),Vo(n,t),Dt(n.model.schema,e,t)&&pn(n,e,t,s)}}function Vo(n,e){const t=e.nodeBefore,s=e.nodeAfter;t.name!=s.name&&n.rename(t,s.name),n.clearAttributes(t),n.setAttributes(Object.fromEntries(s.getAttributes()),t),n.merge(e)}function Dt(n,e,t){const s=e.parent,i=t.parent;return s==i||n.isLimit(s)||n.isLimit(i)?!1:Wo(e,t,n)}function $o(n,e){const t=n.getAncestors(),s=e.getAncestors();let i=0;for(;t[i]&&t[i]==s[i];)i++;return[t[i],s[i]]}function Lo(n,e){const t=n.checkChild(e,"$text"),s=n.checkChild(e,"paragraph");return!t&&s}function Wo(n,e,t){const s=new u(n,e);for(const i of s.getWalker())if(t.isLimit(i.item))return!1;return!0}function _n(n,e,t,s={}){const i=n.createElement("paragraph");n.model.schema.setAllowedAttributes(i,s,n),n.insert(i,e),wn(n,t,n.createPositionAt(i,0))}function qo(n,e){const t=n.model.schema.getLimitElement(e);n.remove(n.createRangeIn(t)),_n(n,n.createPositionAt(t,0),e)}function Uo(n,e){const t=n.getLimitElement(e);if(!e.containsEntireContent(t))return!1;const s=e.getFirstRange();return s.start.parent==s.end.parent?!1:n.checkChild(t,"paragraph")}function wn(n,e,t){e instanceof K?n.setSelection(t):e.setTo(t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function zo(n,e){return n.change(t=>{const s=t.createDocumentFragment(),i=e.getFirstRange();if(!i||i.isCollapsed)return s;const r=i.start.root,o=i.start.getCommonPath(i.end),a=r.getNodeByPath(o);let l;i.start.parent==i.end.parent?l=i:l=t.createRange(t.createPositionAt(a,i.start.path[o.length]),t.createPositionAt(a,i.end.path[o.length]+1));const c=l.end.offset-l.start.offset;for(const h of l.getItems({shallow:!0}))h.is("$textProxy")?t.appendText(h.data,h.getAttributes(),s):t.append(t.cloneElement(h,!0),s);if(l!=i){const h=i._getTransformedByMove(l.start,t.createPositionAt(s,0),c)[0],d=t.createRange(t.createPositionAt(s,0),h.start),_=t.createRange(h.end,t.createPositionAt(s,"end"));Cs(_,t),Cs(d,t)}return s})}function Cs(n,e){const t=[];Array.from(n.getItems({direction:"backward"})).map(s=>e.createRangeOn(s)).filter(s=>(s.start.isAfter(n.start)||s.start.isEqual(n.start))&&(s.end.isBefore(n.end)||s.end.isEqual(n.end))).forEach(s=>{t.push(s.start.parent),e.remove(s)}),t.forEach(s=>{let i=s;for(;i.parent&&i.isEmpty;){const r=e.createRangeOn(i);i=i.parent,e.remove(r)}})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Jo(n,e,t){return n.change(s=>{const i=t||n.document.selection;i.isCollapsed||n.deleteContent(i,{doNotAutoparagraph:!0});const r=new Go(n,s,i.anchor),o=[];let a;if(e.is("documentFragment")){if(e.markers.size){const h=[];for(const[d,_]of e.markers){const{start:p,end:v}=_,D=p.isEqual(v);h.push({position:p,name:d,isCollapsed:D},{position:v,name:d,isCollapsed:D})}h.sort(({position:d},{position:_})=>d.isBefore(_)?1:-1);for(const{position:d,name:_,isCollapsed:p}of h){let v=null,D=null;const le=d.parent===e&&d.isAtStart,ee=d.parent===e&&d.isAtEnd;!le&&!ee?(v=s.createElement("$marker"),s.insert(v,d)):p&&(D=le?"start":"end"),o.push({name:_,element:v,collapsed:D})}}a=e.getChildren()}else a=[e];r.handleNodes(a);let l=r.getSelectionRange();if(e.is("documentFragment")&&o.length){const h=l?_e.fromRange(l):null,d={};for(let _=o.length-1;_>=0;_--){const{name:p,element:v,collapsed:D}=o[_],le=!d[p];if(le&&(d[p]=[]),v){const ee=s.createPositionAt(v,"before");d[p].push(ee),s.remove(v)}else{const ee=r.getAffectedRange();if(!ee){D&&d[p].push(r.position);continue}D?d[p].push(ee[D]):d[p].push(le?ee.start:ee.end)}}for(const[_,[p,v]]of Object.entries(d))p&&v&&p.root===v.root&&s.addMarker(_,{usingOperation:!0,affectsData:!0,range:new u(p,v)});h&&(l=h.toRange(),h.detach())}/* istanbul ignore else -- @preserve */l&&(i instanceof K?s.setSelection(l):i.setTo(l));const c=r.getAffectedRange()||n.createRange(i.anchor);return r.destroy(),c})}class Go{constructor(e,t,s){this._firstNode=null,this._lastNode=null,this._lastAutoParagraph=null,this._filterAttributesOf=[],this._affectedStart=null,this._affectedEnd=null,this._nodeToSelect=null,this.model=e,this.writer=t,this.position=s,this.canMergeWith=new Set([this.position.parent]),this.schema=e.schema,this._documentFragment=t.createDocumentFragment(),this._documentFragmentPosition=t.createPositionAt(this._documentFragment,0)}handleNodes(e){for(const t of Array.from(e))this._handleNode(t);this._insertPartialFragment(),this._lastAutoParagraph&&this._updateLastNodeFromAutoParagraph(this._lastAutoParagraph),this._mergeOnRight(),this.schema.removeDisallowedAttributes(this._filterAttributesOf,this.writer),this._filterAttributesOf=[]}_updateLastNodeFromAutoParagraph(e){const t=this.writer.createPositionAfter(this._lastNode),s=this.writer.createPositionAfter(e);if(s.isAfter(t)){this._lastNode=e;/* istanbul ignore if -- @preserve */if(this.position.parent!=e||!this.position.isAtEnd)throw new f("insertcontent-invalid-insertion-position",this);this.position=s,this._setAffectedBoundaries(this.position)}}getSelectionRange(){return this._nodeToSelect?u._createOn(this._nodeToSelect):this.model.schema.getNearestSelectionRange(this.position)}getAffectedRange(){return this._affectedStart?new u(this._affectedStart,this._affectedEnd):null}destroy(){this._affectedStart&&this._affectedStart.detach(),this._affectedEnd&&this._affectedEnd.detach()}_handleNode(e){if(this.schema.isObject(e)){this._handleObject(e);return}let t=this._checkAndAutoParagraphToAllowedPosition(e);if(!t&&(t=this._checkAndSplitToAllowedPosition(e),!t)){this._handleDisallowedNode(e);return}this._appendToFragment(e),this._firstNode||(this._firstNode=e),this._lastNode=e}_insertPartialFragment(){if(this._documentFragment.isEmpty)return;const e=I.fromPosition(this.position,"toNext");this._setAffectedBoundaries(this.position),this._documentFragment.getChild(0)==this._firstNode&&(this.writer.insert(this._firstNode,this.position),this._mergeOnLeft(),this.position=e.toPosition()),this._documentFragment.isEmpty||this.writer.insert(this._documentFragment,this.position),this._documentFragmentPosition=this.writer.createPositionAt(this._documentFragment,0),this.position=e.toPosition(),e.detach()}_handleObject(e){this._checkAndSplitToAllowedPosition(e)?this._appendToFragment(e):this._tryAutoparagraphing(e)}_handleDisallowedNode(e){e.is("element")?this.handleNodes(e.getChildren()):this._tryAutoparagraphing(e)}_appendToFragment(e){/* istanbul ignore if -- @preserve */if(!this.schema.checkChild(this.position,e))throw new f("insertcontent-wrong-position",this,{node:e,position:this.position});this.writer.insert(e,this._documentFragmentPosition),this._documentFragmentPosition=this._documentFragmentPosition.getShiftedBy(e.offsetSize),this.schema.isObject(e)&&!this.schema.checkChild(this.position,"$text")?this._nodeToSelect=e:this._nodeToSelect=null,this._filterAttributesOf.push(e)}_setAffectedBoundaries(e){this._affectedStart||(this._affectedStart=I.fromPosition(e,"toPrevious")),(!this._affectedEnd||this._affectedEnd.isBefore(e))&&(this._affectedEnd&&this._affectedEnd.detach(),this._affectedEnd=I.fromPosition(e,"toNext"))}_mergeOnLeft(){const e=this._firstNode;if(!(e instanceof P)||!this._canMergeLeft(e))return;const t=I._createBefore(e);t.stickiness="toNext";const s=I.fromPosition(this.position,"toNext");this._affectedStart.isEqual(t)&&(this._affectedStart.detach(),this._affectedStart=I._createAt(t.nodeBefore,"end","toPrevious")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.isEqual(this._affectedEnd)&&this._firstNode===this._lastNode&&(this._affectedEnd.detach(),this._affectedEnd=I._createAt(t.nodeBefore,"end","toNext")),this.position=s.toPosition(),s.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_mergeOnRight(){const e=this._lastNode;if(!(e instanceof P)||!this._canMergeRight(e))return;const t=I._createAfter(e);t.stickiness="toNext";/* istanbul ignore if -- @preserve */if(!this.position.isEqual(t))throw new f("insertcontent-invalid-insertion-position",this);this.position=m._createAt(t.nodeBefore,"end");const s=I.fromPosition(this.position,"toPrevious");this._affectedEnd.isEqual(t)&&(this._affectedEnd.detach(),this._affectedEnd=I._createAt(t.nodeBefore,"end","toNext")),this._firstNode===this._lastNode&&(this._firstNode=t.nodeBefore,this._lastNode=t.nodeBefore),this.writer.merge(t),t.getShiftedBy(-1).isEqual(this._affectedStart)&&this._firstNode===this._lastNode&&(this._affectedStart.detach(),this._affectedStart=I._createAt(t.nodeBefore,0,"toPrevious")),this.position=s.toPosition(),s.detach(),this._filterAttributesOf.push(this.position.parent),t.detach()}_canMergeLeft(e){const t=e.previousSibling;return t instanceof P&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(t,e)}_canMergeRight(e){const t=e.nextSibling;return t instanceof P&&this.canMergeWith.has(t)&&this.model.schema.checkMerge(e,t)}_tryAutoparagraphing(e){const t=this.writer.createElement("paragraph");this._getAllowedIn(this.position.parent,t)&&this.schema.checkChild(t,e)&&(t._appendChild(e),this._handleNode(t))}_checkAndAutoParagraphToAllowedPosition(e){if(this.schema.checkChild(this.position.parent,e))return!0;if(!this.schema.checkChild(this.position.parent,"paragraph")||!this.schema.checkChild("paragraph",e))return!1;this._insertPartialFragment();const t=this.writer.createElement("paragraph");return this.writer.insert(t,this.position),this._setAffectedBoundaries(this.position),this._lastAutoParagraph=t,this.position=this.writer.createPositionAt(t,0),!0}_checkAndSplitToAllowedPosition(e){const t=this._getAllowedIn(this.position.parent,e);if(!t)return!1;for(t!=this.position.parent&&this._insertPartialFragment();t!=this.position.parent;)if(this.position.isAtStart){const s=this.position.parent;this.position=this.writer.createPositionBefore(s),s.isEmpty&&s.parent===t&&this.writer.remove(s)}else if(this.position.isAtEnd)this.position=this.writer.createPositionAfter(this.position.parent);else{const s=this.writer.createPositionAfter(this.position.parent);this._setAffectedBoundaries(this.position),this.writer.split(this.position),this.position=s,this.canMergeWith.add(this.position.nodeAfter)}return!0}_getAllowedIn(e,t){return this.schema.checkChild(e,t)?e:this.schema.isLimit(e)?null:this._getAllowedIn(e.parent,t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ko(n,e,t,s={}){if(!n.schema.isObject(e))throw new f("insertobject-element-not-an-object",n,{object:e});const i=t||n.document.selection;let r=i;s.findOptimalPosition&&n.schema.isBlock(e)&&(r=n.createSelection(n.schema.findOptimalInsertionRange(i,s.findOptimalPosition)));const o=Et(i.getSelectedBlocks()),a={};return o&&Object.assign(a,n.schema.getAttributesWithProperty(o,"copyOnReplace",!0)),n.change(l=>{r.isCollapsed||n.deleteContent(r,{doNotAutoparagraph:!0});let c=e;const h=r.anchor.parent;!n.schema.checkChild(h,e)&&n.schema.checkChild(h,"paragraph")&&n.schema.checkChild("paragraph",e)&&(c=l.createElement("paragraph"),l.insert(e,c)),n.schema.setAllowedAttributes(c,a,l);const d=n.insertContent(c,r);return d.isCollapsed||s.setSelection&&Ho(l,e,s.setSelection,a),d})}function Ho(n,e,t,s){const i=n.model;if(t=="on"){n.setSelection(e,"on");return}if(t!="after")throw new f("insertobject-invalid-place-parameter-value",i);let r=e.nextSibling;if(i.schema.isInline(e)){n.setSelection(e,"after");return}!(r&&i.schema.checkChild(r,"$text"))&&i.schema.checkChild(e.parent,"paragraph")&&(r=n.createElement("paragraph"),i.schema.setAllowedAttributes(r,s,n),i.insertContent(r,n.createPositionAfter(e))),r&&n.setSelection(r,0)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const jo=' ,.?!:;"-()';function Xo(n,e,t={}){const s=n.schema,i=t.direction!="backward",r=t.unit?t.unit:"character",o=!!t.treatEmojiAsSingleUnit,a=e.focus,l=new ne({boundaries:ea(a,i),singleCharacters:!0,direction:i?"forward":"backward"}),c={walker:l,schema:s,isForward:i,unit:r,treatEmojiAsSingleUnit:o};let h;for(;h=l.next();){if(h.done)return;const d=Yo(c,h.value);if(d){e instanceof K?n.change(_=>{_.setSelectionFocus(d)}):e.setFocus(d);return}}}function Yo(n,e){const{isForward:t,walker:s,unit:i,schema:r,treatEmojiAsSingleUnit:o}=n,{type:a,item:l,nextPosition:c}=e;if(a=="text")return n.unit==="word"?Zo(s,t):Qo(s,i,o);if(a==(t?"elementStart":"elementEnd")){if(r.isSelectable(l))return m._createAt(l,t?"after":"before");if(r.checkChild(c,"$text"))return c}else{if(r.isLimit(l)){s.skip(()=>!0);return}if(r.checkChild(c,"$text"))return c}}function Qo(n,e,t){const s=n.position.textNode;if(s){const i=s.data;let r=n.position.offset-s.startOffset;for(;As(i,r)||e=="character"&&Ss(i,r)||t&&Rn(i,r);)n.next(),r=n.position.offset-s.startOffset}return n.position}function Zo(n,e){let t=n.position.textNode;for(t||(t=e?n.position.nodeAfter:n.position.nodeBefore);t&&t.is("$text");){const s=n.position.offset-t.startOffset;if(sa(t,s,e))t=e?n.position.nodeAfter:n.position.nodeBefore;else{if(ta(t.data,s,e))break;n.next()}}return n.position}function ea(n,e){const t=n.root,s=m._createAt(t,e?"end":0);return e?new u(n,s):new u(s,n)}function ta(n,e,t){const s=e+(t?0:-1);return jo.includes(n.charAt(s))}function sa(n,e,t){return e===(t?n.offsetSize:0)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wa extends q(){constructor(){super(),this.markers=new To,this.document=new Ro(this),this.schema=new Gr,this._pendingChanges=[],this._currentWriter=null,["deleteContent","modifySelection","getSelectedContent","applyOperation"].forEach(e=>this.decorate(e)),this.on("applyOperation",(e,t)=>{t[0]._validate()},{priority:"highest"}),this.schema.register("$root",{isLimit:!0}),this.schema.register("$container",{allowIn:["$root","$container"]}),this.schema.register("$block",{allowIn:["$root","$container"],isBlock:!0}),this.schema.register("$blockObject",{allowWhere:"$block",isBlock:!0,isObject:!0}),this.schema.register("$inlineObject",{allowWhere:"$text",allowAttributesOf:"$text",isInline:!0,isObject:!0}),this.schema.register("$text",{allowIn:"$block",isInline:!0,isContent:!0}),this.schema.register("$clipboardHolder",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$documentFragment",{allowContentOf:"$root",allowChildren:"$text",isLimit:!0}),this.schema.register("$marker"),this.schema.addChildCheck((e,t)=>{if(t.name==="$marker")return!0}),Vr(this),this.document.registerPostFixer(nn),this.on("insertContent",(e,[t,s])=>{e.return=Jo(this,t,s)}),this.on("insertObject",(e,[t,s,i])=>{e.return=Ko(this,t,s,i)}),this.on("canEditAt",e=>{const t=!this.document.isReadOnly;e.return=t,t||e.stop()})}change(e){try{return this._pendingChanges.length===0?(this._pendingChanges.push({batch:new Pe,callback:e}),this._runPendingChanges()[0]):e(this._currentWriter)}catch(t){/* istanbul ignore next -- @preserve */f.rethrowUnexpectedError(t,this)}}enqueueChange(e,t){try{e?typeof e=="function"?(t=e,e=new Pe):e instanceof Pe||(e=new Pe(e)):e=new Pe,this._pendingChanges.push({batch:e,callback:t}),this._pendingChanges.length==1&&this._runPendingChanges()}catch(s){/* istanbul ignore next -- @preserve */f.rethrowUnexpectedError(s,this)}}applyOperation(e){e._execute()}insertContent(e,t,s,...i){const r=dt(t,s);return this.fire("insertContent",[e,r,s,...i])}insertObject(e,t,s,i,...r){const o=dt(t,s);return this.fire("insertObject",[e,o,i,i,...r])}deleteContent(e,t){Io(this,e,t)}modifySelection(e,t){Xo(this,e,t)}getSelectedContent(e){return zo(this,e)}hasContent(e,t={}){const s=e instanceof u?e:u._createIn(e);if(s.isCollapsed)return!1;const{ignoreWhitespaces:i=!1,ignoreMarkers:r=!1}=t;if(!r){for(const o of this.markers.getMarkersIntersectingRange(s))if(o.affectsData)return!0}for(const o of s.getItems())if(this.schema.isContent(o))if(o.is("$textProxy"))if(i){if(o.data.search(/\S/)!==-1)return!0}else return!0;else return!0;return!1}canEditAt(e){const t=dt(e);return this.fire("canEditAt",[t])}createPositionFromPath(e,t,s){return new m(e,t,s)}createPositionAt(e,t){return m._createAt(e,t)}createPositionAfter(e){return m._createAfter(e)}createPositionBefore(e){return m._createBefore(e)}createRange(e,t){return new u(e,t)}createRangeIn(e){return u._createIn(e)}createRangeOn(e){return u._createOn(e)}createSelection(...e){return new $(...e)}createBatch(e){return new Pe(e)}createOperationFromJSON(e){return _o.fromJSON(e,this.document)}destroy(){this.document.destroy(),this.stopListening()}_runPendingChanges(){const e=[];this.fire("_beforeChanges");try{for(;this._pendingChanges.length;){const t=this._pendingChanges[0].batch;this._currentWriter=new No(this,t);const s=this._pendingChanges[0].callback(this._currentWriter);e.push(s),this.document._handleChangeBlock(this._currentWriter),this._pendingChanges.shift(),this._currentWriter=null}}finally{this._pendingChanges.length=0,this._currentWriter=null,this.fire("_afterChanges")}return e}}function dt(n,e){if(n)return n instanceof $||n instanceof K?n:n instanceof be?e||e===0?new $(n,e):n.is("rootElement")?new $(n,"in"):new $(n,"on"):new $(n)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qa extends Ee{constructor(){super(...arguments),this.domEventType="click"}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ua extends Ee{constructor(){super(...arguments),this.domEventType=["mousedown","mouseup","mouseover","mouseout"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class za{constructor(e){this.document=e}createDocumentFragment(e){return new me(this.document,e)}createElement(e,t,s){return new G(this.document,e,t,s)}createText(e){return new A(this.document,e)}clone(e,t=!1){return e._clone(t)}appendChild(e,t){return t._appendChild(e)}insertChild(e,t,s){return s._insertChild(e,t)}removeChildren(e,t,s){return s._removeChildren(e,t)}remove(e){const t=e.parent;return t?this.removeChildren(t.getChildIndex(e),1,t):[]}replace(e,t){const s=e.parent;if(s){const i=s.getChildIndex(e);return this.removeChildren(i,1,s),this.insertChild(i,t,s),!0}return!1}unwrapElement(e){const t=e.parent;if(t){const s=t.getChildIndex(e);this.remove(e),this.insertChild(s,e.getChildren(),t)}}rename(e,t){const s=new G(this.document,e,t.getAttributes(),t.getChildren());return this.replace(t,s)?s:null}setAttribute(e,t,s){s._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,s){Ae(e)&&s===void 0?t._setStyle(e):s._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,s){s._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}createPositionAt(e,t){return g._createAt(e,t)}createPositionAfter(e){return g._createAfter(e)}createPositionBefore(e){return g._createBefore(e)}createRange(e,t){return new w(e,t)}createRangeOn(e){return w._createOn(e)}createRangeIn(e){return w._createIn(e)}createSelection(...e){return new Q(...e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const na=/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i,ia=/^rgb\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}[0-9]{1,3}[ %]?\)$/i,ra=/^rgba\([ ]?([0-9]{1,3}[ %]?,[ ]?){3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,oa=/^hsl\([ ]?([0-9]{1,3}[ %]?[,]?[ ]*){3}(1|[0-9]+%|[0]?\.?[0-9]+)?\)$/i,aa=/^hsla\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,la=/\w+\((?:[^()]|\([^()]*\))*\)|\S+/gi,ca=new Set(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","orange","aliceblue","antiquewhite","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","gainsboro","ghostwhite","gold","goldenrod","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","limegreen","linen","magenta","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","oldlace","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","activeborder","activecaption","appworkspace","background","buttonface","buttonhighlight","buttonshadow","buttontext","captiontext","graytext","highlight","highlighttext","inactiveborder","inactivecaption","inactivecaptiontext","infobackground","infotext","menu","menutext","scrollbar","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","window","windowframe","windowtext","rebeccapurple","currentcolor","transparent"]);function ha(n){return n.startsWith("#")?na.test(n):n.startsWith("rgb")?ia.test(n)||ra.test(n):n.startsWith("hsl")?oa.test(n)||aa.test(n):ca.has(n.toLowerCase())}const ua=/^([+-]?[0-9]*([.][0-9]+)?(px|cm|mm|in|pc|pt|ch|em|ex|rem|vh|vw|vmin|vmax)|0)$/;function Ja(n){return ua.test(n)}const fa=/^[+-]?[0-9]*([.][0-9]+)?%$/;function Ga(n){return fa.test(n)}const da=["repeat-x","repeat-y","repeat","space","round","no-repeat"];function ma(n){return da.includes(n)}const ga=["center","top","bottom","left","right"];function pa(n){return ga.includes(n)}const _a=["fixed","scroll","local"];function wa(n){return _a.includes(n)}const ya=/^url\(/;function ba(n){return ya.test(n)}function va(n){const e=n.matchAll(la);return Array.from(e).map(t=>t[0])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ka(n){n.setNormalizer("background",Pa()),n.setNormalizer("background-color",Ca()),n.setReducer("background",ka()),n.setStyleRelation("background",["background-color"])}function Pa(){return n=>{const e={},t=va(n);for(const s of t)ma(s)?(e.repeat=e.repeat||[],e.repeat.push(s)):pa(s)?(e.position=e.position||[],e.position.push(s)):wa(s)?e.attachment=s:ha(s)?e.color=s:ba(s)&&(e.image=s);return{path:"background",value:e}}}function Ca(){return n=>({path:"background.color",value:n})}function ka(){return n=>{const e=[];return e.push(["background-color",n.color]),e}}export{Mt as B,$a as C,Ee as D,Da as E,Pt as F,_e as L,Ua as M,R as N,Se as O,xa as S,ne as T,za as U,Ri as a,Wa as b,Va as c,Pi as d,Ea as e,Ga as f,Ka as g,P as h,Ja as i,qa as j,La as t};
