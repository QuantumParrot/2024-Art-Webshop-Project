import{c as N}from"./calculator-CHDHV-Nf.js";import{m as U,P as B}from"./modal-YTNFo0Rw.js";import{h as H}from"./moment-Cl4UOzQZ.js";import{i as Y,j as v,a as T,m as D,_ as L,o as i,b as c,e,t as s,n as g,k as x,v as S,F as f,l as A,h as _,f as C,p as R,g as j,s as F,d as P,w,r as M,u as q}from"./index-rtmhHDvi.js";import{u as V,a as z}from"./alert-DgPhfteG.js";import{D as W}from"./DeleteModal-DNYn9Nww.js";var G={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:O,VITE_APP_PATH:k}=G,h=V(),u=z(),y=Y("adminOrder",{state:()=>({orders:[],statusCode:{0:{title:"未確認款項",color:""},1:{title:"已確認款項",color:""},2:{title:"安排出貨中",color:""},3:{title:"商品配送中",color:""},4:{title:"訂單已完成",color:""}},currentPage:1}),getters:{totalPages:({orders:t})=>Math.ceil(t.length/5)},actions:{switchPage(t){this.currentPage=t},getOrders(){h.createLoader("get-orders"),v.get(`${O}/api/${k}/admin/orders`).then(t=>{this.orders=t.data.orders,this.switchPage(1)}).catch(t=>u.errorAlert(t)).finally(()=>h.removeLoader("get-orders"))},updateOrder(t,o){const{code:l,order:b}=t,a=()=>{h.setLoader(b.id),v.put(`${O}/api/${k}/admin/order/${b.id}`,{data:{...b,status:Number(l)}}).then(m=>{u.toastAlert(m.data.message,"success"),o(),this.getOrders()}).catch(m=>u.errorAlert(m)).finally(()=>h.setLoader(""))};if(l===4){const m={title:"確定完成訂單？",text:"提醒您，完成訂單之後就無法修改狀態囉！"};u.checkAlert(m,a)}else a()},deleteOrder(t,o){h.createLoader("delete-order"),v.delete(`${O}/api/${k}/admin/order/${t}`).then(()=>{u.toastAlert("我們懷念它 (´;ω;`)","success"),o(),this.getOrders()}).catch(l=>u.errorAlert(l)).finally(()=>h.removeLoader("delete-order"))},downTheDrain(){u.multiverseAlert(()=>{h.createLoader("tan-tiau"),v.delete(`${O}/api/${k}/admin/orders/all`).then(()=>{u.toastAlert("沒了 ... 都沒了 (´;ω;`)","success"),this.getOrders()}).catch(t=>u.errorAlert(t)).finally(()=>h.removeLoader("tan-tiau"))})}}}),J={mixins:[U],props:["tempOrder"],data(){return{modal:"",tab:"content"}},computed:{...T(y,["statusCode"]),...T(V,["loadingTask"])},methods:{...D(y,["updateOrder"]),formatTime(t){return H(t).format("YYYY/MM/DD HH:mm:ss")},preUpdate(t){const o={code:+t.target.value,order:this.tempOrder};this.updateOrder(o,this.hideModal)}}},d=t=>(R("data-v-e5b297fa"),t=t(),j(),t),K={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},Q={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content"},Z={class:"modal-header"},ee={class:"fs-5 mb-0"},te=["disabled"],se=d(()=>e("i",{class:"bi bi-x-circle-fill"},null,-1)),oe=[se],le={class:"modal-body py-4"},ae={class:"nav nav-pills bg-light rounded-2 mb-3"},ne={class:"nav-item flex-grow-1"},de={class:"nav-item flex-grow-1"},re={class:"table table-light"},ie={class:"text-end"},ce={class:"fs-5 fw-bold"},me=d(()=>e("td",{colspan:"2"},"總計",-1)),ue={class:"text-end"},he={class:"mb-0"},_e=d(()=>e("span",null,"付款狀態：",-1)),pe=d(()=>e("span",{class:"badge bg-primary me-2"},"訂單成立日期",-1)),be=d(()=>e("hr",null,null,-1)),ge=d(()=>e("span",{class:"badge bg-primary me-2"},"姓名",-1)),fe=d(()=>e("hr",null,null,-1)),ve=d(()=>e("span",{class:"badge bg-primary me-2"},"電話",-1)),Oe=d(()=>e("hr",null,null,-1)),ke=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"地址")],-1)),ye=d(()=>e("hr",null,null,-1)),Pe=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"信箱")],-1)),we=d(()=>e("hr",null,null,-1)),Me=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"留言")],-1)),Te={class:"pre-wrap mb-0"},xe={key:0,class:"modal-footer"},Ae={class:"alert bg-light d-flex align-items-center gap-3 text-nowrap mb-0"},Ce={class:"d-flex align-items-center"},$e={key:0,class:"spinner-border text-primary me-3",role:"status"},Se=d(()=>e("span",null,"修改訂單狀態",-1)),De=["value","disabled"],Le=["value"];function Ve(t,o,l,b,a,m){return i(),c("div",K,[e("div",Q,[e("div",X,[e("div",Z,[e("h4",ee,s(l.tempOrder.id),1),e("button",{type:"button",class:"btn border-0 p-0 fs-4",disabled:!!t.loadingTask,onClick:o[0]||(o[0]=(...r)=>t.hideModal&&t.hideModal(...r))},oe,8,te)]),e("div",le,[e("ul",ae,[e("li",ne,[e("button",{type:"button",onClick:o[1]||(o[1]=r=>a.tab="content"),class:g(["w-100 nav-link",{active:a.tab==="content"}])}," 訂購商品",2)]),e("li",de,[e("button",{type:"button",onClick:o[2]||(o[2]=r=>a.tab="info"),class:g(["w-100 nav-link",{active:a.tab==="info"}])}," 客戶資訊",2)])]),x(e("div",null,[e("table",re,[e("tbody",null,[(i(!0),c(f,null,A(l.tempOrder.products,(r,p)=>(i(),c("tr",{key:p},[e("td",null,s(r.product.title),1),e("td",null,"× "+s(r.qty)+" "+s(r.product.unit),1),e("td",ie,"NT$ "+s(r.total),1)]))),128))]),e("tfoot",ce,[e("tr",null,[me,e("td",ue,"NT$ "+s(l.tempOrder.total),1)])])]),e("p",he,[_e,e("span",{class:g(l.tempOrder.is_paid?"text-success":"text-danger")},s(l.tempOrder.is_paid?"已付款":"未付款"),3)])],512),[[S,a.tab==="content"]]),x(e("div",null,[e("p",null,[pe,_(" "+s(m.formatTime(l.tempOrder.create_at*1e3)),1)]),be,e("p",null,[ge,_(" "+s(l.tempOrder.user.name),1)]),fe,e("p",null,[ve,_(" "+s(l.tempOrder.user.tel),1)]),Oe,ke,e("p",null,s(l.tempOrder.user.address),1),ye,Pe,e("p",null,s(l.tempOrder.user.email),1),we,Me,e("p",Te,s(l.tempOrder.message),1)],512),[[S,a.tab==="info"]])]),l.tempOrder.is_paid&&l.tempOrder.status!==4?(i(),c("div",xe,[e("div",Ae,[e("div",Ce,[t.loadingTask===l.tempOrder.id?(i(),c("div",$e)):C("",!0),Se]),e("select",{class:"form-select",value:l.tempOrder.status,onChange:o[3]||(o[3]=(...r)=>m.preUpdate&&m.preUpdate(...r)),disabled:!!t.loadingTask},[(i(!0),c(f,null,A(t.statusCode,(r,p)=>(i(),c("option",{key:p,value:p},s(r.title),9,Le))),128))],40,De)])])):C("",!0)])])],512)}const Ee=L(J,[["render",Ve],["__scopeId","data-v-e5b297fa"]]),Ie={mixins:[N],components:{PaginationComponent:B,AdminOrderModal:Ee,DeleteModal:W},data(){return{tempOrder:{user:{},products:{}},deletePermission:!1}},computed:{...T(y,["orders","statusCode","currentPage","totalPages"])},methods:{...D(y,["getOrders","switchPage","deleteOrder","downTheDrain"]),openModal(t,o){this.tempOrder={...t},o==="check"?this.$refs.orderModal.showModal():this.$refs.deleteModal.showModal()}},mounted(){this.getOrders()}},Ne={class:"text-end mb-7"},Ue=e("h3",{class:"fs-2 mb-2"},"訂單管理",-1),Be={class:"fs-6 text-muted"},He={class:"alert bg-light flex-classic mb-5"},Ye={class:"d-flex gap-2"},Re={for:"unlock",class:"btn btn-outline-primary"},je={class:"table table-hover text-nowrap"},Fe=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"10%"},"日期"),e("th",{scope:"col",width:"40%"},"訂單"),e("th",{scope:"col",width:"30%",class:"d-none d-md-table-cell text-end"},"總額"),e("th",{scope:"col",width:"15%",class:"text-center"},"狀態"),e("th",{scope:"col",class:"text-center"},"刪除")])],-1),qe={class:"align-middle"},ze=["onClick"],We={class:"me-2"},Ge=e("i",{class:"bi bi-search"},null,-1),Je={class:"d-none d-md-table-cell text-end"},Ke={class:"text-center"},Qe={class:"text-end"},Xe=["disabled","onClick"],Ze=e("i",{class:"bi bi-trash3-fill"},null,-1),et=[Ze],tt={key:1,class:"alert bg-light"},st={class:"mb-4"},ot={class:"text-muted"},lt={class:"mt-3"},at=e("b",null,"客戶姓名",-1),nt=e("b",null,"訂單總額",-1);function dt(t,o,l,b,a,m){const r=M("pagination-component"),p=M("admin-order-modal"),E=M("delete-modal");return i(),c(f,null,[e("div",Ne,[Ue,e("p",Be,[e("span",null,"目前共有 "+s(t.orders.length)+" 筆訂單，",1),e("span",null,"尚有 "+s(t.orders.filter(n=>!n.is_paid).length)+" 筆未結單",1)])]),t.orders.length?(i(),c(f,{key:0},[e("div",He,[e("div",Ye,[x(e("input",{type:"checkbox",id:"unlock",class:"btn-check","onUpdate:modelValue":o[0]||(o[0]=n=>a.deletePermission=n)},null,512),[[F,a.deletePermission]]),e("label",Re,[e("i",{class:g(["bi",a.deletePermission?"bi-unlock-fill":"bi-lock-fill"])},null,2)]),a.deletePermission?(i(),c("button",{key:0,type:"button",class:"btn btn-danger",onClick:o[1]||(o[1]=(...n)=>t.downTheDrain&&t.downTheDrain(...n))},"刪除所有訂單")):C("",!0)]),P(r,{current:t.currentPage,total:t.totalPages,onSwitchPage:t.switchPage},null,8,["current","total","onSwitchPage"])]),e("table",je,[Fe,e("tbody",qe,[(i(!0),c(f,null,A(t.orders,n=>{var $;return i(),c("tr",{key:n.id},[e("td",null,s(t.formatDate(n.create_at*1e3,"/")),1),e("td",null,[e("span",{class:g(["badge me-3",n.is_paid?"bg-success":"bg-danger"])},s(n.is_paid?"已付款":"未付款"),3),e("a",{href:"#",onClick:q(I=>m.openModal(n,"check"),["prevent"])},[e("span",We,s(n.user.name),1),Ge],8,ze)]),e("td",Je,"NT$ "+s(n.total),1),e("td",Ke,s(($=t.statusCode[n.status])==null?void 0:$.title),1),e("td",Qe,[e("button",{type:"button",class:"btn btn-outline-danger",disabled:!a.deletePermission,onClick:I=>m.openModal(n,"delete")},et,8,Xe)])])}),128))])])],64)):(i(),c("div",tt,"沒有訂單記錄")),P(p,{ref:"orderModal","temp-order":a.tempOrder},null,8,["temp-order"]),P(E,{ref:"deleteModal",onDeleteTarget:o[2]||(o[2]=n=>t.deleteOrder(a.tempOrder.id,this.$refs.deleteModal.hideModal))},{title:w(()=>[_("確定刪除訂單！？")]),alert:w(()=>[_("這是客人的訂單欸！你要確定欸！(ﾟдﾟ≡ﾟдﾟ)")]),itemDetail:w(()=>[e("details",st,[e("summary",null,[_("訂單編號："),e("span",ot,s(a.tempOrder.id),1)]),e("p",lt,[at,_("："+s(a.tempOrder.user.name),1)]),e("p",null,[nt,_("：NT$ "+s(a.tempOrder.total),1)])])]),_:1},512)],64)}const _t=L(Ie,[["render",dt]]);export{_t as default};
