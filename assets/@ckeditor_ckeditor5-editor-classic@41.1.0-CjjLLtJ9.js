import{E as g,n as u,D as h,a as m,S as f,T as w,I as p}from"./@ckeditor_ckeditor5-ui@41.1.0-CruSshla.js";import{i as b,R as d,C as y,j as v}from"./@ckeditor_ckeditor5-utils@41.1.0-Cn-yVoWx.js";import"./color-convert@2.0.1-DwB1f1Hp.js";import{a as P,D as T,b as k,E,c as C}from"./@ckeditor_ckeditor5-core@41.1.0-D0yh88O_.js";import{e as S}from"./@ckeditor_ckeditor5-engine@41.1.0-CtehaBhy.js";import{E as R,C as x}from"./@ckeditor_ckeditor5-watchdog@41.1.0-B5W-sfM8.js";import{a as _}from"./lodash-es@4.17.21-C5qYGfgy.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class F extends g{constructor(t,e){super(t),this.view=e,this._toolbarConfig=u(t.config.get("toolbar")),this._elementReplacer=new b,this.listenTo(t.editing.view,"scrollToTheSelection",this._handleScrollToTheSelectionWithStickyPanel.bind(this))}get element(){return this.view.element}init(t){const e=this.editor,o=this.view,i=e.editing.view,n=o.editable,s=i.document.getRoot();n.name=s.rootName,o.render();const c=n.element;this.setEditableElement(n.name,c),o.editable.bind("isFocused").to(this.focusTracker),i.attachDomRoot(c),t&&this._elementReplacer.replace(t,this.element),this._initPlaceholder(),this._initToolbar(),this._initDialogPluginIntegration(),this.fire("ready")}destroy(){super.destroy();const t=this.view,e=this.editor.editing.view;this._elementReplacer.restore(),e.detachDomRoot(t.editable.name),t.destroy()}_initToolbar(){const t=this.view;t.stickyPanel.bind("isActive").to(this.focusTracker,"isFocused"),t.stickyPanel.limiterElement=t.element,t.stickyPanel.bind("viewportTopOffset").to(this,"viewportOffset",({top:e})=>e||0),t.toolbar.fillFromConfig(this._toolbarConfig,this.componentFactory),this.addToolbar(t.toolbar)}_initPlaceholder(){const t=this.editor,e=t.editing.view,o=e.document.getRoot(),i=t.sourceElement;let n;const s=t.config.get("placeholder");s&&(n=typeof s=="string"?s:s[this.view.editable.name]),!n&&i&&i.tagName.toLowerCase()==="textarea"&&(n=i.getAttribute("placeholder")),n&&(o.placeholder=n),S({view:e,element:o,isDirectHost:!1,keepOnFocus:!0})}_handleScrollToTheSelectionWithStickyPanel(t,e,o){const i=this.view.stickyPanel;if(i.isSticky){const n=new d(i.element).height;e.viewportOffset.top+=n}else{const n=()=>{this.editor.editing.view.scrollToTheSelection(o)};this.listenTo(i,"change:isSticky",n),setTimeout(()=>{this.stopListening(i,"change:isSticky",n)},20)}}_initDialogPluginIntegration(){if(!this.editor.plugins.has("Dialog"))return;const t=this.view.stickyPanel,e=this.editor.plugins.get("Dialog");e.on("show",()=>{const o=e.view;o.on("moveTo",(i,n)=>{if(!t.isSticky||o.wasMoved)return;const s=new d(t.contentPanelElement);n[1]<s.bottom+h.defaultOffset&&(n[1]=s.bottom+h.defaultOffset)},{priority:"high"})},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V extends m{constructor(t,e,o={}){super(t),this.stickyPanel=new f(t),this.toolbar=new w(t,{shouldGroupWhenFull:o.shouldToolbarGroupWhenFull}),this.editable=new p(t,e)}render(){super.render(),this.stickyPanel.content.add(this.toolbar),this.top.add(this.stickyPanel),this.main.add(this.editable)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class r extends T(E(C)){constructor(t,e={}){if(!a(t)&&e.initialData!==void 0)throw new y("editor-create-initial-data",null);super(e),this.config.get("initialData")===void 0&&this.config.set("initialData",D(t)),a(t)&&(this.sourceElement=t),this.model.document.createRoot();const o=!this.config.get("toolbar.shouldNotGroupWhenFull"),i=new V(this.locale,this.editing.view,{shouldToolbarGroupWhenFull:o});this.ui=new F(this,i),k(this)}destroy(){return this.sourceElement&&this.updateSourceElement(),this.ui.destroy(),super.destroy()}static create(t,e={}){return new Promise(o=>{const i=new this(t,e);o(i.initPlugins().then(()=>i.ui.init(a(t)?t:null)).then(()=>i.data.init(i.config.get("initialData"))).then(()=>i.fire("ready")).then(()=>i))})}}r.Context=P;r.EditorWatchdog=R;r.ContextWatchdog=x;function D(l){return a(l)?v(l):l}function a(l){return _(l)}export{r as C};
