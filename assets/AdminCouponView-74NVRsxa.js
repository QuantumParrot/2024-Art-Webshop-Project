import{d as M,a as $,m as S}from"./pinia@2.1.7_vue@3.4.19-CHKlOEZr.js";import{a as h}from"./axios@1.6.7-Di5RpEPX.js";import{l as V,a as A}from"./alert-rz954VAU.js";import{m as P}from"./modal-CDwUaSdC.js";import{l as L,v as E}from"./@vue_runtime-dom@3.4.19-AC5g8dxk.js";import{_ as k}from"./index-D6-Ga_jm.js";import{aj as r,O as p,P as e,c as u,aH as T,aJ as w,aq as g,F as x,ao as q}from"./@vue_runtime-core@3.4.19-CGfIweqO.js";import{P as D}from"./PaginationComponent-CPEO26-U.js";import{P as _}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./sweetalert2@11.10.5-BCnrvazC.js";import"./@ckeditor_ckeditor5-vue@5.1.0-CegNn2NB.js";import"./vue@3.4.19-CdjQKHui.js";import"./bootstrap@5.3.2_@popperjs_core@2.11.8-D5C7Xrhu.js";import"./@popperjs_core@2.11.8-B-7x2Wgm.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-Bp4gs7Rm.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-Bg5iSJV4.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-DG0Fkrwv.js";import"./vue-router@4.2.5_vue@3.4.19-DxgIm9Z7.js";var U={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:f,VITE_APP_PATH:b}=U,l=V(),d=A(),y=M("adminCoupon",{state:()=>({coupons:[],pagination:{}}),actions:{getCoupons(o=1){l.createLoader("get-coupons"),h.get(`${f}/api/${b}/admin/coupons?page=${o}`).then(t=>{const{coupons:s,pagination:v}=t.data;this.coupons=s,this.pagination=v}).catch(t=>d.errorAlert(t)).finally(()=>l.removeLoader("get-coupons"))},createCoupon(o,t){l.createLoader("create-coupon"),h.post(`${f}/api/${b}/admin/coupon`,{data:o}).then(s=>{d.toastAlert(s.data.message,"success"),t(),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("create-coupon"))},updateCoupon(o,t){l.createLoader("update-coupon"),h.put(`${f}/api/${b}/admin/coupon/${o.id}`,{data:o}).then(s=>{d.toastAlert(s.data.message,"success"),t(),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("update-coupon"))},deleteCoupon(o){const t={title:"確定刪除優惠券？",text:`優惠券名稱：${o.title}`};d.checkAlert(t,()=>{l.createLoader("delete-coupon"),h.delete(`${f}/api/${b}/admin/coupon/${o.id}`).then(s=>{d.toastAlert(s.data.message,"success"),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("delete-coupon"))})},switchCouponStatus(o){const t=!!o.is_enabled;l.createLoader("switch-coupon-status"),h.put(`${f}/api/${b}/admin/coupon/${o.id}`,{data:{...o,is_enabled:t?0:1}}).then(()=>{d.toastAlert(`成功${t?"取消":"開啟"}優惠券`,"success"),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("switch-coupon-status"))}}}),I={mixins:[P],data(){return{coupon:{}}},props:["tempCoupon"],computed:{due_date:{get(){return this.$calc.formatDate(this.coupon.due_date*1e3)},set(o){this.coupon.due_date=new Date(o).getTime()/1e3}}},watch:{tempCoupon(){this.coupon=this.tempCoupon}},methods:{...$(y,["createCoupon","updateCoupon"]),...$(A,["toastAlert"]),confirmUpdate(){this.coupon.id?this.updateCoupon(this.coupon,this.hideModal):this.createCoupon(this.coupon,this.hideModal)}},mounted(){this.coupon=this.tempCoupon}},j={class:"modal fade",tabindex:"-1",ref:"modal"},B={class:"modal-dialog modal-dialog-centered"},H={class:"modal-content"},O={class:"modal-header justify-content-end"},R=e("i",{class:"bi bi-x-circle-fill"},null,-1),F=[R],N={class:"modal-body"},J={class:"mb-3"},W=e("label",{class:"form-label is-required",for:"title"},"優惠券名稱",-1),z={class:"mb-3"},G=e("label",{class:"form-label is-required",for:"code"},"優惠碼",-1),K={class:"mb-3"},Q=e("div",{class:"flex-classic mb-2"},[e("label",{class:"is-required",for:"percent"},"折扣"),e("span",{class:"fs-7 text-danger mb-0"},"必須是 1 ～ 100 之間的整數")],-1),X={class:"input-group"},Y=e("span",{class:"input-group-text"},"％",-1),Z={class:"mb-3"},ee=e("label",{class:"form-label is-required",for:"due_date"},[e("span",null,"優惠截止日期")],-1),oe=["min"],te={class:"modal-footer justify-content-between align-items-center"},se={class:"form-check"},ne=e("label",{class:"form-label",for:"is_enabled"}," 是否啟用",-1),ae=["disabled"];function ie(o,t,s,v,i,c){const m=g("v-field"),C=g("v-form");return r(),p("div",j,[e("div",B,[e("div",H,[e("div",O,[e("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:t[0]||(t[0]=(...n)=>o.hideModal&&o.hideModal(...n))},F)]),u(C,{onSubmit:c.confirmUpdate,ref:"form"},{default:T(({meta:n})=>[e("div",N,[e("div",J,[W,u(m,{id:"title",type:"text",class:"form-control",modelValue:i.coupon.title,"onUpdate:modelValue":t[1]||(t[1]=a=>i.coupon.title=a),modelModifiers:{trim:!0},name:"title",rules:"required"},null,8,["modelValue"])]),e("div",z,[G,u(m,{id:"code",type:"text",class:"form-control",modelValue:i.coupon.code,"onUpdate:modelValue":t[2]||(t[2]=a=>i.coupon.code=a),modelModifiers:{trim:!0},name:"code",rules:"required"},null,8,["modelValue"])]),e("div",K,[Q,e("div",X,[u(m,{id:"percent",type:"number",min:"1",max:"100",class:"form-control",modelValue:i.coupon.percent,"onUpdate:modelValue":t[3]||(t[3]=a=>i.coupon.percent=a),modelModifiers:{number:!0},name:"percent",rules:"required|integer|min_value:1|max_value:100"},null,8,["modelValue"]),Y])]),e("div",Z,[ee,w(e("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=a=>c.due_date=a),min:o.$calc.today()},null,8,oe),[[L,c.due_date]])])]),e("div",te,[e("div",se,[w(e("input",{id:"is_enabled",type:"checkbox",class:"form-check-input","onUpdate:modelValue":t[5]||(t[5]=a=>i.coupon.is_enabled=a),"true-value":1,"false-value":0},null,512),[[E,i.coupon.is_enabled]]),ne]),e("div",null,[e("button",{type:"submit",class:"btn btn-primary me-2",disabled:!n.valid},"確認更新",8,ae),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[6]||(t[6]=(...a)=>o.hideModal&&o.hideModal(...a))},"取消")])])]),_:1},8,["onSubmit"])])])],512)}const le=k(I,[["render",ie]]),de={components:{AdminCouponModal:le,PaginationComponent:D},data(){return{tempCoupon:{}}},computed:{...S(y,["coupons","pagination"])},methods:{...$(y,["getCoupons","deleteCoupon","switchCouponStatus"]),openModal(o){this.tempCoupon=o?{...o}:{is_enabled:0,due_date:this.$calc.now()},this.$refs.couponModal.showModal()}},mounted(){this.getCoupons()}},ce={class:"text-end mb-7"},re=e("h3",{class:"fs-2 mb-2"},"優惠券",-1),pe={class:"text-muted"},ue={class:"alert bg-gray flex-classic mb-5"},me={key:0,class:"table-responsive"},he={class:"table table-hover text-nowrap"},_e=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"10%"},"到期"),e("th",{scope:"col",width:"50%"},"名稱"),e("th",{scope:"col",width:"15%",class:"text-end"},"折扣"),e("th",{scope:"col",width:"10%",class:"text-center"},"狀態"),e("th",{scope:"col",width:"15%",class:"text-center"},"處理")])],-1),fe={class:"align-middle"},be={class:"d-flex align-items-center gap-2"},ge={class:"badge bg-primary py-2"},ve={class:"text-end"},Ce={class:"text-center"},$e={class:"form-switch"},ye=["checked","onChange"],we={class:"text-center"},xe={class:"d-flex flex-column gap-2"},Ae=["onClick"],ke=["onClick"],Me={key:1,class:"alert bg-gray"};function Se(o,t,s,v,i,c){const m=g("pagination-component"),C=g("admin-coupon-modal");return r(),p(x,null,[e("div",ce,[re,e("p",pe,"目前共有 "+_(o.coupons.length)+" 張優惠券",1)]),e("div",ue,[e("div",null,[e("button",{type:"button",class:"btn btn-highlight",onClick:t[0]||(t[0]=n=>c.openModal())},"建立優惠券")]),u(m,{current:o.pagination.current_page,total:o.pagination.total_pages,onSwitchPage:o.getCoupons},null,8,["current","total","onSwitchPage"])]),o.coupons.length?(r(),p("div",me,[e("table",he,[_e,e("tbody",fe,[(r(!0),p(x,null,q(o.coupons,n=>(r(),p("tr",{key:n.id},[e("td",null,_(o.$calc.formatDate(n.due_date*1e3,"/")),1),e("td",null,[e("div",be,[e("span",null,_(n.title),1),e("span",ge,_(n.code),1)])]),e("td",ve,_(n.percent)+"％",1),e("td",Ce,[e("div",$e,[e("input",{type:"checkbox",role:"switch",class:"form-check-input",checked:n.is_enabled,onChange:a=>o.switchCouponStatus(n)},null,40,ye)])]),e("td",we,[e("div",xe,[e("button",{type:"button",class:"w-100 btn btn-outline-secondary",onClick:a=>c.openModal(n)}," 編輯",8,Ae),e("button",{type:"button",class:"w-100 btn btn-outline-danger",onClick:a=>o.deleteCoupon(n)}," 刪除",8,ke)])])]))),128))])])])):(r(),p("div",Me,"還沒有任何優惠券！趕快建立一個吧！")),u(C,{ref:"couponModal","temp-coupon":i.tempCoupon},null,8,["temp-coupon"])],64)}const Ze=k(de,[["render",Se]]);export{Ze as default};
