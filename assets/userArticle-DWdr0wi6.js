import{a as c}from"./axios@1.6.7-Di5RpEPX.js";import{d}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as g,a as f}from"./alert-9WsjHxyk.js";import{u as p}from"./userProduct-DCBWQa0S.js";var P={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const l=g(),h=f(),{VITE_APP_SITE:n,VITE_APP_PATH:u}=P,$=d("userArticle",{state:()=>({articles:[],article:{},filter:"",relatedProducts:[],currentPage:{column:1,news:1}}),getters:{news:({articles:t})=>t.filter(e=>e.type==="網站公告").sort((e,a)=>a.create_at-e.create_at),newsList:({news:t,currentPage:e})=>{t.filter((a,s)=>Math.floor(s/5)+1===e.news)},columns:({articles:t})=>t.filter(e=>e.type==="專欄文章"),columnList:({columns:t,filter:e,currentPage:a})=>{const{column:s}=a;return(e?t.filter(i=>i.category===e):t).filter((i,o)=>Math.floor(o/9)+1===s)},projects:({articles:t})=>t.filter(e=>e.type==="公益計劃"),totalPages:({columns:t,news:e})=>({column:Math.ceil(t.length/9),news:Math.ceil(e.length/5)})},actions:{getArticles(){l.createLoader("get-user-articles"),c.get(`${n}/api/${u}/articles`).then(t=>{this.articles=t.data.articles}).catch(t=>h.errorAlert(t)).finally(()=>l.removeLoader("get-user-articles"))},getArticle(t){l.createLoader("get-single-article"),c.get(`${n}/api/${u}/article/${t}`).then(e=>{this.article=e.data.article,this.article.type==="專欄文章"?(this.router.push(`/article/${this.article.id}`),this.getRelatedProducts(this.article.tag)):this.router.push(`/news/${this.article.id}`)}).catch(e=>h.errorAlert(e)).finally(()=>l.removeLoader("get-single-article"))},switchFilter(t){this.filter=t},switchPage(t,e){this.currentPage[e]=t},async getRelatedProducts(t){const{getRandomProducts:e}=p(),a=await c.get(`${n}/api/${u}/products/all`),s=Object.values(a.data.products);let r=[];Array.isArray(t)&&(r=s.filter(i=>i.tags.some(o=>t.includes(o)))),r.length>3?r=e(r,3):r.push(...e(s,Math.abs(r.length-3))),this.relatedProducts=r}}});export{$ as u};
