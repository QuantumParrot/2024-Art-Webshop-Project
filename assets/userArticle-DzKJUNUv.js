import{a as o}from"./axios@1.6.7-Di5RpEPX.js";import{d}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as p,a as f}from"./alert-BXjizhtP.js";import{u as g}from"./userProduct-zxWCHpn-.js";var m={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=p(),u=f(),{VITE_APP_SITE:n,VITE_APP_PATH:h}=m,y=d("userArticle",{state:()=>({articles:[],article:{},filter:"",relatedProducts:[],currentPage:{column:1,news:1}}),getters:{news:({articles:e})=>e.filter(t=>t.type==="網站公告").sort((t,r)=>r.create_at-t.create_at),newsList:({news:e,currentPage:t})=>{e.filter((r,s)=>Math.floor(s/5)+1===t.news)},columns:({articles:e})=>e.filter(t=>t.type==="專欄文章"),columnList:({columns:e,filter:t,currentPage:r})=>{const{column:s}=r;return(t?e.filter(i=>i.category===t):e).filter((i,l)=>Math.floor(l/9)+1===s)},projects:({articles:e})=>e.filter(t=>t.type==="公益計劃"),totalPages:({columns:e,news:t})=>({column:Math.ceil(e.length/9),news:Math.ceil(t.length/5)})},actions:{getArticles(e=1){const t=`${n}/api/${h}/articles?page=`;c.createLoader("get-user-articles"),o.get(`${t}${e}`).then(r=>{const{articles:s,pagination:a}=r.data;if(this.articles=s,a.total_pages>1){const i=[];for(let l=2;l<=a.total_pages;l+=1)i.push(o.get(`${t}${l}`));return Promise.all(i)}return!1}).then(r=>{Array.isArray(r)&&r.forEach(s=>this.articles.push(...s.data.articles))}).catch(r=>u.errorAlert(r)).finally(()=>c.removeLoader("get-user-articles"))},getArticle(e){c.createLoader("get-single-article"),o.get(`${n}/api/${h}/article/${e}`).then(t=>{this.article=t.data.article,this.article.type==="專欄文章"?(this.router.push(`/article/${this.article.id}`),this.article.recommend&&this.getRelatedProducts(this.article.tag)):this.router.push(`/news/${this.article.id}`)}).catch(t=>u.errorAlert(t)).finally(()=>c.removeLoader("get-single-article"))},switchFilter(e){this.filter=e},switchPage(e,t){this.currentPage[t]=e},async getRelatedProducts(e){const{getRandomProducts:t}=g(),r=await o.get(`${n}/api/${h}/products/all`),s=Object.values(r.data.products);let a=[];Array.isArray(e)&&(a=s.filter(i=>i.tags.some(l=>e.includes(l)))),a.length>3?a=t(a,3):a.push(...t(s,Math.abs(a.length-3))),this.relatedProducts=a}}});export{y as u};
