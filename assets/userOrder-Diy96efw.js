import{a as c}from"./axios@1.6.7-Di5RpEPX.js";import{d as l}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as n,a as p}from"./alert-DjlOGdg_.js";import{c as m}from"./userCart-Mdye1_nz.js";var u={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const a=n(),s=p(),f=m(),{VITE_APP_SITE:i,VITE_APP_PATH:d}=u,$=l("userOrder",{state:()=>({order:{},tempOrder:{}}),actions:{getOrder(e,r){a.createLoader("get-single-order"),c.get(`${i}/api/${d}/order/${e}`).then(o=>{const{order:t}=o.data;t!==null?this.order=this.refactorOrder(t):s.toastAlert("查無此訂單","error")}).finally(()=>{typeof r=="function"&&r(),a.removeLoader("get-single-order")})},createOrder(e){const r={message:e.message,project:e.project||"不指定",state:0},o={user:{name:e.name,tel:e.tel,address:e.address,email:e.email},message:JSON.stringify(r)};a.createLoader("create-order"),c.post(`${i}/api/${d}/order`,{data:o}).then(t=>(s.toastAlert(t.data.message,"success"),c.get(`${i}/api/${d}/order/${t.data.orderId}`))).then(t=>{this.tempOrder=this.refactorOrder(t.data.order),this.router.replace("/checkout/order")}).catch(t=>s.errorAlert(t)).finally(()=>a.removeLoader("create-order"))},refactorOrder(e){const r=+e.total.toFixed(0);if(e.message.startsWith('{"')){const o=JSON.parse(e.message);return{...e,message:o.message,state:+o.state,project:o.project,total:r}}return{...e,state:e.state||0,project:e.project||"不指定",total:r}},payOrder(e){a.createLoader("pay-order"),c.post(`${i}/api/${d}/pay/${e}`).then(()=>{const r={title:"謝謝您！",text:"我們將立即為您出貨，敬請耐心等待等候！",icon:"success",buttonColor:"#424242"};s.modalAlert(r),f.getCarts(),this.getOrder(e),setTimeout(()=>this.router.push("/"),1500)}).catch(r=>s.errorAlert(r)).finally(()=>a.removeLoader("pay-order"))}}});export{$ as u};
