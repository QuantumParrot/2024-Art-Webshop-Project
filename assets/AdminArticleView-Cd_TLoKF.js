import{c as U}from"./calculator-BHGMByDI.js";import{d as N,m as k,a as B}from"./pinia@2.1.7_vue@3.4.19-BaxWQ2Jo.js";import{a as b}from"./axios@1.6.7-Di5RpEPX.js";import{l as $,a as L}from"./alert-se1nEnsJ.js";import{b as F}from"./@ckeditor_ckeditor5-vue@5.1.0-BRsWHAsX.js";import{m as R,P as j}from"./modal-DAYTWpTV.js";import{C as O}from"./@ckeditor_ckeditor5-editor-classic@41.1.0-C5gT8LbW.js";import{E as z}from"./@ckeditor_ckeditor5-essentials@41.1.0-C75rVVOj.js";import{B as W,I as J}from"./@ckeditor_ckeditor5-basic-styles@41.1.0-Bl6ixVuM.js";import"./@ckeditor_ckeditor5-utils@41.1.0-Cn-yVoWx.js";import"./@ckeditor_ckeditor5-core@41.1.0-D0yh88O_.js";import"./@ckeditor_ckeditor5-engine@41.1.0-CtehaBhy.js";import"./@ckeditor_ckeditor5-ui@41.1.0-CAo3E1r6.js";import"./color-convert@2.0.1-_RKowGEt.js";import{L as G}from"./@ckeditor_ckeditor5-link@41.1.0-CzUv6QZd.js";import"./@ckeditor_ckeditor5-widget@41.1.0-CCeCQ99-.js";import"./@ckeditor_ckeditor5-clipboard@41.1.0-CSBXoIoC.js";import{H as K}from"./@ckeditor_ckeditor5-heading@41.1.0-CJzcqE4y.js";import"./@ckeditor_ckeditor5-paragraph@41.1.0-DXqD23bY.js";import{F as Q}from"./@ckeditor_ckeditor5-font@41.1.0-C6OuEVWC.js";import{U as X}from"./UploadForm-DvcbQblo.js";import{m as C,l as Y,v as Z}from"./@vue_runtime-dom@3.4.19-DVfTC9pq.js";import{_ as D}from"./index-6yln5vpf.js";import{aj as u,O as h,P as t,c as n,aH as tt,aJ as v,F as I,ao as q,N as et,aq as g,al as ot,ak as it}from"./@vue_runtime-core@3.4.19-CzGklseq.js";import{n as E,P as A}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./sweetalert2@11.10.5-D1b63BCh.js";import"./vue@3.4.19-bS3wBxtn.js";import"./bootstrap@5.3.2_@popperjs_core@2.11.8-aNy9Y6fu.js";import"./@ckeditor_ckeditor5-watchdog@41.1.0-B5W-sfM8.js";import"./lodash-es@4.17.21-C5qYGfgy.js";import"./@ckeditor_ckeditor5-typing@41.1.0-DSIargVI.js";import"./@ckeditor_ckeditor5-enter@41.1.0-CzFUQWGc.js";import"./@ckeditor_ckeditor5-select-all@41.1.0-DIHXo6am.js";import"./@ckeditor_ckeditor5-undo@41.1.0-BeXJaCFG.js";import"./color-parse@1.4.2-DPQjrGBK.js";import"./color-name@1.1.4-Dc5RlJww.js";import"./vanilla-colorful@0.7.2-PEGE98j7.js";import"./clipboard@2.0.11-BIMaK3BZ.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-CIwtLcK9.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-CtCrC8gK.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-Cp1hpGuW.js";import"./vue-router@4.2.5_vue@3.4.19-CGkOaO3i.js";var st={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:y,VITE_APP_PATH:w}=st,m=$(),p=L(),M=N("adminArticle",{state:()=>({articles:[],pagination:{}}),getters:{tags:({articles:o})=>{const e=[];return o.forEach(l=>l.tag.forEach((c,i)=>{i!==0&&!e.includes(c)&&e.push(c)})),e}},actions:{getArticles(o=1){m.createLoader("get-articles"),b.get(`${y}/api/${w}/admin/articles?page=${o}`).then(e=>{const{articles:l,pagination:c}=e.data;this.articles=l.sort((i,d)=>d.create_at-i.create_at),this.pagination=c}).catch(e=>p.errorAlert(e)).finally(()=>m.removeLoader("get-articles"))},createArticle(o,e){m.createLoader("create-article"),b.post(`${y}/api/${w}/admin/article`,{data:o}).then(l=>{p.toastAlert(l.data.message,"success"),e(),this.getArticles()}).catch(l=>p.errorAlert(l)).finally(()=>m.removeLoader("create-article"))},updateArticle(o,e){m.createLoader("update-article"),b.put(`${y}/api/${w}/admin/article/${o.id}`,{data:o}).then(l=>{p.toastAlert(l.data.message,"success"),e(),this.getArticles()}).catch(l=>p.errorAlert(l)).finally(()=>m.removeLoader("update-article"))},deleteArticle(o,e){const l={title:"確定刪除文章？",text:`名稱：${e}`};p.checkAlert(l,()=>{m.createLoader("delete-article"),b.delete(`${y}/api/${w}/admin/article/${o}`).then(c=>{p.toastAlert(c.data.message,"success"),this.getArticles()}).catch(c=>p.errorAlert(c)).finally(()=>m.removeLoader("delete-article"))})},switchArticleStatus(o){const e=o.isPublic;m.createLoader("switch-article-status"),b.put(`${y}/api/${w}/admin/article/${o.id}`,{data:{...o,content:o.description,isPublic:!o.isPublic}}).then(()=>{p.toastAlert(`文章已${e?"隱藏":"公開"}`,"success"),this.getArticles()}).catch(l=>p.errorAlert(l)).finally(()=>m.removeLoader("switch-article-status"))}}}),f=["mb-3"],lt={options:[{model:"paragraph",view:{name:"p",classes:["fs-6",...f]},title:"paragraph"},{model:"heading1",view:{name:"h2",classes:["fs-2",...f]},title:"bootstrap - H2"},{model:"heading2",view:{name:"h3",classes:["fs-3",...f]},title:"bootstrap - H3"},{model:"heading3",view:{name:"h4",classes:["fs-4",...f]},title:"bootstrap - H4"},{model:"heading4",view:{name:"h5",classes:["fs-5",...f]},title:"bootstrap - H5"},{model:"text",view:{name:"p",classes:["fs-7",...f]},title:"small text"}]},at={data(){return{editor:O,editorConfig:{plugins:[z,W,J,G,K,Q],toolbar:{items:["undo","redo","|","heading","bold","italic","fontSize","fontFamily","fontColor","|","link"]},heading:lt}}}},rt={mixins:[R,at,U],components:{ckeditor:F.component,UploadForm:X},props:["tempArticle"],data(){return{tab:"setting",article:{},category:"",uploadState:!1}},computed:{createAt:{get(){return this.formatDate(this.article.create_at*1e3)},set(o){this.article.create_at=new Date(o).getTime()/1e3}}},methods:{...k(M,["createArticle","updateArticle"]),updateData(){if(this.article=this.tempArticle,Array.isArray(this.tempArticle.tag)){const[o,...e]=this.tempArticle.tag;this.category=o,this.article.tag=e}else this.category="",this.article.tag=[]},confirmUpdate(){this.article.tag=this.article.tag.filter(o=>o),this.article.tag.unshift(this.category),this.article.id?this.updateArticle(this.article,this.hideModal):this.createArticle(this.article,this.hideModal)},addNewImage(o){this.article.image=o},updateUploadState(o){this.uploadState=o}},watch:{tempArticle(){this.updateData()}},mounted(){this.updateData()}},r=o=>(ot("data-v-f83a9722"),o=o(),it(),o),nt={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},ct={class:"modal-dialog modal-dialog-centered"},dt={class:"modal-content"},mt={class:"modal-header justify-content-end"},pt=r(()=>t("i",{class:"bi bi-x-circle-fill"},null,-1)),ut=[pt],ht={class:"modal-body"},_t={class:"nav nav-pills bg-light rounded-2 mb-3"},gt={class:"nav-item flex-grow-1"},ft={class:"nav-item flex-grow-1"},bt={class:"nav-item flex-grow-1"},vt={class:"mb-3"},At=r(()=>t("label",{class:"form-label is-required",for:"title"},"文章標題",-1)),yt={class:"mb-3"},wt=r(()=>t("label",{class:"form-label is-required",for:"description"},"文章摘要",-1)),Pt={class:"mb-3"},kt={class:"row row-cols-2"},Vt={class:"col"},St=r(()=>t("label",{class:"form-label is-required",for:"author"},"文章作者",-1)),xt={class:"col"},Ct={class:"mb-3"},Et=r(()=>t("label",{class:"form-label is-required",for:"create_at"},[t("span",null,"發表日期")],-1)),It={class:"mb-3"},Mt=r(()=>t("label",{class:"form-label is-required",for:"category"},[t("span",null,"文章分類")],-1)),Tt={class:"mb-3"},Ut=r(()=>t("p",null,"標籤",-1)),$t={class:"row g-3 mb-3"},Lt=["onUpdate:modelValue"],Dt=["onClick"],qt=r(()=>t("i",{class:"bi bi-x-lg"},null,-1)),Ht=[qt],Nt={class:"mb-3"},Bt=r(()=>t("label",{class:"form-label is-required",for:"image"},"文章圖片",-1)),Ft=["src","alt"],Rt=r(()=>t("hr",null,null,-1)),jt=r(()=>t("hr",null,null,-1)),Ot=r(()=>t("p",{class:"is-required"},"文章內容",-1)),zt={class:"modal-footer justify-content-between align-items-center"},Wt={class:"form-check"},Jt=r(()=>t("label",{class:"form-label",for:"isPublic"}," 是否公開",-1)),Gt=["disabled"];function Kt(o,e,l,c,i,d){const V=g("loading-overlay"),_=g("v-field"),a=g("upload-form"),P=g("ckeditor"),H=g("v-form");return u(),h("div",nt,[t("div",ct,[n(V,{"is-loading":i.uploadState,"is-full":!1},null,8,["is-loading"]),t("div",dt,[t("div",mt,[t("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:e[0]||(e[0]=(...S)=>o.hideModal&&o.hideModal(...S))},ut)]),n(H,{onSubmit:d.confirmUpdate,ref:"form"},{default:tt(({meta:S})=>[t("div",ht,[t("ul",_t,[t("li",gt,[t("button",{type:"button",onClick:e[1]||(e[1]=s=>i.tab="setting"),class:E(["w-100 nav-link",{active:i.tab==="setting"}])}," 文章設定",2)]),t("li",ft,[t("button",{type:"button",onClick:e[2]||(e[2]=s=>i.tab="category"),class:E(["w-100 nav-link",{active:i.tab==="category"}])}," 文章分類",2)]),t("li",bt,[t("button",{type:"button",onClick:e[3]||(e[3]=s=>i.tab="image"),class:E(["w-100 nav-link",{active:i.tab==="image"}])}," 文章圖片",2)])]),v(t("div",null,[t("div",vt,[At,n(_,{id:"title",type:"text",class:"form-control",modelValue:i.article.title,"onUpdate:modelValue":e[4]||(e[4]=s=>i.article.title=s),modelModifiers:{trim:!0},name:"title",rules:"required"},null,8,["modelValue"])]),t("div",yt,[wt,n(_,{id:"title",rows:"3",class:"form-control",modelValue:i.article.description,"onUpdate:modelValue":e[5]||(e[5]=s=>i.article.description=s),modelModifiers:{trim:!0},name:"description",as:"textarea"},null,8,["modelValue"])]),t("div",Pt,[t("div",kt,[t("div",Vt,[St,n(_,{id:"author",type:"text",class:"form-control",modelValue:i.article.author,"onUpdate:modelValue":e[6]||(e[6]=s=>i.article.author=s),modelModifiers:{trim:!0},name:"author",rules:"required"},null,8,["modelValue"])]),t("div",xt,[t("div",Ct,[Et,n(_,{id:"create_at",type:"date",class:"form-control",modelValue:d.createAt,"onUpdate:modelValue":e[7]||(e[7]=s=>d.createAt=s),name:"create_at",rules:"required"},null,8,["modelValue"])])])])])],512),[[C,i.tab==="setting"]]),v(t("div",null,[t("div",It,[Mt,n(_,{id:"category",type:"text",class:"form-control",modelValue:i.category,"onUpdate:modelValue":e[8]||(e[8]=s=>i.category=s),modelModifiers:{trim:!0},name:"category",rules:"required"},null,8,["modelValue"])]),t("div",Tt,[Ut,t("div",$t,[(u(!0),h(I,null,q(i.article.tag,(s,x)=>(u(),h("div",{class:"col-md-3 position-relative",key:s},[v(t("input",{type:"text",class:"form-control","onUpdate:modelValue":T=>i.article.tag[x]=T},null,8,Lt),[[Y,i.article.tag[x]]]),t("button",{type:"button",class:"btn btn-origin btn-inline",onClick:T=>i.article.tag.splice(x,1)},Ht,8,Dt)]))),128))]),t("button",{type:"button",class:"btn btn-primary",onClick:e[9]||(e[9]=s=>i.article.tag.push(""))}," 新增標籤")])],512),[[C,i.tab==="category"]]),v(t("div",null,[t("div",Nt,[Bt,n(_,{id:"image",type:"text",class:"form-control",modelValue:i.article.image,"onUpdate:modelValue":e[10]||(e[10]=s=>i.article.image=s),modelModifiers:{trim:!0},name:"image",rules:"required|url"},null,8,["modelValue"]),i.article.image?(u(),h("img",{key:0,class:"mt-3",src:i.article.image,alt:i.article.title},null,8,Ft)):et("",!0)]),Rt,n(a,{"use-clipboard":!1,"upload-state":i.uploadState,disabled:i.article.image,onAddNewImage:d.addNewImage,onUpdateUploadState:d.updateUploadState},null,8,["upload-state","disabled","onAddNewImage","onUpdateUploadState"])],512),[[C,i.tab==="image"]]),jt,Ot,n(P,{editor:o.editor,config:o.editorConfig,modelValue:i.article.content,"onUpdate:modelValue":e[11]||(e[11]=s=>i.article.content=s)},null,8,["editor","config","modelValue"])]),t("div",zt,[t("div",Wt,[v(t("input",{id:"isPublic",type:"checkbox",class:"form-check-input","onUpdate:modelValue":e[12]||(e[12]=s=>i.article.isPublic=s)},null,512),[[Z,i.article.isPublic]]),Jt]),t("div",null,[t("button",{type:"submit",class:"btn btn-primary me-2",disabled:!S.valid},"確認更新",8,Gt),t("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[13]||(e[13]=(...s)=>o.hideModal&&o.hideModal(...s))},"取消")])])]),_:1},8,["onSubmit"])])])],512)}const Qt=D(rt,[["render",Kt],["__scopeId","data-v-f83a9722"]]);var Xt={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:Yt,VITE_APP_PATH:Zt}=Xt,te={mixins:[U],components:{AdminArticleModal:Qt,PaginationComponent:j},data(){return{tempArticle:{}}},computed:{...B(M,["articles","article","pagination"])},methods:{...k(M,["getArticles","getArticle","deleteArticle","switchArticleStatus"]),...k($,["createLoader","removeLoader"]),...k(L,["errorAlert"]),openModal(o){o?this.getArticle(o):this.tempArticle={isPublic:!1,create_at:this.now()},this.$refs.articleModal.showModal()},getArticle(o){this.createLoader("get-single-article"),this.$http.get(`${Yt}/api/${Zt}/admin/article/${o}`).then(e=>{this.tempArticle=e.data.article}).catch(e=>this.errorAlert(e)).finally(()=>this.removeLoader("get-single-article"))}},mounted(){this.getArticles()}},ee={class:"text-end mb-7"},oe=t("h3",{class:"fs-2 mb-2"},"文章",-1),ie={class:"text-muted"},se={class:"alert bg-light flex-classic mb-5"},le={key:0,class:"table-responsive"},ae={class:"table table-hover text-nowrap"},re=t("thead",null,[t("tr",null,[t("th",{scope:"col",width:"10%"},"日期"),t("th",{scope:"col",width:"10%"},"分類"),t("th",{scope:"col",width:"50%"},"文章"),t("th",{scope:"col",width:"15%",class:"text-center"},"狀態"),t("th",{scope:"col",width:"15%",class:"text-center"},"處理")])],-1),ne={class:"align-middle"},ce={class:"badge bg-highlight text-dark py-2"},de={class:"fw-bold mb-2"},me={class:"text-muted fs-7"},pe={class:"text-center"},ue={class:"form-switch"},he=["checked","onChange"],_e={class:"text-center"},ge={class:"d-flex flex-column gap-2"},fe=["onClick"],be=["onClick"],ve={key:1,class:"alert bg-light"};function Ae(o,e,l,c,i,d){const V=g("pagination-component"),_=g("admin-article-modal");return u(),h(I,null,[t("div",ee,[oe,t("p",ie,"目前共有 "+A(o.articles.length)+" 篇文章 (꜆꜄꜆ ˙꒳˙)꜆꜄꜆ｵﾗｵﾗｵﾗｵﾗ",1)]),t("div",se,[t("div",null,[t("button",{type:"button",class:"btn btn-highlight",onClick:e[0]||(e[0]=a=>d.openModal())},"新增文章")]),n(V,{current:o.pagination.current_page,total:o.pagination.total_pages,onSwitchPage:o.getArticles},null,8,["current","total","onSwitchPage"])]),o.articles.length?(u(),h("div",le,[t("table",ae,[re,t("tbody",ne,[(u(!0),h(I,null,q(o.articles,a=>(u(),h("tr",{key:a.id},[t("td",null,A(o.formatDate(a.create_at*1e3,"/")),1),t("td",null,[t("span",ce,A(a.tag[0]),1)]),t("td",null,[t("p",de,A(a.title),1),t("span",me,"作者｜"+A(a.author),1)]),t("td",pe,[t("div",ue,[t("input",{type:"checkbox",role:"switch",class:"form-check-input",checked:a.isPublic,onChange:P=>o.switchArticleStatus(a)},null,40,he)])]),t("td",_e,[t("div",ge,[t("button",{type:"button",class:"w-100 btn btn-outline-secondary",onClick:P=>d.openModal(a.id)}," 編輯",8,fe),t("button",{type:"button",class:"w-100 btn btn-outline-danger",onClick:P=>o.deleteArticle(a.id,a.title)}," 刪除",8,be)])])]))),128))])])])):(u(),h("div",ve,"還沒有任何文章！趕快新增一篇吧！")),n(_,{ref:"articleModal","temp-article":i.tempArticle},null,8,["temp-article"])],64)}const go=D(te,[["render",Ae]]);export{go as default};
