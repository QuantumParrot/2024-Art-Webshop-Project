import{a as u}from"./axios@1.6.7-Di5RpEPX.js";import{d as P}from"./pinia@2.1.7_vue@3.4.19-CHKlOEZr.js";import{l as f,a as m}from"./alert-dm0RMdUk.js";var A={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=f(),l=m(),{VITE_APP_SITE:n,VITE_APP_PATH:p}=A,y=P("userProduct",{state:()=>({products:[],pagination:{},product:{},totalProducts:[],relatedProducts:[]}),actions:{getProducts(r="",t=1){c.createLoader("get-user-products"),u.get(`${n}/api/${p}/products?category=${r}&page=${t}`).then(e=>{this.products=e.data.products,this.pagination=e.data.pagination}).catch(e=>l.errorAlert(e)).finally(()=>c.removeLoader("get-user-products"))},getProduct(r){c.createLoader("get-single-product"),u.get(`${n}/api/${p}/product/${r}`).then(t=>{this.product=t.data.product,this.totalProducts.length?this.getRelatedProducts(t.data.product):this.getTotalProducts(t.data.product,this.getRelatedProducts)}).catch(t=>l.errorAlert(t)).finally(()=>c.removeLoader("get-single-product"))},getTotalProducts(r,t){c.createLoader("get-total-products"),u.get(`${n}/api/${p}/products/all`).then(e=>{this.totalProducts=Object.values(e.data.products),typeof t=="function"&&t(r)}).catch(e=>l.errorAlert(e)).finally(()=>c.removeLoader("get-total-products"))},getRelatedProducts(r){const{category:t,tags:e}=r,s=this.totalProducts.filter(a=>a.id!==r.id&&Array.isArray(a.tags)),o=s.filter(a=>a.tags.some(i=>e.includes(i)));if(o.length<3){const a=o.map(d=>d.id),i=s.filter(d=>d.category===t&&!a.includes(d.id));if(o.push(...this.getRandomProducts(i,3-o.length)),o.length<3){const d=s.filter(g=>!o.map(h=>h.id).includes(g.id));o.push(...this.getRandomProducts(d,3-o.length))}this.relatedProducts=o}else this.relatedProducts=this.getRandomProducts(o,3)},getRandomProducts(r,t){let e=0;const s=[...r],o=[];function a(){const i=Math.floor(Math.random()*s.length);e+=1,o.push(...s.splice(i,1))}for(;e<t;)a();return o}}});export{y as u};
