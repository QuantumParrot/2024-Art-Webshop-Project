import{P as A}from"./@ckeditor_ckeditor5-core@41.1.0-D0yh88O_.js";import{b as N,$ as F,e as v,q as y,R as W,a0 as M}from"./@ckeditor_ckeditor5-utils@41.1.0-Cn-yVoWx.js";import{M as L,T as R}from"./@ckeditor_ckeditor5-engine@41.1.0-CtehaBhy.js";import{D as I}from"./@ckeditor_ckeditor5-typing@41.1.0-DSIargVI.js";import{m as D}from"./@ckeditor_ckeditor5-ui@41.1.0-ByiSd2gB.js";import"./color-convert@2.0.1-cxVOSbxw.js";import{E as V}from"./@ckeditor_ckeditor5-enter@41.1.0-CzFUQWGc.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fe extends N(){constructor(){super(...arguments),this._stack=[]}add(e,n){const t=this._stack,o=t[0];this._insertDescriptor(e);const i=t[0];o!==i&&!S(o,i)&&this.fire("change:top",{oldDescriptor:o,newDescriptor:i,writer:n})}remove(e,n){const t=this._stack,o=t[0];this._removeDescriptor(e);const i=t[0];o!==i&&!S(o,i)&&this.fire("change:top",{oldDescriptor:o,newDescriptor:i,writer:n})}_insertDescriptor(e){const n=this._stack,t=n.findIndex(i=>i.id===e.id);if(S(e,n[t]))return;t>-1&&n.splice(t,1);let o=0;for(;n[o]&&K(n[o],e);)o++;n.splice(o,0,e)}_removeDescriptor(e){const n=this._stack,t=n.findIndex(o=>o.id===e);t>-1&&n.splice(t,1)}}function S(c,e){return c&&e&&c.priority==e.priority&&E(c.classes)==E(e.classes)}function K(c,e){return c.priority>e.priority?!0:c.priority<e.priority?!1:E(c.classes)>E(e.classes)}function E(c){return Array.isArray(c)?c.sort().join(","):c}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const P="ck-widget_selected";function g(c){return c.is("element")?!!c.getCustomProperty("widget"):!1}function j(c){return c.getCustomProperty("widgetLabel").reduce((n,t)=>typeof t=="function"?n?n+". "+t():t():n?n+". "+t:t,"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const p="widget-type-around";function w(c,e,n){return!!c&&g(c)&&!n.isInline(e)}function B(c){return c.closest(".ck-widget__type-around__button")}function $(c){return c.classList.contains("ck-widget__type-around__button_before")?"before":"after"}function U(c,e){const n=c.closest(".ck-widget");return e.mapDomToView(n)}function _(c){return c.getAttribute(p)}const q='<svg viewBox="0 0 10 8" xmlns="http://www.w3.org/2000/svg"><path d="M9.055.263v3.972h-6.77M1 4.216l2-2.038m-2 2 2 2.038"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const x=["before","after"],G=new DOMParser().parseFromString(q,"image/svg+xml").firstChild,C="ck-widget__type-around_disabled";class H extends A{constructor(){super(...arguments),this._currentFakeCaretModelElement=null}static get pluginName(){return"WidgetTypeAround"}static get requires(){return[V,I]}init(){const e=this.editor,n=e.editing.view;this.on("change:isEnabled",(t,o,i)=>{n.change(s=>{for(const r of n.document.roots)i?s.removeClass(C,r):s.addClass(C,r)}),i||e.model.change(s=>{s.removeSelectionAttribute(p)})}),this._enableTypeAroundUIInjection(),this._enableInsertingParagraphsOnButtonClick(),this._enableInsertingParagraphsOnEnterKeypress(),this._enableInsertingParagraphsOnTypingKeystroke(),this._enableTypeAroundFakeCaretActivationUsingKeyboardArrows(),this._enableDeleteIntegration(),this._enableInsertContentIntegration(),this._enableInsertObjectIntegration(),this._enableDeleteContentIntegration()}destroy(){super.destroy(),this._currentFakeCaretModelElement=null}_insertParagraph(e,n){const t=this.editor,o=t.editing.view,i=t.model.schema.getAttributesWithProperty(e,"copyOnReplace",!0);t.execute("insertParagraph",{position:t.model.createPositionAt(e,n),attributes:i}),o.focus(),o.scrollToTheSelection()}_listenToIfEnabled(e,n,t,o){this.listenTo(e,n,(...i)=>{this.isEnabled&&t(...i)},o)}_insertParagraphAccordingToFakeCaretPosition(){const t=this.editor.model.document.selection,o=_(t);if(!o)return!1;const i=t.getSelectedElement();return this._insertParagraph(i,o),!0}_enableTypeAroundUIInjection(){const e=this.editor,n=e.model.schema,t=e.locale.t,o={before:t("Insert paragraph before block"),after:t("Insert paragraph after block")};e.editing.downcastDispatcher.on("insert",(i,s,r)=>{const l=r.mapper.toViewElement(s.item);l&&w(l,s.item,n)&&(z(r.writer,o,l),l.getCustomProperty("widgetLabel").push(()=>this.isEnabled?t("Press Enter to type after or press Shift + Enter to type before the widget"):""))},{priority:"low"})}_enableTypeAroundFakeCaretActivationUsingKeyboardArrows(){const e=this.editor,n=e.model,t=n.document.selection,o=n.schema,i=e.editing.view;this._listenToIfEnabled(i.document,"arrowKey",(r,l)=>{this._handleArrowKeyPress(r,l)},{context:[g,"$text"],priority:"high"}),this._listenToIfEnabled(t,"change:range",(r,l)=>{l.directChange&&e.model.change(a=>{a.removeSelectionAttribute(p)})}),this._listenToIfEnabled(n.document,"change:data",()=>{const r=t.getSelectedElement();if(r){const l=e.editing.mapper.toViewElement(r);if(w(l,r,o))return}e.model.change(l=>{l.removeSelectionAttribute(p)})}),this._listenToIfEnabled(e.editing.downcastDispatcher,"selection",(r,l,a)=>{const u=a.writer;if(this._currentFakeCaretModelElement){const h=a.mapper.toViewElement(this._currentFakeCaretModelElement);h&&(u.removeClass(x.map(s),h),this._currentFakeCaretModelElement=null)}const d=l.selection.getSelectedElement();if(!d)return;const m=a.mapper.toViewElement(d);if(!w(m,d,o))return;const f=_(l.selection);f&&(u.addClass(s(f),m),this._currentFakeCaretModelElement=d)}),this._listenToIfEnabled(e.ui.focusTracker,"change:isFocused",(r,l,a)=>{a||e.model.change(u=>{u.removeSelectionAttribute(p)})});function s(r){return`ck-widget_type-around_show-fake-caret_${r}`}}_handleArrowKeyPress(e,n){const t=this.editor,o=t.model,i=o.document.selection,s=o.schema,r=t.editing.view,l=n.keyCode,a=F(l,t.locale.contentLanguageDirection),u=r.document.selection.getSelectedElement(),d=t.editing.mapper.toModelElement(u);let m;w(u,d,s)?m=this._handleArrowKeyPressOnSelectedWidget(a):i.isCollapsed?m=this._handleArrowKeyPressWhenSelectionNextToAWidget(a):n.shiftKey||(m=this._handleArrowKeyPressWhenNonCollapsedSelection(a)),m&&(n.preventDefault(),e.stop())}_handleArrowKeyPressOnSelectedWidget(e){const t=this.editor.model,o=t.document.selection,i=_(o);return t.change(s=>{if(i){if(!(i===(e?"after":"before")))return s.removeSelectionAttribute(p),!0}else return s.setSelectionAttribute(p,e?"after":"before"),!0;return!1})}_handleArrowKeyPressWhenSelectionNextToAWidget(e){const n=this.editor,t=n.model,o=t.schema,i=n.plugins.get("Widget"),s=i._getObjectElementNextToSelection(e),r=n.editing.mapper.toViewElement(s);return w(r,s,o)?(t.change(l=>{i._setSelectionOverElement(s),l.setSelectionAttribute(p,e?"before":"after")}),!0):!1}_handleArrowKeyPressWhenNonCollapsedSelection(e){const n=this.editor,t=n.model,o=t.schema,i=n.editing.mapper,s=t.document.selection,r=e?s.getLastPosition().nodeBefore:s.getFirstPosition().nodeAfter,l=i.toViewElement(r);return w(l,r,o)?(t.change(a=>{a.setSelection(r,"on"),a.setSelectionAttribute(p,e?"after":"before")}),!0):!1}_enableInsertingParagraphsOnButtonClick(){const e=this.editor,n=e.editing.view;this._listenToIfEnabled(n.document,"mousedown",(t,o)=>{const i=B(o.domTarget);if(!i)return;const s=$(i),r=U(i,n.domConverter),l=e.editing.mapper.toModelElement(r);this._insertParagraph(l,s),o.preventDefault(),t.stop()})}_enableInsertingParagraphsOnEnterKeypress(){const e=this.editor,n=e.model.document.selection,t=e.editing.view;this._listenToIfEnabled(t.document,"enter",(o,i)=>{if(o.eventPhase!="atTarget")return;const s=n.getSelectedElement(),r=e.editing.mapper.toViewElement(s),l=e.model.schema;let a;this._insertParagraphAccordingToFakeCaretPosition()?a=!0:w(r,s,l)&&(this._insertParagraph(s,i.isSoft?"before":"after"),a=!0),a&&(i.preventDefault(),o.stop())},{context:g})}_enableInsertingParagraphsOnTypingKeystroke(){const n=this.editor.editing.view.document;this._listenToIfEnabled(n,"insertText",(t,o)=>{this._insertParagraphAccordingToFakeCaretPosition()&&(o.selection=n.selection)},{priority:"high"}),v.isAndroid?this._listenToIfEnabled(n,"keydown",(t,o)=>{o.keyCode==229&&this._insertParagraphAccordingToFakeCaretPosition()}):this._listenToIfEnabled(n,"compositionstart",()=>{this._insertParagraphAccordingToFakeCaretPosition()},{priority:"high"})}_enableDeleteIntegration(){const e=this.editor,n=e.editing.view,t=e.model,o=t.schema;this._listenToIfEnabled(n.document,"delete",(i,s)=>{if(i.eventPhase!="atTarget")return;const r=_(t.document.selection);if(!r)return;const l=s.direction,a=t.document.selection.getSelectedElement(),u=r==="before",d=l=="forward";if(u===d)e.execute("delete",{selection:t.createSelection(a,"on")});else{const f=o.getNearestSelectionRange(t.createPositionAt(a,r),l);if(f)if(!f.isCollapsed)t.change(h=>{h.setSelection(f),e.execute(d?"deleteForward":"delete")});else{const h=t.createSelection(f.start);if(t.modifySelection(h,{direction:l}),!h.focus.isEqual(f.start))t.change(b=>{b.setSelection(f),e.execute(d?"deleteForward":"delete")});else{const b=Q(o,f.start.parent);t.deleteContent(t.createSelection(b,"on"),{doNotAutoparagraph:!0})}}}s.preventDefault(),i.stop()},{context:g})}_enableInsertContentIntegration(){const e=this.editor,n=this.editor.model,t=n.document.selection;this._listenToIfEnabled(e.model,"insertContent",(o,[i,s])=>{if(s&&!s.is("documentSelection"))return;const r=_(t);if(r)return o.stop(),n.change(l=>{const a=t.getSelectedElement(),u=n.createPositionAt(a,r),d=l.createSelection(u),m=n.insertContent(i,d);return l.setSelection(d),m})},{priority:"high"})}_enableInsertObjectIntegration(){const e=this.editor,t=this.editor.model.document.selection;this._listenToIfEnabled(e.model,"insertObject",(o,i)=>{const[,s,r={}]=i;if(s&&!s.is("documentSelection"))return;const l=_(t);l&&(r.findOptimalPosition=l,i[3]=r)},{priority:"high"})}_enableDeleteContentIntegration(){const e=this.editor,t=this.editor.model.document.selection;this._listenToIfEnabled(e.model,"deleteContent",(o,[i])=>{if(i&&!i.is("documentSelection"))return;_(t)&&o.stop()},{priority:"high"})}}function z(c,e,n){const t=c.createUIElement("div",{class:"ck ck-reset_all ck-widget__type-around"},function(o){const i=this.toDomElement(o);return Y(i,e),J(i),i});c.insert(c.createPositionAt(n,"end"),t)}function Y(c,e){for(const n of x){const t=new D({tag:"div",attributes:{class:["ck","ck-widget__type-around__button",`ck-widget__type-around__button_${n}`],title:e[n],"aria-hidden":"true"},children:[c.ownerDocument.importNode(G,!0)]});c.appendChild(t.render())}}function J(c){const e=new D({tag:"div",attributes:{class:["ck","ck-widget__type-around__fake-caret"]}});c.appendChild(e.render())}function Q(c,e){let n=e;for(const t of e.getAncestors({parentFirst:!0})){if(t.childCount>1||c.isLimit(t))break;n=t}return n}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function X(c){const e=c.model;return(n,t)=>{const o=t.keyCode==y.arrowup,i=t.keyCode==y.arrowdown,s=t.shiftKey,r=e.document.selection;if(!o&&!i)return;const l=i;if(s&&te(r,l))return;const a=Z(c,r,l);if(a){if(a.isCollapsed){if(r.isCollapsed)return;if(s)return}(a.isCollapsed||ee(c,a,l))&&(e.change(u=>{const d=l?a.end:a.start;if(s){const m=e.createSelection(r.anchor);m.setFocus(d),u.setSelection(m)}else u.setSelection(d)}),n.stop(),t.preventDefault(),t.stopPropagation())}}}function Z(c,e,n){const t=c.model;if(n){const o=e.isCollapsed?e.focus:e.getLastPosition(),i=k(t,o,"forward");if(!i)return null;const s=t.createRange(o,i),r=T(t.schema,s,"backward");return r?t.createRange(o,r):null}else{const o=e.isCollapsed?e.focus:e.getFirstPosition(),i=k(t,o,"backward");if(!i)return null;const s=t.createRange(i,o),r=T(t.schema,s,"forward");return r?t.createRange(r,o):null}}function k(c,e,n){const t=c.schema,o=c.createRangeIn(e.root),i=n=="forward"?"elementStart":"elementEnd";for(const{previousPosition:s,item:r,type:l}of o.getWalker({startPosition:e,direction:n})){if(t.isLimit(r)&&!t.isInline(r))return s;if(l==i&&t.isBlock(r))return null}return null}function T(c,e,n){const t=n=="backward"?e.end:e.start;if(c.checkChild(t,"$text"))return t;for(const{nextPosition:o}of e.getWalker({direction:n}))if(c.checkChild(o,"$text"))return o;return null}function ee(c,e,n){const t=c.model,o=c.view.domConverter;if(n){const a=t.createSelection(e.start);t.modifySelection(a),!a.focus.isAtEnd&&!e.start.isEqual(a.focus)&&(e=t.createRange(a.focus,e.end))}const i=c.mapper.toViewRange(e),s=o.viewRangeToDom(i),r=W.getDomRangeRects(s);let l;for(const a of r){if(l===void 0){l=Math.round(a.bottom);continue}if(Math.round(a.top)>=l)return!1;l=Math.max(l,Math.round(a.bottom))}return!0}function te(c,e){return!c.isCollapsed&&c.isBackward==e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class he extends A{constructor(){super(...arguments),this._previouslySelected=new Set}static get pluginName(){return"Widget"}static get requires(){return[H,I]}init(){const e=this.editor,n=e.editing.view,t=n.document;this.editor.editing.downcastDispatcher.on("selection",(o,i,s)=>{const r=s.writer,l=i.selection;if(l.isCollapsed)return;const a=l.getSelectedElement();if(!a)return;const u=e.editing.mapper.toViewElement(a);g(u)&&s.consumable.consume(l,"selection")&&r.setSelection(r.createRangeOn(u),{fake:!0,label:j(u)})}),this.editor.editing.downcastDispatcher.on("selection",(o,i,s)=>{this._clearPreviouslySelectedWidgets(s.writer);const r=s.writer,l=r.document.selection;let a=null;for(const u of l.getRanges())for(const d of u){const m=d.item;g(m)&&!oe(m,a)&&(r.addClass(P,m),this._previouslySelected.add(m),a=m)}},{priority:"low"}),n.addObserver(L),this.listenTo(t,"mousedown",(...o)=>this._onMousedown(...o)),this.listenTo(t,"arrowKey",(...o)=>{this._handleSelectionChangeOnArrowKeyPress(...o)},{context:[g,"$text"]}),this.listenTo(t,"arrowKey",(...o)=>{this._preventDefaultOnArrowKeyPress(...o)},{context:"$root"}),this.listenTo(t,"arrowKey",X(this.editor.editing),{context:"$text"}),this.listenTo(t,"delete",(o,i)=>{this._handleDelete(i.direction=="forward")&&(i.preventDefault(),o.stop())},{context:"$root"})}_onMousedown(e,n){const t=this.editor,o=t.editing.view,i=o.document;let s=n.target;if(n.domEvent.detail>=3){this._selectBlockContent(s)&&n.preventDefault();return}if(ne(s)||!g(s)&&(s=s.findAncestor(g),!s))return;v.isAndroid&&n.preventDefault(),i.isFocused||o.focus();const r=t.editing.mapper.toModelElement(s);this._setSelectionOverElement(r)}_selectBlockContent(e){const n=this.editor,t=n.model,o=n.editing.mapper,i=t.schema,s=o.findMappedViewAncestor(this.editor.editing.view.createPositionAt(e,0)),r=ie(o.toModelElement(s),t.schema);return r?(t.change(l=>{const a=i.isLimit(r)?null:se(l.createPositionAfter(r),i),u=l.createPositionAt(r,0),d=a?l.createPositionAt(a,0):l.createPositionAt(r,"end");l.setSelection(l.createRange(u,d))}),!0):!1}_handleSelectionChangeOnArrowKeyPress(e,n){const t=n.keyCode,o=this.editor.model,i=o.schema,s=o.document.selection,r=s.getSelectedElement(),l=M(t,this.editor.locale.contentLanguageDirection),a=l=="down"||l=="right",u=l=="up"||l=="down";if(r&&i.isObject(r)){const m=a?s.getLastPosition():s.getFirstPosition(),f=i.getNearestSelectionRange(m,a?"forward":"backward");f&&(o.change(h=>{h.setSelection(f)}),n.preventDefault(),e.stop());return}if(!s.isCollapsed&&!n.shiftKey){const m=s.getFirstPosition(),f=s.getLastPosition(),h=m.nodeAfter,b=f.nodeBefore;(h&&i.isObject(h)||b&&i.isObject(b))&&(o.change(O=>{O.setSelection(a?f:m)}),n.preventDefault(),e.stop());return}if(!s.isCollapsed)return;const d=this._getObjectElementNextToSelection(a);if(d&&i.isObject(d)){if(i.isInline(d)&&u)return;this._setSelectionOverElement(d),n.preventDefault(),e.stop()}}_preventDefaultOnArrowKeyPress(e,n){const t=this.editor.model,o=t.schema,i=t.document.selection.getSelectedElement();i&&o.isObject(i)&&(n.preventDefault(),e.stop())}_handleDelete(e){const t=this.editor.model.document.selection;if(!this.editor.model.canEditAt(t)||!t.isCollapsed)return;const o=this._getObjectElementNextToSelection(e);if(o)return this.editor.model.change(i=>{let s=t.anchor.parent;for(;s.isEmpty;){const r=s;s=r.parent,i.remove(r)}this._setSelectionOverElement(o)}),!0}_setSelectionOverElement(e){this.editor.model.change(n=>{n.setSelection(n.createRangeOn(e))})}_getObjectElementNextToSelection(e){const n=this.editor.model,t=n.schema,o=n.document.selection,i=n.createSelection(o);if(n.modifySelection(i,{direction:e?"forward":"backward"}),i.isEqual(o))return null;const s=e?i.focus.nodeBefore:i.focus.nodeAfter;return s&&t.isObject(s)?s:null}_clearPreviouslySelectedWidgets(e){for(const n of this._previouslySelected)e.removeClass(P,n);this._previouslySelected.clear()}}function ne(c){let e=c;for(;e;){if(e.is("editableElement")&&!e.is("rootElement"))return!0;if(g(e))return!1;e=e.parent}return!1}function oe(c,e){return e?Array.from(c.getAncestors()).includes(e):!1}function ie(c,e){for(const n of c.getAncestors({includeSelf:!0,parentFirst:!0})){if(e.checkChild(n,"$text"))return n;if(e.isLimit(n)&&!e.isObject(n))break}return null}function se(c,e){const n=new R({startPosition:c});for(const{item:t}of n){if(e.isLimit(t)||!t.is("element"))return null;if(e.checkChild(t,"$text"))return t}return null}export{he as W,g as i};
