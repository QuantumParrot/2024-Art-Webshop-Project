import{c as V}from"./calculator-CHDHV-Nf.js";import{m as E,P as N}from"./modal-GFTEIjR-.js";import{h as B}from"./moment-Cl4UOzQZ.js";import{_ as x,o as i,b as c,e,t as o,n as _,k as A,v as M,F as O,l as C,h as u,f as $,p as H,g as Y,i as R,j as g,a as S,m as U,s as j,d as k,w as y,r as w,u as F}from"./index-BgTYlOVE.js";import{D as q}from"./DeleteModal-BH1uRBWV.js";import{u as D,a as z}from"./alert-CE4qGltT.js";const W={mixins:[E],props:["tempOrder"],emits:["update-order"],data(){return{modal:"",tab:"content"}},methods:{formatTime(t){return B(t).format("YYYY/MM/DD HH:mm:ss")}}},d=t=>(H("data-v-79014413"),t=t(),Y(),t),G={class:"modal modal-lg fade",tabindex:"-1",ref:"modal"},J={class:"modal-dialog modal-dialog-centered"},K={class:"modal-content"},Q={class:"modal-header"},X={class:"fs-5 mb-0"},Z=d(()=>e("i",{class:"bi bi-x-circle-fill"},null,-1)),ee=[Z],te={class:"modal-body py-4"},se={class:"nav nav-pills bg-light rounded-2 mb-3"},oe={class:"nav-item flex-grow-1"},le={class:"nav-item flex-grow-1"},re={class:"table table-light"},ne={class:"text-end"},de={class:"fs-5 fw-bold"},ae=d(()=>e("td",{colspan:"2"},"總計",-1)),ie={class:"text-end"},ce={class:"mb-0"},me=d(()=>e("span",null,"付款狀態：",-1)),ue=d(()=>e("span",{class:"badge bg-primary me-2"},"訂單成立日期",-1)),pe=d(()=>e("hr",null,null,-1)),he=d(()=>e("span",{class:"badge bg-primary me-2"},"姓名",-1)),_e=d(()=>e("hr",null,null,-1)),be=d(()=>e("span",{class:"badge bg-primary me-2"},"電話",-1)),ge=d(()=>e("hr",null,null,-1)),fe=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"地址")],-1)),ve=d(()=>e("hr",null,null,-1)),Oe=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"信箱")],-1)),Pe=d(()=>e("hr",null,null,-1)),ke=d(()=>e("p",null,[e("span",{class:"badge bg-primary"},"留言")],-1)),ye={class:"pre-wrap mb-0"},we={key:0,class:"modal-footer"};function Ae(t,s,r,h,l,b){return i(),c("div",G,[e("div",J,[e("div",K,[e("div",Q,[e("h4",X,o(r.tempOrder.id),1),e("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:s[0]||(s[0]=(...a)=>t.hideModal&&t.hideModal(...a))},ee)]),e("div",te,[e("ul",se,[e("li",oe,[e("button",{type:"button",onClick:s[1]||(s[1]=a=>l.tab="content"),class:_(["w-100 nav-link",{active:l.tab==="content"}])}," 訂購商品",2)]),e("li",le,[e("button",{type:"button",onClick:s[2]||(s[2]=a=>l.tab="info"),class:_(["w-100 nav-link",{active:l.tab==="info"}])}," 客戶資訊",2)])]),A(e("div",null,[e("table",re,[e("tbody",null,[(i(!0),c(O,null,C(r.tempOrder.products,(a,P)=>(i(),c("tr",{key:P},[e("td",null,o(a.product.title),1),e("td",null,"× "+o(a.qty)+" "+o(a.product.unit),1),e("td",ne,"NT$ "+o(a.total),1)]))),128))]),e("tfoot",de,[e("tr",null,[ae,e("td",ie,"NT$ "+o(r.tempOrder.total),1)])])]),e("p",ce,[me,e("span",{class:_(r.tempOrder.is_paid?"text-success":"text-danger")},o(r.tempOrder.is_paid?"已付款":"未付款"),3)])],512),[[M,l.tab==="content"]]),A(e("div",null,[e("p",null,[ue,u(" "+o(b.formatTime(r.tempOrder.create_at*1e3)),1)]),pe,e("p",null,[he,u(" "+o(r.tempOrder.user.name),1)]),_e,e("p",null,[be,u(" "+o(r.tempOrder.user.tel),1)]),ge,fe,e("p",null,o(r.tempOrder.user.address),1),ve,Oe,e("p",null,o(r.tempOrder.user.email),1),Pe,ke,e("p",ye,o(r.tempOrder.message),1)],512),[[M,l.tab==="info"]])]),r.tempOrder.is_paid?$("",!0):(i(),c("div",we,[e("button",{type:"button",class:"btn btn-highlight",onClick:s[3]||(s[3]=a=>t.$emit("update-order"))}," 確認結單")]))])])],512)}const $e=x(W,[["render",Ae],["__scopeId","data-v-79014413"]]);var Me={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:f,VITE_APP_PATH:v}=Me,p=D(),m=z(),T=R("adminOrder",{state:()=>({orders:[],currentPage:1}),getters:{totalPages:({orders:t})=>Math.ceil(t.length/5)},actions:{switchPage(t){this.currentPage=t},getOrders(){p.createLoader("get-orders"),g.get(`${f}/api/${v}/admin/orders`).then(t=>{this.orders=t.data.orders,this.switchPage(1)}).catch(t=>m.errorAlert(t)).finally(()=>p.removeLoader("get-orders"))},updateOrder(t,s){const r={title:"確定結單？",text:"提醒您，送出後即無法修改訂單狀態囉！"};m.checkAlert(r,()=>{p.createLoader("update-order"),g.put(`${f}/api/${v}/admin/order/${t.id}`,{data:{...t,is_paid:!t.is_paid}}).then(h=>{m.toastAlert(h.data.message,"success"),s(),this.getOrders()}).catch(h=>m.errorAlert(h)).finally(()=>p.removeLoader("update-order"))})},deleteOrder(t,s){p.createLoader("delete-order"),g.delete(`${f}/api/${v}/admin/order/${t}`).then(()=>{m.toastAlert("我們懷念它 (´;ω;`)","success"),s(),this.getOrders()}).catch(r=>m.errorAlert(r)).finally(()=>p.removeLoader("delete-order"))},deleteAllOrders(){m.multiverseAlert(this.downTheDrain)},downTheDrain(){p.createLoader("tan-tiau"),g.delete(`${f}/api/${v}/admin/orders/all`).then(()=>{m.toastAlert("沒了 ... 都沒了 (´;ω;`)","success"),this.getOrders()}).catch(t=>m.errorAlert(t)).finally(()=>p.removeLoader("tan-tiau"))}}}),Se={mixins:[V],components:{PaginationComponent:N,AdminOrderModal:$e,DeleteModal:q},data(){return{tempOrder:{user:{},products:{}},deletePermission:!1}},computed:{...S(T,["orders","currentPage","totalPages"]),...S(D,["loadingItem"])},methods:{...U(T,["getOrders","switchPage","updateOrder","deleteOrder","deleteAllOrders"]),openModal(t,s){this.tempOrder={...t},s==="check"?this.$refs.orderModal.showModal():this.$refs.deleteModal.showModal()}},mounted(){this.getOrders()}},Te={class:"text-end mb-5"},xe=e("h3",{class:"fs-2 mb-3"},"訂單管理",-1),Ce={class:"fs-6 text-muted"},De={class:"alert bg-light flex-classic mb-5"},Ie={class:"d-flex gap-2"},Le={for:"unlock",class:"btn btn-outline-primary"},Ve={class:"table table-hover text-nowrap"},Ee=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"10%"}),e("th",{scope:"col",width:"40%"}),e("th",{scope:"col",width:"40%",class:"d-none d-md-table-cell text-end"}),e("th",{scope:"col",width:"10%"})])],-1),Ne={class:"align-middle"},Be=["onClick"],He={class:"me-2"},Ye=e("i",{class:"bi bi-search"},null,-1),Re={class:"d-none d-md-table-cell text-end"},Ue={class:"text-end"},je=["disabled","onClick"],Fe={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},qe={key:1,class:"alert bg-light"},ze={class:"mb-4"},We={class:"text-muted"},Ge={class:"mt-3"},Je=e("b",null,"客戶姓名",-1),Ke=e("b",null,"訂單總額",-1);function Qe(t,s,r,h,l,b){const a=w("pagination-component"),P=w("admin-order-modal"),I=w("delete-modal");return i(),c(O,null,[e("div",Te,[xe,e("p",Ce,[e("span",null,"目前共有 "+o(t.orders.length)+" 筆訂單，",1),e("span",null,"尚有 "+o(t.orders.filter(n=>!n.is_paid).length)+" 筆未結單",1)])]),t.orders.length?(i(),c(O,{key:0},[e("div",De,[e("div",Ie,[A(e("input",{type:"checkbox",id:"unlock",class:"btn-check","onUpdate:modelValue":s[0]||(s[0]=n=>l.deletePermission=n)},null,512),[[j,l.deletePermission]]),e("label",Le,[e("i",{class:_(["bi",l.deletePermission?"bi-unlock-fill":"bi-lock-fill"])},null,2)]),l.deletePermission?(i(),c("button",{key:0,type:"button",class:"btn btn-danger",onClick:s[1]||(s[1]=(...n)=>t.deleteAllOrders&&t.deleteAllOrders(...n))},"刪除所有訂單")):$("",!0)]),k(a,{current:t.currentPage,total:t.totalPages,onSwitchPage:t.switchPage},null,8,["current","total","onSwitchPage"])]),e("table",Ve,[Ee,e("tbody",Ne,[(i(!0),c(O,null,C(t.orders,n=>(i(),c("tr",{key:n.id},[e("td",null,o(t.formatDate(n.create_at*1e3,"/")),1),e("td",null,[e("span",{class:_(["badge me-3",n.is_paid?"bg-success":"bg-danger"])},o(n.is_paid?"已付款":"未付款"),3),e("a",{href:"#",onClick:F(L=>b.openModal(n,"check"),["prevent"])},[e("span",He,o(n.user.name),1),Ye],8,Be)]),e("td",Re,"NT$ "+o(n.total),1),e("td",Ue,[e("button",{type:"button",class:"btn btn-outline-danger",disabled:!l.deletePermission,onClick:L=>b.openModal(n,"delete")},[t.loadingItem===n.id?(i(),c("span",Fe)):$("",!0),u(" 刪除")],8,je)])]))),128))])])],64)):(i(),c("div",qe,"沒有訂單記錄")),k(P,{ref:"orderModal","temp-order":l.tempOrder,onUpdateOrder:s[2]||(s[2]=n=>t.updateOrder(l.tempOrder,t.$refs.orderModal.hideModal))},null,8,["temp-order"]),k(I,{ref:"deleteModal",onDeleteTarget:s[3]||(s[3]=n=>t.deleteOrder(l.tempOrder))},{title:y(()=>[u("確定刪除訂單！？")]),alert:y(()=>[u("這是客人的訂單欸！你要確定欸！(ﾟдﾟ≡ﾟдﾟ)")]),itemDetail:y(()=>[e("details",ze,[e("summary",null,[u("訂單編號："),e("span",We,o(l.tempOrder.id),1)]),e("p",Ge,[Je,u("："+o(l.tempOrder.user.name),1)]),e("p",null,[Ke,u("：NT$ "+o(l.tempOrder.total),1)])])]),_:1},512)],64)}const lt=x(Se,[["render",Qe]]);export{lt as default};
