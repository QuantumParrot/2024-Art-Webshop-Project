import{a as l}from"./axios@1.6.7-Di5RpEPX.js";import{d as p}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as h,a as f}from"./alert-Dw2Xe9FX.js";import{u as g}from"./userProduct-hXqBbad6.js";var P={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const c=h(),d=f(),{VITE_APP_SITE:n,VITE_APP_PATH:u}=P,S=p("userArticle",{state:()=>({articles:[],article:{},relatedProducts:[]}),getters:{projects:({articles:e})=>e.filter(t=>t.type==="公益計劃"),news:({articles:e})=>e.filter(t=>t.type==="網站公告").sort((t,r)=>r.create_at-t.create_at),columns:({articles:e})=>e.filter(t=>t.type==="專欄文章")},actions:{getArticles(e=1){const t=`${n}/api/${u}/articles?page=`;c.createLoader("get-user-articles"),l.get(`${t}${e}`).then(r=>{const{articles:s,pagination:a}=r.data;if(this.articles=s,a.total_pages>1){const o=[];for(let i=2;i<=a.total_pages;i+=1)o.push(l.get(`${t}${i}`));return Promise.all(o)}return!1}).then(r=>{Array.isArray(r)&&r.forEach(s=>this.articles.push(...s.data.articles))}).catch(r=>d.errorAlert(r)).finally(()=>c.removeLoader("get-user-articles"))},getArticle(e){c.createLoader("get-single-article"),l.get(`${n}/api/${u}/article/${e}`).then(t=>{this.article=t.data.article,this.article.type==="專欄文章"?(this.router.push(`/article/${this.article.id}`),this.article.recommend&&this.getRelatedProducts(this.article.tag)):this.router.push(`/news/${this.article.id}`)}).catch(t=>d.errorAlert(t)).finally(()=>c.removeLoader("get-single-article"))},async getRelatedProducts(e){const{getRandomProducts:t}=g(),r=await l.get(`${n}/api/${u}/products/all`),s=Object.values(r.data.products);let a=[];Array.isArray(e)&&(a=s.filter(o=>o.tags.some(i=>e.includes(i)))),a.length>3?a=t(a,3):a.push(...t(s,Math.abs(a.length-3))),this.relatedProducts=a}}});export{S as u};
