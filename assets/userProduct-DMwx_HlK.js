import{a as u}from"./axios@1.6.7-Di5RpEPX.js";import{d as P}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as f,a as m}from"./alert-CIAdBCx8.js";var _={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const d=f(),n=m(),{VITE_APP_SITE:l,VITE_APP_PATH:g}=_,E=P("userProduct",{state:()=>({product:{},relatedProducts:[],productList:[],currentPage:1,categories:["複製油畫","複製雕塑","玩具模型","裝飾工藝","文具禮品"],filter:""}),getters:{products:({productList:t,filter:r})=>r?t.filter(a=>a.category===r):t,totalPages:({products:t})=>Math.ceil(t.length/9),displaying:({products:t,currentPage:r})=>t.filter((a,o)=>Math.floor(o/9)+1===r)},actions:{switchFilter(t){this.filter=this.categories.includes(t)?t:""},switchPage(t){this.currentPage=t},async getProducts(){try{d.createLoader("get-user-products");const t=await u.get(`${l}/api/${g}/products/all`);this.productList=Object.values(t.data.products).reverse()}catch(t){n.errorAlert(t)}finally{d.removeLoader("get-user-products")}return this.productList},async getProduct(t){try{d.createLoader("get-single-product");const r=await u.get(`${l}/api/${g}/product/${t}`);this.product=r.data.product,this.productList.length||await this.getProducts(),this.getRelatedProducts(this.product)}catch(r){n.errorAlert(r)}finally{d.removeLoader("get-single-product")}},getRelatedProducts(t){const{category:r,tags:a}=t,o=this.productList.filter(s=>s.id!==t.id&&Array.isArray(s.tags)),e=o.filter(s=>s.tags.some(i=>a.includes(i)));if(e.length<3){const s=e.map(c=>c.id),i=o.filter(c=>c.category===r&&!s.includes(c.id));if(e.push(...this.getRandomProducts(i,3-e.length)),e.length<3){const c=o.filter(h=>!e.map(p=>p.id).includes(h.id));e.push(...this.getRandomProducts(c,3-e.length))}this.relatedProducts=e}else this.relatedProducts=this.getRandomProducts(e,3)},getRandomProducts(t,r){let a=0;const o=[...t],e=[];function s(){const i=Math.floor(Math.random()*o.length);a+=1,e.push(...o.splice(i,1))}for(;a<r;)s();return e}}});export{E as u};
