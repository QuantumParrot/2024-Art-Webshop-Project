import{d as k,a as $,m as M}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{a as h}from"./axios@1.6.7-Di5RpEPX.js";import{l as S,a as x}from"./alert-Dw2Xe9FX.js";import{m as P}from"./modal-C9K-cvng.js";import{l as L,v as E}from"./@vue_runtime-dom@3.4.19-Jk3xLe3-.js";import{_ as V}from"./index-BgK1Zr7p.js";import{z as r,A as p,Q as e,c as u,aH as T,aJ as w,aq as g,F as A,ao as U}from"./@vue_runtime-core@3.4.19-CKRBtKAL.js";import{P as q}from"./PaginationComponent-BG5evzYt.js";import{P as _}from"./@vue_shared@3.4.19-Bk7MlA8B.js";import"./vue-demi@0.14.7_vue@3.4.19-Dq6ymT-8.js";import"./@vue_reactivity@3.4.19-Ddpy7v_1.js";import"./sweetalert2@11.10.5-Csd-Z1-j.js";import"./@ckeditor_ckeditor5-vue@5.1.0-BEtXLgA-.js";import"./vue@3.4.19-C3VIO2t_.js";import"./bootstrap@5.3.2_@popperjs_core@2.11.8-CaSxFkTE.js";/* empty css                               */import"./vee-validate@4.12.5_vue@3.4.19-BmIHdE2I.js";import"./@vee-validate_rules@4.12.5_vue@3.4.19-DqtB_02U.js";import"./@vee-validate_i18n@4.12.5-DXNnfMG0.js";import"./vue-axios@3.5.2_axios@1.6.7_vue@3.4.19-BaogFJPH.js";import"./moment@2.30.1-Cl4UOzQZ.js";import"./vue-loading-overlay@6.0.4_vue@3.4.19-DaNcwJXO.js";import"./vue-router@4.2.5_vue@3.4.19-BBAnl9m5.js";var D={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:b,VITE_APP_PATH:f}=D,l=S(),d=x(),y=k("adminCoupon",{state:()=>({coupons:[],pagination:{}}),actions:{getCoupons(o=1){l.createLoader("get-coupons"),h.get(`${b}/api/${f}/admin/coupons?page=${o}`).then(t=>{const{coupons:s,pagination:C}=t.data;this.coupons=s,this.pagination=C}).catch(t=>d.errorAlert(t)).finally(()=>l.removeLoader("get-coupons"))},createCoupon(o,t){l.createLoader("create-coupon"),h.post(`${b}/api/${f}/admin/coupon`,{data:o}).then(s=>{d.toastAlert(s.data.message,"success"),t(),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("create-coupon"))},updateCoupon(o,t){l.createLoader("update-coupon"),h.put(`${b}/api/${f}/admin/coupon/${o.id}`,{data:o}).then(s=>{d.toastAlert(s.data.message,"success"),t(),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("update-coupon"))},deleteCoupon(o){const t={title:"確定刪除優惠券？",text:`優惠券名稱：${o.title}`};d.checkAlert(t,()=>{l.createLoader("delete-coupon"),h.delete(`${b}/api/${f}/admin/coupon/${o.id}`).then(s=>{d.toastAlert(s.data.message,"success"),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("delete-coupon"))})},switchCouponStatus(o){const t=!!o.is_enabled;l.createLoader("switch-coupon-status"),h.put(`${b}/api/${f}/admin/coupon/${o.id}`,{data:{...o,is_enabled:t?0:1}}).then(()=>{d.toastAlert(`成功${t?"取消":"開啟"}優惠券`,"success"),this.getCoupons()}).catch(s=>d.errorAlert(s)).finally(()=>l.removeLoader("switch-coupon-status"))}}}),F={mixins:[P],data(){return{coupon:{}}},props:["tempCoupon"],computed:{due_date:{get(){return this.$calc.formatDate(this.coupon.due_date*1e3)},set(o){this.coupon.due_date=new Date(o).getTime()/1e3}}},watch:{tempCoupon(){this.coupon=this.tempCoupon}},methods:{...$(y,["createCoupon","updateCoupon"]),...$(x,["toastAlert"]),confirmUpdate(){this.coupon.id?this.updateCoupon(this.coupon,this.hideModal):this.createCoupon(this.coupon,this.hideModal)}},mounted(){this.coupon=this.tempCoupon}},I={class:"modal fade",tabindex:"-1",ref:"modal"},B={class:"modal-dialog modal-dialog-centered"},O={class:"modal-content"},j={class:"modal-header justify-content-end"},H=e("i",{class:"bi bi-x-circle-fill"},null,-1),N=[H],R={class:"modal-body"},z={class:"mb-3"},J=e("label",{class:"form-label is-required",for:"title"},"優惠券名稱",-1),Q={class:"mb-3"},W=e("label",{class:"form-label is-required",for:"code"},"優惠碼",-1),G={class:"mb-3"},K=e("div",{class:"flex-classic mb-2"},[e("label",{class:"is-required",for:"percent"},"折扣"),e("span",{class:"fs-7 text-danger mb-0"},"必須是 1 ～ 100 之間的整數")],-1),X={class:"input-group"},Y=e("span",{class:"input-group-text"},"％",-1),Z={class:"mb-3"},ee=e("label",{class:"form-label is-required",for:"due_date"},[e("span",null,"優惠截止日期")],-1),oe=["min"],te={class:"modal-footer justify-content-between align-items-center"},se={class:"form-check"},ne=e("label",{class:"form-label",for:"is_enabled"},"是否啟用",-1),ae=["disabled"];function ie(o,t,s,C,i,c){const m=g("VField"),v=g("VForm");return r(),p("div",I,[e("div",B,[e("div",O,[e("div",j,[e("button",{type:"button",class:"btn border-0 p-0 fs-4",onClick:t[0]||(t[0]=(...n)=>o.hideModal&&o.hideModal(...n))},N)]),u(v,{onSubmit:c.confirmUpdate,ref:"form"},{default:T(({meta:n})=>[e("div",R,[e("div",z,[J,u(m,{id:"title",type:"text",class:"form-control",modelValue:i.coupon.title,"onUpdate:modelValue":t[1]||(t[1]=a=>i.coupon.title=a),modelModifiers:{trim:!0},name:"title",rules:"required"},null,8,["modelValue"])]),e("div",Q,[W,u(m,{id:"code",type:"text",class:"form-control",modelValue:i.coupon.code,"onUpdate:modelValue":t[2]||(t[2]=a=>i.coupon.code=a),modelModifiers:{trim:!0},name:"code",rules:"required"},null,8,["modelValue"])]),e("div",G,[K,e("div",X,[u(m,{id:"percent",type:"number",min:"1",max:"100",class:"form-control",modelValue:i.coupon.percent,"onUpdate:modelValue":t[3]||(t[3]=a=>i.coupon.percent=a),modelModifiers:{number:!0},name:"percent",rules:"required|integer|min_value:1|max_value:100"},null,8,["modelValue"]),Y])]),e("div",Z,[ee,w(e("input",{id:"due_date",type:"date",class:"form-control","onUpdate:modelValue":t[4]||(t[4]=a=>c.due_date=a),min:o.$calc.today()},null,8,oe),[[L,c.due_date]])])]),e("div",te,[e("div",se,[w(e("input",{id:"is_enabled",type:"checkbox",class:"form-check-input","onUpdate:modelValue":t[5]||(t[5]=a=>i.coupon.is_enabled=a),"true-value":1,"false-value":0},null,512),[[E,i.coupon.is_enabled]]),ne]),e("div",null,[e("button",{type:"submit",class:"btn btn-primary me-2",disabled:!n.valid}," 確認更新",8,ae),e("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[6]||(t[6]=(...a)=>o.hideModal&&o.hideModal(...a))}," 取消")])])]),_:1},8,["onSubmit"])])])],512)}const le=V(F,[["render",ie]]),de={components:{AdminCouponModal:le,PaginationComponent:q},data(){return{tempCoupon:{}}},computed:{...M(y,["coupons","pagination"])},methods:{...$(y,["getCoupons","deleteCoupon","switchCouponStatus"]),openModal(o){this.tempCoupon=o?{...o}:{is_enabled:0,due_date:this.$calc.now()},this.$refs.couponModal.showModal()}},created(){this.coupons.length||this.getCoupons()}},ce={class:"lh-lg text-end mb-lg-6"},re=e("h3",{class:"fs-2 mb-3"},"COUPONS｜優惠券",-1),pe={class:"text-muted"},ue={class:"alert bg-gray flex-classic mb-6"},me={key:0,class:"table-responsive"},he={class:"table table-hover text-nowrap"},_e=e("thead",null,[e("tr",null,[e("th",{scope:"col",width:"10%"},"到期"),e("th",{scope:"col",width:"50%"},"名稱"),e("th",{scope:"col",width:"15%",class:"text-end"},"折扣"),e("th",{scope:"col",width:"10%",class:"text-center"},"狀態"),e("th",{scope:"col",width:"15%",class:"text-center"},"處理")])],-1),be={class:"align-middle"},fe={class:"d-flex align-items-center gap-2"},ge={class:"d-none d-md-block badge bg-primary py-2"},Ce={class:"text-end"},ve={class:"text-center"},$e={class:"form-switch"},ye=["checked","onChange"],we={class:"text-center"},Ae={class:"d-flex flex-column gap-2"},xe=["onClick"],Ve=["onClick"],ke={key:1,class:"alert bg-gray"};function Me(o,t,s,C,i,c){const m=g("PaginationComponent"),v=g("AdminCouponModal");return r(),p(A,null,[e("div",ce,[re,e("p",pe,"目前共有 "+_(o.coupons.length)+" 張優惠券",1)]),e("div",ue,[e("div",null,[e("button",{type:"button",class:"btn btn-highlight",onClick:t[0]||(t[0]=n=>c.openModal())},"建立優惠券")]),u(m,{current:o.pagination.current_page,total:o.pagination.total_pages,onSwitchPage:o.getCoupons},null,8,["current","total","onSwitchPage"])]),o.coupons.length?(r(),p("div",me,[e("table",he,[_e,e("tbody",be,[(r(!0),p(A,null,U(o.coupons,n=>(r(),p("tr",{key:n.id},[e("td",null,_(o.$calc.formatDate(n.due_date*1e3,"/")),1),e("td",null,[e("div",fe,[e("span",null,_(n.title),1),e("span",ge,_(n.code),1)])]),e("td",Ce,_(n.percent)+"％",1),e("td",ve,[e("div",$e,[e("input",{type:"checkbox",role:"switch",class:"form-check-input",checked:n.is_enabled,onChange:a=>o.switchCouponStatus(n)},null,40,ye)])]),e("td",we,[e("div",Ae,[e("button",{type:"button",class:"w-100 btn btn-outline-secondary",onClick:a=>c.openModal(n)}," 編輯",8,xe),e("button",{type:"button",class:"w-100 btn btn-outline-danger",onClick:a=>o.deleteCoupon(n)}," 刪除",8,Ve)])])]))),128))])])])):(r(),p("div",ke,"還沒有任何優惠券！趕快建立一個吧！")),u(v,{ref:"couponModal","temp-coupon":i.tempCoupon},null,8,["temp-coupon"])],64)}const Ye=V(de,[["render",Me]]);export{Ye as default};
