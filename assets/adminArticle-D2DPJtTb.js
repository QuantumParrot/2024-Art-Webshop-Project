import{a as s}from"./axios@1.6.7-Di5RpEPX.js";import{d as h}from"./pinia@2.1.7_vue@3.4.19-BGrtT45R.js";import{l as A,a as m}from"./alert-Dw2Xe9FX.js";var f={VITE_APP_SITE:"https://vue3-course-api.hexschool.io/v2",VITE_APP_PATH:"ataraxia",BASE_URL:"/2024-Art-Webshop-Project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_APP_SITE:l,VITE_APP_PATH:o}=f,i=A(),c=m(),$=h("adminArticle",{state:()=>({articles:[],categories:{網站公告:["營運通知","優惠活動","展覽資訊","資源分享","網站測試"],專欄文章:["藝術","歷史","地球","天文"],公益計劃:["海洋保育","野生動物救援","社會關懷"]}}),getters:{tags:({articles:t})=>{const e=[];return t.forEach(r=>r.tag.forEach((a,n)=>{n!==0&&!e.includes(a)&&e.push(a)})),e}},actions:{getArticles(){let t=[];i.createLoader("get-articles"),s.get(`${l}/api/${o}/admin/articles`).then(e=>{const{articles:r,pagination:a}=e.data;if(t=r,a.total_pages>1){const n=`${l}/api/${o}/admin/articles?page=`,p=[];for(let d=2;d<=a.total_pages;d+=1)p.push(s.get(`${n}${d}`));return Promise.all(p)}return!1}).then(e=>{Array.isArray(e)&&e.forEach(r=>t.push(...r.data.articles)),this.articles=t.toSorted((r,a)=>a.create_at-r.create_at)}).catch(e=>c.errorAlert(e)).finally(()=>i.removeLoader("get-articles"))},createArticle(t){i.createLoader("create-article"),s.post(`${l}/api/${o}/admin/article`,{data:t}).then(e=>{c.toastAlert(e.data.message,"success"),this.getArticles(),this.router.replace("/admin/article")}).catch(e=>c.errorAlert(e)).finally(()=>i.removeLoader("create-article"))},updateArticle(t){i.createLoader("update-article"),s.put(`${l}/api/${o}/admin/article/${t.id}`,{data:t}).then(e=>{c.toastAlert(e.data.message,"success"),this.getArticles(),this.router.replace("/admin/article")}).catch(e=>c.errorAlert(e)).finally(()=>i.removeLoader("update-article"))},deleteArticle(t,e){const r={title:"確定刪除文章？",text:`名稱：${e}`};c.checkAlert(r,()=>{i.createLoader("delete-article"),s.delete(`${l}/api/${o}/admin/article/${t}`).then(a=>{c.toastAlert(a.data.message,"success"),this.getArticles()}).catch(a=>c.errorAlert(a)).finally(()=>i.removeLoader("delete-article"))})}}});export{$ as a};
